<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Work+Sans:500,600" rel="stylesheet">
  
    <title>Сборка модуля &#8212; Документация odoo 13.0</title>
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/patchqueue.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script><link rel="canonical" href="" />
  
    <link rel="index" title="Алфавитный указатель" href="../genindex.html" />
    <link rel="search" title="Поиск" href="../search.html" />
    <link rel="next" title="Настройка веб-клиента" href="web.html" />
    <link rel="prev" title="Создание сайта" href="website.html" /> 
  </head><body><header class="o_main_header o_has_sub_nav o_inverted ">
<!-- 
    <div class="o_main_header_main">
      <a class="pull-left o_logo" href="/"></a>
      <a href="#" class="o_mobile_menu_toggle visible-xs-block pull-right">
        <span class="sr-only">Toggle navigation</span>
        <span class="mdi-navigation-menu"></span>
      </a>
      <div class="o_header_buttons">
        <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
      </div>
      <ul class="o_primary_nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Apps</a>
          <div class="dropdown-menu o_secondary_nav">
            <div class="container">
              <div class="row">
                <div class="col-sm-3 o_website_apps">
                  <div class="o_nav_app_family">
                    <span></span> Websites
                    <div>Build great user experience</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/website-builder">Website Builder</a></li>
                    <li><a href="https://www.odoo.com/page/e-commerce">eCommerce</a></li>
                    <li><a href="https://www.odoo.com/page/blog-engine">Blogs</a></li>
                    <li><a href="https://www.odoo.com/page/community-builder">Forums</a></li>
                    <li><a href="https://www.odoo.com/page/slides">Slides</a></li>
                    <li><a href="https://adspike.odoo.com">SEA</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_sale_apps">
                  <div class="o_nav_app_family">
                    <span></span> Sales
                    <div>Boost your success rate</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/sales">Sales</a></li>
                    <li><a href="https://www.odoo.com/page/crm">CRM</a></li>
                    <li><a href="https://www.odoo.com/page/billing">Invoicing</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Point of Sale</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/point-of-sale">Shops</a></li>
                        <li><a href="https://www.odoo.com/page/pos-restaurant">Restaurants</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/subscriptions">Subscriptions</a></li>
                    <li><a href="https://www.odoo.com/page/sign">Sign</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_operation_apps">
                  <div class="o_nav_app_family">
                    <span></span> Operations
                    <div>It's all about efficiency</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/accounting">Accounting</a></li>
                    <li><a href="https://www.odoo.com/page/project-management">Project</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Human Resources</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/recruitment">Recruitment</a></li>
                        <li><a href="https://www.odoo.com/page/employees">Employees</a></li>
                        <li><a href="https://www.odoo.com/page/expenses">Expenses</a></li>
                        <li><a href="https://www.odoo.com/page/appraisal">Appraisal</a></li>
                        <li><a href="https://www.odoo.com/page/fleet">Fleet</a></li>
                        <li><a href="https://www.odoo.com/page/leaves">Leaves</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/warehouse">Inventory</a></li>
                    <li><a href="https://www.odoo.com/page/purchase">Purchase</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Manufacturing</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/manufacturing">MRP</a></li>
                        <li><a href="https://www.odoo.com/page/plm">PLM</a></li>
                        <li><a href="https://www.odoo.com/page/maintenance">Maintenance</a></li>
                        <li><a href="https://www.odoo.com/page/quality">Quality</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-sm-3 o_productivity_apps">
                  <div class="o_nav_app_family">
                    <span></span> Productivity Tools
                    <div>Great Tools = Happy People</div>
                  </div>
                  <ul>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Communication</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/discuss">Discuss</a></li>
                        <li><a href="https://www.odoo.com/page/discuss-groups">Mailing Lists</a></li>
                        <li><a href="https://www.odoo.com/page/notes">Notes</a></li>
                        <li><a href="#">Help desk</a></li>
                        <li><a href="#">Appointment</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/timesheet">Timesheet</a></li>
                    <li><a href="https://www.odoo.com/page/email-marketing">Email Marketing</a></li>
                    <li><a href="https://www.odoo.com/page/events">Events</a></li>
                    <li><a href="https://www.odoo.com/page/survey">Survey</a></li>
                    <li><a href="https://www.odoo.com/page/live-chat">Live Chat</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <a href="http://www.odoo.com/apps/modules" class="o_store_link"><i class="fa fa-cube fa-fw"></i> Third party apps</a>
          </div>
        </li>
        <li><a href="https://www.odoo.com/page/tour">Tour</a></li>
        <li><a href="https://www.odoo.com/pricing">Pricing</a></li>
        <li><a href="https://www.odoo.com/page/docs">Docs</a></li>
      </ul>
    </div>
-->
    <nav class="navbar o_sub_nav">
      <div class="container">
        <div class="navbar-header visible-xs">
            <button type="button" class="navbar-toggle collapsed text-left btn-block" data-toggle="collapse" data-target="#o_sub-menu" aria-expanded="false">
              Navigate
              <span class="mdi-hardware-keyboard-arrow-down pull-right"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="o_sub-menu">
          <ol class="o_breadcrumb breadcrumb nav navbar-left">
              
              





    
        
            <li><a href="../index.html">Developer Doc</a></li>
        
    
    <li class="active"><a href="#">Сборка модуля</a></li>

              
          </ol>

          <div class="call-to-action navbar-right hidden-xs">
            <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
          </div>

          <ul class="navbar-nav navbar-right nav o_sub_nav_actions">
            
              <li class="divider"></li>
            

            
            


            
          </ul>

          <ul class="nav navbar-nav navbar-right">
            

            
            
<!--
<li><a href="https://www.odoo.com/documentation/user/13.0/index.html">User</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/index.html">Developer</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/setup/install.html">Installation</a></li>
<li><a href="https://odoo.com/slides">eLearning</a></li>
<li><a href="https://www.odoo.com/page/odoo-white-paper">White Papers</a></li>
<li><a href="https://www.odoo.com/page/legal">Legal</a></li>
-->
            

            
          </ul>
        </div>
      </div>
    </nav>
  </header><div id="wrap" class="">
    
    
    
    <figure class="card top has_banner">
      <span class="card-img" style="background-image: url('../_static/banners/build_a_module.jpg');"></span>
      <div class="container text-center">
        <h1> Сборка модуля </h1>
      </div>
    </figure>
    
    
    
      <main class="container ">
        
        <div class="o_content row">
          
          <aside>
            <div class="navbar-aside text-center">
              <ul class="nav list-group text-left"><li class="list-group-item"><a href="#start-stop-the-odoo-server" class="reference internal ripple">Запуск / остановка сервера Odoo</a></li><li class="list-group-item"><a href="#build-an-odoo-module" class="reference internal ripple">Создайте модуль Odoo</a><ul ><li class="list-group-item"><a href="#composition-of-a-module" class="reference internal ripple">Композиция модуля</a></li><li class="list-group-item"><a href="#module-structure" class="reference internal ripple">Модульная структура</a></li><li class="list-group-item"><a href="#object-relational-mapping" class="reference internal ripple">Объектно-реляционное отображение</a></li><li class="list-group-item"><a href="#model-fields" class="reference internal ripple">Модельные поля</a><ul ><li class="list-group-item"><a href="#common-attributes" class="reference internal ripple">Общие атрибуты</a></li><li class="list-group-item"><a href="#simple-fields" class="reference internal ripple">Простые поля</a></li><li class="list-group-item"><a href="#reserved-fields" class="reference internal ripple">Зарезервированные поля</a></li><li class="list-group-item"><a href="#special-fields" class="reference internal ripple">Специальные поля</a></li></ul></li><li class="list-group-item"><a href="#data-files" class="reference internal ripple">Дата файлы</a></li><li class="list-group-item"><a href="#actions-and-menus" class="reference internal ripple">Действия и меню</a></li></ul></li><li class="list-group-item"><a href="#basic-views" class="reference internal ripple">Основные виды</a><ul ><li class="list-group-item"><a href="#generic-view-declaration" class="reference internal ripple">Декларация общего вида</a></li><li class="list-group-item"><a href="#tree-views" class="reference internal ripple">Дерево просмотров</a></li><li class="list-group-item"><a href="#form-views" class="reference internal ripple">Представления формы</a></li><li class="list-group-item"><a href="#search-views" class="reference internal ripple">Поиск просмотров</a></li></ul></li><li class="list-group-item"><a href="#relations-between-models" class="reference internal ripple">Отношения между моделями</a><ul ><li class="list-group-item"><a href="#relational-fields" class="reference internal ripple">Реляционные поля</a></li></ul></li><li class="list-group-item"><a href="#inheritance" class="reference internal ripple">наследование</a><ul ><li class="list-group-item"><a href="#model-inheritance" class="reference internal ripple">Модель наследования</a></li><li class="list-group-item"><a href="#view-inheritance" class="reference internal ripple">Посмотреть наследство</a><ul ><li class="list-group-item"><a href="#domains" class="reference internal ripple">Домены</a></li></ul></li></ul></li><li class="list-group-item"><a href="#computed-fields-and-default-values" class="reference internal ripple">Вычисляемые поля и значения по умолчанию</a><ul ><li class="list-group-item"><a href="#dependencies" class="reference internal ripple">зависимости</a></li><li class="list-group-item"><a href="#default-values" class="reference internal ripple">Значения по умолчанию</a></li></ul></li><li class="list-group-item"><a href="#onchange" class="reference internal ripple">По изменению</a></li><li class="list-group-item"><a href="#model-constraints" class="reference internal ripple">Ограничения модели</a></li><li class="list-group-item"><a href="#advanced-views" class="reference internal ripple">Расширенные представления</a><ul ><li class="list-group-item"><a href="#id3" class="reference internal ripple">Дерево просмотров</a></li><li class="list-group-item"><a href="#calendars" class="reference internal ripple">Календари</a></li><li class="list-group-item"><a href="#id4" class="reference internal ripple">Поиск просмотров</a></li><li class="list-group-item"><a href="#gantt" class="reference internal ripple">Ганта</a></li><li class="list-group-item"><a href="#graph-views" class="reference internal ripple">Графические представления</a></li><li class="list-group-item"><a href="#kanban" class="reference internal ripple">Kanban</a></li></ul></li><li class="list-group-item"><a href="#security" class="reference internal ripple">Безопасность</a><ul ><li class="list-group-item"><a href="#group-based-access-control-mechanisms" class="reference internal ripple">Механизмы контроля доступа на основе групп</a></li><li class="list-group-item"><a href="#access-rights" class="reference internal ripple">Права доступа</a></li><li class="list-group-item"><a href="#record-rules" class="reference internal ripple">Правила записи</a></li></ul></li><li class="list-group-item"><a href="#wizards" class="reference internal ripple">Волшебники</a><ul ><li class="list-group-item"><a href="#launching-wizards" class="reference internal ripple">Запуск мастеров</a></li></ul></li><li class="list-group-item"><a href="#internationalization" class="reference internal ripple">интернационализация</a></li><li class="list-group-item"><a href="#reporting" class="reference internal ripple">Составление отчетов</a><ul ><li class="list-group-item"><a href="#printed-reports" class="reference internal ripple">Печатные отчеты</a></li><li class="list-group-item"><a href="#dashboards" class="reference internal ripple">Сводки</a></li></ul></li><li class="list-group-item"><a href="#webservices" class="reference internal ripple">WebServices</a><ul ><li class="list-group-item"><a href="#xml-rpc-library" class="reference internal ripple">Библиотека XML-RPC</a></li><li class="list-group-item"><a href="#json-rpc-library" class="reference internal ripple">Библиотека JSON-RPC</a></li></ul></li></ul>
              
              <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/13.0/doc/howtos/backend.rst" class="gith-link">
                  Edit on GitHub
              </a></p>
              
            </div>
          </aside>
          
          <article class="doc-body ">
            
            
  <section id="building-a-module"><i id="howto-module"></i><i id="howto-base"></i><div role="alert" class="alert alert-warning"><h3 class="alert-title">Предупреждение</h3><p >Этот учебник требует <a href="../setup/install.html#setup-install" class="alert-link reference internal"><span class="std std-ref">having installed Odoo</span></a></p></div></section><section id="start-stop-the-odoo-server"><h2 >Запуск / остановка сервера Odoo</h2><p >Odoo использует архитектуру клиент / сервер, в которой клиенты являются веб-браузерами, обращающимися к серверу Odoo через RPC.</p><p >Бизнес-логика и расширение обычно выполняются на стороне сервера, хотя к клиенту могут быть добавлены поддерживающие функции клиента (например, новое представление данных, такое как интерактивные карты).</p><p >Чтобы запустить сервер, просто вызовите команду :ref:<a href="#id1"><span id="id2" class="problematic">`</span></a>odoo-bin &lt;reference/cmdline&gt;`в оболочке, добавив полный путь к файлу, если необходимо:</p><div class="highlight-default bash code"><div class="highlight"><pre><span></span><span class="n">odoo</span><span class="o">-</span><span class="nb">bin</span>
</pre></div>
</div>
<p >Сервер останавливается двойным нажатием клавиши `` Ctrl-C`` с терминала или уничтожением соответствующего процесса ОС.</p></section><section id="build-an-odoo-module"><h2 >Создайте модуль Odoo</h2><p >Серверные и клиентские расширения упакованы как * модули <a href="#id1"><span id="id2" class="problematic">*</span></a>, которые могут быть загружены в * базу данных <a href="#id3"><span id="id4" class="problematic">*</span></a>.</p><p >Модули Odoo могут либо добавлять совершенно новую бизнес-логику в систему Odoo, либо изменять и расширять существующую бизнес-логику: можно создать модуль для добавления правил учета в вашей стране к общей поддержке учета Odoo, а в следующем модуле добавлена поддержка визуализации в реальном времени. автобусного парка.</p><p >Таким образом, все в Odoo начинается и заканчивается модулями.</p></section><section id="composition-of-a-module"><h3 >Композиция модуля</h3><p >Модуль Odoo может содержать несколько элементов:</p><dl ><dt >Бизнес объекты</dt><dd >Объявленные как классы Python, эти ресурсы автоматически сохраняются Odoo в зависимости от их конфигурации.</dd><dt ><a href="../reference/views.html#reference-views" class="reference internal"><span class="std std-ref">Object views</span></a></dt><dd >Определение отображения бизнес-объектов</dd><dt ><a href="../reference/data.html#reference-data" class="reference internal"><span class="std std-ref">Data files</span></a></dt><dd ><p >Файлы XML или CSV, объявляющие метаданные модели:</p><ul ><li >: Ссылка: <code >просмотров &lt;reference/views&gt; `или :ref:`views &lt;reference/views&gt;</code>,</li><li >данные конфигурации (параметризация модулей, <a href="../reference/security.html#reference-security" class="reference internal"><span class="std std-ref">security rules</span></a>),</li><li >демонстрационные данные</li><li >и более</li></ul></dd><dt ><a href="../reference/http.html#reference-controllers" class="reference internal"><span class="std std-ref">Web controllers</span></a></dt><dd >Обрабатывать запросы из веб-браузеров</dd><dt >Статические веб-данные</dt><dd >Изображения, CSS или файлы JavaScript, используемые веб-интерфейсом или веб-сайтом</dd></dl></section><section id="module-structure"><h3 >Модульная структура</h3><p >Каждый модуль является каталогом в каталоге * module <a href="#id1"><span id="id2" class="problematic">*</span></a>. Каталоги модулей указываются с помощью опции: option: <a href="#id3"><span id="id4" class="problematic">`</span></a>–addons-path &lt;odoo-bin –addons-path&gt; <a href="#id5"><span id="id6" class="problematic">`</span></a>вариант.</p><div role="alert" class="alert alert-info aphorism"><h3 class="alert-title">Совет</h3><p >большинство параметров командной строки также можно установить с помощью <a href="../reference/cmdline.html#reference-cmdline-config" class="alert-link reference internal"><span class="std std-ref">a configuration file</span></a></p></div><p >Модуль Odoo объявлен его <a href="../reference/module.html#reference-module-manifest" class="reference internal"><span class="std std-ref">manifest</span></a>. Смотрите документацию :ref:<a href="#id1"><span id="id2" class="problematic">`</span></a>manifest &lt;reference/module/manifest&gt;`об этом.</p><p >Модуль также является пакетом <a href="http://docs.python.org/2/tutorial/modules.html#packages" class="external reference">Python '</a> с файлом` <code >__init __. py`</code>, содержащим инструкции по импорту для различных файлов Python в модуле.</p><p >Например, если модуль имеет один файл `` mymodule.py``, `` __init __. Py`` может содержать</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">mymodule</span>
</pre></div>
</div>
<p >Odoo предоставляет механизм, помогающий настроить новый модуль :ref:<a href="#id1"><span id="id2" class="problematic">`</span></a>odoo-bin &lt;reference/cmdline/server&gt;`имеет подкоманду :ref:<a href="#id3"><span id="id4" class="problematic">`</span></a>odoo-bin &lt;reference/cmdline/server&gt;`создать пустой модуль:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> odoo-bin scaffold &lt;module name&gt; &lt;where to put it&gt;
</pre></div>
</div>
<p >Команда создает подкаталог для вашего модуля и автоматически создает набор стандартных файлов для модуля. Большинство из них просто содержат закомментированный код или XML. Использование большинства из этих файлов будет объяснено в этом руководстве.</p><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Создание модуля</p><p >Используйте командную строку выше, чтобы создать пустой модуль Open Academy и установить его в Odoo.</p><ol ><li >Вызвать команду `` odoo-bin scaffold openacademy addons``.</li><li >Адаптируйте файл манифеста к вашему модулю.</li><li >Не беспокойтесь о других файлах.</li></ol><div class="pq-patch"><em >openacademy/__manifest__.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll">    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Open Academy&quot;</span><span class="p">,</span>
</span><span class="hll">
</span><span class="hll">    <span class="s1">&#39;summary&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;Manage trainings&quot;&quot;&quot;</span><span class="p">,</span>
</span><span class="hll">
</span><span class="hll">    <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="s2">        Open Academy module for managing trainings:</span>
</span><span class="hll"><span class="s2">            - training courses</span>
</span><span class="hll"><span class="s2">            - training sessions</span>
</span><span class="hll"><span class="s2">            - attendees registration</span>
</span><span class="hll"><span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
</span><span class="hll">
</span><span class="hll">    <span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="s2">&quot;My Company&quot;</span><span class="p">,</span>
</span><span class="hll">    <span class="s1">&#39;website&#39;</span><span class="p">:</span> <span class="s2">&quot;http://www.yourcompany.com&quot;</span><span class="p">,</span>
</span><span class="hll">
</span><span class="hll">    <span class="c1"># Categories can be used to filter modules in modules listing</span>
</span><span class="hll">    <span class="c1"># Check https://github.com/odoo/odoo/blob/13.0/odoo/addons/base/data/ir_module_category_data.xml</span>
</span><span class="hll">    <span class="c1"># for the full list</span>
</span><span class="hll">    <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span>
</span><span class="hll">    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;0.1&#39;</span><span class="p">,</span>
</span><span class="hll">
</span><span class="hll">    <span class="c1"># any module necessary for this one to work correctly</span>
</span><span class="hll">    <span class="s1">&#39;depends&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">],</span>
</span><span class="hll">
</span><span class="hll">    <span class="c1"># always loaded</span>
</span><span class="hll">    <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="hll">        <span class="c1"># &#39;security/ir.model.access.csv&#39;,</span>
</span><span class="hll">        <span class="s1">&#39;templates.xml&#39;</span><span class="p">,</span>
</span><span class="hll">    <span class="p">],</span>
</span><span class="hll">    <span class="c1"># only loaded in demonstration mode</span>
</span><span class="hll">    <span class="s1">&#39;demo&#39;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="hll">        <span class="s1">&#39;demo.xml&#39;</span><span class="p">,</span>
</span><span class="hll">    <span class="p">],</span>
</span><span class="hll"><span class="p">}</span>
</span></pre></div>
</div>
</div><em >openacademy/__init__.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">controllers</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">models</span>
</span></pre></div>
</div>
</div><em >openacademy/controllers.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">http</span>
</span><span class="hll">
</span><span class="hll"><span class="c1"># class Openacademy(http.Controller):</span>
</span><span class="hll"><span class="c1">#     @http.route(&#39;/openacademy/openacademy/&#39;, auth=&#39;public&#39;)</span>
</span><span class="hll"><span class="c1">#     def index(self, **kw):</span>
</span><span class="hll"><span class="c1">#         return &quot;Hello, world&quot;</span>
</span><span class="hll">
</span><span class="hll"><span class="c1">#     @http.route(&#39;/openacademy/openacademy/objects/&#39;, auth=&#39;public&#39;)</span>
</span><span class="hll"><span class="c1">#     def list(self, **kw):</span>
</span><span class="hll"><span class="c1">#         return http.request.render(&#39;openacademy.listing&#39;, {</span>
</span><span class="hll"><span class="c1">#             &#39;root&#39;: &#39;/openacademy/openacademy&#39;,</span>
</span><span class="hll"><span class="c1">#             &#39;objects&#39;: http.request.env[&#39;openacademy.openacademy&#39;].search([]),</span>
</span><span class="hll"><span class="c1">#         })</span>
</span><span class="hll">
</span><span class="hll"><span class="c1">#     @http.route(&#39;/openacademy/openacademy/objects/&lt;model(&quot;openacademy.openacademy&quot;):obj&gt;/&#39;, auth=&#39;public&#39;)</span>
</span><span class="hll"><span class="c1">#     def object(self, obj, **kw):</span>
</span><span class="hll"><span class="c1">#         return http.request.render(&#39;openacademy.object&#39;, {</span>
</span><span class="hll"><span class="c1">#             &#39;object&#39;: obj</span>
</span><span class="hll"><span class="c1">#         })</span>
</span></pre></div>
</div>
</div><em >openacademy/demo.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="hll"><span class="nt">&lt;odoo&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="c">&lt;!--  --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;record id=&quot;object0&quot; model=&quot;openacademy.openacademy&quot;&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;field name=&quot;name&quot;&gt;Object 0&lt;/field&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;/record&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--  --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;record id=&quot;object1&quot; model=&quot;openacademy.openacademy&quot;&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;field name=&quot;name&quot;&gt;Object 1&lt;/field&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;/record&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--  --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;record id=&quot;object2&quot; model=&quot;openacademy.openacademy&quot;&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;field name=&quot;name&quot;&gt;Object 2&lt;/field&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;/record&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--  --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;record id=&quot;object3&quot; model=&quot;openacademy.openacademy&quot;&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;field name=&quot;name&quot;&gt;Object 3&lt;/field&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;/record&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--  --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;record id=&quot;object4&quot; model=&quot;openacademy.openacademy&quot;&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;field name=&quot;name&quot;&gt;Object 4&lt;/field&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;/record&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--  --&gt;</span>
</span><span class="hll">
</span><span class="hll"><span class="nt">&lt;/odoo&gt;</span>
</span></pre></div>
</div>
</div><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span class="hll">
</span><span class="hll"><span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span>
</span><span class="hll">
</span><span class="hll"><span class="c1"># class openacademy(models.Model):</span>
</span><span class="hll"><span class="c1">#     _name = &#39;openacademy.openacademy&#39;</span>
</span><span class="hll">
</span><span class="hll"><span class="c1">#     name = fields.Char()</span>
</span></pre></div>
</div>
</div><em >openacademy/security/ir.model.access.csv</em><div class="pq-section"><div class="highlight-guess"><div class="highlight"><pre><span></span><span class="hll"><span class="err">id,name,model_id/id,group_id/id,perm_read,perm_write,perm_create,perm_unlink</span>
</span><span class="hll"><span class="err">access_openacademy_openacademy,openacademy.openacademy,model_openacademy_openacademy,,1,0,0,0</span>
</span></pre></div>
</div>
</div><em >openacademy/templates.xml</em><div class="pq-section"><div class="highlight-xml+django"><div class="highlight"><pre><span></span><span class="hll"><span class="nt">&lt;odoo&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="c">&lt;!-- &lt;template id=&quot;listing&quot;&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;ul&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;li t-foreach=&quot;objects&quot; t-as=&quot;object&quot;&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--       &lt;a t-attf-href=&quot;</span><span class="cp">{{</span> <span class="nv">root</span> <span class="cp">}}</span><span class="c">/objects/</span><span class="cp">{{</span> <span class="nv">object.id</span> <span class="cp">}}</span><span class="c">&quot;&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--         &lt;t t-esc=&quot;object.display_name&quot;/&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--       &lt;/a&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;/li&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;/ul&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- &lt;/template&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- &lt;template id=&quot;object&quot;&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;h1&gt;&lt;t t-esc=&quot;object.display_name&quot;/&gt;&lt;/h1&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;dl&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;t t-foreach=&quot;object._fields&quot; t-as=&quot;field&quot;&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--       &lt;dt&gt;&lt;t t-esc=&quot;field&quot;/&gt;&lt;/dt&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--       &lt;dd&gt;&lt;t t-esc=&quot;object[field]&quot;/&gt;&lt;/dd&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;/t&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;/dl&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- &lt;/template&gt; --&gt;</span>
</span><span class="hll">
</span><span class="hll"><span class="nt">&lt;/odoo&gt;</span>
</span></pre></div>
</div>
</div></div></div></section><section id="object-relational-mapping"><h3 >Объектно-реляционное отображение</h3><p >Ключевым компонентом Odoo является слой: abbr: <code >ORM (Object-Relational Mapping)</code>. Этот уровень позволяет избежать необходимости писать большинство: abbr: <code >SQL (язык структурированных запросов)</code> вручную и предоставляет службы расширяемости и безопасности [#rawsql] _.</p><p >Бизнес-объекты объявляются как классы Python, расширяющие <a href="../reference/orm.html#odoo.models.Model" title="odoo.models.Model" class="reference internal"><code class="xref py py-class">Model</code></a>, который интегрирует их в автоматизированную систему персистентности.</p><p >Модели могут быть настроены путем установки ряда атрибутов при их определении. Наиболее важный атрибут: attr: <code >~ odoo.models.Model._name</code>, который является обязательным и определяет имя модели в системе Odoo. Вот минимально полное определение модели:</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">models</span>
<span class="k">class</span> <span class="nc">MinimalModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test.model&#39;</span>
</pre></div>
</div>
</section><section id="model-fields"><h3 >Модельные поля</h3><p >Поля используются для определения того, что модель может хранить и где. Поля определяются как атрибуты в классе модели:</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span>

<span class="k">class</span> <span class="nc">LessMinimalModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test.model2&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
</pre></div>
</div>
</section><section id="common-attributes"><h4 >Общие атрибуты</h4><p >Как и сама модель, ее поля можно настроить, передав атрибуты конфигурации в качестве параметров:</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p >Некоторые атрибуты доступны во всех полях, вот наиболее распространенные:</p><dl ><dt >: attr: <code >~ odoo.fields.Field.string</code> (` <code >unicode`</code>, по умолчанию: имя поля)</dt><dd >Метка поля в пользовательском интерфейсе (видимая пользователями).</dd><dt >: attr: <code >~ odoo.fields.Field.required</code> (` <code >bool`</code>, по умолчанию:` <code >False`</code>)</dt><dd >Если `` True``, поле не может быть пустым, оно должно либо иметь значение по умолчанию, либо всегда иметь значение при создании записи.</dd><dt >: attr: <code >~ odoo.fields.Field.help</code> (` <code >unicode`</code>, по умолчанию:` <code >&amp;#39;&amp;#39;</code> <a href="#id1"><span id="id2" class="problematic">`</span></a>)</dt><dd >Подробно, предоставляет подсказку для пользователей в пользовательском интерфейсе.</dd><dt >: attr: <code >~ odoo.fields.Field.index</code> (` <code >bool`</code>, по умолчанию:` <code >False`</code>)</dt><dd >Просит, чтобы Odoo создал <a href="http://use-the-index-luke.com/sql/preface" class="external reference">индекс базы данных</a> для столбца.</dd></dl></section><section id="simple-fields"><h4 >Простые поля</h4><p >Существует две широкие категории полей: «простые» поля, которые представляют собой атомарные значения, хранящиеся непосредственно в таблице модели, и «реляционные» поля, связывающие записи (одной и той же модели или разных моделей).</p><p >Примеры простых полей <a href="../reference/orm.html#odoo.fields.Boolean" title="odoo.fields.Boolean" class="reference internal"><code class="xref py py-class">Boolean</code></a>, <a href="../reference/orm.html#odoo.fields.Boolean" title="odoo.fields.Boolean" class="reference internal"><code class="xref py py-class">Boolean</code></a>, <a href="../reference/orm.html#odoo.fields.Boolean" title="odoo.fields.Boolean" class="reference internal"><code class="xref py py-class">Boolean</code></a>.</p></section><section id="reserved-fields"><h4 >Зарезервированные поля</h4><p >Odoo создает несколько полей во всех моделях [#autofields] _. Эти поля управляются системой и не должны быть записаны. Их можно прочитать, если они полезны или необходимы:</p><dl ><dt >: attr: <code >~ odoo.fields.Model.id</code> ( <code class="xref py py-class">Id</code>)</dt><dd >Уникальный идентификатор записи в ее модели.</dd><dt >: attr: <code >~ odoo.fields.Model.create_date</code> ( <a href="../reference/orm.html#odoo.fields.Datetime" title="odoo.fields.Datetime" class="reference internal"><code class="xref py py-class">Datetime</code></a>)</dt><dd >Дата создания записи.</dd><dt >: attr: <code >~ odoo.fields.Model.create_uid</code> ( <a href="../reference/orm.html#odoo.fields.Many2one" title="odoo.fields.Many2one" class="reference internal"><code class="xref py py-class">Many2one</code></a>)</dt><dd >Пользователь, который создал запись.</dd><dt >: attr: <code >~ odoo.fields.Model.write_date</code> ( <a href="../reference/orm.html#odoo.fields.Datetime" title="odoo.fields.Datetime" class="reference internal"><code class="xref py py-class">Datetime</code></a>)</dt><dd >Дата последнего изменения записи.</dd><dt >: attr: <code >~ odoo.fields.Model.write_uid</code> ( <a href="../reference/orm.html#odoo.fields.Many2one" title="odoo.fields.Many2one" class="reference internal"><code class="xref py py-class">Many2one</code></a>)</dt><dd >пользователь, который последним изменил запись.</dd></dl></section><section id="special-fields"><h4 >Специальные поля</h4><p >По умолчанию Odoo также требует поле `` name`` во всех моделях для различных режимов отображения и поиска. Поле, используемое для этих целей, может быть переопределено установкой: attr: <code >~ odoo.models.Model._rec_name</code>.</p><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Определить модель</p><p >Определите новую модель данных * Course * в модуле * openacademy <a href="#id1"><span id="id2" class="problematic">*</span></a>. Курс имеет название и описание. Курсы должны иметь название.</p><p >Отредактируйте файл `` openacademy / models / models.py``, чтобы включить класс * Course <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span>
<span class="hll">
</span><span class="hll"><span class="k">class</span> <span class="nc">Course</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="hll">    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;openacademy.course&#39;</span>
</span>    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;OpenAcademy Courses&quot;</span>
<span class="hll">
</span><span class="hll">    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Title&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span>    <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">()</span>
</pre></div>
</div>
</div></div></div></section><section id="data-files"><h3 >Дата файлы</h3><p >Odoo - система с высокой степенью обработки данных. Хотя поведение настраивается с использованием кода <a href="http://python.org" class="external reference">Python</a>, часть значения модуля находится в данных, которые он устанавливает при загрузке.</p><div role="alert" class="alert alert-info aphorism"><h3 class="alert-title">Совет</h3><p >некоторые модули существуют исключительно для добавления данных в Odoo</p></div><p >Данные модуля объявляются через <a href="../reference/data.html#reference-data" class="reference internal"><span class="std std-ref">data files</span></a>, Файлы XML с` ` &lt;record&gt; Создавать элементы. Каждый `` &lt;record&gt; `` элемент создает или обновляет запись в базе данных.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;odoo&gt;</span>

        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;{model name}&quot;</span> <span class="na">id=</span><span class="s">&quot;{record identifier}&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;{a field name}&quot;</span><span class="nt">&gt;</span>{a value}<span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;/odoo&gt;</span>
</pre></div>
</div>
<ul ><li >`` model`` - название модели Odoo для записи.</li><li >`` id`` - это: term: <code >external identifier</code>, он позволяет ссылаться на запись (без необходимости знать ее идентификатор в базе данных).</li><li >`` &lt;field&gt; `` элементы имеют `` name``, которое является именем поля в модели (например, `` description``). Их тело является ценностью поля.</li></ul><p >Файлы данных должны быть объявлены в файле манифеста для загрузки, они могут быть объявлены в списке `` 'data'`` (всегда загружен) или в списке <code >&amp;#39; demo&amp;#39;</code> (загружается только в демонстрационном режиме) ,</p><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Определить демонстрационные данные</p><p >Создайте демонстрационные данные, заполнив модель * Courses * несколькими демонстрационными курсами.</p><p >Отредактируйте файл `` openacademy / demo / demo.xml`` для включения некоторых данных.</p><div class="pq-patch"><em >openacademy/demo.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;odoo&gt;</span>

<span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;openacademy.course&quot;</span> <span class="na">id=</span><span class="s">&quot;course0&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Course 0<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span><span class="nt">&gt;</span>Course 0&#39;s description
</span><span class="hll">
</span><span class="hll">Can have multiple lines
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;openacademy.course&quot;</span> <span class="na">id=</span><span class="s">&quot;course1&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Course 1<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="c">&lt;!-- no description for this one --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;openacademy.course&quot;</span> <span class="na">id=</span><span class="s">&quot;course2&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Course 2<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span><span class="nt">&gt;</span>Course 2&#39;s description<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span>
<span class="nt">&lt;/odoo&gt;</span>
</pre></div>
</div>
</div></div></div><div role="alert" class="alert alert-info"><h3 class="alert-title">Совет</h3><p >Содержимое файлов данных загружается только тогда, когда модуль установлен или обновлен.</p><p >После внесения некоторых изменений не забудьте использовать :ref:<a href="#id1"><span id="id2" class="problematic">`</span></a>odoo-bin -u openacademy &lt;reference/cmdline&gt;`чтобы сохранить изменения в вашей базе данных.</p></div></section><section id="actions-and-menus"><h3 >Действия и меню</h3><p >Действия и меню - это обычные записи в базе данных, которые обычно объявляются через файлы данных. Действия могут быть вызваны тремя способами:</p><ol ><li >нажав на пункты меню (связанные с конкретными действиями)</li><li >нажав на кнопки в представлениях (если они связаны с действиями)</li><li >как контекстные действия на объекте</li></ol><p >Поскольку меню несколько сложны, чтобы объявить, что есть `` &lt;menuitem&gt; `` ярлык для объявления `` ir.ui.menu`` и более простого подключения к соответствующему действию.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span> <span class="na">id=</span><span class="s">&quot;action_list_ideas&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Ideas<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>idea.idea<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
<span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;menu_ideas&quot;</span> <span class="na">parent=</span><span class="s">&quot;menu_root&quot;</span> <span class="na">name=</span><span class="s">&quot;Ideas&quot;</span> <span class="na">sequence=</span><span class="s">&quot;10&quot;</span>
          <span class="na">action=</span><span class="s">&quot;action_list_ideas&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert alert-danger aphorism"><h3 class="alert-title">Опасно</h3><p >Действие должно быть объявлено перед соответствующим меню в файле XML.</p><p >Файлы данных выполняются последовательно, перед созданием меню в базе данных должен присутствовать `` id` действия.</p></div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Определить новые пункты меню</p><p >Определите новые пункты меню для доступа к курсам в пункте меню OpenAcademy. Пользователь должен иметь возможность:</p><ul ><li >отобразить список всех курсов</li><li >создавать / изменять курсы</li></ul><ol ><li >Создайте `` openacademy / views / openacademy.xml`` с действием и меню, запускающими действие</li><li >Добавьте его в список `` data`` `` openacademy / __ manifest __. Py``</li></ol><div class="pq-patch"><em >openacademy/__manifest__.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1"># &#39;security/ir.model.access.csv&#39;,</span>
        <span class="s1">&#39;templates.xml&#39;</span><span class="p">,</span>
<span class="hll">        <span class="s1">&#39;views/openacademy.xml&#39;</span><span class="p">,</span>
</span>    <span class="p">],</span>
    <span class="c1"># only loaded in demonstration mode</span>
    <span class="s1">&#39;demo&#39;</span><span class="p">:</span> <span class="p">[</span>
</pre></div>
</div>
</div><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="hll"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class="hll"><span class="nt">&lt;odoo&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="c">&lt;!-- window action --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--</span>
</span><span class="hll"><span class="c">            The following tag is an action definition for a &quot;window action&quot;,</span>
</span><span class="hll"><span class="c">            that is an action opening a view or a set of views</span>
</span><span class="hll"><span class="c">        --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span> <span class="na">id=</span><span class="s">&quot;course_list_action&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Courses<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>openacademy.course<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;help&quot;</span> <span class="na">type=</span><span class="s">&quot;html&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;o_view_nocontent_smiling_face&quot;</span><span class="nt">&gt;</span>Create the first course
</span><span class="hll">                <span class="nt">&lt;/p&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="c">&lt;!-- top level menu: no parent --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;main_openacademy_menu&quot;</span> <span class="na">name=</span><span class="s">&quot;Open Academy&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- A first level in the left side menu is needed</span>
</span><span class="hll"><span class="c">             before using action= attribute --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;openacademy_menu&quot;</span> <span class="na">name=</span><span class="s">&quot;Open Academy&quot;</span>
</span><span class="hll">                  <span class="na">parent=</span><span class="s">&quot;main_openacademy_menu&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- the following menuitem should appear *after*</span>
</span><span class="hll"><span class="c">             its parent openacademy_menu and *after* its</span>
</span><span class="hll"><span class="c">             action course_list_action --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;courses_menu&quot;</span> <span class="na">name=</span><span class="s">&quot;Courses&quot;</span> <span class="na">parent=</span><span class="s">&quot;openacademy_menu&quot;</span>
</span><span class="hll">                  <span class="na">action=</span><span class="s">&quot;course_list_action&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- Full id location:</span>
</span><span class="hll"><span class="c">             action=&quot;openacademy.course_list_action&quot;</span>
</span><span class="hll"><span class="c">             It is not required when it is the same module --&gt;</span>
</span><span class="hll">
</span><span class="hll"><span class="nt">&lt;/odoo&gt;</span>
</span></pre></div>
</div>
</div></div></div></section><section id="basic-views"><h2 >Основные виды</h2><p >Представления определяют способ отображения записей модели. Каждый тип представления представляет режим визуализации (список записей, график их агрегации и т. Д.). Представления могут быть запрошены либо по типу (например, * список партнеров <a href="#id1"><span id="id2" class="problematic">*</span></a>), либо по их идентификатору. Для общих запросов будет использоваться представление с правильным типом и самым низким приоритетом (поэтому представление с самым низким приоритетом каждого типа является представлением по умолчанию для этого типа).</p><p ><a href="../reference/views.html#reference-views-inheritance" class="reference internal"><span class="std std-ref">View inheritance</span></a> allows altering views
declared elsewhere (adding or removing content).</p></section><section id="generic-view-declaration"><h3 >Декларация общего вида</h3><p >Представление объявляется как запись модели `` ir.ui.view``. Тип представления подразумевается корневым элементом поля `` arch``:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;view_id&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>view.name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>object_name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;priority&quot;</span> <span class="na">eval=</span><span class="s">&quot;16&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- view content: &lt;form&gt;, &lt;tree&gt;, &lt;graph&gt;, ... --&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert alert-danger aphorism"><h3 class="alert-title">Опасно</h3><p >Содержимое представления - XML.</p><p >Поле `` arch`` должно быть объявлено как `` type = <code >xml</code> `` для правильного анализа.</p></div></section><section id="tree-views"><h3 >Дерево просмотров</h3><p >Древовидные представления, также называемые представлениями списка, отображают записи в табличной форме.</p><p >Их корневой элемент `` &lt;tree&gt; <a href="#id1"><span id="id2" class="problematic">``</span></a>. Простейшая форма представления дерева просто перечисляет все поля для отображения в таблице (каждое поле в виде столбца):</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">&quot;Idea list&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/tree&gt;</span>
</pre></div>
</div>
</section><section id="form-views"><h3 >Представления формы</h3><p >Формы используются для создания и редактирования отдельных записей.</p><p >Их корневой элемент `` &lt;form&gt; <a href="#id1"><span id="id2" class="problematic">``</span></a>. Они состоят из элементов структуры высокого уровня (группы, записные книжки) и интерактивных элементов (кнопки и поля):</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">&quot;Idea form&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span> <span class="na">col=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;separator</span> <span class="na">string=</span><span class="s">&quot;General stuff&quot;</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/group&gt;</span>

        <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span> <span class="na">col=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;separator</span> <span class="na">string=</span><span class="s">&quot;Dates&quot;</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;active&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;invent_date&quot;</span> <span class="na">readonly=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/group&gt;</span>

        <span class="nt">&lt;notebook</span> <span class="na">colspan=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">&quot;Description&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">nolabel=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/page&gt;</span>
        <span class="nt">&lt;/notebook&gt;</span>

        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;state&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/group&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Настройте представление формы, используя XML</p><p >Создайте свой собственный вид формы для объекта курса. Данные должны отображаться: название и описание курса.</p><div class="pq-patch"><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;odoo&gt;</span>

<span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;course_form_view&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>course.form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>openacademy.course<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">&quot;Course Form&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;sheet&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;group&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;/group&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/sheet&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/form&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span>        <span class="c">&lt;!-- window action --&gt;</span>
        <span class="c">&lt;!--</span>
<span class="c">            The following tag is an action definition for a &quot;window action&quot;,</span>
</pre></div>
</div>
</div></div></div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Ноутбуки</p><p >В представлении формы «Курс» поместите поле описания под вкладкой, чтобы позже было легче добавить другие вкладки, содержащие дополнительную информацию.</p><p >Измените представление формы курса следующим образом:</p><div class="pq-patch"><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span>                    <span class="nt">&lt;sheet&gt;</span>
                        <span class="nt">&lt;group&gt;</span>
                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
                        <span class="nt">&lt;/group&gt;</span>
<span class="hll">                        <span class="nt">&lt;notebook&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">&quot;Description&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;/page&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">&quot;About&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                                This is an example of notebooks
</span><span class="hll">                            <span class="nt">&lt;/page&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;/notebook&gt;</span>
</span>                    <span class="nt">&lt;/sheet&gt;</span>
                <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/field&gt;</span>
</pre></div>
</div>
</div></div></div><p >Представления формы также могут использовать обычный HTML для более гибких макетов:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">&quot;Idea Form&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;header&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">string=</span><span class="s">&quot;Confirm&quot;</span> <span class="na">type=</span><span class="s">&quot;object&quot;</span> <span class="na">name=</span><span class="s">&quot;action_confirm&quot;</span>
                <span class="na">states=</span><span class="s">&quot;draft&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_highlight&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">string=</span><span class="s">&quot;Mark as done&quot;</span> <span class="na">type=</span><span class="s">&quot;object&quot;</span> <span class="na">name=</span><span class="s">&quot;action_done&quot;</span>
                <span class="na">states=</span><span class="s">&quot;confirmed&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_highlight&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">string=</span><span class="s">&quot;Reset to draft&quot;</span> <span class="na">type=</span><span class="s">&quot;object&quot;</span> <span class="na">name=</span><span class="s">&quot;action_draft&quot;</span>
                <span class="na">states=</span><span class="s">&quot;confirmed,done&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;state&quot;</span> <span class="na">widget=</span><span class="s">&quot;statusbar&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;sheet&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_title&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;name&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_edit_only&quot;</span> <span class="na">string=</span><span class="s">&quot;Idea Name&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;h1&gt;&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="nt">/&gt;&lt;/h1&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;separator</span> <span class="na">string=</span><span class="s">&quot;General&quot;</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span> <span class="na">col=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Idea description...&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/group&gt;</span>
    <span class="nt">&lt;/sheet&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
</section><section id="search-views"><h3 >Поиск просмотров</h3><p >Представления поиска настраивают поле поиска, связанное с представлением списка (и другими агрегированными представлениями). Их корневой элемент `` &lt;search&gt; `` и они состоят из полей, определяющих, по каким полям можно искать:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;search&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/search&gt;</span>
</pre></div>
</div>
<p >Если для модели не существует вида поиска, Odoo генерирует вид, который позволяет выполнять поиск только в поле `` name``.</p><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Поиск курсов</p><p >Разрешить поиск курсов на основе их названия или их описания.</p><div class="pq-patch"><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span>            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>

<span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;course_search_view&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>course.search<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>openacademy.course<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;search&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/search&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span>        <span class="c">&lt;!-- window action --&gt;</span>
        <span class="c">&lt;!--</span>
<span class="c">            The following tag is an action definition for a &quot;window action&quot;,</span>
</pre></div>
</div>
</div></div></div></section><section id="relations-between-models"><h2 >Отношения между моделями</h2><p >Запись из модели может быть связана с записью из другой модели. Например, запись заказа на продажу связана с записью клиента, которая содержит данные клиента; это также связано с записями строки заказа на продажу.</p><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Создать модель сеанса</p><p >Для модуля Open Academy мы рассмотрим модель для * сессий <a href="#id1"><span id="id2" class="problematic">*</span></a>: сессия - это появление курса, преподаваемого в данное время для данной аудитории.</p><p >Создайте модель для * сессий <a href="#id1"><span id="id2" class="problematic">*</span></a>. Сессия имеет имя, дату начала, продолжительность и количество мест. Добавьте действие и пункт меню для их отображения. Сделайте новую модель видимой через пункт меню.</p><ol ><li >Создайте класс * Session * в `` openacademy / models / models.py``.</li><li >Добавьте доступ к объекту сеанса в `` openacademy / view / openacademy.xml``.</li></ol><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Title&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="hll">    <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">()</span>
</span><span class="hll">
</span><span class="hll">
</span><span class="hll"><span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="hll">    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;openacademy.session&#39;</span>
</span><span class="hll">    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;OpenAcademy Sessions&quot;</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="hll">    <span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">()</span>
</span><span class="hll">    <span class="n">duration</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Duration in days&quot;</span><span class="p">)</span>
</span>    <span class="n">seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Number of seats&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span>             action=&quot;openacademy.course_list_action&quot;
             It is not required when it is the same module --&gt;

<span class="hll">        <span class="c">&lt;!-- session form view --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;session_form_view&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>session.form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">&quot;Session Form&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;sheet&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;group&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;start_date&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;duration&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;seats&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;/group&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/sheet&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/form&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span> <span class="na">id=</span><span class="s">&quot;session_list_action&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Sessions<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;session_menu&quot;</span> <span class="na">name=</span><span class="s">&quot;Sessions&quot;</span>
</span><span class="hll">                  <span class="na">parent=</span><span class="s">&quot;openacademy_menu&quot;</span>
</span><span class="hll">                  <span class="na">action=</span><span class="s">&quot;session_list_action&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">
</span><span class="nt">&lt;/odoo&gt;</span>
</pre></div>
</div>
</div></div><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >`` digits = (6, 2) `` определяет точность числа с плавающей запятой: 6 - общее количество цифр, а 2 - количество цифр после запятой. Обратите внимание, что в результате число цифр до запятой не превышает 4</p></div></div></section><section id="relational-fields"><h3 >Реляционные поля</h3><p >Реляционные поля связывают записи либо одной модели (иерархии), либо разных моделей.</p><p >Типы реляционных полей:</p><dl ><dt ><a href="../reference/orm.html#odoo.fields.Many2one" title="odoo.fields.Many2one" class="reference internal"><code class="xref py py-class">Many2one(other_model, ondelete='set null')</code></a></dt><dd ><p >Простая ссылка на другой объект:</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="n">foo</span><span class="o">.</span><span class="n">other_id</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<div role="alert" class="alert alert-go_to"><h3 class="alert-title">См.также</h3><p ><a href="http://www.postgresql.org/docs/9.3/static/tutorial-fk.html" class="external reference alert-link">внешние ключи</a></p></div></dd><dt ><a href="../reference/orm.html#odoo.fields.One2many" title="odoo.fields.One2many" class="reference internal"><code class="xref py py-class">One2many(other_model, related_field)</code></a></dt><dd ><p >Виртуальное отношение, обратное классу <a href="../reference/orm.html#odoo.fields.Many2one" title="odoo.fields.Many2one" class="reference internal"><code class="xref py py-class">Many2one</code></a>. A <a href="../reference/orm.html#odoo.fields.Many2one" title="odoo.fields.Many2one" class="reference internal"><code class="xref py py-class">Many2one</code></a> ведет себя как контейнер записей, доступ к нему приводит к (возможно, пустому) набору записей</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">foo</span><span class="o">.</span><span class="n">other_ids</span><span class="p">:</span>
    <span class="nb">print</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<div role="alert" class="alert alert-danger"><h3 class="alert-title">Опасно</h3><p >Поскольку <a href="../reference/orm.html#odoo.fields.One2many" title="odoo.fields.One2many" class="alert-link reference internal"><code class="xref py py-class">One2many</code></a> является виртуальным отношением, в поле: samp:` {other_model} <code >и его имени должно быть * поле * :class:`~odoo.fields.One2many</code> * должно * быть: samp: <code >{related_field}</code></p></div></dd><dt >: Класс: <a href="#id1"><span id="id2" class="problematic">`</span></a>Many2many (other_model) &lt;odoo.fields.Many2many&gt; `</dt><dd ><p >Двунаправленная множественная связь, любая запись на одной стороне может быть связана с любым количеством записей на другой стороне. Ведет себя как контейнер записей, доступ к нему также приводит к возможно пустому набору записей:</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">foo</span><span class="o">.</span><span class="n">other_ids</span><span class="p">:</span>
    <span class="nb">print</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</dd></dl><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Many2one отношения</p><p >Используя many2one, измените модели * Course * и * Session <a href="#id1"><span id="id2" class="problematic">*</span></a>, чтобы отразить их связь с другими моделями:</p><ul ><li >У курса есть * ответственный * пользователь; значение этого поля является записью встроенной модели `` res.users``.</li><li >Сессия имеет * инструктор <a href="#id1"><span id="id2" class="problematic">*</span></a>; значение этого поля является записью встроенной модели `` res.partner``.</li><li >Сессия связана с * курсом <a href="#id1"><span id="id2" class="problematic">*</span></a>; значение этого поля является записью модели `` openacademy.course`` и является обязательным.</li><li >Адаптируйте взгляды.</li></ul><ol ><li >Добавьте соответствующие поля `` Many2one`` к моделям и</li><li >добавить их в представлениях.</li></ol><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Title&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">()</span>

<span class="hll">    <span class="n">responsible_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;set null&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Responsible&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="hll">
</span>
<span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;openacademy.session&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">()</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Duration in days&quot;</span><span class="p">)</span>
    <span class="n">seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Number of seats&quot;</span><span class="p">)</span>
<span class="hll">
</span><span class="hll">    <span class="n">instructor_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Instructor&quot;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">course_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;openacademy.course&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Course&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>
</div>
</div><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span>                    <span class="nt">&lt;sheet&gt;</span>
                        <span class="nt">&lt;group&gt;</span>
                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
<span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;responsible_id&quot;</span><span class="nt">/&gt;</span>
</span>                        <span class="nt">&lt;/group&gt;</span>
                        <span class="nt">&lt;notebook&gt;</span>
                            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">&quot;Description&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span>            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>

<span class="hll">        <span class="c">&lt;!-- override the automatically generated list view for courses --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;course_tree_view&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>course.tree<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>openacademy.course<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">&quot;Course Tree&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;responsible_id&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/tree&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span>        <span class="c">&lt;!-- window action --&gt;</span>
        <span class="c">&lt;!--</span>
<span class="c">            The following tag is an action definition for a &quot;window action&quot;,</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span>                <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">&quot;Session Form&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;sheet&gt;</span>
                        <span class="nt">&lt;group&gt;</span>
<span class="hll">                            <span class="nt">&lt;group</span> <span class="na">string=</span><span class="s">&quot;General&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;course_id&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;instructor_id&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;/group&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;group</span> <span class="na">string=</span><span class="s">&quot;Schedule&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;start_date&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;duration&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;seats&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;/group&gt;</span>
</span>                        <span class="nt">&lt;/group&gt;</span>
                    <span class="nt">&lt;/sheet&gt;</span>
                <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>

<span class="hll">        <span class="c">&lt;!-- session tree/list view --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;session_tree_view&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>session.tree<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">&quot;Session Tree&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;course_id&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/tree&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span>        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span> <span class="na">id=</span><span class="s">&quot;session_list_action&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Sessions<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</pre></div>
</div>
</div></div></div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Обратные отношения</p><p >Используя обратное реляционное поле one2many, измените модели, чтобы отразить связь между курсами и сессиями.</p><ol ><li >Изменить класс `` Course``, и</li><li >добавьте поле в виде формы курса.</li></ol><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>
    <span class="n">responsible_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span>
<span class="hll">        <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;set null&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Responsible&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="hll">    <span class="n">session_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span>
</span>        <span class="s1">&#39;openacademy.session&#39;</span><span class="p">,</span> <span class="s1">&#39;course_id&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Sessions&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</pre></div>
</div>
</div><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span>                            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">&quot;Description&quot;</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span><span class="nt">/&gt;</span>
                            <span class="nt">&lt;/page&gt;</span>
<span class="hll">                            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">&quot;Sessions&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;session_ids&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                                    <span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">&quot;Registered sessions&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;instructor_id&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                                    <span class="nt">&lt;/tree&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;/field&gt;</span>
</span>                            <span class="nt">&lt;/page&gt;</span>
                        <span class="nt">&lt;/notebook&gt;</span>
                    <span class="nt">&lt;/sheet&gt;</span>
</pre></div>
</div>
</div></div></div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Несколько много-много отношений</p><p >Используя реляционное поле many2many, измените модель * Session <a href="#id1"><span id="id2" class="problematic">*</span></a>, чтобы связать каждый сеанс с набором * чел <a href="#id3"><span id="id4" class="problematic">*</span></a>. Участники будут представлены записями партнеров, поэтому мы будем ссылаться на встроенную модель `` res.partner``. Адаптируйте взгляды соответственно.</p><ol ><li >Изменить класс `` Session``, и</li><li >добавьте поле в виде формы.</li></ol><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">instructor_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Instructor&quot;</span><span class="p">)</span>
    <span class="n">course_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;openacademy.course&#39;</span><span class="p">,</span>
        <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Course&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="hll">    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Attendees&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</div><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span>                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;seats&quot;</span><span class="nt">/&gt;</span>
                            <span class="nt">&lt;/group&gt;</span>
                        <span class="nt">&lt;/group&gt;</span>
<span class="hll">                        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;attendee_ids&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;attendee_ids&quot;</span><span class="nt">/&gt;</span>
</span>                    <span class="nt">&lt;/sheet&gt;</span>
                <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/field&gt;</span>
</pre></div>
</div>
</div></div></div></section><section id="inheritance"><h2 >наследование</h2></section><section id="model-inheritance"><h3 >Модель наследования</h3><p >Odoo предоставляет два механизма * наследования * для расширения существующей модели модульным способом.</p><p >Первый механизм наследования позволяет модулю изменять поведение модели, определенной в другом модуле:</p><ul ><li >добавить поля в модель,</li><li >переопределить определение полей в модели,</li><li >добавить ограничения в модель,</li><li >добавить методы в модель,</li><li >переопределить существующие методы в модели.</li></ul><p >Второй механизм наследования (делегирование) позволяет связать каждую запись модели с записью в родительской модели и обеспечивает прозрачный доступ к полям родительской записи.</p><img src="../_images/inheritance_methods.png" class="center-block img-responsive"><div role="alert" class="alert alert-go_to"><h3 class="alert-title">См.также</h3><ul ><li >: Атр: <code >~ odoo.models.Model._inherit</code></li><li >: Атр: <code >~ odoo.models.Model._inherits</code></li></ul></div></section><section id="view-inheritance"><h3 >Посмотреть наследство</h3><p >Вместо того, чтобы изменять существующие представления на месте (перезаписывая их), Odoo обеспечивает наследование представлений, где дочерние «расширенные» представления применяются поверх корневых представлений, и могут добавлять или удалять содержимое из своего родителя.</p><p >Представление расширения ссылается на своего родителя, используя поле `` attributeit_id``, и вместо одного представления его поле `` arch`` состоит из любого количества элементов `` xpath``, которые выбирают и изменяют содержимое своего родительского представления:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- improved idea categories list --&gt;</span>
<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;idea_category_list2&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>id.category.list2<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>idea.category<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inherit_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;id_category_list&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- find field description and add the field</span>
<span class="c">             idea_ids after it --&gt;</span>
        <span class="nt">&lt;xpath</span> <span class="na">expr=</span><span class="s">&quot;//field[@name=&#39;description&#39;]&quot;</span> <span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;idea_ids&quot;</span> <span class="na">string=</span><span class="s">&quot;Number of ideas&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/xpath&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<dl ><dt >`` expr``</dt><dd >Выражение <a href="http://w3.org/TR/xpath" class="external reference">XPath</a>, выбирающее один элемент в родительском представлении. Вызывает ошибку, если она не соответствует ни одному элементу или более одного</dd><dt >`` position``</dt><dd ><p >Операция, применяемая к сопоставленному элементу:</p><dl ><dt >`` Inside``</dt><dd >добавляет тело `` xpath`` в конце соответствующего элемента</dd><dt >`` replace``</dt><dd >заменяет соответствующий элемент на тело `` xpath``, заменяя любое вхождение узла `` $ 0`` в новом теле на исходный элемент</dd><dt >`` before``</dt><dd >вставляет тело `` xpath`` как брата перед соответствующим элементом</dd><dt >`` after``</dt><dd >вставляет тело `` xpaths`` как брата после соответствующего элемента</dd><dt >`` attributes``</dt><dd >изменяет атрибуты соответствующего элемента, используя специальные элементы `` attribute`` в теле `` xpath``</dd></dl></dd></dl><div role="alert" class="alert alert-info"><h3 class="alert-title">Совет</h3><p >При сопоставлении одного элемента атрибут `` position`` может быть установлен непосредственно на элемент, который будет найден. Оба наследования ниже приведут к одному и тому же результату.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;xpath</span> <span class="na">expr=</span><span class="s">&quot;//field[@name=&#39;description&#39;]&quot;</span> <span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;idea_ids&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/xpath&gt;</span>

<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;idea_ids&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/field&gt;</span>
</pre></div>
</div>
</div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Изменить существующий контент</p><ul ><li >Используя наследование модели, измените существующую модель * Partner <a href="#id1"><span id="id2" class="problematic">*</span></a>, добавив логическое поле `` instructor``, и поле many2many, соответствующее отношению сеанса-партнера.</li><li >Используя наследование представления, отобразите эти поля в представлении формы партнера.</li></ul><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Это возможность ввести режим разработчика, чтобы осмотреть вид, найти его внешний идентификатор и место для размещения нового поля.</p></div><ol ><li >Создайте файл `` openacademy / models / partner.py`` и импортируйте его в `` __init __. Py``</li><li >Создайте файл `` openacademy / views / partner.xml`` и добавьте его в `` __manifest __. Py``</li></ol><div class="pq-patch"><em >openacademy/__init__.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">controllers</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">models</span>
<span class="hll"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">partner</span>
</span></pre></div>
</div>
</div><em >openacademy/__manifest__.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>        <span class="c1"># &#39;security/ir.model.access.csv&#39;,</span>
        <span class="s1">&#39;templates.xml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;views/openacademy.xml&#39;</span><span class="p">,</span>
<span class="hll">        <span class="s1">&#39;views/partner.xml&#39;</span><span class="p">,</span>
</span>    <span class="p">],</span>
    <span class="c1"># only loaded in demonstration mode</span>
    <span class="s1">&#39;demo&#39;</span><span class="p">:</span> <span class="p">[</span>
</pre></div>
</div>
</div><em >openacademy/partner.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">fields</span><span class="p">,</span> <span class="n">models</span>
</span><span class="hll">
</span><span class="hll"><span class="k">class</span> <span class="nc">Partner</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="hll">    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;res.partner&#39;</span>
</span><span class="hll">
</span><span class="hll">    <span class="c1"># Add a new column to the res.partner model, by default partners are not</span>
</span><span class="hll">    <span class="c1"># instructors</span>
</span><span class="hll">    <span class="n">instructor</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="s2">&quot;Instructor&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">session_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;openacademy.session&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Attended Sessions&quot;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>
</div>
</div><em >openacademy/views/partner.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="hll"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class="hll"> <span class="nt">&lt;odoo&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="c">&lt;!-- Add instructor field to existing view --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;partner_instructor_form_view&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>partner.instructor<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>res.partner<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inherit_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;base.view_partner_form&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;notebook</span> <span class="na">position=</span><span class="s">&quot;inside&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">&quot;Sessions&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;group&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;instructor&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;session_ids&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;/group&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/page&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/notebook&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span> <span class="na">id=</span><span class="s">&quot;contact_list_action&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Contacts<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>res.partner<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;configuration_menu&quot;</span> <span class="na">name=</span><span class="s">&quot;Configuration&quot;</span>
</span><span class="hll">                  <span class="na">parent=</span><span class="s">&quot;main_openacademy_menu&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;contact_menu&quot;</span> <span class="na">name=</span><span class="s">&quot;Contacts&quot;</span>
</span><span class="hll">                  <span class="na">parent=</span><span class="s">&quot;configuration_menu&quot;</span>
</span><span class="hll">                  <span class="na">action=</span><span class="s">&quot;contact_list_action&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">
</span><span class="hll"><span class="nt">&lt;/odoo&gt;</span>
</span></pre></div>
</div>
</div></div></div></section><section id="domains"><h4 >Домены</h4><p >В Odoo <a href="../reference/orm.html#reference-orm-domains" class="reference internal"><span class="std std-ref">Поиск доменов</span></a> - это значения, которые кодируют условия в записях. Домен - это список критериев, используемых для выбора подмножества записей модели. Каждый критерий представляет собой тройку с именем поля, оператором и значением.</p><p >Например, при использовании в модели * Product * следующий домен выбирает все * услуги * с ценой за единицу более * 1000 *</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="s1">&#39;product_type&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;service&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;unit_price&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
</pre></div>
</div>
<p >По умолчанию критерии объединяются с неявным AND. Логические операторы `` &amp;amp; `` (AND), `` | `` (OR) и <a href="#id1"><span id="id2" class="problematic">``</span></a>! `` (NOT) могут использоваться для явного объединения критериев. Они используются в префиксной позиции (оператор вставляется перед его аргументами, а не между ними). Например, чтобы выбрать продукты <code >которые являются услугами * ИЛИ * имеют цену за единицу, которая * НЕ * между 1000 и 2000</code></p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;product_type&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;service&#39;</span><span class="p">),</span>
    <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;unit_price&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;unit_price&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)]</span>
</pre></div>
</div>
<p >Параметр `` domain`` может быть добавлен в реляционные поля, чтобы ограничить допустимые записи для отношения при попытке выбора записей в клиентском интерфейсе.</p><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Домены на реляционных полях</p><p >При выборе инструктора для * Session * должны быть видны только инструкторы (партнеры с `` instructor``, установленным в `` True``).</p><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">duration</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Duration in days&quot;</span><span class="p">)</span>
    <span class="n">seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Number of seats&quot;</span><span class="p">)</span>

<span class="hll">    <span class="n">instructor_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Instructor&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;instructor&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)])</span>
</span>    <span class="n">course_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;openacademy.course&#39;</span><span class="p">,</span>
        <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Course&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Attendees&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Домен, объявленный как литеральный список, оценивается на стороне сервера и не может ссылаться на динамические значения с правой стороны, домен, объявленный как строка, оценивается на стороне клиента и допускает имена полей с правой стороны.</p></div></div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Более сложные домены</p><p >Создайте новые категории партнеров * Учитель / Уровень 1 * и * Учитель / Уровень 2 <a href="#id1"><span id="id2" class="problematic">*</span></a>. Инструктором сеанса может быть либо инструктор, либо преподаватель (любого уровня).</p><ol ><li >Изменить домен модели * Session *</li><li >Измените `` openacademy / view / partner.xml``, чтобы получить доступ к * категориям партнеров <a href="#id1"><span id="id2" class="problematic">*</span></a>:</li></ol><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Number of seats&quot;</span><span class="p">)</span>

    <span class="n">instructor_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Instructor&quot;</span><span class="p">,</span>
<span class="hll">        <span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;instructor&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
</span><span class="hll">                     <span class="p">(</span><span class="s1">&#39;category_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s2">&quot;Teacher&quot;</span><span class="p">)])</span>
</span>    <span class="n">course_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;openacademy.course&#39;</span><span class="p">,</span>
        <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Course&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Attendees&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div><em >openacademy/views/partner.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span>                  parent=&quot;configuration_menu&quot;
                  action=&quot;contact_list_action&quot;/&gt;

<span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span> <span class="na">id=</span><span class="s">&quot;contact_cat_list_action&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Contact Tags<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>res.partner.category<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;contact_cat_menu&quot;</span> <span class="na">name=</span><span class="s">&quot;Contact Tags&quot;</span>
</span><span class="hll">                  <span class="na">parent=</span><span class="s">&quot;configuration_menu&quot;</span>
</span><span class="hll">                  <span class="na">action=</span><span class="s">&quot;contact_cat_list_action&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;res.partner.category&quot;</span> <span class="na">id=</span><span class="s">&quot;teacher1&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Teacher / Level 1<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;res.partner.category&quot;</span> <span class="na">id=</span><span class="s">&quot;teacher2&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Teacher / Level 2<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="nt">&lt;/odoo&gt;</span>
</pre></div>
</div>
</div></div></div></section><section id="computed-fields-and-default-values"><h2 >Вычисляемые поля и значения по умолчанию</h2><p >До сих пор поля были сохранены непосредственно в базе данных и получены непосредственно из нее. Поля также могут быть * вычислены <a href="#id1"><span id="id2" class="problematic">*</span></a>. В этом случае значение поля не извлекается из базы данных, а вычисляется на лету, вызывая метод модели.</p><p >Чтобы создать вычисляемое поле, создайте поле и установите его атрибут: attr: <code >~ odoo.fields.Field.compute</code> в качестве имени метода. Метод вычисления должен просто установить значение поля для вычисления для каждой записи в `` self``.</p><div role="alert" class="alert alert-danger aphorism"><h3 class="alert-title">Опасно</h3><p >`` self`` это коллекция</p><p >Объект `` self`` является * набором записей <a href="#id1"><span id="id2" class="problematic">*</span></a>, то есть упорядоченным набором записей. Он поддерживает стандартные операции Python для коллекций, такие как `` len (self) `` и `` iter (self) <code >, плюс дополнительные операции над множествами, такие как `` recs1 + recs2</code>.</p><p >Итерирование по `` self`` дает записи одну за другой, где каждая запись сама является коллекцией размера 1. Вы можете получить доступ / назначить поля в отдельных записях, используя точечную запись, как `` record.name``.</p></div><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span>

<span class="k">class</span> <span class="nc">ComputedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test.computed&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_name&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_compute_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">))</span>
</pre></div>
</div>
</section><section id="dependencies"><h3 >зависимости</h3><p >Значение вычисляемого поля обычно зависит от значений других полей в вычисляемой записи. ORM ожидает, что разработчик определит эти зависимости в методе compute с помощью декоратора <a href="../reference/orm.html#odoo.api.depends" title="odoo.api.depends" class="reference internal"><code class="xref py py-func">depends()</code></a>. Данные зависимости используются ORM для запуска пересчета поля всякий раз, когда некоторые его зависимости были изменены:</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span>

<span class="k">class</span> <span class="nc">ComputedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test.computed&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_name&#39;</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Record with value </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">record</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Вычисляемые поля</p><ul ><li >Добавьте процент занятых мест в модель * Session *</li><li >Отобразить это поле в виде дерева и формы</li><li >Отобразить поле как индикатор выполнения</li></ul><ol ><li >Добавить вычисляемое поле в * Session *</li><li >Показать поле в представлении * Session <a href="#id1"><span id="id2" class="problematic">*</span></a>:</li></ol><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">course_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;openacademy.course&#39;</span><span class="p">,</span>
        <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Course&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Attendees&quot;</span><span class="p">)</span>
<span class="hll">
</span><span class="hll">    <span class="n">taken_seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Taken seats&quot;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_taken_seats&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;seats&#39;</span><span class="p">,</span> <span class="s1">&#39;attendee_ids&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">_taken_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span class="hll">            <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">seats</span><span class="p">:</span>
</span><span class="hll">                <span class="n">r</span><span class="o">.</span><span class="n">taken_seats</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span class="hll">            <span class="k">else</span><span class="p">:</span>
</span><span class="hll">                <span class="n">r</span><span class="o">.</span><span class="n">taken_seats</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">)</span> <span class="o">/</span> <span class="n">r</span><span class="o">.</span><span class="n">seats</span>
</span></pre></div>
</div>
</div><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span>                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;start_date&quot;</span><span class="nt">/&gt;</span>
                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;duration&quot;</span><span class="nt">/&gt;</span>
                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;seats&quot;</span><span class="nt">/&gt;</span>
<span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;taken_seats&quot;</span> <span class="na">widget=</span><span class="s">&quot;progressbar&quot;</span><span class="nt">/&gt;</span>
</span>                            <span class="nt">&lt;/group&gt;</span>
                        <span class="nt">&lt;/group&gt;</span>
                        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;attendee_ids&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span>                <span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">&quot;Session Tree&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;course_id&quot;</span><span class="nt">/&gt;</span>
<span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;taken_seats&quot;</span> <span class="na">widget=</span><span class="s">&quot;progressbar&quot;</span><span class="nt">/&gt;</span>
</span>                <span class="nt">&lt;/tree&gt;</span>
            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
</div></div></div></section><section id="default-values"><h3 >Значения по умолчанию</h3><p >Любому полю может быть присвоено значение по умолчанию. В определении поля добавьте параметр `` default = X``, где `` X`` является либо литеральным значением Python (логическое значение, целое число, число с плавающей точкой, строка), либо функцией, принимающей набор записей и возвращающей значение</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
<span class="n">user_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</pre></div>
</div>
<div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Объект `` self.env`` предоставляет доступ к параметрам запроса и другим полезным вещам:</p><ul ><li >`` self.env.cr`` или `` self._cr`` - это объект * курсор * базы данных; используется для запросов к базе данных</li><li >`` self.env.uid`` или `` self._uid`` - это идентификатор базы данных текущего пользователя</li><li >`` self.env.user`` - запись текущего пользователя</li><li >`` self.env.context`` или `` self._context`` является контекстным словарем</li><li >`` self.env.ref (xml_id) `` возвращает запись, соответствующую идентификатору XML</li><li >`` self.env [model_name] `` возвращает экземпляр заданной модели</li></ul></div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Активные объекты - значения по умолчанию</p><ul ><li >Определите значение по умолчанию для start_date как сегодня (см . <a href="../reference/orm.html#odoo.fields.Date" title="odoo.fields.Date" class="alert-link reference internal"><code class="xref py py-class">Date</code></a>).</li><li >Добавьте поле `` active`` в класс Session и установите сеансы как активные по умолчанию.</li></ul><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;OpenAcademy Sessions&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="hll">    <span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">today</span><span class="p">)</span>
</span>    <span class="n">duration</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Duration in days&quot;</span><span class="p">)</span>
    <span class="n">seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Number of seats&quot;</span><span class="p">)</span>
<span class="hll">    <span class="n">active</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span>
    <span class="n">instructor_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Instructor&quot;</span><span class="p">,</span>
        <span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;instructor&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
</pre></div>
</div>
</div><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span>                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;course_id&quot;</span><span class="nt">/&gt;</span>
                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;instructor_id&quot;</span><span class="nt">/&gt;</span>
<span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;active&quot;</span><span class="nt">/&gt;</span>
</span>                            <span class="nt">&lt;/group&gt;</span>
                            <span class="nt">&lt;group</span> <span class="na">string=</span><span class="s">&quot;Schedule&quot;</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;start_date&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</div></div><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Odoo имеет встроенные правила, делающие поля с полем `` active``, установленным в `` False``, невидимым.</p></div></div></section><section id="onchange"><h2 >По изменению</h2><p >Механизм «onchange» предоставляет клиентскому интерфейсу способ обновлять форму всякий раз, когда пользователь заполняет значение в поле, без сохранения чего-либо в базе данных.</p><p >Например, предположим, что модель имеет три поля: «сумма», «единица измерения» и «цена», и вы хотите обновить цену в форме при изменении любого из других полей. Чтобы достичь этого, определите метод, где `` self`` представляет запись в представлении формы, и украсьте ее с помощью <a href="../reference/orm.html#odoo.api.onchange" title="odoo.api.onchange" class="reference internal"><code class="xref py py-func">onchange()</code></a>, чтобы указать, в каком поле она должна быть запущена. Любые изменения, внесенные вами в `` self``, будут отражены в форме.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- content of form view --&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;amount&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;unit_price&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;price&quot;</span> <span class="na">readonly=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># onchange handler</span>
<span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">,</span> <span class="s1">&#39;unit_price&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_onchange_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># set auto-changing field</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_price</span>
    <span class="c1"># Can optionally return a warning and domains</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Something bad happened&quot;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;It was very bad indeed&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p >Для вычисляемых полей встроенное поведение `` onchange`` является встроенным, что можно увидеть, играя с формой * Session <a href="#id1"><span id="id2" class="problematic">*</span></a>: измените количество мест или участников, и индикатор выполнения `` take_seats`` автоматически обновится.</p><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Предупреждение</p><p >Добавьте явный onchange, чтобы предупредить о недопустимых значениях, таких как отрицательное количество мест или больше участников, чем мест.</p><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>                <span class="n">r</span><span class="o">.</span><span class="n">taken_seats</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">r</span><span class="o">.</span><span class="n">taken_seats</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">)</span> <span class="o">/</span> <span class="n">r</span><span class="o">.</span><span class="n">seats</span>
<span class="hll">
</span><span class="hll">    <span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;seats&#39;</span><span class="p">,</span> <span class="s1">&#39;attendee_ids&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">_verify_valid_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seats</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span class="hll">            <span class="k">return</span> <span class="p">{</span>
</span><span class="hll">                <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="hll">                    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Incorrect &#39;seats&#39; value&quot;</span><span class="p">,</span>
</span><span class="hll">                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;The number of available seats may not be negative&quot;</span><span class="p">,</span>
</span><span class="hll">                <span class="p">},</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seats</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">):</span>
</span><span class="hll">            <span class="k">return</span> <span class="p">{</span>
</span><span class="hll">                <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="hll">                    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Too many attendees&quot;</span><span class="p">,</span>
</span><span class="hll">                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;Increase seats or remove excess attendees&quot;</span><span class="p">,</span>
</span><span class="hll">                <span class="p">},</span>
</span><span class="hll">            <span class="p">}</span>
</span></pre></div>
</div>
</div></div></div></section><section id="model-constraints"><h2 >Ограничения модели</h2><p >Odoo предоставляет два способа настройки автоматически проверяемых инвариантов: <code class="xref py py-func">Python constraints &lt;odoo.api.constrains&gt;`и: attr:()</code> ограничения SQL &lt;odoo.models.Model._sql_constraints&gt; <a href="#id1"><span id="id2" class="problematic">`</span></a>.</p><p >Ограничение Python определяется как метод, оформленный с помощью <a href="../reference/orm.html#odoo.api.constrains" title="odoo.api.constrains" class="reference internal"><code class="xref py py-func">constrains()</code></a>, и вызывается для набора записей. Декоратор определяет, какие поля участвуют в ограничении, поэтому ограничение автоматически оценивается при изменении одного из них. Ожидается, что метод вызовет исключение, если его инвариант не выполняется:</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">odoo.exceptions</span> <span class="kn">import</span> <span class="n">ValidationError</span>

<span class="nd">@api</span><span class="o">.</span><span class="n">constrains</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_check_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Your record is too old: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">record</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
    <span class="c1"># all records passed the test, don&#39;t return anything</span>
</pre></div>
</div>
<div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Добавить ограничения Python</p><p >Добавьте ограничение, которое проверяет, что инструктор не присутствует в посетителях его / ее собственного сеанса.</p><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="hll"><span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span><span class="p">,</span> <span class="n">exceptions</span>
</span>
<span class="k">class</span> <span class="nc">Course</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;openacademy.course&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;Increase seats or remove excess attendees&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">}</span>
<span class="hll">
</span><span class="hll">    <span class="nd">@api</span><span class="o">.</span><span class="n">constrains</span><span class="p">(</span><span class="s1">&#39;instructor_id&#39;</span><span class="p">,</span> <span class="s1">&#39;attendee_ids&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">_check_instructor_not_in_attendees</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span class="hll">            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">instructor_id</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">instructor_id</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">:</span>
</span><span class="hll">                <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;A session&#39;s instructor can&#39;t be an attendee&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</div></div></div><p >Ограничения SQL определяются через атрибут модели: attr: <code >~ odoo.models.Model._sql_constraints</code>. Последний присваивается списку троек строк `` (name, sql_definition, message) <code >, где `` name</code> - допустимое имя ограничения SQL, `` sql_definition`` - выражение <a href="http://www.postgresql.org/docs/9.3/static/ddl-constraints.html" class="external reference">table_constraint</a>, а `` message `` это сообщение об ошибке.</p><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Добавить ограничения SQL</p><p >С помощью <a href="http://www.postgresql.org/docs/9.3/static/ddl-constraints.html" class="external reference alert-link">документации PostgreSQL</a> добавьте следующие ограничения:</p><ol ><li >ПРОВЕРЬТЕ, что описание курса и название курса отличаются</li><li >Сделайте название курса УНИКАЛЬНЫМ</li></ol><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">session_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span>
        <span class="s1">&#39;openacademy.session&#39;</span><span class="p">,</span> <span class="s1">&#39;course_id&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Sessions&quot;</span><span class="p">)</span>

<span class="hll">    <span class="n">_sql_constraints</span> <span class="o">=</span> <span class="p">[</span>
</span><span class="hll">        <span class="p">(</span><span class="s1">&#39;name_description_check&#39;</span><span class="p">,</span>
</span><span class="hll">         <span class="s1">&#39;CHECK(name != description)&#39;</span><span class="p">,</span>
</span><span class="hll">         <span class="s2">&quot;The title of the course should not be the description&quot;</span><span class="p">),</span>
</span><span class="hll">
</span><span class="hll">        <span class="p">(</span><span class="s1">&#39;name_unique&#39;</span><span class="p">,</span>
</span><span class="hll">         <span class="s1">&#39;UNIQUE(name)&#39;</span><span class="p">,</span>
</span><span class="hll">         <span class="s2">&quot;The course title must be unique&quot;</span><span class="p">),</span>
</span><span class="hll">    <span class="p">]</span>
</span><span class="hll">
</span>
<span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;openacademy.session&#39;</span>
</pre></div>
</div>
</div></div></div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Упражнение 6 - добавление дубликата</p><p >Поскольку мы добавили ограничение для уникальности имени курса, больше нельзя использовать функцию «дубликата» ( <span class="menuselection">Form ‣ Duplicate</span>).</p><p >Реализуйте свой собственный метод «copy», который позволяет дублировать объект Course, заменяя оригинальное имя на «Copy of [original name]».</p><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">session_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span>
        <span class="s1">&#39;openacademy.session&#39;</span><span class="p">,</span> <span class="s1">&#39;course_id&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Sessions&quot;</span><span class="p">)</span>

<span class="hll">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span class="hll">        <span class="n">default</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">default</span> <span class="ow">or</span> <span class="p">{})</span>
</span><span class="hll">
</span><span class="hll">        <span class="n">copied_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_count</span><span class="p">(</span>
</span><span class="hll">            <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=like&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Copy of </span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))])</span>
</span><span class="hll">        <span class="k">if</span> <span class="ow">not</span> <span class="n">copied_count</span><span class="p">:</span>
</span><span class="hll">            <span class="n">new_name</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;Copy of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span class="hll">        <span class="k">else</span><span class="p">:</span>
</span><span class="hll">            <span class="n">new_name</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;Copy of </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">copied_count</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">        <span class="n">default</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_name</span>
</span><span class="hll">        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Course</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
</span><span class="hll">
</span>    <span class="n">_sql_constraints</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;name_description_check&#39;</span><span class="p">,</span>
         <span class="s1">&#39;CHECK(name != description)&#39;</span><span class="p">,</span>
</pre></div>
</div>
</div></div></div></section><section id="advanced-views"><h2 >Расширенные представления</h2></section><section id="id3"><h3 >Дерево просмотров</h3><p >Древовидные представления могут принимать дополнительные атрибуты для дальнейшей настройки их поведения:</p><dl ><dt >`` Украшения - {$ имя} ``</dt><dd ><p >разрешить изменение стиля текста строки на основе атрибутов соответствующей записи.</p><p >Значения являются выражениями Python. Для каждой записи выражение оценивается с использованием атрибутов записи в качестве значений контекста, и если `` true``, соответствующий стиль применяется к строке. Другими значениями контекста являются `` uid`` (идентификатор текущего пользователя) и `` current_date`` (текущая дата в виде строки вида `` yyyy-MM-dd``).</p><p >`` {$ name} `` может быть `` bf`` (`` font-weight: bold``), `` it`` (`` font-style: italic``) или любым <a href="https://getbootstrap.com/docs/3.3/components/#available-variations" class="external reference">начальным контекстным цветом</a> (` <code >опасность`</code>,` <code >info`</code>,` <code >muted`</code>,` <code >primary`</code>,` <code >success`</code> или` <code >warning`</code>).</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">&quot;Idea Categories&quot;</span> <span class="na">decoration-info=</span><span class="s">&quot;state==&#39;draft&#39;&quot;</span>
    <span class="na">decoration-danger=</span><span class="s">&quot;state==&#39;trashed&#39;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;state&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/tree&gt;</span>
</pre></div>
</div>
</dd><dt >`` Editable``</dt><dd >Либо `` <code >top</code> <a href="#id1"><span id="id2" class="problematic">``</span></a>, либо `` <code >bottom</code> <a href="#id3"><span id="id4" class="problematic">``</span></a>. Делает вид дерева доступным для редактирования (вместо того, чтобы проходить через вид формы), значение - это позиция, где появляются новые строки.</dd></dl><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Раскраска списка</p><p >Измените представление дерева сеансов таким образом, чтобы сеансы продолжительностью менее 5 дней окрашивались в синий цвет, а сеансы продолжительностью более 15 дней - в красный.</p><p >Измените представление дерева сеанса:</p><div class="pq-patch"><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>session.tree<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
<span class="hll">                <span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">&quot;Session Tree&quot;</span> <span class="na">decoration-info=</span><span class="s">&quot;duration&amp;lt;5&quot;</span> <span class="na">decoration-danger=</span><span class="s">&quot;duration&amp;gt;15&quot;</span><span class="nt">&gt;</span>
</span>                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;course_id&quot;</span><span class="nt">/&gt;</span>
<span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;duration&quot;</span> <span class="na">invisible=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
</span>                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;taken_seats&quot;</span> <span class="na">widget=</span><span class="s">&quot;progressbar&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/tree&gt;</span>
            <span class="nt">&lt;/field&gt;</span>
</pre></div>
</div>
</div></div></div></section><section id="calendars"><h3 >Календари</h3><p >Отображает записи как события календаря. Их корневой элемент `` &lt;calendar&gt; `` и их наиболее распространенными атрибутами являются:</p><dl ><dt >`` color``</dt><dd >Имя поля, используемого для * цветовой сегментации <a href="#id1"><span id="id2" class="problematic">*</span></a>. Цвета автоматически распределяются по событиям, но событиям в том же сегменте цвета (записи, которые имеют одинаковое значение для своего поля `` @ color``) будет присвоен тот же цвет.</dd><dt >`` date_start``</dt><dd >поле записи, содержащее дату / время начала события</dd><dt >`` date_stop`` (необязательно)</dt><dd >поле записи, содержащее дату / время окончания события</dd><dt >`` String``</dt><dd >поле записи, чтобы определить метку для каждого события календаря</dd></dl><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;calendar</span> <span class="na">string=</span><span class="s">&quot;Ideas&quot;</span> <span class="na">date_start=</span><span class="s">&quot;invent_date&quot;</span> <span class="na">color=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/calendar&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Просмотр календаря</p><p >Добавьте представление календаря в модель * Session <a href="#id1"><span id="id2" class="problematic">*</span></a>, чтобы пользователь мог просматривать события, связанные с Open Academy.</p><ol ><li ><p >Добавить поле `` end_date``, вычисленное из `` start_date`` и `` duration``</p><div role="alert" class="alert alert-info"><h3 class="alert-title">Совет</h3><p >обратная функция делает поле доступным для записи и позволяет перемещать сеансы (с помощью перетаскивания) в представлении календаря</p></div></li><li >Добавить представление календаря к модели * Session *</li><li >И добавьте представление календаря к действиям модели * Session *</li></ol><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="hll"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
</span><span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span><span class="p">,</span> <span class="n">exceptions</span>

<span class="k">class</span> <span class="nc">Course</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Attendees&quot;</span><span class="p">)</span>

    <span class="n">taken_seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Taken seats&quot;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_taken_seats&#39;</span><span class="p">)</span>
<span class="hll">    <span class="n">end_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;End Date&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span class="hll">        <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_get_end_date&#39;</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="s1">&#39;_set_end_date&#39;</span><span class="p">)</span>
</span>
    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;seats&#39;</span><span class="p">,</span> <span class="s1">&#39;attendee_ids&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_taken_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>                <span class="p">},</span>
            <span class="p">}</span>

<span class="hll">    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;start_date&#39;</span><span class="p">,</span> <span class="s1">&#39;duration&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">_get_end_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span class="hll">            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">start_date</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">duration</span><span class="p">):</span>
</span><span class="hll">                <span class="n">r</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">start_date</span>
</span><span class="hll">                <span class="k">continue</span>
</span><span class="hll">
</span><span class="hll">            <span class="c1"># Add duration to start_date, but: Monday + 5 days = Saturday, so</span>
</span><span class="hll">            <span class="c1"># subtract one second to get on Friday instead</span>
</span><span class="hll">            <span class="n">duration</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span class="hll">            <span class="n">r</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">start_date</span> <span class="o">+</span> <span class="n">duration</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">_set_end_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span class="hll">            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">start_date</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">end_date</span><span class="p">):</span>
</span><span class="hll">                <span class="k">continue</span>
</span><span class="hll">
</span><span class="hll">            <span class="c1"># Compute the difference between dates, but: Friday - Monday = 4 days,</span>
</span><span class="hll">            <span class="c1"># so add one day to get 5 days instead</span>
</span><span class="hll">            <span class="n">r</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">end_date</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class="hll">
</span>    <span class="nd">@api</span><span class="o">.</span><span class="n">constrains</span><span class="p">(</span><span class="s1">&#39;instructor_id&#39;</span><span class="p">,</span> <span class="s1">&#39;attendee_ids&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_check_instructor_not_in_attendees</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</pre></div>
</div>
</div><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span>            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>

<span class="hll">        <span class="c">&lt;!-- calendar view --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;session_calendar_view&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>session.calendar<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;calendar</span> <span class="na">string=</span><span class="s">&quot;Session Calendar&quot;</span> <span class="na">date_start=</span><span class="s">&quot;start_date&quot;</span> <span class="na">date_stop=</span><span class="s">&quot;end_date&quot;</span> <span class="na">color=</span><span class="s">&quot;instructor_id&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/calendar&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span>        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span> <span class="na">id=</span><span class="s">&quot;session_list_action&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Sessions<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
<span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form,calendar<span class="nt">&lt;/field&gt;</span>
</span>        <span class="nt">&lt;/record&gt;</span>

        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;session_menu&quot;</span> <span class="na">name=</span><span class="s">&quot;Sessions&quot;</span>
</pre></div>
</div>
</div></div></div></section><section id="id4"><h3 >Поиск просмотров</h3><p >Поиск просмотра `` &lt;field&gt; Элементы `` могут иметь `` @ filter_domain``, который переопределяет домен, сгенерированный для поиска в данном поле. В данном домене `` self`` представляет значение, введенное пользователем. В приведенном ниже примере он используется для поиска в обоих полях `` name`` и `` description``.</p><p >Виды поиска также могут содержать `` &lt;filter&gt; `` элементы, которые действуют как переключатели для предопределенных поисков. Фильтры должны иметь один из следующих атрибутов:</p><dl ><dt >`` Domain``</dt><dd >добавить данный домен в текущий поиск</dd><dt >`` context``</dt><dd >добавить некоторый контекст в текущий поиск; используйте ключ `` group_by`` для группировки результатов по заданному имени поля</dd></dl><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;search</span> <span class="na">string=</span><span class="s">&quot;Ideas&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">string=</span><span class="s">&quot;Name and description&quot;</span>
           <span class="na">filter_domain=</span><span class="s">&quot;[&#39;|&#39;, (&#39;name&#39;, &#39;ilike&#39;, self), (&#39;description&#39;, &#39;ilike&#39;, self)]&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;country_id&quot;</span> <span class="na">widget=</span><span class="s">&quot;selection&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">&quot;my_ideas&quot;</span> <span class="na">string=</span><span class="s">&quot;My Ideas&quot;</span>
            <span class="na">domain=</span><span class="s">&quot;[(&#39;inventor_id&#39;, &#39;=&#39;, uid)]&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;group</span> <span class="na">string=</span><span class="s">&quot;Group By&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">&quot;group_by_inventor&quot;</span> <span class="na">string=</span><span class="s">&quot;Inventor&quot;</span>
                <span class="na">context=</span><span class="s">&quot;{&#39;group_by&#39;: &#39;inventor_id&#39;}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/group&gt;</span>
<span class="nt">&lt;/search&gt;</span>
</pre></div>
</div>
<p >Чтобы использовать поисковое представление не по умолчанию в действии, оно должно быть связано с помощью поля `` search_view_id`` в записи действия.</p><p >Действие также может установить значения по умолчанию для полей поиска через свое поле `` context``: ключи контекста в форме: samp: <code >search_default_ {field_name}</code> инициализируют * field_name * с указанным значением. Фильтры поиска должны иметь необязательное `` @ name``, чтобы иметь значение по умолчанию и вести себя как логические значения (они могут быть включены только по умолчанию).</p><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Поиск просмотров</p><ol ><li >Добавьте кнопку, чтобы отфильтровать курсы, за которые текущий пользователь несет ответственность, в представлении поиска курса. Сделайте его выбранным по умолчанию.</li><li >Добавьте кнопку для групповых курсов ответственным пользователем.</li></ol><div class="pq-patch"><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span>                <span class="nt">&lt;search&gt;</span>
                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span><span class="nt">/&gt;</span>
<span class="hll">                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">&quot;my_courses&quot;</span> <span class="na">string=</span><span class="s">&quot;My Courses&quot;</span>
</span><span class="hll">                            <span class="na">domain=</span><span class="s">&quot;[(&#39;responsible_id&#39;, &#39;=&#39;, uid)]&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;group</span> <span class="na">string=</span><span class="s">&quot;Group By&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">&quot;by_responsible&quot;</span> <span class="na">string=</span><span class="s">&quot;Responsible&quot;</span>
</span><span class="hll">                                <span class="na">context=</span><span class="s">&quot;{&#39;group_by&#39;: &#39;responsible_id&#39;}&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/group&gt;</span>
</span>                <span class="nt">&lt;/search&gt;</span>
            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Courses<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>openacademy.course<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
<span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;context&quot;</span> <span class="na">eval=</span><span class="s">&quot;{&#39;search_default_my_courses&#39;: 1}&quot;</span><span class="nt">/&gt;</span>
</span>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;help&quot;</span> <span class="na">type=</span><span class="s">&quot;html&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;o_view_nocontent_smiling_face&quot;</span><span class="nt">&gt;</span>Create the first course
                <span class="nt">&lt;/p&gt;</span>
</pre></div>
</div>
</div></div></div></section><section id="gantt"><h3 >Ганта</h3><div role="alert" class="alert alert-warning"><h3 class="alert-title">Предупреждение</h3><p >Для представления Ганта требуется модуль web_gantt, который присутствует в :ref:<a href="#id1"><span id="id2" class="problematic">`</span></a>the enterprise edition &lt;setup/install/editions&gt;`версия.</p></div><p >Горизонтальные гистограммы обычно используются для отображения планирования и продвижения проекта, их корневым элементом является `` &lt;gantt&gt; <a href="#id1"><span id="id2" class="problematic">``</span></a>.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;gantt</span> <span class="na">string=</span><span class="s">&quot;Ideas&quot;</span>
       <span class="na">date_start=</span><span class="s">&quot;invent_date&quot;</span>
       <span class="na">date_stop=</span><span class="s">&quot;date_finished&quot;</span>
       <span class="na">progress=</span><span class="s">&quot;progress&quot;</span>
       <span class="na">default_group_by=</span><span class="s">&quot;inventor_id&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Диаграммы Ганта</p><p >Добавьте диаграмму Ганта, позволяющую пользователю просматривать расписание сеансов, связанных с модулем Open Academy. Сессии должны быть сгруппированы инструктором.</p><ol ><li >Добавьте определение представления Ганта и добавьте представление Ганта к действию модели * Session *</li></ol><div class="pq-patch"><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span>            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>

<span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;session_gantt_view&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>session.gantt<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;gantt</span> <span class="na">string=</span><span class="s">&quot;Session Gantt&quot;</span>
</span><span class="hll">                       <span class="na">date_start=</span><span class="s">&quot;start_date&quot;</span> <span class="na">date_stop=</span><span class="s">&quot;end_date&quot;</span>
</span><span class="hll">                       <span class="na">default_group_by=</span><span class="s">&#39;instructor_id&#39;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/gantt&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span>        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span> <span class="na">id=</span><span class="s">&quot;session_list_action&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Sessions<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
<span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form,calendar,gantt<span class="nt">&lt;/field&gt;</span>
</span>        <span class="nt">&lt;/record&gt;</span>

        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;session_menu&quot;</span> <span class="na">name=</span><span class="s">&quot;Sessions&quot;</span>
</pre></div>
</div>
</div></div></div></section><section id="graph-views"><h3 >Графические представления</h3><p >Представления графиков позволяют осуществлять сводный обзор и анализ моделей, их корневым элементом является `` &lt;graph&gt; <a href="#id1"><span id="id2" class="problematic">``</span></a>.</p><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Сводные представления (элемент `` &lt;pivot&gt; <a href="#id1"><span id="id2" class="problematic">``</span></a>) многомерная таблица, позволяющая выбрать файлеры и измерения, чтобы получить правильный агрегированный набор данных перед переходом к более графическому обзору. Сводное представление использует то же определение содержимого, что и представления графика.</p></div><p >Представления графика имеют 4 режима отображения, режим по умолчанию выбирается с помощью атрибута `` @ type``.</p><dl ><dt >Бар (по умолчанию)</dt><dd ><p >гистограмма, первое измерение используется для определения групп на горизонтальной оси, другие измерения определяют агрегированные столбцы в каждой группе.</p><p >По умолчанию столбцы расположены бок о бок, их можно сложить с помощью `` @ stacked = <code >True</code> `` на `` &lt;graph&gt; ``</p></dd><dt >Линия</dt><dd >Двухмерная линейная диаграмма</dd><dt >пирог</dt><dd >2-мерный пирог</dd></dl><p >Графические представления содержат `` &lt;field&gt; `` с обязательным атрибутом `` @ type``, принимающим значения:</p><dl ><dt >`` row`` (по умолчанию)</dt><dd >поле должно быть агрегировано по умолчанию</dd><dt >`` measure``</dt><dd >поле должно быть агрегировано, а не сгруппировано по</dd></dl><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;graph</span> <span class="na">string=</span><span class="s">&quot;Total idea score by Inventor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;score&quot;</span> <span class="na">type=</span><span class="s">&quot;measure&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/graph&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert alert-warning"><h3 class="alert-title">Предупреждение</h3><p >Представления графика выполняют агрегацию значений базы данных, они не работают с несохраненными вычисляемыми полями.</p></div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Графическое представление</p><p >Добавьте представление «График» в объекте «Сеанс», в котором для каждого курса отображается количество участников в форме гистограммы.</p><ol ><li >Добавьте количество участников в качестве сохраненного вычисляемого поля</li><li >Затем добавьте соответствующий вид</li></ol><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">end_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;End Date&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_get_end_date&#39;</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="s1">&#39;_set_end_date&#39;</span><span class="p">)</span>

<span class="hll">    <span class="n">attendees_count</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span>
</span><span class="hll">        <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Attendees count&quot;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_get_attendees_count&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="hll">
</span>    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;seats&#39;</span><span class="p">,</span> <span class="s1">&#39;attendee_ids&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_taken_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>            <span class="c1"># so add one day to get 5 days instead</span>
            <span class="n">r</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">end_date</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span>

<span class="hll">    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;attendee_ids&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">_get_attendees_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span class="hll">            <span class="n">r</span><span class="o">.</span><span class="n">attendees_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">)</span>
</span><span class="hll">
</span>    <span class="nd">@api</span><span class="o">.</span><span class="n">constrains</span><span class="p">(</span><span class="s1">&#39;instructor_id&#39;</span><span class="p">,</span> <span class="s1">&#39;attendee_ids&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_check_instructor_not_in_attendees</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</pre></div>
</div>
</div><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span>            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>

<span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;openacademy_session_graph_view&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>openacademy.session.graph<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;graph</span> <span class="na">string=</span><span class="s">&quot;Participations by Courses&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;course_id&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;attendees_count&quot;</span> <span class="na">type=</span><span class="s">&quot;measure&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/graph&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span>        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span> <span class="na">id=</span><span class="s">&quot;session_list_action&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Sessions<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
<span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form,calendar,gantt,graph<span class="nt">&lt;/field&gt;</span>
</span>        <span class="nt">&lt;/record&gt;</span>

        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;session_menu&quot;</span> <span class="na">name=</span><span class="s">&quot;Sessions&quot;</span>
</pre></div>
</div>
</div></div></div></section><section id="kanban"><h3 >Kanban</h3><p >Используется для организации задач, производственных процессов и т. Д.… Их корневым элементом является `` &lt;kanban&gt; <a href="#id1"><span id="id2" class="problematic">``</span></a>.</p><p >Представление Канбан показывает набор карт, возможно сгруппированных в столбцы. Каждая карточка представляет запись, а каждый столбец - значения поля агрегации.</p><p >Например, задачи проекта могут быть организованы по этапам (каждый столбец является этапом) или по ответственным (каждый столбец является пользователем) и т. Д.</p><p >Представления Kanban определяют структуру каждой карты как набор элементов формы (включая базовый HTML) и <a href="../reference/qweb.html#reference-qweb" class="reference internal"><span class="std std-ref">Qweb</span></a>.</p><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Канбан вид</p><p >Добавьте представление Kanban, отображающее сеансы, сгруппированные по курсам (таким образом, столбцы - это курсы).</p><ol ><li >Добавьте целочисленное поле `` color`` к модели * Session *</li><li >Добавьте представление kanban и обновите действие</li></ol><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">duration</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Duration in days&quot;</span><span class="p">)</span>
    <span class="n">seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Number of seats&quot;</span><span class="p">)</span>
    <span class="n">active</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="hll">    <span class="n">color</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
</span>
    <span class="n">instructor_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Instructor&quot;</span><span class="p">,</span>
        <span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;instructor&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
</pre></div>
</div>
</div><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml+django"><div class="highlight"><pre><span></span>            &lt;/field&gt;
        &lt;/record&gt;

<span class="hll">        &lt;record model=&quot;ir.ui.view&quot; id=&quot;view_openacad_session_kanban&quot;&gt;
</span><span class="hll">            &lt;field name=&quot;name&quot;&gt;openacademy.session.kanban&lt;/field&gt;
</span><span class="hll">            &lt;field name=&quot;model&quot;&gt;openacademy.session&lt;/field&gt;
</span><span class="hll">            &lt;field name=&quot;arch&quot; type=&quot;xml&quot;&gt;
</span><span class="hll">                &lt;kanban default_group_by=&quot;course_id&quot;&gt;
</span><span class="hll">                    &lt;field name=&quot;color&quot;/&gt;
</span><span class="hll">                    &lt;templates&gt;
</span><span class="hll">                        &lt;t t-name=&quot;kanban-box&quot;&gt;
</span><span class="hll">                            &lt;div
</span><span class="hll">                                    t-attf-class=&quot;oe_kanban_color_{{kanban_getcolor(record.color.raw_value)}}
</span><span class="hll">                                                  oe_kanban_global_click_edit oe_semantic_html_override
</span><span class="hll">                                                  oe_kanban_card {{record.group_fancy==1 ? &#39;oe_kanban_card_fancy&#39; : &#39;&#39;}}&quot;&gt;
</span><span class="hll">                                &lt;div class=&quot;oe_dropdown_kanban&quot;&gt;
</span><span class="hll">                                    &lt;!-- dropdown menu --&gt;
</span><span class="hll">                                    &lt;div class=&quot;oe_dropdown_toggle&quot;&gt;
</span><span class="hll">                                        &lt;i class=&quot;fa fa-bars fa-lg&quot; title=&quot;Manage&quot; aria-label=&quot;Manage&quot;/&gt;
</span><span class="hll">                                        &lt;ul class=&quot;oe_dropdown_menu&quot;&gt;
</span><span class="hll">                                            &lt;li&gt;
</span><span class="hll">                                                &lt;a type=&quot;delete&quot;&gt;Delete&lt;/a&gt;
</span><span class="hll">                                            &lt;/li&gt;
</span><span class="hll">                                            &lt;li&gt;
</span><span class="hll">                                                &lt;ul class=&quot;oe_kanban_colorpicker&quot;
</span><span class="hll">                                                    data-field=&quot;color&quot;/&gt;
</span><span class="hll">                                            &lt;/li&gt;
</span><span class="hll">                                        &lt;/ul&gt;
</span><span class="hll">                                    &lt;/div&gt;
</span><span class="hll">                                    &lt;div class=&quot;oe_clear&quot;&gt;&lt;/div&gt;
</span><span class="hll">                                &lt;/div&gt;
</span><span class="hll">                                &lt;div t-attf-class=&quot;oe_kanban_content&quot;&gt;
</span><span class="hll">                                    &lt;!-- title --&gt;
</span><span class="hll">                                    Session name:
</span><span class="hll">                                    &lt;field name=&quot;name&quot;/&gt;
</span><span class="hll">                                    &lt;br/&gt;
</span><span class="hll">                                    Start date:
</span><span class="hll">                                    &lt;field name=&quot;start_date&quot;/&gt;
</span><span class="hll">                                    &lt;br/&gt;
</span><span class="hll">                                    duration:
</span><span class="hll">                                    &lt;field name=&quot;duration&quot;/&gt;
</span><span class="hll">                                &lt;/div&gt;
</span><span class="hll">                            &lt;/div&gt;
</span><span class="hll">                        &lt;/t&gt;
</span><span class="hll">                    &lt;/templates&gt;
</span><span class="hll">                &lt;/kanban&gt;
</span><span class="hll">            &lt;/field&gt;
</span><span class="hll">        &lt;/record&gt;
</span><span class="hll">
</span>        &lt;record model=&quot;ir.actions.act_window&quot; id=&quot;session_list_action&quot;&gt;
            &lt;field name=&quot;name&quot;&gt;Sessions&lt;/field&gt;
            &lt;field name=&quot;res_model&quot;&gt;openacademy.session&lt;/field&gt;
<span class="hll">            &lt;field name=&quot;view_mode&quot;&gt;tree,form,calendar,gantt,graph,kanban&lt;/field&gt;
</span>        &lt;/record&gt;

        &lt;menuitem id=&quot;session_menu&quot; name=&quot;Sessions&quot;
</pre></div>
</div>
</div></div></div></section><section id="security"><h2 >Безопасность</h2><p >Механизмы контроля доступа должны быть настроены для достижения согласованной политики безопасности.</p></section><section id="group-based-access-control-mechanisms"><h3 >Механизмы контроля доступа на основе групп</h3><p >Группы создаются как обычные записи в модели `` res.groups`` и получают доступ к меню через определения меню. Однако даже без меню объекты могут быть доступны косвенно, поэтому для групп должны быть определены фактические разрешения на уровне объектов (чтение, запись, создание, отмена связи). Они обычно вставляются через файлы CSV внутри модулей. Также возможно ограничить доступ к определенным полям в представлении или объекте, используя атрибут групп поля.</p></section><section id="access-rights"><h3 >Права доступа</h3><p >Права доступа определяются как записи модели <code >ir.model.access</code>. Каждое право доступа связано с моделью, группой (или без группы для глобального доступа) и набором разрешений: чтение, запись, создание, отмена связи. Такие права доступа обычно создаются CSV-файлом, названным в честь его модели: `` ir.model.access.csv``.</p><div class="highlight-text"><div class="highlight"><pre><span></span>id,name,model_id/id,group_id/id,perm_read,perm_write,perm_create,perm_unlink
access_idea_idea,idea.idea,model_idea_idea,base.group_user,1,1,1,0
access_idea_vote,idea.vote,model_idea_vote,base.group_user,1,1,1,0
</pre></div>
</div>
<div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Добавить контроль доступа через интерфейс Odoo</p><p >Создайте нового пользователя <code >Джон Смит</code>. Затем создайте группу «OpenAcademy / Session Read» с доступом для чтения к модели * Session <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p><ol ><li >Создайте нового пользователя * John Smith * через <span class="menuselection">Settings ‣ Users ‣ Users</span></li><li >Создайте новую группу `` session_read`` через <span class="menuselection">Settings ‣ Users ‣ Groups</span>, она должна иметь доступ для чтения на модели * Session *</li><li >Отредактируйте * John Smith <a href="#id1"><span id="id2" class="problematic">*</span></a>, чтобы сделать его членом `` session_read``</li><li >Войдите в систему как * John Smith <a href="#id1"><span id="id2" class="problematic">*</span></a>, чтобы проверить правильность прав доступа</li></ol></div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Добавить контроль доступа через файлы данных в вашем модуле</p><p >Используя файлы данных,</p><ul ><li >Создать группу * OpenAcademy / Manager * с полным доступом ко всем моделям OpenAcademy</li><li >Сделайте * Session * и * Course * доступными для чтения всем пользователям</li></ul><ol ><li >Создайте новый файл `` openacademy / security / security.xml`` для хранения группы OpenAcademy Manager</li><li >Отредактируйте файл `` openacademy / security / ir.model.access.csv`` с правами доступа к моделям</li><li >Наконец, обновите `` openacademy / __ manifest __. Py``, чтобы добавить в него новые файлы данных.</li></ol><div class="pq-patch"><em >openacademy/__manifest__.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>
    <span class="c1"># always loaded</span>
<span class="hll">    <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="hll">        <span class="s1">&#39;security/security.xml&#39;</span><span class="p">,</span>
</span>        <span class="s1">&#39;security/ir.model.access.csv&#39;</span><span class="p">,</span>
        <span class="s1">&#39;templates.xml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;views/openacademy.xml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;views/partner.xml&#39;</span><span class="p">,</span>
</pre></div>
</div>
</div><em >openacademy/security/ir.model.access.csv</em><div class="pq-section"><div class="highlight-guess"><div class="highlight"><pre><span></span><span class="err">id,name,model_id/id,group_id/id,perm_read,perm_write,perm_create,perm_unlink</span>
<span class="hll"><span class="err">course_manager,course manager,model_openacademy_course,group_manager,1,1,1,1</span>
</span><span class="hll"><span class="err">session_manager,session manager,model_openacademy_session,group_manager,1,1,1,1</span>
</span><span class="hll"><span class="err">course_read_all,course all,model_openacademy_course,,1,0,0,0</span>
</span><span class="hll"><span class="err">session_read_all,session all,model_openacademy_session,,1,0,0,0</span>
</span></pre></div>
</div>
</div><em >openacademy/security/security.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="hll"><span class="nt">&lt;odoo&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;group_manager&quot;</span> <span class="na">model=</span><span class="s">&quot;res.groups&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>OpenAcademy / Manager<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll"><span class="nt">&lt;/odoo&gt;</span>
</span></pre></div>
</div>
</div></div></div></section><section id="record-rules"><h3 >Правила записи</h3><p >Правило записи ограничивает права доступа к подмножеству записей данной модели. Правило является записью модели `` ir.rule`` и связано с моделью, рядом групп (поле many2many), разрешениями, к которым применяется ограничение, и доменом. Домен указывает, к каким записям права доступа ограничены.</p><p >Вот пример правила, которое предотвращает удаление отведений, которые не находятся в состоянии `` cancel``. Обратите внимание, что значение поля `` groups`` должно соответствовать тому же соглашению, что и метод <a href="../reference/orm.html#odoo.models.Model.write" title="odoo.models.Model.write" class="reference internal"><code class="py-meth xref py">write()</code></a> ORM.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;delete_cancelled_only&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.rule&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Only cancelled leads may be deleted<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;crm.model_crm_lead&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;groups&quot;</span> <span class="na">eval=</span><span class="s">&quot;[(4, ref(&#39;sales_team.group_sale_manager&#39;))]&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_read&quot;</span> <span class="na">eval=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_write&quot;</span> <span class="na">eval=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_create&quot;</span> <span class="na">eval=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_unlink&quot;</span> <span class="na">eval=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;domain_force&quot;</span><span class="nt">&gt;</span>[(&#39;state&#39;,&#39;=&#39;,&#39;cancel&#39;)]<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Правило записи</p><p >Добавьте правило записи для модели Course и группы «OpenAcademy / Manager», которая ограничивает доступ `` write`` и `` unlink`` к ответственному за курс. Если курс не несет ответственности, все пользователи группы должны иметь возможность его изменить.</p><p >Создайте новое правило в `` openacademy / security / security.xml``:</p><div class="pq-patch"><em >openacademy/security/security.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span>        <span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;group_manager&quot;</span> <span class="na">model=</span><span class="s">&quot;res.groups&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>OpenAcademy / Manager<span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>
<span class="hll">    
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;only_responsible_can_modify&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.rule&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Only Responsible can modify Course<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;model_openacademy_course&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;groups&quot;</span> <span class="na">eval=</span><span class="s">&quot;[(4, ref(&#39;openacademy.group_manager&#39;))]&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_read&quot;</span> <span class="na">eval=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_write&quot;</span> <span class="na">eval=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_create&quot;</span> <span class="na">eval=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_unlink&quot;</span> <span class="na">eval=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;domain_force&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                [&#39;|&#39;, (&#39;responsible_id&#39;,&#39;=&#39;,False),
</span><span class="hll">                      (&#39;responsible_id&#39;,&#39;=&#39;,user.id)]
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span>
<span class="nt">&lt;/odoo&gt;</span>
</pre></div>
</div>
</div></div></div></section><section id="wizards"><h2 >Волшебники</h2><p >Мастера описывают интерактивные сеансы с пользователем (или диалоговыми окнами) через динамические формы. Мастер - это просто модель, расширяющая класс <a href="../reference/orm.html#odoo.models.TransientModel" title="odoo.models.TransientModel" class="reference internal"><code class="xref py py-class">TransientModel</code></a> вместо <a href="../reference/orm.html#odoo.models.TransientModel" title="odoo.models.TransientModel" class="reference internal"><code class="xref py py-class">TransientModel</code></a>. Класс <a href="../reference/orm.html#odoo.models.TransientModel" title="odoo.models.TransientModel" class="reference internal"><code class="xref py py-class">TransientModel</code></a> расширяет <a href="../reference/orm.html#odoo.models.TransientModel" title="odoo.models.TransientModel" class="reference internal"><code class="xref py py-class">TransientModel</code></a> и повторно использует все существующие механизмы со следующими особенностями:</p><ul ><li >Записи мастера не должны быть постоянными; они автоматически удаляются из базы данных через определенное время. Вот почему они называются * переходные <a href="#id1"><span id="id2" class="problematic">*</span></a>.</li><li >Модели мастера не требуют явных прав доступа: у пользователей есть все права на записи мастера.</li><li >Записи мастера могут ссылаться на обычные записи или записи мастера через поля many2one, но обычные записи * не могут * ссылаться на записи мастера через поле many2one.</li></ul><p >Мы хотим создать мастера, который позволит пользователям создавать участников для определенного сеанса или для списка сеансов одновременно.</p><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Определить мастера</p><p >Создайте модель мастера с отношением many2one с моделью * Session * и отношением many2many с моделью * Partner <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p><p >Добавьте новый файл `` openacademy / wizard.py``:</p><div class="pq-patch"><em >openacademy/__init__.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">controllers</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">partner</span>
<span class="hll"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">wizard</span>
</span></pre></div>
</div>
</div><em >openacademy/wizard.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span class="hll">
</span><span class="hll"><span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span>
</span><span class="hll">
</span><span class="hll"><span class="k">class</span> <span class="nc">Wizard</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">TransientModel</span><span class="p">):</span>
</span><span class="hll">    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;openacademy.wizard&#39;</span>
</span><span class="hll">    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Wizard: Quick Registration of Attendees to Sessions&quot;</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">session_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;openacademy.session&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Session&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="hll">    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Attendees&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</div></div></div></section><section id="launching-wizards"><h3 >Запуск мастеров</h3><p >Мастера запускаются записями `` ir.actions.act_window``, с полем `` target``, установленным в значение `` new``. Последний открывает окно мастера во всплывающем окне. Действие может быть вызвано пунктом меню.</p><p >Существует еще один способ запуска мастера: использование записи `` ir.actions.act_window``, как указано выше, но с дополнительным полем <code >ʻinding_model_id`</code>, который указывает в контексте какой модели доступно действие. Мастер отобразится в контекстных действиях модели над основным видом. Из-за некоторых внутренних перехватов в ORM такое действие объявляется в XML с тегом «act_window».</p><div class="highlight-default code xml"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">act_window</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;launch_the_wizard&quot;</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Launch the Wizard&quot;</span>
            <span class="n">binding_model</span><span class="o">=</span><span class="s2">&quot;context.model.name&quot;</span>
            <span class="n">res_model</span><span class="o">=</span><span class="s2">&quot;wizard.model.name&quot;</span>
            <span class="n">view_mode</span><span class="o">=</span><span class="s2">&quot;form&quot;</span>
            <span class="n">target</span><span class="o">=</span><span class="s2">&quot;new&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p >Мастера используют обычные представления, а их кнопки могут использовать атрибут `` special = <code >cancel</code> <a href="#id1"><span id="id2" class="problematic">``</span></a>, чтобы закрыть окно мастера без сохранения.</p><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Запустите мастера</p><ol ><li >Определите представление формы для мастера.</li><li >Добавьте действие для его запуска в контексте модели * Session <a href="#id1"><span id="id2" class="problematic">*</span></a>.</li><li >Определите значение по умолчанию для поля сеанса в мастере; используйте контекстный параметр `` self._context`` для получения текущего сеанса.</li></ol><div class="pq-patch"><em >openacademy/wizard.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;openacademy.wizard&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Wizard: Quick Registration of Attendees to Sessions&quot;</span>

<span class="hll">    <span class="k">def</span> <span class="nf">_default_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;openacademy.session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;active_id&#39;</span><span class="p">))</span>
</span><span class="hll">
</span>    <span class="n">session_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;openacademy.session&#39;</span><span class="p">,</span>
<span class="hll">        <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Session&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_default_session</span><span class="p">)</span>
</span>    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Attendees&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml+django"><div class="highlight"><pre><span></span>                  parent=&quot;openacademy_menu&quot;
                  action=&quot;session_list_action&quot;/&gt;

<span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;wizard_form_view&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>wizard.form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>openacademy.wizard<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">&quot;Add Attendees&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;group&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;session_id&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;attendee_ids&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/group&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/form&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;act_window</span> <span class="na">id=</span><span class="s">&quot;launch_session_wizard&quot;</span>
</span><span class="hll">                    <span class="na">name=</span><span class="s">&quot;Add Attendees&quot;</span>
</span><span class="hll">                    <span class="na">binding_model=</span><span class="s">&quot;openacademy.session&quot;</span>
</span><span class="hll">                    <span class="na">res_model=</span><span class="s">&quot;openacademy.wizard&quot;</span>
</span><span class="hll">                    <span class="na">view_mode=</span><span class="s">&quot;form&quot;</span>
</span><span class="hll">                    <span class="na">target=</span><span class="s">&quot;new&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">
</span><span class="nt">&lt;/odoo&gt;</span>
</pre></div>
</div>
</div></div></div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Зарегистрировать участников</p><p >Добавьте кнопки в мастер и реализуйте соответствующий метод для добавления участников в данный сеанс.</p><div class="pq-patch"><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml+django"><div class="highlight"><pre><span></span>                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;session_id&quot;</span><span class="nt">/&gt;</span>
                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;attendee_ids&quot;</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;/group&gt;</span>
<span class="hll">                    <span class="nt">&lt;footer&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;button</span> <span class="na">name=</span><span class="s">&quot;subscribe&quot;</span> <span class="na">type=</span><span class="s">&quot;object&quot;</span>
</span><span class="hll">                                <span class="na">string=</span><span class="s">&quot;Subscribe&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_highlight&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                        or
</span><span class="hll">                        <span class="nt">&lt;button</span> <span class="na">special=</span><span class="s">&quot;cancel&quot;</span> <span class="na">string=</span><span class="s">&quot;Cancel&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/footer&gt;</span>
</span>                <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
</div><em >openacademy/wizard.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">session_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;openacademy.session&#39;</span><span class="p">,</span>
        <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Session&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_default_session</span><span class="p">)</span>
    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Attendees&quot;</span><span class="p">)</span>
<span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="o">.</span><span class="n">attendee_ids</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attendee_ids</span>
</span><span class="hll">        <span class="k">return</span> <span class="p">{}</span>
</span></pre></div>
</div>
</div></div></div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Зарегистрировать участников для нескольких сессий</p><p >Измените модель мастера, чтобы участники могли быть зарегистрированы в нескольких сеансах.</p><div class="pq-patch"><em >openacademy/views/openacademy.xml</em><div class="pq-section"><div class="highlight-xml+django"><div class="highlight"><pre><span></span>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">&quot;Add Attendees&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;group&gt;</span>
<span class="hll">                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;session_ids&quot;</span><span class="nt">/&gt;</span>
</span>                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;attendee_ids&quot;</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;/group&gt;</span>
                    <span class="nt">&lt;footer&gt;</span>
</pre></div>
</div>
</div><em >openacademy/wizard.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;openacademy.wizard&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Wizard: Quick Registration of Attendees to Sessions&quot;</span>

<span class="hll">    <span class="k">def</span> <span class="nf">_default_sessions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;openacademy.session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;active_ids&#39;</span><span class="p">))</span>
</span>
<span class="hll">    <span class="n">session_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;openacademy.session&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Sessions&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_default_sessions</span><span class="p">)</span>
</span>    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Attendees&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="hll">        <span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_ids</span><span class="p">:</span>
</span><span class="hll">            <span class="n">session</span><span class="o">.</span><span class="n">attendee_ids</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attendee_ids</span>
</span>        <span class="k">return</span> <span class="p">{}</span>
</pre></div>
</div>
</div></div></div></section><section id="internationalization"><h2 >интернационализация</h2><p >Каждый модуль может предоставлять свои собственные переводы в каталоге i18n, имея файлы с именем LANG.po, где LANG - код языкового стандарта для языка, или сочетание языка и страны, когда они различаются (например, pt.po или pt_BR.po). Переводы будут автоматически загружаться Odoo для всех включенных языков. Разработчики всегда используют английский при создании модуля, а затем экспортируют термины модуля, используя функцию экспорта POT gettext в Odoo ( <span class="menuselection">Settings ‣ Translations ‣ Import/Export ‣ Export Translation</span> без указания языка), чтобы создать файл POT шаблона модуля, а затем получить переведенные файлы PO. Многие IDE имеют плагины или режимы для редактирования и объединения файлов PO / POT.</p><div role="alert" class="alert alert-info"><h3 class="alert-title">Совет</h3><p >Файлы Portable Object, сгенерированные Odoo, публикуются на Transifex. &lt;<a href="https://www.transifex.com/odoo/public/" class="external reference alert-link">https://www.transifex.com/odoo/public/</a>&gt;`__, облегчая перевод программного обеспечения.</p></div><div class="highlight-text"><div class="highlight"><pre><span></span>|- idea/ # The module directory
   |- i18n/ # Translation files
      | - idea.pot # Translation Template (exported from Odoo)
      | - fr.po # French translation
      | - pt_BR.po # Brazilian Portuguese translation
      | (...)
</pre></div>
</div>
<div role="alert" class="alert alert-info"><h3 class="alert-title">Совет</h3><p >По умолчанию экспорт POT Odoo извлекает только метки внутри файлов XML или внутри определений полей в коде Python, но любую строку Python можно преобразовать таким образом, окружив ее функцией <code class="xref py py-func">odoo._()</code> (например,` <code >_ (</code> Label «)` <a href="#id1"><span id="id2" class="problematic">`</span></a>)</p></div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Перевести модуль</p><p >Выберите второй язык для вашей установки Odoo. Переведите ваш модуль, используя возможности, предоставляемые Odoo.</p><ol ><li >Создайте каталог `` openacademy / i18n / ``</li><li >You will need to activate the developer mode
to access the menus mentioned below (
<span class="menuselection">Settings ‣ Activate the developer mode</span>
)</li><li >Install whichever language you want (
<span class="menuselection">Settings ‣ Translations ‣ Languages</span>)</li><li >Generate the missing terms (<span class="menuselection">Settings ‣
Translations ‣ Application Terms ‣ Generate Missing Terms</span>)</li><li >Create a template translation file by exporting (
<span class="menuselection">Settings ‣ Translations -&gt; Import/Export
‣ Export Translation</span>) without specifying a language, save in
<code >openacademy/i18n/</code></li><li >Create a translation file by exporting (
<span class="menuselection">Settings ‣ Translations ‣ Import/Export
‣ Export Translation</span>) and specifying a language. Save it in
<code >openacademy/i18n/</code></li><li >Откройте экспортированный файл перевода (с помощью основного текстового редактора или специального редактора PO-файлов, например, <a href="http://poedit.net" class="external reference alert-link">POEdit</a> и переведите отсутствующие термины</li><li >В `` models.py`` добавьте оператор импорта для функции `` odoo._`` и пометьте отсутствующие строки как переводимые</li><li >Повторите шаги 3-6</li></ol><div class="pq-patch"><em >openacademy/models.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="hll"><span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span><span class="p">,</span> <span class="n">exceptions</span><span class="p">,</span> <span class="n">_</span>
</span>
<span class="k">class</span> <span class="nc">Course</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;openacademy.course&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>        <span class="n">default</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">default</span> <span class="ow">or</span> <span class="p">{})</span>

        <span class="n">copied_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_count</span><span class="p">(</span>
<span class="hll">            <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=like&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Copy of </span><span class="si">{}</span><span class="s2">%&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))])</span>
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">copied_count</span><span class="p">:</span>
<span class="hll">            <span class="n">new_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Copy of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span>        <span class="k">else</span><span class="p">:</span>
<span class="hll">            <span class="n">new_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Copy of </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">copied_count</span><span class="p">)</span>
</span>
        <span class="n">default</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_name</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Course</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seats</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="hll">                    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Incorrect &#39;seats&#39; value&quot;</span><span class="p">),</span>
</span><span class="hll">                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;The number of available seats may not be negative&quot;</span><span class="p">),</span>
</span>                <span class="p">},</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seats</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="hll">                    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Too many attendees&quot;</span><span class="p">),</span>
</span><span class="hll">                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Increase seats or remove excess attendees&quot;</span><span class="p">),</span>
</span>                <span class="p">},</span>
            <span class="p">}</span>

</pre></div>
</div>
</div></div></div></section><section id="reporting"><h2 >Составление отчетов</h2></section><section id="printed-reports"><h3 >Печатные отчеты</h3><p >Odoo использует механизм отчетов, основанный на <a href="../reference/qweb.html#reference-qweb" class="reference internal"><span class="std std-ref">Qweb</span></a>,` Twitter Bootstrap`_ и <a href="http://wkhtmltopdf.org" class="external reference">Wkhtmltopdf</a>.</p><p >Отчет представляет собой сочетание двух элементов:</p><ul ><li ><p >`` ir.actions.report``, для которого `` &lt;report&gt; `` предоставляется элемент ярлыка, он устанавливает различные основные параметры для отчета (тип по умолчанию, должен ли отчет сохраняться в базе данных после генерации,…)</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;report</span>
    <span class="na">id=</span><span class="s">&quot;account_invoices&quot;</span>
    <span class="na">model=</span><span class="s">&quot;account.invoice&quot;</span>
    <span class="na">string=</span><span class="s">&quot;Invoices&quot;</span>
    <span class="na">report_type=</span><span class="s">&quot;qweb-pdf&quot;</span>
    <span class="na">name=</span><span class="s">&quot;account.report_invoice&quot;</span>
    <span class="na">file=</span><span class="s">&quot;account.report_invoice&quot;</span>
    <span class="na">attachment_use=</span><span class="s">&quot;True&quot;</span>
    <span class="na">attachment=</span><span class="s">&quot;(object.state in (&#39;open&#39;,&#39;paid&#39;)) and</span>
<span class="s">        (&#39;INV&#39;+(object.number or &#39;&#39;).replace(&#39;/&#39;,&#39;&#39;)+&#39;.pdf&#39;)&quot;</span>
<span class="nt">/&gt;</span>
</pre></div>
</div>
</li><li ><p >Стандарт :ref:<a href="#id1"><span id="id2" class="problematic">`</span></a>QWeb view &lt;reference/views/qweb&gt;`для фактического отчета:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;web.html_container&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;docs&quot;</span> <span class="na">t-as=</span><span class="s">&quot;o&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;web.external_layout&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h2&gt;</span>Report title<span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/t&gt;</span>

the standard rendering context provides a number of elements, the most
important being:

``docs``
    the records for which the report is printed
``user``
    the user printing the report
</pre></div>
</div>
</li></ul><p >Поскольку отчеты являются стандартными веб-страницами, они доступны через URL-адрес, а выходными параметрами можно управлять через этот URL-адрес, например, HTML-версия отчета * Invoice * доступна по адресу http: // localhost: 8069 / report / html / account .report_invoice / 1 (если установлен `` account``) и PDF-версия по адресу http: // localhost: 8069 / report / pdf / account.report_invoice / 1.</p><div role="alert" id="reference-backend-reporting-printed-reports-pdf-without-styles" class="alert alert-danger"><h3 class="alert-title">Опасно</h3><p >Если кажется, что в вашем отчете PDF отсутствуют стили (т. Е. Текст отображается, но стиль / макет отличается от HTML-версии), возможно, ваш процесс <a href="http://wkhtmltopdf.org" class="external reference alert-link">wkhtmltopdf</a> не может связаться с вашим веб-сервером для их загрузки.</p><p >Если вы проверяете журналы своего сервера и видите, что стили CSS не загружаются при создании отчета в формате PDF, скорее всего, это проблема.</p><p >Процесс <a href="http://wkhtmltopdf.org" class="external reference alert-link">wkhtmltopdf</a> будет использовать системный параметр `` web.base.url`` в качестве * корневого пути * ко всем связанным файлам, но этот параметр автоматически обновляется каждый раз, когда администратор входит в систему. Если ваш сервер находится за каким-то прокси, который не может быть достигнут. Вы можете исправить это, добавив один из следующих системных параметров:</p><ul ><li >`` report.url``, указывающий на URL-адрес, доступный с вашего сервера (вероятно, `` http: // localhost: 8069`` или что-то подобное). Он будет использоваться только для этой цели.</li><li >Параметр `` web.base.url.freeze``, установленный на `` True``, остановит автоматическое обновление `` web.base.url``.</li></ul></div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Создать отчет для модели Session</p><p >Для каждого сеанса он должен отображать имя сеанса, его начало и конец, а также список участников сеанса.</p><div class="pq-patch"><em >openacademy/__manifest__.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>        <span class="s1">&#39;templates.xml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;views/openacademy.xml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;views/partner.xml&#39;</span><span class="p">,</span>
<span class="hll">        <span class="s1">&#39;reports.xml&#39;</span><span class="p">,</span>
</span>    <span class="p">],</span>
    <span class="c1"># only loaded in demonstration mode</span>
    <span class="s1">&#39;demo&#39;</span><span class="p">:</span> <span class="p">[</span>
</pre></div>
</div>
</div><em >openacademy/reports.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="hll"><span class="nt">&lt;odoo&gt;</span>
</span><span class="hll">
</span><span class="hll">    <span class="nt">&lt;report</span>
</span><span class="hll">        <span class="na">id=</span><span class="s">&quot;report_session&quot;</span>
</span><span class="hll">        <span class="na">model=</span><span class="s">&quot;openacademy.session&quot;</span>
</span><span class="hll">        <span class="na">string=</span><span class="s">&quot;Session Report&quot;</span>
</span><span class="hll">        <span class="na">name=</span><span class="s">&quot;openacademy.report_session_view&quot;</span>
</span><span class="hll">        <span class="na">file=</span><span class="s">&quot;openacademy.report_session&quot;</span>
</span><span class="hll">        <span class="na">report_type=</span><span class="s">&quot;qweb-pdf&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">
</span><span class="hll">    <span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">&quot;report_session_view&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;web.html_container&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;docs&quot;</span> <span class="na">t-as=</span><span class="s">&quot;doc&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;web.external_layout&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;h2</span> <span class="na">t-field=</span><span class="s">&quot;doc.name&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;p&gt;</span>From <span class="nt">&lt;span</span> <span class="na">t-field=</span><span class="s">&quot;doc.start_date&quot;</span><span class="nt">/&gt;</span> to <span class="nt">&lt;span</span> <span class="na">t-field=</span><span class="s">&quot;doc.end_date&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;h3&gt;</span>Attendees:<span class="nt">&lt;/h3&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;ul&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;doc.attendee_ids&quot;</span> <span class="na">t-as=</span><span class="s">&quot;attendee&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;li&gt;&lt;span</span> <span class="na">t-field=</span><span class="s">&quot;attendee.name&quot;</span><span class="nt">/&gt;&lt;/li&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;/t&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;/ul&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/div&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/t&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/t&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/t&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/template&gt;</span>
</span><span class="hll">
</span><span class="hll"><span class="nt">&lt;/odoo&gt;</span>
</span></pre></div>
</div>
</div></div></div></section><section id="dashboards"><h3 >Сводки</h3><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Определить панель инструментов</p><p >Определите панель мониторинга, содержащую созданное вами представление графика, представление календаря сеансов и представление списка курсов (переключается на представление формы). Эта панель должна быть доступна через пункт меню в меню и автоматически отображаться в веб-клиенте при выборе главного меню OpenAcademy.</p><ol ><li ><p >Создайте файл `` openacademy / views / session_board.xml``. Он должен содержать представление доски, действия, указанные в этом представлении, действие по открытию панели мониторинга и переопределение пункта главного меню для добавления действия панели мониторинга.</p><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Доступные стили панели инструментов: `` 1``, `` 1-1``, `` 1-2``, `` 2-1`` и `` 1-1-1``</p></div></li><li >Обновите `` openacademy / __ manifest __. Py`` для ссылки на новый файл данных</li></ol><div class="pq-patch"><em >openacademy/__manifest__.py</em><div class="pq-section"><div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;0.1&#39;</span><span class="p">,</span>

    <span class="c1"># any module necessary for this one to work correctly</span>
<span class="hll">    <span class="s1">&#39;depends&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="s1">&#39;board&#39;</span><span class="p">],</span>
</span>
    <span class="c1"># always loaded</span>
    <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>        <span class="s1">&#39;templates.xml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;views/openacademy.xml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;views/partner.xml&#39;</span><span class="p">,</span>
<span class="hll">        <span class="s1">&#39;views/session_board.xml&#39;</span><span class="p">,</span>
</span>        <span class="s1">&#39;reports.xml&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="c1"># only loaded in demonstration mode</span>
</pre></div>
</div>
</div><em >openacademy/views/session_board.xml</em><div class="pq-section"><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="hll"><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span class="hll"><span class="nt">&lt;odoo&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span> <span class="na">id=</span><span class="s">&quot;act_session_graph&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Attendees by course<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>graph<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_id&quot;</span>
</span><span class="hll">                   <span class="na">ref=</span><span class="s">&quot;openacademy.openacademy_session_graph_view&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span> <span class="na">id=</span><span class="s">&quot;act_session_calendar&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Sessions<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>calendar<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;openacademy.session_calendar_view&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span> <span class="na">id=</span><span class="s">&quot;act_course_list&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Courses<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>openacademy.course<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;board_session_form&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Session Dashboard Form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>board.board<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;type&quot;</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">&quot;Session Dashboard&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;board</span> <span class="na">style=</span><span class="s">&quot;2-1&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;column&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;action</span>
</span><span class="hll">                                <span class="na">string=</span><span class="s">&quot;Attendees by course&quot;</span>
</span><span class="hll">                                <span class="na">name=</span><span class="s">&quot;%(act_session_graph)d&quot;</span>
</span><span class="hll">                                <span class="na">height=</span><span class="s">&quot;150&quot;</span>
</span><span class="hll">                                <span class="na">width=</span><span class="s">&quot;510&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;action</span>
</span><span class="hll">                                <span class="na">string=</span><span class="s">&quot;Sessions&quot;</span>
</span><span class="hll">                                <span class="na">name=</span><span class="s">&quot;%(act_session_calendar)d&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;/column&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;column&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;action</span>
</span><span class="hll">                                <span class="na">string=</span><span class="s">&quot;Courses&quot;</span>
</span><span class="hll">                                <span class="na">name=</span><span class="s">&quot;%(act_course_list)d&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;/column&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/board&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/form&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span> <span class="na">id=</span><span class="s">&quot;open_board_session&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Session Dashboard<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>board.board<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;usage&quot;</span><span class="nt">&gt;</span>menu<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;board_session_form&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;menuitem</span>
</span><span class="hll">            <span class="na">name=</span><span class="s">&quot;Session Dashboard&quot;</span> <span class="na">parent=</span><span class="s">&quot;base.menu_reporting_dashboard&quot;</span>
</span><span class="hll">            <span class="na">action=</span><span class="s">&quot;open_board_session&quot;</span>
</span><span class="hll">            <span class="na">sequence=</span><span class="s">&quot;1&quot;</span>
</span><span class="hll">            <span class="na">id=</span><span class="s">&quot;menu_board_session&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">
</span><span class="hll"><span class="nt">&lt;/odoo&gt;</span>
</span></pre></div>
</div>
</div></div></div></section><section id="webservices"><h2 >WebServices</h2><p >Модуль веб-сервиса предлагает общий интерфейс для всех веб-сервисов:</p><ul ><li >XML-RPC</li><li >JSON-RPC</li></ul><p >Бизнес-объекты также могут быть доступны через механизм распределенных объектов. Все они могут быть изменены через клиентский интерфейс с контекстными представлениями.</p><p >Odoo доступен через интерфейсы XML-RPC / JSON-RPC, для которых существуют библиотеки на многих языках.</p></section><section id="xml-rpc-library"><h3 >Библиотека XML-RPC</h3><p >В следующем примере показана программа на Python 3, которая взаимодействует с сервером Odoo с помощью библиотеки `` xmlrpc.client`` ::</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xmlrpc.client</span>

<span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">/xmlrpc/&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>

<span class="n">uid</span> <span class="o">=</span> <span class="n">xmlrpc</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s1">&#39;common&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">DB</span><span class="p">,</span> <span class="n">USER</span><span class="p">,</span> <span class="n">PASS</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Logged in as </span><span class="si">%s</span><span class="s2"> (uid: </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">USER</span><span class="p">,</span> <span class="n">uid</span><span class="p">))</span>

<span class="c1"># Create a new note</span>
<span class="n">sock</span> <span class="o">=</span> <span class="n">xmlrpc</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;color&#39;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s1">&#39;memo&#39;</span> <span class="p">:</span> <span class="s1">&#39;This is a note&#39;</span><span class="p">,</span>
    <span class="s1">&#39;create_uid&#39;</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">note_id</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">DB</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">PASS</span><span class="p">,</span> <span class="s1">&#39;note.note&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Добавить новый сервис для клиента</p><p >Напишите программу на Python, способную отправлять запросы XML-RPC на ПК под управлением Odoo (ваш или ваш инструктор). Эта программа должна отображать все сессии и их соответствующее количество мест. Также следует создать новую сессию для одного из курсов.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">xmlrpc.client</span>
<span class="n">HOST</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
<span class="n">PORT</span> <span class="o">=</span> <span class="mi">8069</span>
<span class="n">DB</span> <span class="o">=</span> <span class="s1">&#39;openacademy&#39;</span>
<span class="n">USER</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span>
<span class="n">PASS</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span>
<span class="n">ROOT</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">/xmlrpc/&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">HOST</span><span class="p">,</span><span class="n">PORT</span><span class="p">)</span>

<span class="c1"># 1. Login</span>
<span class="n">uid</span> <span class="o">=</span> <span class="n">xmlrpc</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span><span class="n">ROOT</span> <span class="o">+</span> <span class="s1">&#39;common&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">DB</span><span class="p">,</span><span class="n">USER</span><span class="p">,</span><span class="n">PASS</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Logged in as </span><span class="si">%s</span><span class="s2"> (uid:</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">USER</span><span class="p">,</span><span class="n">uid</span><span class="p">))</span>

<span class="n">call</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
    <span class="n">xmlrpc</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span><span class="n">ROOT</span> <span class="o">+</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">,</span>
    <span class="n">DB</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">PASS</span><span class="p">)</span>

<span class="c1"># 2. Read the sessions</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="s1">&#39;openacademy.session&#39;</span><span class="p">,</span><span class="s1">&#39;search_read&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;seats&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">sessions</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Session </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2"> seats)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;seats&#39;</span><span class="p">]))</span>
<span class="c1"># 3.create a new session</span>
<span class="n">session_id</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="s1">&#39;openacademy.session&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="s1">&#39;My session&#39;</span><span class="p">,</span>
    <span class="s1">&#39;course_id&#39;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>
</div>
<p >Вместо того, чтобы использовать жестко идентифицированный идентификатор курса, код может искать курс по имени</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># 3.create a new session for the &quot;Functional&quot; course</span>
<span class="n">course_id</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="s1">&#39;openacademy.course&#39;</span><span class="p">,</span> <span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;ilike&#39;</span><span class="p">,</span><span class="s1">&#39;Functional&#39;</span><span class="p">)])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">session_id</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="s1">&#39;openacademy.session&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="s1">&#39;My session&#39;</span><span class="p">,</span>
    <span class="s1">&#39;course_id&#39;</span> <span class="p">:</span> <span class="n">course_id</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>
</div>
</div></section><section id="json-rpc-library"><h3 >Библиотека JSON-RPC</h3><p >В следующем примере показана программа Python 3, которая взаимодействует с сервером Odoo со стандартными библиотеками Python `` urllib.request`` и `` json``. В этом примере предполагается, что приложение ** Productivity ** (`` note``) установлено</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="n">HOST</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
<span class="n">PORT</span> <span class="o">=</span> <span class="mi">8069</span>
<span class="n">DB</span> <span class="o">=</span> <span class="s1">&#39;openacademy&#39;</span>
<span class="n">USER</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span>
<span class="n">PASS</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span>

<span class="k">def</span> <span class="nf">json_rpc</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
        <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">reply</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">service</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">json_rpc</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;call&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">service</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="n">args</span><span class="p">})</span>

<span class="c1"># log in the given database</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">/jsonrpc&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>
<span class="n">uid</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;common&quot;</span><span class="p">,</span> <span class="s2">&quot;login&quot;</span><span class="p">,</span> <span class="n">DB</span><span class="p">,</span> <span class="n">USER</span><span class="p">,</span> <span class="n">PASS</span><span class="p">)</span>

<span class="c1"># create a new note</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s1">&#39;memo&#39;</span><span class="p">:</span> <span class="s1">&#39;This is another note&#39;</span><span class="p">,</span>
    <span class="s1">&#39;create_uid&#39;</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">note_id</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;execute&quot;</span><span class="p">,</span> <span class="n">DB</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">PASS</span><span class="p">,</span> <span class="s1">&#39;note.note&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p >Примеры могут быть легко адаптированы из XML-RPC в JSON-RPC.</p><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Существует несколько высокоуровневых API-интерфейсов на разных языках для доступа к системам Odoo без * явного * прохождения XML-RPC или JSON-RPC, таких как:</p><ul ><li ><a href="https://github.com/akretion/ooor" class="external reference alert-link">https://github.com/akretion/ooor</a></li><li ><a href="https://github.com/OCA/odoorpc" class="external reference alert-link">https://github.com/OCA/odoorpc</a></li><li ><a href="https://github.com/nicolas-van/openerp-client-lib" class="external reference alert-link">https://github.com/nicolas-van/openerp-client-lib</a></li><li ><a href="http://pythonhosted.org/OdooRPC" class="external reference alert-link">http://pythonhosted.org/OdooRPC</a></li><li ><a href="https://github.com/abhishek-jaiswal/php-openerp-lib" class="external reference alert-link">https://github.com/abhishek-jaiswal/php-openerp-lib</a></li></ul></div><div id="autofields" class="footnote"><span class="footnote-label"><a class="footnote-backref" href="#id2">[1]</a></span> можно: attr: <a href="#id1"><span id="id2" class="problematic">`</span></a>отключить автоматическое создание некоторых полей &lt;odoo.models.Model._log_access&gt; `</div><div id="rawsql" class="footnote"><span class="footnote-label"><a class="footnote-backref" href="#id1">[2]</a></span> Написание необработанных SQL-запросов возможно, но требует осторожности, поскольку обходит все механизмы аутентификации и безопасности Odoo.</div></section>

          </article>
        </div>
        
        <div id="mask"></div>
      </main>
  </div>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
<!-- 
  <footer>
    <div id="footer" class="container">
      <span class="o_logo o_logo_inverse center-block o_footer_logo"></span>
      <div class="row">
        <div class="col-sm-7 col-md-7 col-lg-6">
          <div class="row">
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Community</span>
              <ul>
                <li><a href="https://github.com/odoo/odoo">Github</a></li>
                <li><a href="http://www.odoo.com/page/download">Download</a></li>
                <li class="divider"></li>
                <li><a href="http://runbot.odoo.com/runbot/repo/git-github-com-odoo-enterprise-7">Runbot</a></li>
                <li><a href="https://github.com/odoo/odoo/wiki/Translations">Translations</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/odoo-community">Mailing Lists</a></li>
                <li><a href="http://www.odoo.com/forum/help-1">Forum</a></li>
              </ul>
            </div>
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Services</span>
              <ul>
                <li><a href="https://www.odoo.sh">Odoo Cloud Platform</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/help">Support</a></li>
                <li><a href="https://upgrade.odoo.com">Upgrade</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/partners">Find a partner</a></li>
                <li><a href="http://www.odoo.com/page/become-a-partner">Become a partner</a></li>
                <li class="divider"></li>
                <li><a href="http://training.odoo.com/courses/odoo-functional">Training Center</a></li>
                <li><a href="http://www.odoo.com/page/education-program">Education</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/security">Security</a></li>
              </ul>
            </div>
            <div class="col-xs-12 col-sm-4 mb64">
              <span class="menu_title">About us</span>
              <ul>
                <li><a href="http://www.odoo.com/page/about-us">Our company</a></li>
                <li><a href="http://www.odoo.com/page/contactus">Contact</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/event">Events</a></li>
                <li><a href="http://www.odoo.com/blog">Blog</a></li>
                <li><a href="http://www.odoo.com/blog/6">Customers</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/jobs">Jobs</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/page/legal">Legal</a> | <a href="http://www.odoo.com/privacy">Privacy</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-5 col-md-4 col-md-offset-1 col-lg-5 col-lg-offset-1">
          <p>
            <small>
              Odoo is a suite of open source business apps that cover all your company needs: CRM, eCommerce, accounting, inventory, point of sale, project management, etc.
              <br/><br/>
              Odoo's unique value proposition is to be at the same time very easy to use and fully integrated.
            </small>
          </p>
        </div>
      </div>
    </div>
    <div class="o_footer_bottom">
      <div class="container">
        <a class="small" href="http://www.odoo.com/page/website-builder">Website made with <span class="o_logo o_logo_inverse o_logo_15"></span></a>
        <div class="social-links pull-right">
          <a href="http://www.odoo.com/web/about/facebook"><i class="fa fa-facebook"></i></a>
          <a href="http://www.odoo.com/web/about/twitter"><i class="fa fa-twitter"></i></a>
          <a href="http://www.odoo.com/web/about/linkedin"><i class="fa fa-linkedin"></i></a>
          <a href="mailto:info@odoo.com"><i class="fa fa-envelope"></i></a>
        </div>
      </div>
    </div>
  </footer>
  -->
  </body>
</html>