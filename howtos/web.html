<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Work+Sans:500,600" rel="stylesheet">
  
    <title>Настройка веб-клиента &#8212; Документация odoo 13.0</title>
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/patchqueue.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script><link rel="canonical" href="" />
  
    <link rel="index" title="Алфавитный указатель" href="../genindex.html" />
    <link rel="search" title="Поиск" href="../search.html" />
    <link rel="next" title="Профилирование кода Odoo" href="profilecode.html" />
    <link rel="prev" title="Сборка модуля" href="backend.html" /> 
  </head><body><header class="o_main_header o_has_sub_nav o_inverted ">
<!-- 
    <div class="o_main_header_main">
      <a class="pull-left o_logo" href="/"></a>
      <a href="#" class="o_mobile_menu_toggle visible-xs-block pull-right">
        <span class="sr-only">Toggle navigation</span>
        <span class="mdi-navigation-menu"></span>
      </a>
      <div class="o_header_buttons">
        <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
      </div>
      <ul class="o_primary_nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Apps</a>
          <div class="dropdown-menu o_secondary_nav">
            <div class="container">
              <div class="row">
                <div class="col-sm-3 o_website_apps">
                  <div class="o_nav_app_family">
                    <span></span> Websites
                    <div>Build great user experience</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/website-builder">Website Builder</a></li>
                    <li><a href="https://www.odoo.com/page/e-commerce">eCommerce</a></li>
                    <li><a href="https://www.odoo.com/page/blog-engine">Blogs</a></li>
                    <li><a href="https://www.odoo.com/page/community-builder">Forums</a></li>
                    <li><a href="https://www.odoo.com/page/slides">Slides</a></li>
                    <li><a href="https://adspike.odoo.com">SEA</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_sale_apps">
                  <div class="o_nav_app_family">
                    <span></span> Sales
                    <div>Boost your success rate</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/sales">Sales</a></li>
                    <li><a href="https://www.odoo.com/page/crm">CRM</a></li>
                    <li><a href="https://www.odoo.com/page/billing">Invoicing</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Point of Sale</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/point-of-sale">Shops</a></li>
                        <li><a href="https://www.odoo.com/page/pos-restaurant">Restaurants</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/subscriptions">Subscriptions</a></li>
                    <li><a href="https://www.odoo.com/page/sign">Sign</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_operation_apps">
                  <div class="o_nav_app_family">
                    <span></span> Operations
                    <div>It's all about efficiency</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/accounting">Accounting</a></li>
                    <li><a href="https://www.odoo.com/page/project-management">Project</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Human Resources</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/recruitment">Recruitment</a></li>
                        <li><a href="https://www.odoo.com/page/employees">Employees</a></li>
                        <li><a href="https://www.odoo.com/page/expenses">Expenses</a></li>
                        <li><a href="https://www.odoo.com/page/appraisal">Appraisal</a></li>
                        <li><a href="https://www.odoo.com/page/fleet">Fleet</a></li>
                        <li><a href="https://www.odoo.com/page/leaves">Leaves</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/warehouse">Inventory</a></li>
                    <li><a href="https://www.odoo.com/page/purchase">Purchase</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Manufacturing</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/manufacturing">MRP</a></li>
                        <li><a href="https://www.odoo.com/page/plm">PLM</a></li>
                        <li><a href="https://www.odoo.com/page/maintenance">Maintenance</a></li>
                        <li><a href="https://www.odoo.com/page/quality">Quality</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-sm-3 o_productivity_apps">
                  <div class="o_nav_app_family">
                    <span></span> Productivity Tools
                    <div>Great Tools = Happy People</div>
                  </div>
                  <ul>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Communication</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/discuss">Discuss</a></li>
                        <li><a href="https://www.odoo.com/page/discuss-groups">Mailing Lists</a></li>
                        <li><a href="https://www.odoo.com/page/notes">Notes</a></li>
                        <li><a href="#">Help desk</a></li>
                        <li><a href="#">Appointment</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/timesheet">Timesheet</a></li>
                    <li><a href="https://www.odoo.com/page/email-marketing">Email Marketing</a></li>
                    <li><a href="https://www.odoo.com/page/events">Events</a></li>
                    <li><a href="https://www.odoo.com/page/survey">Survey</a></li>
                    <li><a href="https://www.odoo.com/page/live-chat">Live Chat</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <a href="http://www.odoo.com/apps/modules" class="o_store_link"><i class="fa fa-cube fa-fw"></i> Third party apps</a>
          </div>
        </li>
        <li><a href="https://www.odoo.com/page/tour">Tour</a></li>
        <li><a href="https://www.odoo.com/pricing">Pricing</a></li>
        <li><a href="https://www.odoo.com/page/docs">Docs</a></li>
      </ul>
    </div>
-->
    <nav class="navbar o_sub_nav">
      <div class="container">
        <div class="navbar-header visible-xs">
            <button type="button" class="navbar-toggle collapsed text-left btn-block" data-toggle="collapse" data-target="#o_sub-menu" aria-expanded="false">
              Navigate
              <span class="mdi-hardware-keyboard-arrow-down pull-right"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="o_sub-menu">
          <ol class="o_breadcrumb breadcrumb nav navbar-left">
              
              





    
        
            <li><a href="../index.html">Developer Doc</a></li>
        
    
    <li class="active"><a href="#">Настройка веб-клиента</a></li>

              
          </ol>

          <div class="call-to-action navbar-right hidden-xs">
            <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
          </div>

          <ul class="navbar-nav navbar-right nav o_sub_nav_actions">
            
              <li class="divider"></li>
            

            
            


            
          </ul>

          <ul class="nav navbar-nav navbar-right">
            

            
            
<!--
<li><a href="https://www.odoo.com/documentation/user/13.0/index.html">User</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/index.html">Developer</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/setup/install.html">Installation</a></li>
<li><a href="https://odoo.com/slides">eLearning</a></li>
<li><a href="https://www.odoo.com/page/odoo-white-paper">White Papers</a></li>
<li><a href="https://www.odoo.com/page/legal">Legal</a></li>
-->
            

            
          </ul>
        </div>
      </div>
    </nav>
  </header><div id="wrap" class="">
    
    
    
    <figure class="card top has_banner">
      <span class="card-img" style="background-image: url('../_static/banners/build_interface_ext.jpg');"></span>
      <div class="container text-center">
        <h1> Настройка веб-клиента </h1>
      </div>
    </figure>
    
    
    
      <main class="container ">
        
        <div class="o_content row">
          
          <aside>
            <div class="navbar-aside text-center">
              <ul class="nav list-group text-left"><li class="list-group-item"><a href="#a-simple-module" class="reference internal ripple">Простой модуль</a></li><li class="list-group-item"><a href="#odoo-javascript-module" class="reference internal ripple">Модуль JavaScript Odoo</a></li><li class="list-group-item"><a href="#classes" class="reference internal ripple">Классы</a></li><li class="list-group-item"><a href="#widgets-basics" class="reference internal ripple">Основы виджетов</a><ul ><li class="list-group-item"><a href="#your-first-widget" class="reference internal ripple">Ваш первый виджет</a></li><li class="list-group-item"><a href="#display-content" class="reference internal ripple">Показать содержимое</a></li><li class="list-group-item"><a href="#widget-parents-and-children" class="reference internal ripple">Виджет Родители и Дети</a></li><li class="list-group-item"><a href="#destroying-widgets" class="reference internal ripple">Уничтожение виджетов</a></li></ul></li><li class="list-group-item"><a href="#the-qweb-template-engine" class="reference internal ripple">Шаблонный движок QWeb</a><ul ><li class="list-group-item"><a href="#using-qweb" class="reference internal ripple">Использование QWeb</a><ul ><li class="list-group-item"><a href="#qweb-context" class="reference internal ripple">Контекст QWeb</a></li><li class="list-group-item"><a href="#template-declaration" class="reference internal ripple">Шаблон декларации</a></li><li class="list-group-item"><a href="#escaping" class="reference internal ripple">Спасаясь</a></li><li class="list-group-item"><a href="#outputting-html" class="reference internal ripple">Вывод HTML</a></li><li class="list-group-item"><a href="#conditionals" class="reference internal ripple">Conditionals</a></li><li class="list-group-item"><a href="#iteration" class="reference internal ripple">итерация</a></li><li class="list-group-item"><a href="#defining-attributes" class="reference internal ripple">Определение атрибутов</a></li><li class="list-group-item"><a href="#calling-other-templates" class="reference internal ripple">Вызов других шаблонов</a></li><li class="list-group-item"><a href="#to-learn-more-about-qweb" class="reference internal ripple">Чтобы узнать больше о QWeb</a></li><li class="list-group-item"><a href="#exercise" class="reference internal ripple">Упражнение</a></li></ul></li></ul></li><li class="list-group-item"><a href="#widget-helpers" class="reference internal ripple">Помощники виджетов</a><ul ><li class="list-group-item"><a href="#widget-s-jquery-selector" class="reference internal ripple">JQuery Selector `` Widget``</a></li><li class="list-group-item"><a href="#easier-dom-events-binding" class="reference internal ripple">Более простая привязка событий DOM</a></li></ul></li><li class="list-group-item"><a href="#widget-events-and-properties" class="reference internal ripple">Виджет События и Свойства</a><ul ><li class="list-group-item"><a href="#events" class="reference internal ripple">События</a></li><li class="list-group-item"><a href="#properties" class="reference internal ripple">свойства</a></li><li class="list-group-item"><a href="#id3" class="reference internal ripple">Упражнение</a></li></ul></li><li class="list-group-item"><a href="#modify-existing-widgets-and-classes" class="reference internal ripple">Изменить существующие виджеты и классы</a></li><li class="list-group-item"><a href="#translations" class="reference internal ripple">Переводы</a></li><li class="list-group-item"><a href="#communication-with-the-odoo-server" class="reference internal ripple">Связь с сервером Odoo</a><ul ><li class="list-group-item"><a href="#contacting-models" class="reference internal ripple">Связаться с моделями</a></li><li class="list-group-item"><a href="#compoundcontext" class="reference internal ripple">CompoundContext</a></li><li class="list-group-item"><a href="#queries" class="reference internal ripple">Запросы</a></li></ul></li><li class="list-group-item"><a href="#exercises" class="reference internal ripple">упражнения</a></li><li class="list-group-item"><a href="#existing-web-components" class="reference internal ripple">Существующие веб-компоненты</a><ul ><li class="list-group-item"><a href="#the-action-manager" class="reference internal ripple">Диспетчер действий</a><ul ><li class="list-group-item"><a href="#using-the-action-manager" class="reference internal ripple">Использование диспетчера действий</a></li></ul></li><li class="list-group-item"><a href="#client-actions" class="reference internal ripple">Действия клиента</a></li><li class="list-group-item"><a href="#architecture-of-the-views" class="reference internal ripple">Архитектура взглядов</a><ul ><li class="list-group-item"><a href="#the-view-manager" class="reference internal ripple">Диспетчер представлений</a></li><li class="list-group-item"><a href="#the-views" class="reference internal ripple">Виды</a></li></ul></li><li class="list-group-item"><a href="#the-form-view-fields" class="reference internal ripple">Поля просмотра формы</a><ul ><li class="list-group-item"><a href="#creating-a-new-type-of-field" class="reference internal ripple">Создание нового типа поля</a><ul ><li class="list-group-item"><a href="#simple-read-only-field" class="reference internal ripple">Простое поле только для чтения</a></li><li class="list-group-item"><a href="#read-write-field" class="reference internal ripple">Поле для чтения и записи</a></li></ul></li></ul></li><li class="list-group-item"><a href="#the-form-view-custom-widgets" class="reference internal ripple">Форма просмотра пользовательских виджетов</a></li></ul></li></ul>
              
              <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/13.0/doc/howtos/web.rst" class="gith-link">
                  Edit on GitHub
              </a></p>
              
            </div>
          </aside>
          
          <article class="doc-body ">
            
            
  <section id="customizing-the-web-client"><p >Примечание: этот раздел действительно устарел. Когда-нибудь он будет обновлен, но, тем не менее, этот учебник, вероятно, будет разочаровывать, поскольку он был написан очень давно.</p><p >Это руководство о создании модулей для веб-клиента Odoo.</p><p >Чтобы создать сайты с помощью Odoo, смотрите <a href="website.html" class="reference internal"><span class="doc">Создание сайта</span></a>; чтобы добавить бизнес-возможности или расширить существующие бизнес-системы Odoo, смотрите <a href="website.html" class="reference internal"><span class="doc">Создание сайта</span></a>.</p><div role="alert" class="alert alert-warning"><h3 class="alert-title">Предупреждение</h3><p >Это руководство предполагает знание:</p><ul ><li >Основы Javascript и хорошие практики</li><li ><a href="http://jquery.org" class="external reference alert-link">jQuery</a></li><li ><a href="http://underscorejs.org" class="external reference alert-link">Underscore.js</a></li></ul><p >Также требуется :ref:<a href="#id1"><span id="id2" class="problematic">`</span></a>an installed Odoo &lt;setup/install&gt;`и <a href="http://git-scm.com" class="external reference alert-link">Git</a>.</p></div></section><section id="a-simple-module"><h2 >Простой модуль</h2><p >Давайте начнем с простого модуля Odoo, который содержит базовую конфигурацию веб-компонента и позволяет нам тестировать веб-фреймворк.</p><p >Пример модуля доступен онлайн и может быть загружен с помощью следующей команды:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> git clone http://github.com/odoo/petstore
</pre></div>
</div>
<p >Это создаст папку `` petstore``, где бы вы ни выполняли команду. Затем вам нужно добавить эту папку в путь Odoo: option: <code >addons &lt;odoo-bin --addons-path&gt; `, создайте новую базу данных и установите модуль</code> <code >oepetstore`</code>.</p><p >Если вы просматриваете папку `` petstore``, вы должны увидеть следующее содержимое:</p><div class="highlight-text"><div class="highlight"><pre><span></span>oepetstore
|-- images
|   |-- alligator.jpg
|   |-- ball.jpg
|   |-- crazy_circle.jpg
|   |-- fish.jpg
|   `-- mice.jpg
|-- __init__.py
|-- oepetstore.message_of_the_day.csv
|-- __manifest__.py
|-- petstore_data.xml
|-- petstore.py
|-- petstore.xml
`-- static
    `-- src
        |-- css
        |   `-- petstore.css
        |-- js
        |   `-- petstore.js
        `-- xml
            `-- petstore.xml
</pre></div>
</div>
<p >Модуль уже содержит различные настройки сервера. Мы вернемся к ним позже, а сейчас давайте сосредоточимся на веб-контенте в папке `` static``.</p><p >Файлы, используемые на «веб» стороне модуля Odoo, должны быть помещены в «статическую» папку, чтобы они были доступны для веб-браузера, файлы за пределами этой папки не могут быть извлечены браузерами. Подпапки `` src / css``, `` src / js`` и `` src / xml`` являются стандартными и не являются строго необходимыми.</p><dl ><dt >`` Oepetstore / статический / CSS / petstore.css``</dt><dd >В настоящее время пусто, будет содержать <a href="http://www.w3.org/Style/CSS/Overview.en.html" class="external reference">CSS</a> для содержимого зоомагазина</dd><dt >`` Oepetstore / статический / XML / petstore.xml``</dt><dd >В основном пустой, будет содержать шаблоны <a href="../reference/qweb.html#reference-qweb" class="reference internal"><span class="std std-ref">Qweb</span></a></dd><dt >`` Oepetstore / статический / JS / petstore.js``</dt><dd ><p >Самая важная (и интересная) часть содержит логику приложения (или, по крайней мере, его веб-браузера) в виде javascript. В настоящее время он должен выглядеть так:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;pet store home page loaded&quot;</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
        <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl><p >Который только печатает небольшое сообщение в консоли браузера.</p><p >Файлы в папке `` static`` должны быть определены в модуле для их правильной загрузки. Все в `` src / xml`` определено в `` __manifest __. Py``, а содержимое `` src / css`` и `` src / js`` определено в `` petstore.xml``, или похожий файл.</p><div role="alert" class="alert alert-warning"><h3 class="alert-title">Предупреждение</h3><p >Все файлы JavaScript объединяются и: term: <code >minified</code> для улучшения времени загрузки приложения.</p><p >Одним из недостатков является то, что отладка становится более сложной, так как отдельные файлы исчезают, а код становится значительно менее читаемым. Этот процесс можно отключить, включив «режим разработчика»: войдите в свой экземпляр Odoo (по умолчанию пользователь * admin * пароль * admin <a href="#id1"><span id="id2" class="problematic">*</span></a>), откройте меню пользователя (в правом верхнем углу экрана Odoo) и выберите : guilabel: <code >О Odoo</code> тогда: guilabel:` Активируйте режим разработчика`:</p><img src="../_images/about_odoo.png" class="center-block img-responsive"><img src="../_images/devmode.png" class="center-block img-responsive"><p >Это перезагрузит веб-клиент с отключенными оптимизациями, что значительно облегчит разработку и отладку.</p></div></section><section id="odoo-javascript-module"><h2 >Модуль JavaScript Odoo</h2><p >Javascript не имеет встроенных модулей. В результате все переменные, определенные в разных файлах, объединяются и могут конфликтовать. Это привело к появлению различных шаблонов модулей, используемых для создания чистых пространств имен и ограничения рисков конфликтов имен.</p><p >Инфраструктура Odoo использует один такой шаблон для определения модулей в веб-аддонах, чтобы как код пространства имен, так и правильно упорядочить его загрузку.</p><p >`` oepetstore / static / js / petstore.js`` содержит объявление модуля</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">local</span><span class="p">.</span><span class="nx">xxx</span> <span class="o">=</span> <span class="p">...;</span>
<span class="p">}</span>
</pre></div>
</div>
<p >В сети Odoo модули объявляются как функции, установленные в глобальной переменной `` odoo``. Имя функции должно совпадать с надстройкой (в данном случае `` oepetstore``), чтобы инфраструктура могла найти ее и автоматически инициализировать.</p><p >Когда веб-клиент загружает ваш модуль, он вызывает корневую функцию и предоставляет два параметра:</p><ul ><li >Первый параметр - это текущий экземпляр веб-клиента Odoo, он предоставляет доступ к различным возможностям, определенным Odoo (переводы, сетевые сервисы), а также к объектам, определенным ядром или другими модулями.</li><li >второй параметр - это ваше собственное локальное пространство имен, автоматически создаваемое веб-клиентом. Объекты и переменные, которые должны быть доступны извне вашего модуля (либо потому, что веб-клиент Odoo должен вызывать их, либо потому, что другие могут захотеть настроить их), должны быть установлены внутри этого пространства имен.</li></ul></section><section id="classes"><h2 >Классы</h2><p >Во многом как модули и в отличие от большинства объектно-ориентированных языков, javascript не встраивает * классы * [#classes] _, хотя он обеспечивает примерно эквивалентные (если более низкоуровневые и более подробные) механизмы.</p><p >Для простоты и дружелюбия к разработчикам Odoo web предлагает систему классов, основанную на «Простом наследовании JavaScript» Джона Резига.</p><p >Новые классы определяются путем вызова метода <code class="js xref js-func">extend()</code> <code class="js xref js-class">odoo.web.Class()</code></p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Метод <code class="js xref js-func">extend()</code> принимает словарь, описывающий содержимое нового класса (методы и статические атрибуты). В этом случае у него будет только метод `` say_hello``, который не принимает параметров.</p><p >Классы создаются с использованием оператора `` new``</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello&quot; in the console</span>
</pre></div>
</div>
<p >А к атрибутам экземпляра можно получить доступ через `` this``</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Bob&quot;</span><span class="p">;</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob&quot; in the console</span>
</pre></div>
</div>
<p >Классы могут предоставить инициализатор для выполнения начальной настройки экземпляра, определив метод `` init () <code >. Инициализатор получает параметры, переданные при использовании оператора `` new</code></p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob&quot; in the console</span>
</pre></div>
</div>
<p >Также возможно создавать подклассы из существующих (используемых-определенных) классов, вызывая <code class="js xref js-func">extend()</code> в родительском классе, как это делается для подкласса <code class="js xref js-class">Class()</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MySpanishClass</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hola&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySpanishClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hola Bob&quot; in the console</span>
</pre></div>
</div>
<p >При переопределении метода с использованием наследования вы можете использовать `` this._super () `` для вызова оригинального метода</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MySpanishClass</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;translation in Spanish: hola&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySpanishClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob \n translation in Spanish: hola Bob&quot; in the console</span>
</pre></div>
</div>
<div role="alert" class="alert alert-warning"><h3 class="alert-title">Предупреждение</h3><p >`` _super`` не является стандартным методом, он устанавливается на лету для следующего метода в текущей цепочке наследования, если таковой имеется. Он определяется только во время * синхронной * части вызова метода, для использования в асинхронных обработчиках (после сетевых вызовов или в `` setTimeout`` обратных вызовах) ссылка на его значение должна быть сохранена, к ней нельзя обращаться через `` this``</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// broken, will generate an error</span>
<span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// correct</span>
<span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// don&#39;t forget .bind()</span>
    <span class="kd">var</span> <span class="nx">_super</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">_super</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div></section><section id="widgets-basics"><h2 >Основы виджетов</h2><p >Веб-клиент Odoo связывает <a href="http://jquery.org" class="external reference">jQuery</a> для легкой манипуляции с DOM. Он полезен и предоставляет лучший API, чем стандартный <a href="http://www.w3.org/TR/DOM-Level-3-Core/" class="external reference">W3C DOM</a> [#dombugs] _, но недостаточен для структурирования сложных приложений, приводящих к сложному обслуживанию.</p><p >Подобно объектно-ориентированным настольным инструментам пользовательского интерфейса (например, <a href="http://qt-project.org" class="external reference">Qt</a>, <a href="https://developer.apple.com/technologies/mac/cocoa.html" class="external reference">Cocoa</a> или <a href="http://www.gtk.org" class="external reference">GTK</a>), Odoo Web делает определенные компоненты ответственными за разделы страницы. В Odoo web основой для таких компонентов является класс <code class="js xref js-class">Widget()</code>, компонент, специализирующийся на обработке раздела страницы и отображении информации для пользователя.</p></section><section id="your-first-widget"><h3 >Ваш первый виджет</h3><p >Начальный демонстрационный модуль уже предоставляет базовый виджет:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;pet store home page loaded&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Он расширяет <code class="js xref js-class">Widget()</code> и переопределяет стандартный метод <code class="js xref js-func">start()</code>, который - как и предыдущий `` MyClass`` - пока мало что делает.</p><p >Эта строка в конце файла</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
    <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p >регистрирует наш основной виджет как действие клиента. Действия клиента будут объяснены позже, а пока именно это позволяет нашему виджету вызываться и отображаться, когда мы выбираем <span class="menuselection">Pet Store ‣ Pet Store ‣ Home Page</span>.</p><div role="alert" class="alert alert-warning"><h3 class="alert-title">Предупреждение</h3><p >Поскольку виджет будет вызываться извне нашего модуля, веб-клиенту нужно его «полностью определенное» имя, а не локальная версия.</p></div></section><section id="display-content"><h3 >Показать содержимое</h3><p >Виджеты имеют ряд методов и функций, но основы просты:</p><ul ><li >настроить виджет</li><li >отформатировать данные виджета</li><li >отобразить виджет</li></ul><p >Виджет `` HomePage`` уже имеет метод <code class="js xref js-func">start()</code>. Этот метод является частью обычного жизненного цикла виджета и автоматически вызывается после вставки виджета на страницу. Мы можем использовать его для отображения некоторого контента.</p><p >Все виджеты имеют: attr: <code >~ odoo.Widget. $ El</code>, который представляет раздел страницы, за который они отвечают (как объект <a href="http://jquery.org" class="external reference">jQuery</a>). Содержимое виджета должно быть вставлено туда. По умолчанию: attr: <code >~ odoo.Widget. $ El</code> является пустым` ` &lt;div&gt; Элемент.</p><p >`` ` &lt;div&gt; Элемент `` обычно невидим для пользователя, если у него нет содержимого (или без определенных стилей, задающих его размер), поэтому на странице ничего не отображается, когда запускается `` HomePage``.</p><p >Давайте добавим некоторый контент в корневой элемент виджета, используя jQuery</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Это сообщение теперь появится при открытии <span class="menuselection">Pet Store ‣ Pet Store ‣ Home Page</span></p><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Чтобы обновить код JavaScript, загруженный в Odoo Web, вам необходимо перезагрузить страницу. Нет необходимости перезагружать сервер Odoo.</p></div><p >Виджет `` HomePage`` используется Odoo Web и управляется автоматически. Чтобы узнать, как использовать виджет «с нуля», давайте создадим новый:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;We are so happy to see you again in this menu!&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Теперь мы можем добавить наш `` GreetingsWidget`` к `` HomePage`` с помощью метода `` GreetingsWidget`` <code class="js xref js-func">appendTo()</code></p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">greeting</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<ul ><li >`` HomePage`` сначала добавляет свой собственный контент в свой корень DOM</li><li >Затем `` HomePage`` создает экземпляр `` GreetingsWidget``</li><li >Наконец, он сообщает `` GreetingsWidget``, куда вставлять себя, делегируя часть его: attr: <code >~ odoo.Widget. $ El`</code> <code >GreetingsWidget`</code>.</li></ul><p >Когда вызывается метод <code class="js xref js-func">appendTo()</code>, он просит виджет вставить себя в указанную позицию и отобразить его содержимое. Метод <code class="js xref js-func">appendTo()</code> будет вызываться во время вызова <code class="js xref js-func">appendTo()</code>.</p><p >Чтобы увидеть, что происходит под отображаемым интерфейсом, мы будем использовать браузер DOM Explorer. Но сначала давайте немного изменим наши виджеты, чтобы нам было легче находить, где они находятся, путем: attr: <a href="#id1"><span id="id2" class="problematic">`</span></a>добавления класса к их корневым элементам &lt;odoo.Widget.className&gt; <a href="#id3"><span id="id4" class="problematic">`</span></a>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;oe_petstore_homepage&#39;</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">});</span>
<span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;oe_petstore_greetings&#39;</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Если вы можете найти соответствующий раздел DOM (щелкните правой кнопкой мыши по тексту, затем: guilabel: <code >Inspect Element</code>), он должен выглядеть следующим образом:</p><div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Hello dear Odoo user!<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;oe_petstore_greetings&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>We are so happy to see you again in this menu!<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p >Который ясно показывает два `` &lt;div&gt; Элементы `` автоматически создаются <code class="js xref js-class">Widget()</code>, потому что мы добавили к ним несколько классов.</p><p >Мы также можем увидеть два div-сообщения, которые мы добавили сами</p><p >Наконец, обратите внимание на `` &lt;div class=»oe_petstore_greetings»&gt; Элемент <code >, который представляет экземпляр `` GreetingsWidget</code>, * находится внутри * `` &lt;div class=»oe_petstore_homepage»&gt; `` который представляет экземпляр `` HomePage``, так как мы добавили</p></section><section id="widget-parents-and-children"><h3 >Виджет Родители и Дети</h3><p >В предыдущей части мы создали экземпляр виджета, используя следующий синтаксис:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</pre></div>
</div>
<p >Первый аргумент - это `` this``, который в этом случае был экземпляром `` HomePage``. Это сообщает создаваемому виджету, какой другой виджет является его * parent <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p><p >Как мы уже видели, виджеты обычно вставляются в DOM другим виджетом и * внутри * этого корневого элемента другого виджета. Это означает, что большинство виджетов являются «частью» другого виджета и существуют от его имени. Мы называем контейнер * parent <a href="#id1"><span id="id2" class="problematic">*</span></a>, а содержащийся в нем виджет * child <a href="#id3"><span id="id4" class="problematic">*</span></a>.</p><p >Ввиду множества технических и концептуальных причин, виджету необходимо знать, кто является его родителем, а кто - его дочерними.</p><dl ><dt >: FUNC: <code >~ odoo.Widget.getParent</code></dt><dd ><p >может быть использован для получения родителя виджета:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getParent</span><span class="p">().</span><span class="nx">$el</span> <span class="p">);</span>
        <span class="c1">// will print &quot;div.oe_petstore_homepage&quot; in the console</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</dd><dt >: FUNC: <code >~ odoo.Widget.getChildren</code></dt><dd ><p >может быть использован для получения списка своих детей:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">greeting</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getChildren</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="nx">$el</span><span class="p">);</span>
        <span class="c1">// will print &quot;div.oe_petstore_greetings&quot; in the console</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</dd></dl><p >При переопределении метода <code class="js xref js-func">init()</code> крайне важно * передать родительский элемент в вызов` <code >this._super ()</code> <a href="#id1"><span id="id2" class="problematic">`</span></a>, иначе отношение не будет установлено правильно</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Наконец, если у виджета нет родителя (например, потому что это корневой виджет приложения), `` null`` может быть предоставлено как parent</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</pre></div>
</div>
</section><section id="destroying-widgets"><h3 >Уничтожение виджетов</h3><p >Если вы можете отображать контент для своих пользователей, вы также сможете удалить его. Это делается с помощью метода <code class="js xref js-func">destroy()</code></p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">greeting</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
</pre></div>
</div>
<p >Когда виджет уничтожается, он сначала вызывает <code class="js xref js-func">destroy()</code> для всех своих дочерних элементов. Затем он стирает себя из DOM. Если вы установили постоянные структуры в <code class="js xref js-func">destroy()</code> или <code class="js xref js-func">destroy()</code>, которые должны быть явно очищены (потому что сборщик мусора не будет их обрабатывать), вы можете переопределить <code class="js xref js-func">destroy()</code>.</p><div role="alert" class="alert alert-danger"><h3 class="alert-title">Опасно</h3><p >при переопределении <code class="js xref js-func">destroy()</code>,` <code >_super ()</code> <code >* должны всегда вызываться *, иначе виджет и его дочерние элементы очищаются неправильно, оставляя возможные утечки памяти и</code> фантомные события <a href="#id1"><span id="id2" class="problematic">`</span></a>, даже если ошибка не отображается</p></div></section><section id="the-qweb-template-engine"><h2 >Шаблонный движок QWeb</h2><p >В предыдущем разделе мы добавляли контент в наши виджеты, напрямую манипулируя (и добавляя в) их DOM:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p >Это позволяет генерировать и отображать любой тип контента, но становится громоздким при генерации значительного количества DOM (много дублирования, проблемы с цитированием, …)</p><p >Как и во многих других средах, решение Odoo заключается в использовании «движка шаблонов». Шаблонный движок Odoo называется <a href="../reference/qweb.html#reference-qweb" class="reference internal"><span class="std std-ref">Qweb</span></a>.</p><p >QWeb - это язык шаблонов на основе XML, похожий на <a href="http://en.wikipedia.org/wiki/Genshi_(templating_language)" class="external reference">Genshi</a>,` Thymeleaf &lt;<a href="http://en.wikipedia.org/wiki/Thymeleaf" class="external reference">http://en.wikipedia.org/wiki/Thymeleaf</a>&gt;`_ или` Facelets &lt;<a href="http://en.wikipedia.org/wiki/Facelets" class="external reference">http://en.wikipedia.org/wiki/Facelets</a>&gt;`_. Он имеет следующие характеристики:</p><ul ><li >Он полностью реализован на JavaScript и отображается в браузере</li><li >Каждый файл шаблона (файлы XML) содержит несколько шаблонов</li><li >Он имеет специальную поддержку в Odoo Web <code class="js xref js-class">Widget()</code>, хотя его можно использовать и вне веб-клиента Odoo (и его можно использовать <code class="js xref js-class">Widget()</code>, не полагаясь на QWeb).</li></ul><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Основанием для использования QWeb вместо существующих механизмов шаблонов javascript является расширяемость уже существующих (сторонних) шаблонов, во многом аналогично Odoo <a href="../reference/views.html#reference-views" class="alert-link reference internal"><span class="std std-ref">views</span></a>.</p><p >Большинство шаблонизаторов javascript основаны на тексте, что исключает простую структурную расширяемость, когда шаблонизатор на основе XML может быть изменен в общем, используя, например, XPath или CSS и DSL с изменением дерева (или даже просто XSLT). Такая гибкость и расширяемость является основной характеристикой Odoo, и ее потеря считалась неприемлемой.</p></div></section><section id="using-qweb"><h3 >Использование QWeb</h3><p >Сначала давайте определим простой шаблон QWeb в почти пустом файле `` oepetstore / static / src / xml / petstore.xml``:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;background-color: red;&quot;</span><span class="nt">&gt;</span>This is some simple HTML<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<p >Теперь мы можем использовать этот шаблон внутри виджета `` HomePage``. Используя переменную загрузчика `` QWeb``, определенную в верхней части страницы, мы можем вызвать шаблон, определенный в файле XML:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">));</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p ><code class="js xref js-func">QWeb.render()</code> looks for the specified template, renders it to a string
and returns the result.</p><p >Однако, поскольку <code class="js xref js-class">Widget()</code> имеет специальную интеграцию для QWeb, шаблон можно установить непосредственно в виджете с помощью его атрибута: attr:` ~ odoo.Widget.template`</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Несмотря на то, что результат выглядит примерно одинаково, есть два различия между этими использованиями:</p><ul ><li >во второй версии шаблон отображается прямо перед вызовом <code class="js xref js-func">start()</code></li><li >в первой версии содержимое шаблона добавляется в корневой элемент виджета, тогда как во второй версии корневой элемент шаблона непосредственно * устанавливается как * корневой элемент виджета. Именно поэтому подвиджет <code >приветствия</code> также получает красный фон</li></ul><div role="alert" class="alert alert-warning"><h3 class="alert-title">Предупреждение</h3><p >Шаблоны должны иметь один не `` t`` корневой элемент, особенно если они установлены как виджет: attr: <code >~ odoo.Widget.template</code>. Если имеется несколько «корневых элементов», результаты не определены (обычно используется только первый корневой элемент, а остальные игнорируются).</p></div></section><section id="qweb-context"><h4 >Контекст QWeb</h4><p >Шаблонам QWeb могут быть заданы данные и они могут содержать базовую логику отображения.</p><p >Для явных вызовов <code class="js xref js-func">QWeb.render()</code> данные шаблона передаются как второй параметр:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Klaus&quot;</span><span class="p">});</span>
</pre></div>
</div>
<p >с шаблоном, измененным на:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<p >приведет к:</p><div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Hello Klaus<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p >При использовании интеграции <code class="js xref js-class">Widget()</code> невозможно предоставить дополнительные данные для шаблона. Шаблону будет дана одна переменная контекста `` widget``, ссылающаяся на виджет, визуализируемый непосредственно перед вызовом <code class="js xref js-func">start()</code> (состояние виджета, по сути, будет таким, как установлено <code class="js xref js-func">start()</code>):</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;widget.name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Mordecai&quot;</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Результат:</p><div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Hello Mordecai<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
</section><section id="template-declaration"><h4 >Шаблон декларации</h4><p >Мы видели, как * визуализировать * шаблоны QWeb, теперь давайте посмотрим на синтаксис самих шаблонов.</p><p >Шаблон QWeb состоит из обычного XML, смешанного с директивами QWeb <a href="#id1"><span id="id2" class="problematic">*</span></a>. Директива QWeb объявляется с атрибутами XML, начинающимися с `` t-<a href="#id3"><span id="id4" class="problematic">``</span></a>.</p><p >Самая основная директива - это `` t-name``, используемая для объявления новых шаблонов в файле шаблона:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;templates&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>This is some simple HTML<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<p >`` t-name`` берет имя определяемого шаблона и объявляет, что его можно вызвать с помощью <code class="js xref js-func">QWeb.render()</code>. Он может использоваться только на верхнем уровне файла шаблона.</p></section><section id="escaping"><h4 >Спасаясь</h4><p >Директива `` t-esc`` может использоваться для вывода текста:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
<p >Он принимает выражение Javascript, которое оценивается, результат выражения затем экранируется HTML и вставляется в документ. Поскольку это выражение, можно указать только имя переменной, как указано выше, или более сложное выражение, например, вычисление:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;3+5&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
<p >или вызовы метода:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name.toUpperCase()&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
</section><section id="outputting-html"><h4 >Вывод HTML</h4><p >Чтобы внедрить HTML в отображаемую страницу, используйте `` t-raw``. Как и `` t-esc``, он принимает произвольное выражение Javascript в качестве параметра, но не выполняет шаг HTML-escape.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-raw=</span><span class="s">&quot;name.link(user_account)&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert alert-danger"><h3 class="alert-title">Опасно</h3><p >`` t-raw`` * * не должен * использоваться для каких-либо данных, которые могут содержать неэкранированный пользовательский контент, так как это приводит к уязвимости <a href="http://en.wikipedia.org/wiki/Cross-site_scripting" class="external reference alert-link">межсайтовый скриптинг</a></p></div></section><section id="conditionals"><h4 >Conditionals</h4><p >QWeb может иметь условные блоки, используя `` t-if``. Директива принимает произвольное выражение, если выражение является ложным (`` false``, `` null``, `` 0`` или пустой строкой), весь блок подавляется, в противном случае он отображается.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;true == true&quot;</span><span class="nt">&gt;</span>
        true is true
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;true == false&quot;</span><span class="nt">&gt;</span>
        true is not true
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >У QWeb нет структуры <code >else</code>, используйте второй `` t-if`` с инвертированным исходным условием. Вы можете сохранить условие в локальной переменной, если это сложное или дорогое выражение.</p></div></section><section id="iteration"><h4 >итерация</h4><p >Для итерации по списку используйте `` t-foreach`` и `` t-as``. `` t-foreach`` принимает выражение, возвращающее список для повторения на `` t-as``, принимает имя переменной для привязки к каждому элементу во время итерации.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;names&quot;</span> <span class="na">t-as=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >`` t-foreach`` также можно использовать с числами и объектами (словарями)</p></div></section><section id="defining-attributes"><h4 >Определение атрибутов</h4><p >QWeb предоставляет две связанные директивы для определения вычисляемых атрибутов:: samp: <code >t-att- {name}</code> и: samp: <code >t-attf- {name}</code>. В любом случае * name * - это имя атрибута, который нужно создать (например, `` t-att-id`` определяет атрибут `` id`` после рендеринга).</p><p >`` t-att-`` принимает выражение javascript, результат которого установлен в качестве значения атрибута, это наиболее полезно, если вычисляется все значение атрибута:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;</span>
    Input your name:
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">t-att-value=</span><span class="s">&quot;defaultName&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p >`` t-attf-`` принимает * строку формата <a href="#id1"><span id="id2" class="problematic">*</span></a>. Строка формата - это буквальный текст с блоками интерполяции внутри, а блок интерполяции - это выражение javascript между `` {{`` и <a href="#id3"><span id="id4" class="problematic">``</span></a>}} <a href="#id5"><span id="id6" class="problematic">``</span></a>, которое будет заменено результатом выражения. Это наиболее полезно для атрибутов, которые являются частично литеральными и частично вычисляемыми, такими как класс:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div</span> <span class="na">t-attf-class=</span><span class="s">&quot;container {{ left ? &#39;text-left&#39; : &#39;&#39; }} {{ extra_class }}&quot;</span><span class="nt">&gt;</span>
    insert content here
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
</section><section id="calling-other-templates"><h4 >Вызов других шаблонов</h4><p >Шаблоны могут быть разбиты на под-шаблоны (для простоты, удобства обслуживания, возможности повторного использования или во избежание чрезмерного вложения разметки).</p><p >Это делается с помощью директивы `` t-call``, которая берет имя шаблона для рендеринга:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;A&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-a&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;B&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;B&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-b&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<p >рендеринг шаблона `` A`` приведет к:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-a&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-b&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p >Под-шаблоны наследуют контекст рендеринга своего абонента.</p></section><section id="to-learn-more-about-qweb"><h4 >Чтобы узнать больше о QWeb</h4><p >Ссылку на QWeb смотрите <a href="../reference/qweb.html#reference-qweb" class="reference internal"><span class="std std-ref">Qweb</span></a>.</p></section><section id="exercise"><h4 >Упражнение</h4><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Использование QWeb в виджетах</p><p >Создайте виджет, конструктор которого принимает два параметра помимо `` parent``: `` product_names`` и `` color``.</p><ul ><li >`` product_names`` должен массив строк, каждая из которых является названием продукта</li><li >`` color`` - это строка, содержащая цвет в цветовом формате CSS (то есть: `` # 000000`` для черного).</li></ul><p >Виджет должен отображать данные названия продуктов одно под другим, каждое в отдельном поле с цветом фона со значением `` color`` и рамкой. Вы должны использовать QWeb для рендеринга HTML. Любой необходимый CSS должен быть в `` oepetstore / static / src / css / petstore.css``.</p><p >Используйте виджет в `` HomePage`` с полдюжины товаров.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">products</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ProductsWidget</span><span class="p">(</span>
                <span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="s2">&quot;mouse&quot;</span><span class="p">,</span> <span class="s2">&quot;keyboard&quot;</span><span class="p">,</span> <span class="s2">&quot;graphic card&quot;</span><span class="p">,</span> <span class="s2">&quot;screen&quot;</span><span class="p">],</span> <span class="s2">&quot;#00FF00&quot;</span><span class="p">);</span>
            <span class="nx">products</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">ProductsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;ProductsWidget&quot;</span><span class="p">,</span>
        <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">products</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">products</span> <span class="o">=</span> <span class="nx">products</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">color</span><span class="p">;</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
        <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;ProductsWidget&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;widget.products&quot;</span> <span class="na">t-as=</span><span class="s">&quot;product&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;oe_products_item&quot;</span>
                      <span class="na">t-attf-style=</span><span class="s">&quot;background-color: {{ widget.color }};&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;product&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/span&gt;</span>
                <span class="nt">&lt;br/&gt;</span>
            <span class="nt">&lt;/t&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">oe_products_item</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">inline-block</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="kc">black</span><span class="p">;</span>
    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<a href="../_images/qweb.png" class="alert-link reference internal"><img src="../_images/qweb.png" class="center-block img-responsive"></a></div></section><section id="widget-helpers"><h2 >Помощники виджетов</h2></section><section id="widget-s-jquery-selector"><h3 >JQuery Selector `` Widget``</h3><p >Выбор элементов DOM внутри виджета может быть выполнен путем вызова метода `` find () `` в корне DOM виджета</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input.my_input&quot;</span><span class="p">)...</span>
</pre></div>
</div>
<p >Но поскольку это обычная операция, класс: <code >~ odoo.Widget</code> предоставляет эквивалентный ярлык через метод <code class="js xref js-func">$()</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input.my_input&quot;</span><span class="p">)...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<div role="alert" class="alert alert-warning"><h3 class="alert-title">Предупреждение</h3><p >Глобальная функция jQuery `` $ () `` не должна * никогда * использоваться, если только она не является абсолютно необходимой: выделение в корне виджета ограничивается виджетом и локально для него, но выборки с помощью `` $ () `` являются глобальными к странице / приложению и может соответствовать частям других виджетов и представлений, что приводит к странным или опасным побочным эффектам. Поскольку виджет обычно должен действовать только на принадлежащем ему разделе DOM, нет причин для глобального выбора.</p></div></section><section id="easier-dom-events-binding"><h3 >Более простая привязка событий DOM</h3><p >Ранее мы связывали события DOM, используя обычные обработчики событий jQuery (например, `` .click () `` или `` .change () <a href="#id1"><span id="id2" class="problematic">``</span></a>) для элементов виджета</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.my_button&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">button_clicked</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">button_clicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">..</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Хотя это работает, у него есть несколько проблем:</p><ol ><li >это довольно многословно</li><li >он не поддерживает замену корневого элемента виджета во время выполнения, поскольку привязка выполняется только при запуске `` start () `` (во время инициализации виджета)</li><li >требует решения проблем `` this``</li></ol><p >Таким образом, виджеты предоставляют ярлык для привязки событий DOM через: attr: <code >~ odoo.Widget.events</code></p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;click .my_button&quot;</span><span class="o">:</span> <span class="s2">&quot;button_clicked&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">button_clicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">..</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p >: attr: <code >~ odoo.Widget.events</code> - это объект (отображение) события для функции или метода, вызываемого при его запуске:</p><ul ><li >ключ - это имя события, возможно, уточненное с помощью селектора CSS; в этом случае только если событие происходит с выбранным подэлементом, будет запущена функция или метод: `` click`` будет обрабатывать все щелчки в виджете, но `` click .my_button`` будет обрабатывать только клики в элементах, имеющих класс `` my_button``</li><li ><p >значение - это действие, которое нужно выполнить, когда событие инициируется</p><p >Это может быть либо функция:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;click&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* code here */</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p >или имя метода объекта (см. пример выше).</p><p >В любом случае, `` this`` является экземпляром виджета, а обработчику дается один параметр - объект события <a href="http://jquery.org" class="external reference">jQuery</a> для события.</p></li></ul></section><section id="widget-events-and-properties"><h2 >Виджет События и Свойства</h2></section><section id="events"><h3 >События</h3><p >Виджеты предоставляют систему событий (отдельно от системы событий DOM / jQuery, описанной выше): виджет может запускать события сам по себе, а другие виджеты (или он сам) могут связывать себя и прослушивать эти события:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">ConfirmWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click button.ok_button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;user_chose&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="s1">&#39;click button.cancel_button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;user_chose&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Are you sure you want to perform this action?&lt;/div&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;button class=&#39;ok_button&#39;&gt;Ok&lt;/button&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;button class=&#39;cancel_button&#39;&gt;Cancel&lt;/button&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Этот виджет действует как фасад, превращая пользовательский ввод (через события DOM) в документируемое внутреннее событие, с которым родительские виджеты могут связывать себя.</p><p ><code class="js xref js-func">trigger()</code> takes the name of the event to trigger as
its first (mandatory) argument, any further arguments are treated as event
data and passed directly to listeners.</p><p >Затем мы можем установить родительское событие, создающее экземпляр нашего общего виджета и прослушивающее событие `` user_chose``, используя <code class="js xref js-func">on()</code></p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ConfirmWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;user_chose&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">user_chose</span><span class="p">);</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">user_chose</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The user agreed to continue&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The user refused to continue&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p ><code class="js xref js-func">on()</code> binds a function to be called when the
event identified by <code >event_name</code> is. The <code >func</code> argument is the
function to call and <code >object</code> is the object to which that function is
related if it is a method. The bound function will be called with the
additional arguments of <code class="js xref js-func">trigger()</code> if it has
any. Example:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="p">...</span>
    <span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;my_event&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">my_event_triggered</span><span class="p">);</span>
    <span class="nx">widget</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;my_event&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">},</span>
<span class="nx">my_event_triggered</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
    <span class="c1">// will print &quot;1 2 3&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Запуск событий на другом виджете, как правило, плохая идея. Основным исключением из этого правила является `` odoo.web.bus``, которое существует специально для трансляций событий, в которых любой виджет может быть интересен во всем веб-приложении Odoo.</p></div></section><section id="properties"><h3 >свойства</h3><p >Свойства очень похожи на обычные атрибуты объекта в том, что они позволяют хранить данные в экземпляре виджета, однако у них есть дополнительная функция, которая вызывает события при установке</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span> <span class="o">=</span> <span class="p">...</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:name&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name_changed</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Nicolas&quot;</span><span class="p">);</span>
<span class="p">},</span>
<span class="nx">name_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The new value of the property &#39;name&#39; is&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<ul ><li ><code class="js xref js-func">set()</code> sets the value of a property and triggers
<code class="samp">change:<em >propname</em></code> (where <em >propname</em> is the property name passed as
first parameter to <code class="js xref js-func">set()</code>) and <code >change</code></li><li ><code class="js xref js-func">get()</code> retrieves the value of a property.</li></ul></section><section id="id3"><h3 >Упражнение</h3><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Свойства и события виджета</p><p >Создайте виджет `` ColorInputWidget``, который будет отображать 3 `` &lt;input type=»text»&gt; <code >. Каждый из этих &lt;input&gt; `` предназначен для ввода шестнадцатеричного числа от 00 до FF. Когда любой из этих `` &lt;input&gt; `` модифицируется пользователем, виджет должен запрашивать содержимое трех `` &lt;input&gt; ``, объедините их значения, чтобы получить полный цветовой код CSS (т.е.: `` # 00FF00</code>) и поместите результат в свойство с именем `` color``. Обратите внимание на событие jQuery `` change () <a href="#id1"><span id="id2" class="problematic">``</span></a>, которое вы можете привязать к любому HTML `` &lt;input&gt; `` element и `` val () `` метод, который может запрашивать текущее значение этого `` &lt;input&gt; `` может быть полезным для вас для этого упражнения.</p><p >Затем измените виджет `` HomePage``, чтобы создать экземпляр `` ColorInputWidget`` и отобразить его. Виджет `` HomePage`` также должен отображать пустой прямоугольник. Этот прямоугольник всегда должен в любой момент иметь тот же цвет фона, что и цвет в свойстве `` color`` экземпляра `` ColorInputWidget``.</p><p >Используйте QWeb для генерации всего HTML.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">ColorInputWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;ColorInputWidget&quot;</span><span class="p">,</span>
        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;change input&#39;</span><span class="o">:</span> <span class="s1">&#39;input_changed&#39;</span>
        <span class="p">},</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">input_changed</span><span class="p">();</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="nx">input_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">color</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;#&quot;</span><span class="p">,</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_red&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_green&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_blue&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
            <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="nx">color</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ColorInputWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:color&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">color_changed</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">color_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_div&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">));</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;ColorInputWidget&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Red: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_color_red&quot;</span> <span class="na">value=</span><span class="s">&quot;00&quot;</span><span class="nt">&gt;&lt;/input&gt;&lt;br</span> <span class="nt">/&gt;</span>
            Green: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_color_green&quot;</span> <span class="na">value=</span><span class="s">&quot;00&quot;</span><span class="nt">&gt;&lt;/input&gt;&lt;br</span> <span class="nt">/&gt;</span>
            Blue: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_color_blue&quot;</span> <span class="na">value=</span><span class="s">&quot;00&quot;</span><span class="nt">&gt;&lt;/input&gt;&lt;br</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_color_div&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">oe_color_div</span> <span class="p">{</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></section><section id="modify-existing-widgets-and-classes"><h2 >Изменить существующие виджеты и классы</h2><p >Система классов веб-фреймворка Odoo позволяет напрямую изменять существующие классы, используя метод <code class="js xref js-func">include()</code></p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">TestClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">testMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;hello&quot;</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">TestClass</span><span class="p">.</span><span class="nx">include</span><span class="p">({</span>
    <span class="nx">testMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; world&quot;</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nx">TestClass</span><span class="p">().</span><span class="nx">testMethod</span><span class="p">());</span>
<span class="c1">// will print &quot;hello world&quot;</span>
</pre></div>
</div>
<p >Эта система похожа на механизм наследования, за исключением того, что она будет изменять целевой класс вместо создания нового класса.</p><p >В этом случае `` this._super () `` вызовет исходную реализацию заменяемого / переопределенного метода. Если у класса уже есть подклассы, все вызовы `` this._super () `` в подклассах будут вызывать новые реализации, определенные в вызове <code class="js xref js-func">include()</code>. Это также будет работать, если некоторые экземпляры класса (или любого из его подклассов) были созданы до вызова <code class="js xref js-func">include()</code>.</p></section><section id="translations"><h2 >Переводы</h2><p >Процесс перевода текста в коде Python и JavaScript очень похож. Вы могли заметить эти строки в начале файла `` petstore.js``</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
    <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
</pre></div>
</div>
<p >Эти строки просто используются для импорта функций перевода в текущем модуле JavaScript. Они используются таким образом:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Hello user!&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p >В Odoo файлы переводов автоматически создаются путем сканирования исходного кода. Все фрагменты кода, вызывающие определенную функцию, обнаруживаются, и их содержимое добавляется в файл перевода, который затем отправляется переводчикам. В Python эта функция называется `` _ () <a href="#id1"><span id="id2" class="problematic">``</span></a>. В JavaScript эта функция <code class="js xref js-func">_t()</code> (а также <code class="js xref js-func">_t()</code>).</p><p >`` _t () `` вернет перевод, определенный для заданного текста. Если для этого текста не определен перевод, он вернет исходный текст как есть.</p><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Для вставки пользовательских значений в переводимые строки рекомендуется использовать <a href="http://gabceb.github.io/underscore.string.site/#sprintf" class="external reference alert-link">_.str.sprintf</a> с именованными аргументами * после * перевода</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">sprintf</span><span class="p">(</span>
    <span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Hello, %(user)s!&quot;</span><span class="p">),</span> <span class="p">{</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s2">&quot;Ed&quot;</span>
<span class="p">}));</span>
</pre></div>
</div>
<p >Это делает переводимые строки более читаемыми для переводчиков и дает им больше гибкости для изменения порядка или игнорирования параметров.</p></div><p ><code class="js xref js-func">_lt()</code> («lazy translate») is similar but somewhat more
complex: instead of translating its parameter immediately, it returns
an object which, when converted to a string, will perform the translation.</p><p >Он используется для определения переводимых терминов до инициализации системы переводов, например, для атрибутов класса (поскольку модули загружаются до того, как язык пользователя настроен, а переводы загружены).</p></section><section id="communication-with-the-odoo-server"><h2 >Связь с сервером Odoo</h2></section><section id="contacting-models"><h3 >Связаться с моделями</h3><p >Большинство операций с Odoo включают взаимодействие с * моделями <a href="#id1"><span id="id2" class="problematic">*</span></a>, реализующими деловые интересы, и эти модели будут (потенциально) взаимодействовать с некоторым механизмом хранения (обычно <a href="http://en.wikipedia.org/wiki/PostgreSQL" class="external reference">PostgreSQL</a>).</p><p >Хотя <a href="http://jquery.org" class="external reference">jQuery</a> предоставляет функцию <a href="http://api.jquery.com/jquery.ajax/" class="external reference">$ .ajax</a> для сетевых взаимодействий, для взаимодействия с Odoo требуются дополнительные метаданные, настройка которых перед каждым вызовом будет многословной и подверженной ошибкам. В результате Odoo Web предоставляет высокоуровневые коммуникационные примитивы.</p><p >Чтобы продемонстрировать это, файл `` petstore.py`` уже содержит небольшую модель с примером метода:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">message_of_the_day</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s2">&quot;oepetstore.message_of_the_day&quot;</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
    <span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;hello&quot;</span><span class="p">:</span> <span class="s2">&quot;world&quot;</span><span class="p">}</span>

    <span class="n">message</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(),</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
</pre></div>
</div>
<p >Это объявляет модель с двумя полями и метод `` my_method () <a href="#id1"><span id="id2" class="problematic">``</span></a>, который возвращает буквальный словарь.</p><p >Вот пример виджета, который вызывает `` my_method () `` и отображает результат:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s2">&quot;oepetstore.message_of_the_day&quot;</span><span class="p">);</span>
        <span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">()}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">);</span>
            <span class="c1">// will show &quot;Hello world&quot; to the user</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Класс, используемый для вызова моделей Odoo <code class="js xref js-class">odoo.Model()</code>. Он создается с именем модели Odoo в качестве первого параметра (`` oepetstore.message_of_the_day`` здесь).</p><p ><code class="js xref js-func">call()</code> can be used to call any (public) method of an
Odoo model. It takes the following positional arguments:</p><dl ><dt >`` Name``</dt><dd >Имя метода для вызова, `` my_method`` здесь</dd><dt >`` args``</dt><dd ><p >массив <a href="https://docs.python.org/2/glossary.html#term-argument" class="external reference">позиционных аргументов</a> для предоставления методу. Поскольку в примере нет позиционного аргумента, параметр `` args`` не предоставляется.</p><p >Вот другой пример с позиционными аргументами:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
<span class="k">def</span> <span class="nf">my_method2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">...</span>
<span class="c1">// with this a=1, b=2 and c=3</span>
</pre></div>
</div>
</dd><dt >`` kwargs``</dt><dd ><p >отображение <a href="https://docs.python.org/2/glossary.html#term-argument" class="external reference">ключевого слова arguments</a> для передачи. В примере представлен единственный именованный аргумент `` context``.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
<span class="k">def</span> <span class="nf">my_method2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">c</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="p">...</span>
<span class="c1">// with this a=1, b=2 and c=3</span>
</pre></div>
</div>
</dd></dl><p ><code class="js xref js-func">call()</code> returns a deferred resolved with the value
returned by the model’s method as first argument.</p></section><section id="compoundcontext"><h3 >CompoundContext</h3><p >В предыдущем разделе использовался аргумент `` context``, который не был объяснен в вызове метода:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">()})</span>
</pre></div>
</div>
<p >Контекст подобен «магическому» аргументу, который веб-клиент всегда дает серверу при вызове метода. Контекст представляет собой словарь, содержащий несколько ключей. Одним из наиболее важных ключей является язык пользователя, используемый сервером для перевода всех сообщений приложения. Другой - это часовой пояс пользователя, который используется для правильного вычисления даты и времени, если Odoo используется людьми в разных странах.</p><p >`` Аргумент`` необходим во всех методах, в противном случае могут произойти плохие вещи (например, приложение не переведено правильно). Вот почему, когда вы вызываете метод модели, вы всегда должны предоставлять этот аргумент. Решением для достижения этого является использование <code class="js xref js-class">odoo.web.CompoundContext()</code>.</p><p ><code class="js xref js-class">CompoundContext()</code> is a class used to pass the user’s
context (with language, time zone, etc…) to the server as well as adding new
keys to the context (some models“ methods use arbitrary keys added to the
context). It is created by giving to its constructor any number of
dictionaries or other <code class="js xref js-class">CompoundContext()</code> instances. It will
merge all those contexts before sending them to the server.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">({</span><span class="s1">&#39;new_key&#39;</span><span class="o">:</span> <span class="s1">&#39;key_value&#39;</span><span class="p">})})</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
<span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span>
    <span class="o">//</span> <span class="n">will</span> <span class="nb">print</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="s1">&#39;new_key&#39;</span><span class="p">:</span> <span class="s1">&#39;key_value&#39;</span><span class="p">,</span> <span class="s1">&#39;tz&#39;</span><span class="p">:</span> <span class="s1">&#39;Europe/Brussels&#39;</span><span class="p">,</span> <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p >Вы можете увидеть словарь в аргументе `` context``, который содержит некоторые ключи, относящиеся к конфигурации текущего пользователя в Odoo, плюс ключ `` new_key``, который был добавлен при создании экземпляра <code class="js xref js-class">CompoundContext()</code>.</p></section><section id="queries"><h3 >Запросы</h3><p >В то время как <code class="js xref js-func">call()</code> достаточно для любого взаимодействия с моделями Odoo, Odoo Web предоставляет помощника для более простых и четких запросов моделей (выборка записей на основе различных условий): <code class="js xref js-func">call()</code>, который действует как ярлык для общей комбинации: py <code class="js xref js-meth">search()</code> и :: py <code class="js xref js-meth">search()</code>. Он обеспечивает более четкий синтаксис для поиска и чтения моделей:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email&#39;</span><span class="p">,</span> <span class="s1">&#39;signature&#39;</span><span class="p">])</span>
     <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">main_company</span><span class="p">]])</span>
     <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
     <span class="p">.</span><span class="nx">all</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do work with users records</span>
<span class="p">});</span>
</pre></div>
</div>
<p >против:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">main_company</span><span class="p">]],</span> <span class="p">{</span><span class="nx">limit</span><span class="o">:</span> <span class="mi">15</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">ids</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ids</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email&#39;</span><span class="p">,</span> <span class="s1">&#39;signature&#39;</span><span class="p">]]);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// do work with users records</span>
    <span class="p">});</span>
</pre></div>
</div>
<ul ><li ><code class="js xref js-func">query()</code> takes an optional list of fields as
parameter (if no field is provided, all fields of the model are fetched). It
returns a <code class="js xref js-class">odoo.web.Query()</code> which can be further customized before
being executed</li><li ><code class="js xref js-class">Query()</code> represents the query being built. It is
immutable, methods to customize the query actually return a modified copy,
so it’s possible to use the original and the new version side-by-side. See
<code class="js xref js-class">Query()</code> for its customization options.</li></ul><p >Когда запрос настроен как нужно, просто вызовите <code class="js xref js-func">all()</code>, чтобы выполнить его и вернуть отложенный результат. Результат такой же, как: py :meth:<a href="#id1"><span id="id2" class="problematic">`</span></a>~odoo.models.Model.read`'s, массив словарей, где каждый словарь является запрошенной записью, с каждым запрошенным полем ключ словаря.</p></section><section id="exercises"><h2 >упражнения</h2><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Послание дня</p><p >Создайте виджет «MessageOfTheDay», отображающий последнюю запись модели «oepetstore.message_of_the_day». Виджет должен получить свою запись, как только она будет отображена.</p><p >Отобразите виджет на домашней странице Pet Store.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;MessageOfTheDay&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s2">&quot;oepetstore.message_of_the_day&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">order_by</span><span class="p">(</span><span class="s1">&#39;-create_date&#39;</span><span class="p">,</span> <span class="s1">&#39;-id&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">first</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_mywidget_message_of_the_day&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                <span class="p">});</span>
        <span class="p">},</span>
    <span class="p">});</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;MessageOfTheDay&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_motd&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;oe_mywidget_message_of_the_day&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">oe_petstore_motd</span> <span class="p">{</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#F0EEEE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Список игрушек для домашних животных</p><p >Создайте виджет `` PetToysList``, отображающий 5 игрушек (используя их имя и их изображения).</p><p >Игрушки для домашних животных не хранятся в новой модели, вместо этого они хранятся в `` product.product`` с использованием специальной категории * Игрушки для домашних животных <a href="#id1"><span id="id2" class="problematic">*</span></a>. Вы можете увидеть предварительно сгенерированные игрушки и добавить новые, перейдя по адресу <span class="menuselection">Pet Store ‣ Pet Store ‣ Pet Toys</span>. Возможно, вам понадобится изучить `` product.product``, чтобы создать правильный домен, чтобы выбрать только игрушки для домашних животных.</p><p >В Odoo изображения обычно хранятся в обычных полях, закодированных как <a href="http://en.wikipedia.org/wiki/Base64" class="external reference alert-link">base64</a>, HTML поддерживает отображение изображений прямо из base64 с помощью: samp: ` &lt;img src=»data:{mime_type};base64,{base64_image_data}»/&gt; `</p><p >Виджет `` PetToysList`` должен отображаться на главной странице справа от виджета `` MessageOfTheDay``. Вам нужно будет сделать макет с помощью CSS, чтобы добиться этого.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
                <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">PetToysList</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.oe_petstore_homepage_left&#39;</span><span class="p">)),</span>
                <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.oe_petstore_homepage_right&#39;</span><span class="p">))</span>
            <span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;MessageOfTheDay&#39;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;oepetstore.message_of_the_day&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">order_by</span><span class="p">(</span><span class="s1">&#39;-create_date&#39;</span><span class="p">,</span> <span class="s1">&#39;-id&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">first</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_mywidget_message_of_the_day&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">PetToysList</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;PetToysList&#39;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;product.product&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;categ_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s2">&quot;Pet Toys&quot;</span><span class="p">]])</span>
                <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">all</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">_</span><span class="p">(</span><span class="nx">results</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;PetToy&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">item</span><span class="o">:</span> <span class="nx">item</span><span class="p">}));</span>
                    <span class="p">});</span>
                <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage_left&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage_right&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;MessageOfTheDay&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_motd&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;oe_mywidget_message_of_the_day&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;PetToysList&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_pettoyslist&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;PetToy&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_pettoy&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;item.name&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
            <span class="nt">&lt;p&gt;&lt;img</span> <span class="na">t-att-src=</span><span class="s">&quot;&#39;data:image/jpg;base64,&#39;+item.image&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">oe_petstore_homepage</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">table</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">oe_petstore_homepage_left</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">table-cell</span><span class="p">;</span>
    <span class="k">width</span> <span class="p">:</span> <span class="mi">300</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">oe_petstore_homepage_right</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">table-cell</span><span class="p">;</span>
    <span class="k">width</span> <span class="p">:</span> <span class="mi">300</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">oe_petstore_motd</span> <span class="p">{</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#F0EEEE</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">oe_petstore_pettoyslist</span> <span class="p">{</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">oe_petstore_pettoy</span> <span class="p">{</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#F0EEEE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></section><section id="existing-web-components"><h2 >Существующие веб-компоненты</h2></section><section id="the-action-manager"><h3 >Диспетчер действий</h3><p >В Odoo многие операции начинаются с <a href="../reference/actions.html#reference-actions" class="reference internal"><span class="std std-ref">action</span></a>: открытие пункта меню (для просмотра), печать отчета, …</p><p >Действия - это фрагменты данных, описывающие, как клиент должен реагировать на активацию фрагмента контента. Действия могут быть сохранены (и прочитаны через модель), или они могут быть сгенерированы на лету (локально клиенту с помощью кода JavaScript или удаленно с помощью метода модели).</p><p >В Odoo Web компонентом, отвечающим за обработку и реагирование на эти действия, является * Диспетчер действий <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p></section><section id="using-the-action-manager"><h4 >Использование диспетчера действий</h4><p >Диспетчер действий может быть вызван явно из кода javascript путем создания словаря, описывающего :ref:<a href="#id1"><span id="id2" class="problematic">`</span></a>an action &lt;reference/actions&gt;`правильного типа и вызывая экземпляр диспетчера действий с ним.</p><p ><code class="js xref js-func">do_action()</code> is a shortcut of <code class="js xref js-class">Widget()</code>
looking up the «current» action manager and executing the action:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">TestWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">dispatch_to_new_action</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">do_action</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;ir.actions.act_window&#39;</span><span class="p">,</span>
            <span class="nx">res_model</span><span class="o">:</span> <span class="s2">&quot;product.product&quot;</span><span class="p">,</span>
            <span class="nx">res_id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nx">views</span><span class="o">:</span> <span class="p">[[</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">]],</span>
            <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;current&#39;</span><span class="p">,</span>
            <span class="nx">context</span><span class="o">:</span> <span class="p">{},</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Наиболее распространенным действием `` type`` является `` ir.actions.act_window``, которое предоставляет представления модели (отображает модель различными способами), ее наиболее распространенными атрибутами являются:</p><dl ><dt >`` res_model``</dt><dd >Модель для отображения в представлениях</dd><dt >`` res_id`` (необязательно)</dt><dd >Для представлений формы предварительно выбранная запись в `` res_model``</dd><dt >`` Views``</dt><dd >Перечисляет виды, доступные через действие. Список `` [view_id, view_type] <code >, `` view_id</code> может быть либо идентификатором базы данных представления правильного типа, либо `` false``, чтобы использовать представление по умолчанию для указанного типа. Типы просмотра не могут присутствовать несколько раз. Действие откроет первый вид списка по умолчанию.</dd><dt >`` Target``</dt><dd >Либо `` current`` (по умолчанию), который заменяет раздел <code >content</code> веб-клиента действием, либо `` new``, чтобы открыть действие в диалоговом окне.</dd><dt >`` context``</dt><dd >Дополнительные данные контекста для использования в действии.</dd></dl><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Перейти к продукту</p><p >Измените компонент `` PetToysList``, чтобы при нажатии на игрушку домашняя страница заменялась видом формы игрушки.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">PetToysList</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;PetToysList&#39;</span><span class="p">,</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click .oe_petstore_pettoy&#39;</span><span class="o">:</span> <span class="s1">&#39;selected_item&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;product.product&#39;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">])</span>
            <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;categ_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s2">&quot;Pet Toys&quot;</span><span class="p">]])</span>
            <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">all</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">_</span><span class="p">(</span><span class="nx">results</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;PetToy&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">item</span><span class="o">:</span> <span class="nx">item</span><span class="p">}));</span>
                <span class="p">});</span>
            <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">selected_item</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">do_action</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;ir.actions.act_window&#39;</span><span class="p">,</span>
            <span class="nx">res_model</span><span class="o">:</span> <span class="s1">&#39;product.product&#39;</span><span class="p">,</span>
            <span class="nx">res_id</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span>
            <span class="nx">views</span><span class="o">:</span> <span class="p">[[</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">]],</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;PetToy&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_pettoy&quot;</span> <span class="na">t-att-data-id=</span><span class="s">&quot;item.id&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;item.name&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;&lt;img</span> <span class="na">t-attf-src=</span><span class="s">&quot;data:image/jpg;base64,{{item.image}}&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
</div></section><section id="client-actions"><h3 >Действия клиента</h3><p >В этом руководстве мы использовали простой виджет `` HomePage``, который веб-клиент автоматически запускает, когда мы выбираем нужный пункт меню. Но как веб-сайт Odoo узнал, как запустить этот виджет? Потому что виджет зарегистрирован как * клиентское действие <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p><p >Действие клиента - это (как следует из его названия) тип действия, определенный почти полностью в клиенте, в javascript для Odoo web. Сервер просто отправляет тег действия (произвольное имя) и при необходимости добавляет несколько параметров, но кроме этого * все * обрабатывается пользовательским кодом клиента.</p><p >Наш виджет зарегистрирован как обработчик для действия клиента через это:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p >`` instance.web.client_actions`` - это <code class="js xref js-class">Registry()</code>, в котором диспетчер действий ищет обработчики действий клиента, когда ему нужно их выполнить. Первый параметр <code class="js xref js-class">Registry()</code> - это имя (тег) действия клиента, а второй параметр - это путь к виджету из корня веб-клиента Odoo.</p><p >Когда клиентское действие должно быть выполнено, менеджер действий ищет его тег в реестре, идет по указанному пути и отображает виджет, который он находит в конце.</p><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >обработчик клиентских действий также может быть обычной функцией, в этом случае он будет вызван, а его результат (если есть) будет интерпретирован как следующее действие, которое будет выполнено.</p></div><p >На стороне сервера мы просто определили действие `` ir.actions.client``:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;action_home_page&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.actions.client&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;tag&quot;</span><span class="nt">&gt;</span>petstore.homepage<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p >и меню, открывающее действие:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;home_page_petstore_menu&quot;</span> <span class="na">parent=</span><span class="s">&quot;petstore_menu&quot;</span>
          <span class="na">name=</span><span class="s">&quot;Home Page&quot;</span> <span class="na">action=</span><span class="s">&quot;action_home_page&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</section><section id="architecture-of-the-views"><h3 >Архитектура взглядов</h3><p >Большая часть полезности (и сложности) сети Odoo заключается в представлениях. Каждый тип представления - это способ отображения модели в клиенте.</p></section><section id="the-view-manager"><h4 >Диспетчер представлений</h4><p >Когда экземпляр `` ActionManager`` получает действие типа `` ir.actions.act_window``, он делегирует синхронизацию и обработку самих представлений * view manager <a href="#id1"><span id="id2" class="problematic">*</span></a>, который затем устанавливает одно или несколько представлений в зависимости от на требования оригинальной акции:</p><a href="../_images/viewarchitecture.svg" class="reference internal"><img src="../_images/viewarchitecture.svg" class="center-block img-responsive"></a></section><section id="the-views"><h4 >Виды</h4><p >Большинство <span class="xref std std-ref">Odoo views &lt;reference/views&gt;`реализованы через подкласс :class:`odoo.web.View</span>, который предоставляет немного общей базовой структуры для обработки событий и отображения информации о модели.</p><p >The <em >search view</em> is considered a view type by the main Odoo framework, but
handled separately by the web client (as it’s a more permanent fixture and
can interact with other views, which regular views don’t do).</p><p >Представление отвечает за загрузку своего собственного XML-описания (используя: py <code class="js xref js-class">fields_view_get()</code>) и любого другого необходимого источника данных. Для этой цели представления снабжаются необязательным идентификатором представления, установленным в качестве атрибута: attr: <code >~ odoo.web.View.view_id</code>.</p><p >Представления также предоставляются с экземпляром <code class="js xref js-class">DataSet()</code>, который содержит наиболее необходимую информацию о модели (имя модели и, возможно, различные идентификаторы записей).</p><p >Представления могут также захотеть обрабатывать поисковые запросы, переопределив <code class="js xref js-func">do_search()</code> и обновив их <code class="js xref js-class">DataSet()</code> по мере необходимости.</p></section><section id="the-form-view-fields"><h3 >Поля просмотра формы</h3><p >Общей необходимостью является расширение представления веб-формы для добавления новых способов отображения полей.</p><p >Все встроенные поля имеют реализацию отображения по умолчанию, может потребоваться новый виджет формы для правильного взаимодействия с новым типом поля (например, поле: term: <code >GIS</code>) или для предоставления новых представлений и способов взаимодействия с существующими типами полей (например, validate: py <code class="js xref js-class">Char()</code> поля, которые должны содержать адреса электронной почты и отображать их в виде ссылок электронной почты).</p><p >Чтобы явно указать, какой виджет формы следует использовать для отображения поля, просто используйте атрибут `` widget`` в описании XML представления:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;contact_mail&quot;</span> <span class="na">widget=</span><span class="s">&quot;email&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><ul ><li >один и тот же виджет используется как в режиме просмотра (только для чтения), так и в режиме редактирования вида формы, невозможно использовать виджет в одном и другой виджет в другом</li><li >и данное поле (имя) нельзя использовать несколько раз в одной форме</li><li >виджет может игнорировать текущий режим представления формы и оставаться неизменным как в представлении, так и в издании</li></ul></div><p >Поля создаются экземпляром представления формы после того, как он прочитал свое XML-описание и создал соответствующий HTML-код, представляющий это описание. После этого представление формы будет взаимодействовать с объектами поля, используя некоторые методы. Эти методы определяются интерфейсом `` FieldInterface``. Почти все поля наследуют абстрактный класс `` AbstractField``. Этот класс определяет некоторые механизмы по умолчанию, которые должны быть реализованы большинством полей.</p><p >Вот некоторые из обязанностей полевого класса:</p><ul ><li >Класс поля должен отображать и позволять пользователю редактировать значение поля.</li><li ><p >Он должен правильно реализовать 3 атрибута поля, доступные во всех полях Odoo. Класс `` AbstractField`` уже реализует алгоритм, который динамически вычисляет значение этих атрибутов (они могут измениться в любой момент, потому что их значение изменяется в соответствии со значением других полей). Их значения хранятся в * Свойствах виджета * (свойства виджета были объяснены ранее в этом руководстве). Каждый класс полей отвечает за проверку этих свойств виджетов и их динамическую адаптацию в зависимости от их значений. Вот описание каждого из этих атрибутов:</p><ul ><li >`` обязательный``: поле должно иметь значение перед сохранением. Если `` required`` равно `` true`` и поле не имеет значения, метод `` is_valid () `` поля должен возвращать `` false``.</li><li >`` invisible``: если это `` true``, поле должно быть невидимым. Класс `` AbstractField`` уже имеет базовую реализацию этого поведения, которая подходит для большинства полей.</li><li >`` readonly``: когда `` true``, поле не должно редактироваться пользователем. Большинство полей в Odoo ведут себя совершенно по-разному в зависимости от значения `` readonly``. Например, `` FieldChar`` отображает HTML `` &lt;input&gt; `` когда он доступен для редактирования и просто отображает текст, когда он доступен только для чтения. Это также означает, что в нем гораздо больше кода, необходимого для реализации только одного поведения, но это необходимо для обеспечения хорошего взаимодействия с пользователем.</li></ul></li><li >Поля имеют два метода: `` set_value () `` и `` get_value () <code >, которые вызываются представлением формы, чтобы дать ему значение для отображения и возврата нового значения, введенного пользователем. Эти методы должны иметь возможность обрабатывать значение, заданное сервером Odoo, когда `` read () `` выполняется на модели, и возвращать действительное значение для `` write () ``. Помните, что типы данных JavaScript / Python, используемые для представления значений, заданных `` read () `` и переданных `` write () ``, не обязательно совпадают в Odoo. Например, когда вы читаете many2one, это всегда кортеж, первое значение которого является идентификатором указанной записи, а второе - именем get (то есть: `` (15, `Agrolait`) ``). Но когда вы пишете many2one, это должно быть одно целое число, а не кортеж. `` AbstractField</code> имеет реализацию этих методов по умолчанию, которая хорошо работает для простого типа данных и устанавливает свойство виджета с именем `` value``.</li></ul><p >Обратите внимание, что для лучшего понимания того, как реализовать поля, вам настоятельно рекомендуется взглянуть на определение интерфейса `` FieldInterface`` и класса `` AbstractField`` непосредственно в коде веб-клиента Odoo.</p></section><section id="creating-a-new-type-of-field"><h4 >Создание нового типа поля</h4><p >В этой части мы объясним, как создать новый тип поля. Примером здесь будет повторная реализация класса `` FieldChar`` и постепенное объяснение каждой части.</p></section><section id="simple-read-only-field"><h5 >Простое поле только для чтения</h5><p >Вот первая реализация, которая будет отображать только текст. Пользователь не сможет изменять содержимое поля.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">FieldChar2</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;char2&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldChar2&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p >В этом примере мы объявляем класс с именем `` FieldChar2``, унаследованный от `` AbstractField``. Мы также регистрируем этот класс в реестре `` instance.web.form.widgets`` под ключом `` char2``. Это позволит нам использовать это новое поле в любом представлении формы, указав `` widget = <code >char2</code> `` в `` &lt;field/&gt; `` тег в объявлении XML представления.</p><p >В этом примере мы определяем один метод: `` render_value () <code >. Все, что он делает, это отображает свойство виджета `` value</code>. Это два инструмента, определенных классом `` AbstractField``. Как объяснялось ранее, представление формы будет вызывать метод `` set_value () `` поля для установки значения для отображения. Этот метод уже имеет реализацию по умолчанию в `` AbstractField``, которая просто устанавливает свойство виджета `` value``. `` AbstractField`` также наблюдает за событием `` change: value`` и вызывает `` render_value () `` при его возникновении. Итак, `` render_value () `` - это удобный метод для реализации в дочерних классах, чтобы выполнять некоторые операции каждый раз, когда значение поля изменяется.</p><p >В методе `` init () `` мы также определяем значение по умолчанию для поля, если оно не указано в представлении формы (здесь мы предполагаем, что значение по умолчанию для поля `` char`` должно быть пустой строкой).</p></section><section id="read-write-field"><h5 >Поле для чтения и записи</h5><p >Поля только для чтения, которые только отображают контент и не позволяют пользователю изменять его, могут быть полезны, но большинство полей в Odoo также позволяют редактировать. Это делает классы полей более сложными, главным образом потому, что поля должны обрабатывать как редактируемый, так и нередактируемый режим, эти режимы часто совершенно разные (для целей разработки и удобства использования), и поля должны иметь возможность переключаться между режимами в любой момент.</p><p >Чтобы узнать, в каком режиме должно быть текущее поле, класс `` AbstractField`` устанавливает свойство виджета с именем <code >ffective_readonly</code>. Поле должно следить за изменениями в этом свойстве виджета и отображать правильный режим соответственно. Пример:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">FieldChar2</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">render_value</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_field</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;FieldChar2&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">widget</span><span class="o">:</span> <span class="k">this</span><span class="p">}));</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">internal_set_value</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;char2&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldChar2&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;FieldChar2&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_char2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;! widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<p >В методе `` start () `` (который вызывается сразу после добавления виджета в DOM) мы связываемся с событием `` change :ffective_readonly``. Это позволяет нам отображать поле каждый раз, когда изменяется свойство виджета <code >ffective_readonly</code>. Этот обработчик события вызовет `` display_field () <code >, который также вызывается непосредственно в `` start () ``. `` Display_field () `` был создан специально для этого поля, это не метод, определенный в `` AbstractField</code> или любом другом классе. Мы можем использовать этот метод для отображения содержимого поля в зависимости от текущего режима.</p><p >Отныне концепция этого поля является типичной, за исключением того, что есть много проверок, чтобы узнать состояние свойства <code >ffective_readonly</code>:</p><ul ><li >В шаблоне QWeb, используемом для отображения содержимого виджета, он отображает `` &lt;input type=»text» /&gt; `` если мы находимся в режиме чтения-записи и ничего особенно в режиме только для чтения.</li><li >В методе `` display_field () `` мы должны связать событие `` change`` с `` &lt;input type=»text» /&gt; `` знать, когда пользователь изменил значение. Когда это происходит, мы вызываем метод `` internal_set_value () `` с новым значением поля. Это удобный метод, предоставляемый классом `` AbstractField``. Этот метод установит новое значение в свойстве `` value``, но не вызовет вызов `` render_value () `` (который не является необходимым, поскольку `` &lt;input type=»text» /&gt; `` уже содержит правильное значение).</li><li >В `` render_value () `` мы используем совершенно другой код для отображения значения поля в зависимости от того, находимся ли мы только для чтения или в режиме чтения-записи.</li></ul><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Создать поле цвета</p><p >Создайте класс `` FieldColor``. Значение этого поля должно быть строкой, содержащей цветовой код, подобный используемому в CSS (пример: `` # FF0000`` для красного). В режиме только для чтения это цветное поле должно отображать небольшой блок, цвет которого соответствует значению поля. В режиме чтения-записи вы должны отобразить `` &lt;input type=»color» /&gt; <a href="#id1"><span id="id2" class="problematic">``</span></a>. Этот тип &lt;input /&gt; `` - это компонент HTML5, который работает не во всех браузерах, но хорошо работает в Google Chrome. Так что это нормально использовать в качестве упражнения.</p><p >Вы можете использовать этот виджет в виде формы модели `` message_of_the_day`` для его поля с именем `` color``. В качестве бонуса вы можете изменить виджет `` MessageOfTheDay``, созданный в предыдущей части этого руководства, для отображения сообщения дня с цветом фона, указанным в поле `` color``.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">FieldColor</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;change input&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;effective_readonly&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">internal_set_value</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">render_value</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_field</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;FieldColor&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">widget</span><span class="o">:</span> <span class="k">this</span><span class="p">}));</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_field_color_content&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>
<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldColor&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;FieldColor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_color&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_color_content&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;! widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;color&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">oe_field_color_content</span> <span class="p">{</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">50</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="kc">black</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></section><section id="the-form-view-custom-widgets"><h3 >Форма просмотра пользовательских виджетов</h3><p >Поля формы используются для редактирования одного поля и неразрывно связаны с полем. Поскольку это может быть ограничением, также возможно создавать * виджеты форм <a href="#id1"><span id="id2" class="problematic">*</span></a>, которые не так ограничены и имеют меньше связей с конкретным жизненным циклом.</p><p >Пользовательские виджеты формы могут быть добавлены в представление формы через тег `` widget``:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;widget</span> <span class="na">type=</span><span class="s">&quot;xxx&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p >Этот тип виджета будет просто создан представлением формы во время создания HTML в соответствии с определением XML. Они имеют общие свойства с полями (например, свойство <code >ffective_readonly</code>), но им не назначено точное поле. И поэтому у них нет методов типа `` get_value () `` и `` set_value () <code >. Они должны наследоваться от абстрактного класса `` FormWidget</code>.</p><p >Виджеты форм могут взаимодействовать с полями форм, прослушивая их изменения и выбирая или изменяя их значения. Они могут получить доступ к полям формы через свой атрибут: attr: <code >~ odoo.web.form.FormWidget.field_manager</code></p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetMultiplication</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:integer_a&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:integer_b&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_result</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;integer_a&quot;</span><span class="p">)</span> <span class="o">*</span>
                     <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;integer_b&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;a*b = &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;multiplication&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetMultiplication&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p >: attr: <code >~ odoo.web.form.FormWidget</code>, как правило, сам по себе <code class="js xref js-class">FormView()</code>, но используемые в нем функции должны быть ограничены теми, которые определены <code class="js xref js-class">FormView()</code>, наиболее полезным из которых является:</p><ul ><li ><code class="js xref js-func">get_field_value(field_name)()</code>
which returns the value of a field.</li><li ><code class="js xref js-func">set_values(values)()</code> sets multiple
field values, takes a mapping of <code >{field_name: value_to_set}</code></li><li >Событие: samp: <code >field_changed: {field_name}</code> запускается каждый раз, когда изменяется значение поля `` field_name``</li></ul><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Показать координаты на карте Google</p><p >Добавьте два поля в `` product.product``, хранящие широту и долготу, затем создайте новый виджет формы, чтобы отобразить широту и долготу происхождения товара на карте.</p><p >Чтобы отобразить карту, используйте вложение Google Map:</p><div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;400&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;300&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll=XXX,YYY&amp;amp;output=embed&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
</pre></div>
</div>
<p >где `` XXX`` следует заменить на широту, а `` YYY`` на долготу.</p><p >Отобразите два поля позиции и виджет карты, используя их на новой странице записной книжки вида продукта.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetCoordinates</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_latitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_longitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_map</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;WidgetCoordinates&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;latitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_latitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_longitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}));</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetCoordinates&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;WidgetCoordinates&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;iframe</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;300&quot;</span>
        <span class="na">t-attf-src=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll={{latitude}},{{longitude}}&amp;amp;output=embed&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/iframe&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
</div><div role="alert" class="alert alert-exercise"><h3 class="alert-title">Exercise</h3><p >Получить текущую координату</p><p >Добавьте кнопку сброса координат продукта к местоположению пользователя, вы можете получить эти координаты с помощью <a href="http://diveintohtml5.info/geolocation.html" class="external reference alert-link">API геолокации javascript</a>.</p><p >Теперь мы хотели бы отобразить дополнительную кнопку, чтобы автоматически установить координаты местоположения текущего пользователя.</p><p >Чтобы получить координаты пользователя, проще всего использовать JavaScript API геолокации. <a href="http://www.w3schools.com/html/html5_geolocation.asp" class="external reference alert-link">Смотрите онлайн документацию, чтобы узнать, как ее использовать</a>.</p><p >Обратите также внимание, что пользователь не должен нажимать на эту кнопку, когда представление формы находится в режиме только для чтения. Таким образом, этот пользовательский виджет должен правильно обрабатывать свойство <code >ffective_readonly</code>, как любое поле. Один из способов сделать это - сделать так, чтобы кнопка исчезла, когда <code >ffective_readonly</code> истинно.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetCoordinates</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span><span class="p">(</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="s1">&#39;received_position&#39;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">sup</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_latitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_longitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">sup</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">display_map</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;WidgetCoordinates&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;latitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_latitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_longitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}));</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;button&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">));</span>
    <span class="p">},</span>
    <span class="nx">received_position</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">set_values</span><span class="p">({</span>
            <span class="s2">&quot;provider_latitude&quot;</span><span class="o">:</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">latitude</span><span class="p">,</span>
            <span class="s2">&quot;provider_longitude&quot;</span><span class="o">:</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">longitude</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetCoordinates&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;WidgetCoordinates&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;iframe</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;300&quot;</span>
        <span class="na">t-attf-src=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll={{latitude}},{{longitude}}&amp;amp;output=embed&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/iframe&gt;</span>
    <span class="nt">&lt;button&gt;</span>Get My Current Coordinate<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
</div><div id="id4" class="footnote"><span class="footnote-label"><a class="footnote-backref" href="#id1">[1]</a></span> как отдельное понятие от экземпляров. Во многих языках классы являются полноценными объектами и самим экземпляром (метаклассов), но между классами и экземплярами остаются две довольно отдельные иерархии</div><div id="dombugs" class="footnote"><span class="footnote-label"><a class="footnote-backref" href="#id2">[2]</a></span> а также устранение различий между браузерами, хотя со временем это стало менее необходимым</div></section>

          </article>
        </div>
        
        <div id="mask"></div>
      </main>
  </div>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
<!-- 
  <footer>
    <div id="footer" class="container">
      <span class="o_logo o_logo_inverse center-block o_footer_logo"></span>
      <div class="row">
        <div class="col-sm-7 col-md-7 col-lg-6">
          <div class="row">
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Community</span>
              <ul>
                <li><a href="https://github.com/odoo/odoo">Github</a></li>
                <li><a href="http://www.odoo.com/page/download">Download</a></li>
                <li class="divider"></li>
                <li><a href="http://runbot.odoo.com/runbot/repo/git-github-com-odoo-enterprise-7">Runbot</a></li>
                <li><a href="https://github.com/odoo/odoo/wiki/Translations">Translations</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/odoo-community">Mailing Lists</a></li>
                <li><a href="http://www.odoo.com/forum/help-1">Forum</a></li>
              </ul>
            </div>
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Services</span>
              <ul>
                <li><a href="https://www.odoo.sh">Odoo Cloud Platform</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/help">Support</a></li>
                <li><a href="https://upgrade.odoo.com">Upgrade</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/partners">Find a partner</a></li>
                <li><a href="http://www.odoo.com/page/become-a-partner">Become a partner</a></li>
                <li class="divider"></li>
                <li><a href="http://training.odoo.com/courses/odoo-functional">Training Center</a></li>
                <li><a href="http://www.odoo.com/page/education-program">Education</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/security">Security</a></li>
              </ul>
            </div>
            <div class="col-xs-12 col-sm-4 mb64">
              <span class="menu_title">About us</span>
              <ul>
                <li><a href="http://www.odoo.com/page/about-us">Our company</a></li>
                <li><a href="http://www.odoo.com/page/contactus">Contact</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/event">Events</a></li>
                <li><a href="http://www.odoo.com/blog">Blog</a></li>
                <li><a href="http://www.odoo.com/blog/6">Customers</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/jobs">Jobs</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/page/legal">Legal</a> | <a href="http://www.odoo.com/privacy">Privacy</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-5 col-md-4 col-md-offset-1 col-lg-5 col-lg-offset-1">
          <p>
            <small>
              Odoo is a suite of open source business apps that cover all your company needs: CRM, eCommerce, accounting, inventory, point of sale, project management, etc.
              <br/><br/>
              Odoo's unique value proposition is to be at the same time very easy to use and fully integrated.
            </small>
          </p>
        </div>
      </div>
    </div>
    <div class="o_footer_bottom">
      <div class="container">
        <a class="small" href="http://www.odoo.com/page/website-builder">Website made with <span class="o_logo o_logo_inverse o_logo_15"></span></a>
        <div class="social-links pull-right">
          <a href="http://www.odoo.com/web/about/facebook"><i class="fa fa-facebook"></i></a>
          <a href="http://www.odoo.com/web/about/twitter"><i class="fa fa-twitter"></i></a>
          <a href="http://www.odoo.com/web/about/linkedin"><i class="fa fa-linkedin"></i></a>
          <a href="mailto:info@odoo.com"><i class="fa fa-envelope"></i></a>
        </div>
      </div>
    </div>
  </footer>
  -->
  </body>
</html>