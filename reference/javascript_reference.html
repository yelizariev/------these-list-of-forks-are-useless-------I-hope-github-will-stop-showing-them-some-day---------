<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Work+Sans:500,600" rel="stylesheet">
  
    <title>Ссылка на JavaScript &#8212; Документация odoo 13.0</title>
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/patchqueue.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script><link rel="canonical" href="" />
  
    <link rel="index" title="Алфавитный указатель" href="../genindex.html" />
    <link rel="search" title="Поиск" href="../search.html" />
    <link rel="next" title="Перевод модулей" href="translations.html" />
    <link rel="prev" title="Javascript Cheatsheet" href="javascript_cheatsheet.html" /> 
  </head><body><header class="o_main_header o_has_sub_nav o_inverted ">
<!-- 
    <div class="o_main_header_main">
      <a class="pull-left o_logo" href="/"></a>
      <a href="#" class="o_mobile_menu_toggle visible-xs-block pull-right">
        <span class="sr-only">Toggle navigation</span>
        <span class="mdi-navigation-menu"></span>
      </a>
      <div class="o_header_buttons">
        <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
      </div>
      <ul class="o_primary_nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Apps</a>
          <div class="dropdown-menu o_secondary_nav">
            <div class="container">
              <div class="row">
                <div class="col-sm-3 o_website_apps">
                  <div class="o_nav_app_family">
                    <span></span> Websites
                    <div>Build great user experience</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/website-builder">Website Builder</a></li>
                    <li><a href="https://www.odoo.com/page/e-commerce">eCommerce</a></li>
                    <li><a href="https://www.odoo.com/page/blog-engine">Blogs</a></li>
                    <li><a href="https://www.odoo.com/page/community-builder">Forums</a></li>
                    <li><a href="https://www.odoo.com/page/slides">Slides</a></li>
                    <li><a href="https://adspike.odoo.com">SEA</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_sale_apps">
                  <div class="o_nav_app_family">
                    <span></span> Sales
                    <div>Boost your success rate</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/sales">Sales</a></li>
                    <li><a href="https://www.odoo.com/page/crm">CRM</a></li>
                    <li><a href="https://www.odoo.com/page/billing">Invoicing</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Point of Sale</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/point-of-sale">Shops</a></li>
                        <li><a href="https://www.odoo.com/page/pos-restaurant">Restaurants</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/subscriptions">Subscriptions</a></li>
                    <li><a href="https://www.odoo.com/page/sign">Sign</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_operation_apps">
                  <div class="o_nav_app_family">
                    <span></span> Operations
                    <div>It's all about efficiency</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/accounting">Accounting</a></li>
                    <li><a href="https://www.odoo.com/page/project-management">Project</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Human Resources</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/recruitment">Recruitment</a></li>
                        <li><a href="https://www.odoo.com/page/employees">Employees</a></li>
                        <li><a href="https://www.odoo.com/page/expenses">Expenses</a></li>
                        <li><a href="https://www.odoo.com/page/appraisal">Appraisal</a></li>
                        <li><a href="https://www.odoo.com/page/fleet">Fleet</a></li>
                        <li><a href="https://www.odoo.com/page/leaves">Leaves</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/warehouse">Inventory</a></li>
                    <li><a href="https://www.odoo.com/page/purchase">Purchase</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Manufacturing</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/manufacturing">MRP</a></li>
                        <li><a href="https://www.odoo.com/page/plm">PLM</a></li>
                        <li><a href="https://www.odoo.com/page/maintenance">Maintenance</a></li>
                        <li><a href="https://www.odoo.com/page/quality">Quality</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-sm-3 o_productivity_apps">
                  <div class="o_nav_app_family">
                    <span></span> Productivity Tools
                    <div>Great Tools = Happy People</div>
                  </div>
                  <ul>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Communication</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/discuss">Discuss</a></li>
                        <li><a href="https://www.odoo.com/page/discuss-groups">Mailing Lists</a></li>
                        <li><a href="https://www.odoo.com/page/notes">Notes</a></li>
                        <li><a href="#">Help desk</a></li>
                        <li><a href="#">Appointment</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/timesheet">Timesheet</a></li>
                    <li><a href="https://www.odoo.com/page/email-marketing">Email Marketing</a></li>
                    <li><a href="https://www.odoo.com/page/events">Events</a></li>
                    <li><a href="https://www.odoo.com/page/survey">Survey</a></li>
                    <li><a href="https://www.odoo.com/page/live-chat">Live Chat</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <a href="http://www.odoo.com/apps/modules" class="o_store_link"><i class="fa fa-cube fa-fw"></i> Third party apps</a>
          </div>
        </li>
        <li><a href="https://www.odoo.com/page/tour">Tour</a></li>
        <li><a href="https://www.odoo.com/pricing">Pricing</a></li>
        <li><a href="https://www.odoo.com/page/docs">Docs</a></li>
      </ul>
    </div>
-->
    <nav class="navbar o_sub_nav">
      <div class="container">
        <div class="navbar-header visible-xs">
            <button type="button" class="navbar-toggle collapsed text-left btn-block" data-toggle="collapse" data-target="#o_sub-menu" aria-expanded="false">
              Navigate
              <span class="mdi-hardware-keyboard-arrow-down pull-right"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="o_sub-menu">
          <ol class="o_breadcrumb breadcrumb nav navbar-left">
              
              





    
        
            <li><a href="../index.html">Developer Doc</a></li>
        
    
    <li class="active"><a href="#">Ссылка на JavaScript</a></li>

              
          </ol>

          <div class="call-to-action navbar-right hidden-xs">
            <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
          </div>

          <ul class="navbar-nav navbar-right nav o_sub_nav_actions">
            
              <li class="divider"></li>
            

            
            


            
          </ul>

          <ul class="nav navbar-nav navbar-right">
            

            
            
<!--
<li><a href="https://www.odoo.com/documentation/user/13.0/index.html">User</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/index.html">Developer</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/setup/install.html">Installation</a></li>
<li><a href="https://odoo.com/slides">eLearning</a></li>
<li><a href="https://www.odoo.com/page/odoo-white-paper">White Papers</a></li>
<li><a href="https://www.odoo.com/page/legal">Legal</a></li>
-->
            

            
          </ul>
        </div>
      </div>
    </nav>
  </header><div id="wrap" class="">
    
    
    
    <figure class="card top has_banner">
      <span class="card-img" style="background-image: url('../_static/banners/javascript.jpg');"></span>
      <div class="container text-center">
        <h1> Ссылка на JavaScript </h1>
      </div>
    </figure>
    
    
    
      <main class="container ">
        
        <div class="o_content row">
          
          <aside>
            <div class="navbar-aside text-center">
              <ul class="nav list-group text-left"><li class="list-group-item"><a href="#overview" class="reference internal ripple">обзор</a></li><li class="list-group-item"><a href="#web-client" class="reference internal ripple">Веб-клиент</a><ul ><li class="list-group-item"><a href="#single-page-application" class="reference internal ripple">Одностраничное приложение</a></li><li class="list-group-item"><a href="#overview-of-web-client-js-code" class="reference internal ripple">Обзор JS-кода веб-клиента</a></li></ul></li><li class="list-group-item"><a href="#assets-management" class="reference internal ripple">Управление активами</a><ul ><li class="list-group-item"><a href="#main-bundles" class="reference internal ripple">Основные связки</a></li><li class="list-group-item"><a href="#adding-files-in-an-asset-bundle" class="reference internal ripple">Добавление файлов в пакет активов</a></li><li class="list-group-item"><a href="#what-to-do-if-a-file-is-not-loaded-updated" class="reference internal ripple">Что делать, если файл не загружен / обновлен</a></li></ul></li><li class="list-group-item"><a href="#javascript-module-system" class="reference internal ripple">Система модулей Javascript</a><ul ><li class="list-group-item"><a href="#defining-a-module" class="reference internal ripple">Определение модуля</a></li><li class="list-group-item"><a href="#asynchronous-modules" class="reference internal ripple">Асинхронные модули</a></li><li class="list-group-item"><a href="#best-practices" class="reference internal ripple">Лучшие практики</a></li></ul></li><li class="list-group-item"><a href="#class-system" class="reference internal ripple">Система классов</a><ul ><li class="list-group-item"><a href="#creating-a-subclass" class="reference internal ripple">Создание подкласса</a></li><li class="list-group-item"><a href="#inheritance" class="reference internal ripple">наследование</a></li><li class="list-group-item"><a href="#mixins" class="reference internal ripple">Примеси</a></li><li class="list-group-item"><a href="#patching-an-existing-class" class="reference internal ripple">Исправление существующего класса</a></li></ul></li><li class="list-group-item"><a href="#widgets" class="reference internal ripple">Виджеты</a><ul ><li class="list-group-item"><a href="#widget-lifecycle" class="reference internal ripple">Жизненный цикл виджета</a></li><li class="list-group-item"><a href="#widget-api" class="reference internal ripple">API виджетов</a></li><li class="list-group-item"><a href="#inserting-a-widget-in-the-dom" class="reference internal ripple">Вставка виджета в DOM</a></li><li class="list-group-item"><a href="#widget-guidelines" class="reference internal ripple">Руководство по виджетам</a></li></ul></li><li class="list-group-item"><a href="#qweb-template-engine" class="reference internal ripple">QWeb Template Engine</a></li><li class="list-group-item"><a href="#event-system" class="reference internal ripple">Система событий</a><ul ><li class="list-group-item"><a href="#base-event-system" class="reference internal ripple">Базовая система событий</a></li><li class="list-group-item"><a href="#extended-event-system" class="reference internal ripple">Расширенная система событий</a></li></ul></li><li class="list-group-item"><a href="#registries" class="reference internal ripple">реестры</a></li><li class="list-group-item"><a href="#communication-between-widgets" class="reference internal ripple">Связь между виджетами</a></li><li class="list-group-item"><a href="#services" class="reference internal ripple">Сервисы</a><ul ><li class="list-group-item"><a href="#service" class="reference internal ripple">обслуживание</a></li><li class="list-group-item"><a href="#service-provider" class="reference internal ripple">Поставщик услуг</a></li><li class="list-group-item"><a href="#widget" class="reference internal ripple">Виджет</a></li><li class="list-group-item"><a href="#rpcs" class="reference internal ripple">RPCs</a></li></ul></li><li class="list-group-item"><a href="#notifications" class="reference internal ripple">Уведомления</a><ul ><li class="list-group-item"><a href="#notification-system" class="reference internal ripple">Система уведомления</a></li><li class="list-group-item"><a href="#displaying-a-notification" class="reference internal ripple">Отображение уведомления</a></li></ul></li><li class="list-group-item"><a href="#systray" class="reference internal ripple">Systray</a><ul ><li class="list-group-item"><a href="#adding-a-new-systray-item" class="reference internal ripple">Добавление нового элемента Systray</a></li><li class="list-group-item"><a href="#ordering" class="reference internal ripple">заказ</a></li></ul></li><li class="list-group-item"><a href="#translation-management" class="reference internal ripple">Управление переводом</a></li><li class="list-group-item"><a href="#session" class="reference internal ripple">сессия</a><ul ><li class="list-group-item"><a href="#adding-information-to-the-session" class="reference internal ripple">Добавление информации в сессию</a></li></ul></li><li class="list-group-item"><a href="#views" class="reference internal ripple">Взгляды</a></li><li class="list-group-item"><a href="#field-widgets" class="reference internal ripple">Полевые Виджеты</a><ul ><li class="list-group-item"><a href="#abstractfield" class="reference internal ripple">AbstractField</a></li><li class="list-group-item"><a href="#decorations" class="reference internal ripple">Украшения</a></li><li class="list-group-item"><a href="#non-relational-fields" class="reference internal ripple">Нереляционные поля</a></li><li class="list-group-item"><a href="#relational-fields" class="reference internal ripple">Реляционные поля</a></li></ul></li><li class="list-group-item"><a href="#client-actions" class="reference internal ripple">Действия клиента</a><ul ><li class="list-group-item"><a href="#adding-a-client-action" class="reference internal ripple">Добавление действия клиента</a></li><li class="list-group-item"><a href="#using-the-control-panel-mixin" class="reference internal ripple">Использование панели управления mixin</a></li></ul></li></ul>
              
              <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/13.0/doc/reference/javascript_reference.rst" class="gith-link">
                  Edit on GitHub
              </a></p>
              
            </div>
          </aside>
          
          <article class="doc-body ">
            
            
  <section id="javascript-reference"><p >В этом документе представлена структура Odoo Javascript. Этот каркас не является крупным приложением с точки зрения строк кода, но он довольно универсален, потому что это в основном машина, превращающая описание декларативного интерфейса в живое приложение, способное взаимодействовать с любой моделью и записями в базе данных. Можно даже использовать веб-клиент для изменения интерфейса веб-клиента.</p><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >HTML-версия всех строк документации js в Odoo доступна по адресу: <a href="javascript_api.html#api-js" class="alert-link reference internal"><span class="std std-ref">JS API</span></a></p></div></section><section id="overview"><h2 >обзор</h2><p >Инфраструктура Javascript предназначена для работы с тремя основными вариантами использования:</p><ul ><li >the <em >web client</em>: this is the private web application, where one can view and
edit business data. This is a single page application (the page is never
reloaded, only the new data is fetched from the server whenever it is needed)</li><li >the <em >website</em>: this is the public part of Odoo.  It allows an unidentified
user to browse some content, to shop or to perform many actions, as a client.
This is a classical website: various routes with controllers and some
javascript to make it work.</li><li >the <em >point of sale</em>: this is the interface for the point of sale. It is a
specialized single page application.</li></ul><p >Некоторый код JavaScript является общим для этих трех вариантов использования и связан вместе (см. Ниже в разделе ресурсов). В этом документе основное внимание будет уделено дизайну веб-клиента.</p></section><section id="web-client"><h2 >Веб-клиент</h2></section><section id="single-page-application"><h3 >Одностраничное приложение</h3><p >Короче говоря, * webClient <a href="#id1"><span id="id2" class="problematic">*</span></a>, экземпляр * WebClient * является корневым компонентом всего пользовательского интерфейса. Его ответственность заключается в организации всех различных подкомпонентов и предоставлении услуг, таких как rpcs, локальное хранилище и многое другое.</p><p >Во время выполнения веб-клиент представляет собой одностраничное приложение. Ему не нужно запрашивать полную страницу с сервера каждый раз, когда пользователь выполняет действие. Вместо этого он запрашивает только то, что ему нужно, а затем заменяет / обновляет представление. Кроме того, он управляет URL-адресом: он синхронизируется с состоянием веб-клиента.</p><p >Это означает, что, пока пользователь работает над Odoo, класс веб-клиента (и менеджер действий) фактически создает и уничтожает многие подкомпоненты. Состояние очень динамично, и каждый виджет может быть уничтожен в любое время.</p></section><section id="overview-of-web-client-js-code"><h3 >Обзор JS-кода веб-клиента</h3><p >Здесь мы даем очень краткий обзор кода веб-клиента в дополнении * web / static / src / js <a href="#id1"><span id="id2" class="problematic">*</span></a>. Обратите внимание, что это намеренно не является исчерпывающим. Мы покрываем только самые важные файлы / папки.</p><ul ><li ><em >boot.js</em>: this is the file that defines the module system.  It needs to be
loaded first.</li><li ><em >core/</em>: this is a collection of lower level building blocks. Notably, it
contains the class system, the widget system, concurrency utilities, and many
other class/functions.</li><li ><em >chrome/</em>: in this folder, we have most large widgets which make up most of
the user interface.</li><li ><em >chrome/abstract_web_client.js</em> and <em >chrome/web_client.js</em>: together, these
files define the WebClient widget, which is the root widget for the web client.</li><li ><em >chrome/action_manager.js</em>: this is the code that will convert an action into
a widget (for example a kanban or a form view)</li><li ><em >chrome/search_X.js</em> all these files define the search view (it is not a view
in the point of view of the web client, only from the server point of view)</li><li ><em >fields</em>: all main view field widgets are defined here</li><li ><em >views</em>: this is where the views are located</li></ul></section><section id="assets-management"><h2 >Управление активами</h2><p >Управление активами в Odoo не так просто, как в некоторых других приложениях. Одна из причин заключается в том, что у нас есть множество ситуаций, когда требуются некоторые, но не все активы. Например, потребности веб-клиента, торговой точки, веб-сайта или даже мобильного приложения различны. Кроме того, некоторые активы могут быть большими, но они редко нужны. В этом случае мы иногда хотим, чтобы они загружались лениво.</p><p >Основная идея заключается в том, что мы определяем набор * bundles * в xml. Пакет здесь определяется как набор файлов (javascript, css, scss). В Odoo наиболее важные пакеты определены в файле * addons / web / views / webclient_templates.xml <a href="#id1"><span id="id2" class="problematic">*</span></a>. Это выглядит так:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">&quot;web.assets_common&quot;</span> <span class="na">name=</span><span class="s">&quot;Common Assets (used in backend interface and website)&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href=</span><span class="s">&quot;/web/static/lib/jquery.ui/jquery-ui.css&quot;</span><span class="nt">/&gt;</span>
    ...
    <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;/web/static/src/js/boot.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    ...
<span class="nt">&lt;/template&gt;</span>
</pre></div>
</div>
<p >Затем файлы в пакете можно вставить в шаблон с помощью директивы * t-call-assets <a href="#id1"><span id="id2" class="problematic">*</span></a>:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-call-assets=</span><span class="s">&quot;web.assets_common&quot;</span> <span class="na">t-js=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;t</span> <span class="na">t-call-assets=</span><span class="s">&quot;web.assets_common&quot;</span> <span class="na">t-css=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p >Вот что происходит, когда шаблон отображается сервером с этими директивами:</p><ul ><li >все файлы * scss <a href="#id1"><span id="id2" class="problematic">*</span></a>, описанные в комплекте, скомпилированы в файлы css. Файл с именем * file.scss * будет скомпилирован в файл с именем * file.scss.css <a href="#id3"><span id="id4" class="problematic">*</span></a>.</li><li ><dl ><dt >если мы находимся в режиме * debug = assets <a href="#id1"><span id="id2" class="problematic">*</span></a>,</dt><dd ><ul ><li >директива * t-call-assets * с атрибутом * t-js <a href="#id1"><span id="id2" class="problematic">*</span></a>, установленным в false, будет заменена списком тегов таблицы стилей, указывающих на файлы css</li><li >директива * t-call-assets * с атрибутом * t-css <a href="#id1"><span id="id2" class="problematic">*</span></a>, установленным в false, будет заменена списком тегов сценария, указывающих на файлы js</li></ul></dd></dl></li><li ><dl ><dt >если мы не в режиме * debug = assets <a href="#id1"><span id="id2" class="problematic">*</span></a>,</dt><dd ><ul ><li >CSS-файлы будут объединены и уменьшены, а затем будет создан тег таблицы стилей.</li><li >js-файлы объединяются и минимизируются, затем генерируется тег сценария</li></ul></dd></dl></li></ul><p >Обратите внимание, что файлы ресурсов кэшируются, поэтому теоретически браузер должен загружать их только один раз.</p></section><section id="main-bundles"><h3 >Основные связки</h3><p >Когда сервер Odoo запущен, он проверяет временную метку каждого файла в пакете и при необходимости создает / воссоздает соответствующие пакеты.</p><p >Вот несколько важных пакетов, которые большинству разработчиков нужно знать:</p><ul ><li ><em >web.assets_common</em>: this bundle contains most assets which are common to the
web client, the website, and also the point of sale. This is supposed to contain
lower level building blocks for the odoo framework.  Note that it contains the
<em >boot.js</em> file, which defines the odoo module system.</li><li ><em >web.assets_backend</em>: this bundle contains the code specific to the web client
(notably the web client/action manager/views)</li><li ><em >web.assets_frontend</em>: this bundle is about all that is specific to the public
website: ecommerce, forum, blog, event management, …</li></ul></section><section id="adding-files-in-an-asset-bundle"><h3 >Добавление файлов в пакет активов</h3><p >Правильный способ добавить файл, находящийся в * addons / web <a href="#id1"><span id="id2" class="problematic">*</span></a>, в пакет очень прост: достаточно просто добавить тег * script * или * stylesheet * в пакет в файле * webclient_templates.xml <a href="#id3"><span id="id4" class="problematic">*</span></a>. Но когда мы работаем в другом дополнении, нам нужно добавить файл из этого дополнения. В этом случае это должно быть сделано в три этапа:</p><ol ><li >добавьте файл * assets.xml * в папку * views / *</li><li >добавьте строку 'views / assets.xml' в ключ 'data' в файле манифеста</li><li >создайте унаследованное представление желаемого пакета и добавьте файл (ы) с выражением xpath. Например,</li></ol><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">&quot;assets_backend&quot;</span> <span class="na">name=</span><span class="s">&quot;helpdesk assets&quot;</span> <span class="na">inherit_id=</span><span class="s">&quot;web.assets_backend&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xpath</span> <span class="na">expr=</span><span class="s">&quot;//script[last()]&quot;</span> <span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/scss&quot;</span> <span class="na">href=</span><span class="s">&quot;/helpdesk/static/src/scss/helpdesk.scss&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;/helpdesk/static/src/js/helpdesk_dashboard.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/xpath&gt;</span>
<span class="nt">&lt;/template&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Обратите внимание, что файлы в пакете загружаются сразу же, когда пользователь загружает веб-клиент odoo. Это означает, что файлы передаются через сеть каждый раз (кроме случаев, когда кеш браузера активен). В некоторых случаях может быть лучше лениво загрузить некоторые активы. Например, если для виджета требуется большая библиотека, и этот виджет не является основной частью опыта, то может быть хорошей идеей загружать библиотеку только тогда, когда виджет фактически создан. Класс виджета имеет встроенную поддержку только для этого варианта использования. (см. раздел <a href="#reference-javascript-reference-qweb" class="alert-link reference internal"><span class="std std-ref">QWeb Template Engine</span></a>)</p></div></section><section id="what-to-do-if-a-file-is-not-loaded-updated"><h3 >Что делать, если файл не загружен / обновлен</h3><p >Существует много разных причин, по которым файл может быть загружен неправильно. Вот несколько вещей, которые вы можете попробовать решить:</p><ul ><li >после запуска сервера он не знает, был ли изменен файл ресурса. Таким образом, вы можете просто перезапустить сервер, чтобы восстановить ресурсы.</li><li >проверьте консоль (в инструментах разработчика, обычно открываемых с помощью F12), чтобы убедиться в отсутствии явных ошибок</li><li >попробуйте добавить console.log в начале вашего файла (до определения любого модуля), чтобы вы могли увидеть, был ли файл загружен или нет</li><li >в пользовательском интерфейсе в режиме отладки (ВСТАВЬТЕ ССЫЛКУ ЗДЕСЬ В РЕЖИМ ОТЛАДКИ) есть опция, заставляющая сервер обновлять свои файлы ресурсов.</li><li >используйте режим * debug = assets <a href="#id1"><span id="id2" class="problematic">*</span></a>. Это фактически пропустит пакеты активов (обратите внимание, что это фактически не решает проблему. Сервер все еще использует устаревшие пакеты)</li><li >наконец, наиболее удобный способ сделать это для разработчика - запустить сервер с параметром * - dev = all <a href="#id1"><span id="id2" class="problematic">*</span></a>. Это активирует параметры средства просмотра файлов, которые автоматически аннулируют активы при необходимости. Обратите внимание, что это не очень хорошо работает, если ОС Windows.</li><li >не забудьте обновить свою страницу!</li><li >или, возможно, чтобы сохранить файл кода …</li></ul><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >После того, как файл ресурса был воссоздан, вам нужно обновить страницу, чтобы перезагрузить нужные файлы (если это не работает, файлы могут быть кэшированы).</p></div></section><section id="javascript-module-system"><h2 >Система модулей Javascript</h2><p >Как только мы сможем загрузить наши файлы JavaScript в браузер, нам нужно убедиться, что они загружены в правильном порядке. Для этого в Odoo определена небольшая модульная система (находится в файле * addons / web / static / src / js / boot.js <a href="#id1"><span id="id2" class="problematic">*</span></a>, который должен быть загружен первым).</p><p >Система модулей Odoo, вдохновленная AMD, работает путем определения функции * define * для глобального объекта odoo. Затем мы определяем каждый модуль javascript, вызывая эту функцию. В платформе Odoo модуль представляет собой фрагмент кода, который будет выполнен в максимально короткие сроки. У него есть имя и, возможно, некоторые зависимости. Когда его зависимости загружены, модуль также будет загружен. Значением модуля является возвращаемое значение функции, определяющей модуль.</p><p >Как пример, это может выглядеть так:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// in file a.js</span>
<span class="nx">odoo</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;module.A&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">require</span><span class="p">)</span> <span class="p">{</span>
    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">A</span> <span class="o">=</span> <span class="p">...;</span>

    <span class="k">return</span> <span class="nx">A</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// in file b.js</span>
<span class="nx">odoo</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;module.B&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">require</span><span class="p">)</span> <span class="p">{</span>
    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">A</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;module.A&#39;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">B</span> <span class="o">=</span> <span class="p">...;</span> <span class="c1">// something that involves A</span>

    <span class="k">return</span> <span class="nx">B</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Альтернативный способ определения модуля состоит в том, чтобы явно указать список зависимостей во втором аргументе.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;module.Something&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;module.A&#39;</span><span class="p">,</span> <span class="s1">&#39;module.B&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">require</span><span class="p">)</span> <span class="p">{</span>
    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">A</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;module.A&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">B</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;module.B&#39;</span><span class="p">);</span>

    <span class="c1">// some code</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Если некоторые зависимости отсутствуют / не готовы, то модуль просто не будет загружен. Через несколько секунд в консоли появится предупреждение.</p><p >Обратите внимание, что циклические зависимости не поддерживаются. Это имеет смысл, но это означает, что нужно быть осторожным.</p></section><section id="defining-a-module"><h3 >Определение модуля</h3><p >Метод * odoo.define * имеет три аргумента:</p><ul ><li ><p ><em >moduleName</em>: the name of the javascript module.  It should be a unique string.
The convention is to have the name of the odoo addon followed by a specific
description. For example, „web.Widget“ describes a module defined in the <em >web</em>
addon, which exports a <em >Widget</em> class (because the first letter is capitalized)</p><p >Если имя не уникально, исключение будет выдано и отображено в консоли.</p></li><li ><em >dependencies</em>: the second argument is optional. If given, it should be a list
of strings, each corresponding to a javascript module.  This describes the
dependencies that are required to be loaded before the module is executed. If
the dependencies are not explicitly given here, then the module system will
extract them from the function by calling toString on it, then using a regexp
to find all <em >require</em> statements.</li></ul><div class="highlight-javascript"><div class="highlight"><pre><span></span>  <span class="nx">odoo</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;module.Something&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;web.ajax&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">require</span><span class="p">)</span> <span class="p">{</span>
    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">ajax</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.ajax&#39;</span><span class="p">);</span>

    <span class="c1">// some code here</span>
    <span class="k">return</span> <span class="nx">something</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<ul ><li >наконец, последний аргумент - это функция, которая определяет модуль. Его возвращаемое значение - это значение модуля, которое может быть передано другим модулям, требующим его. Обратите внимание, что существует небольшое исключение для асинхронных модулей, см. Следующий раздел.</li></ul><p >Если ошибка происходит, она будет зарегистрирована (в режиме отладки) в консоли:</p><ul ><li >`` Отсутствующие зависимости``: эти модули не отображаются на странице. Возможно, что файл JavaScript отсутствует на странице или что имя модуля неверно</li><li >`` Failed modules``: обнаружена ошибка JavaScript</li><li >`` Rejected modules``: модуль возвращает отклоненное обещание. Он (и его зависимые модули) не загружен.</li><li >`` Отклоненные связанные модули``: Модули, зависящие от отклоненного модуля</li><li >`` Не загруженные модули``: модули, которые зависят от отсутствующего или неисправного модуля</li></ul></section><section id="asynchronous-modules"><h3 >Асинхронные модули</h3><p >Может случиться так, что модуль должен выполнить некоторую работу, прежде чем он будет готов. Например, он может сделать RPC для загрузки некоторых данных. В этом случае модуль может просто вернуть обещание. В этом случае система модулей просто будет ждать выполнения обещания, прежде чем зарегистрировать модуль.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;module.Something&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">require</span><span class="p">)</span> <span class="p">{</span>
    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">ajax</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.ajax&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">ajax</span><span class="p">.</span><span class="nx">rpc</span><span class="p">(...).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// some code here</span>
        <span class="k">return</span> <span class="nx">something</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
</section><section id="best-practices"><h3 >Лучшие практики</h3><ul ><li >помните соглашение для имени модуля: * имя дополнения * с суффиксом * имя модуля <a href="#id1"><span id="id2" class="problematic">*</span></a>.</li><li >объявите все ваши зависимости в верхней части модуля. Кроме того, они должны быть отсортированы в алфавитном порядке по имени модуля. Это облегчает понимание вашего модуля.</li><li >объявить все экспортированные значения в конце</li><li >старайтесь не экспортировать слишком много вещей из одного модуля. Обычно лучше просто экспортировать одну вещь в один (маленький / маленький) модуль.</li><li >асинхронные модули могут быть использованы для упрощения некоторых случаев использования. Например, модуль * web.dom_ready * возвращает обещание, которое будет выполнено, когда dom будет фактически готов. Таким образом, другой модуль, которому требуется DOM, может просто где-то иметь инструкцию * require ('web.dom_ready') <a href="#id1"><span id="id2" class="problematic">*</span></a>, и код будет выполняться только тогда, когда DOM будет готов.</li><li >Старайтесь избегать определения более одного модуля в одном файле. Это может быть удобно в краткосрочной перспективе, но на самом деле это сложнее поддерживать.</li></ul></section><section id="class-system"><h2 >Система классов</h2><p >Odoo был разработан до того, как стали доступны классы ECMAScript 6. В Ecmascript 5 стандартным способом определения класса является определение функции и добавление методов к ее объекту-прототипу. Это хорошо, но это немного сложно, когда мы хотим использовать наследование, mixins.</p><p >По этим причинам Odoo решил использовать собственную систему классов, вдохновленную Джоном Резигом. Базовый класс находится в * web.Class <a href="#id1"><span id="id2" class="problematic">*</span></a>, в файле * class.js <a href="#id3"><span id="id4" class="problematic">*</span></a>.</p></section><section id="creating-a-subclass"><h3 >Создание подкласса</h3><p >Давайте обсудим, как создаются классы. Основным механизмом является использование метода * extended * (это более или менее эквивалентно * extension * в классах ES6).</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Class</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.Class&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">Animal</span> <span class="o">=</span> <span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">hunger</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">move</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">hunger</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">hunger</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">eat</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">hunger</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >В этом примере функция * init * является конструктором. Он будет вызван при создании экземпляра. Создание экземпляра выполняется с помощью ключевого слова * new <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p></section><section id="inheritance"><h3 >наследование</h3><p >Удобно иметь возможность наследовать существующий класс. Это просто делается с помощью метода * extended * в суперклассе. Когда метод вызывается, фреймворк тайно перепривязывает специальный метод: * _super * к вызываемому в настоящее время методу. Это позволяет нам использовать * this._super * всякий раз, когда нам нужно вызвать родительский метод.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Animal</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.Animal&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">Dog</span> <span class="o">=</span> <span class="nx">Animal</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">move</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">bark</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">bark</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;woof&#39;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">dog</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dog</span><span class="p">();</span>
<span class="nx">dog</span><span class="p">.</span><span class="nx">move</span><span class="p">()</span>
</pre></div>
</div>
</section><section id="mixins"><h3 >Примеси</h3><p >Система классов odoo не поддерживает множественное наследование, но для тех случаев, когда нам нужно поделиться некоторым поведением, у нас есть смешанная система: метод * extended * может фактически принимать произвольное число аргументов и объединит их все в новый класс.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Animal</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.Animal&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">DanceMixin</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">dance</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;dancing...&#39;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">Hamster</span> <span class="o">=</span> <span class="nx">Animal</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">DanceMixin</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">sleep</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;sleeping&#39;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >В этом примере класс * Hamster * является подклассом Animal, но он также смешивает DanceMixin.</p></section><section id="patching-an-existing-class"><h3 >Исправление существующего класса</h3><p >Это не часто, но нам иногда нужно изменить другой класс * на месте <a href="#id1"><span id="id2" class="problematic">*</span></a>. Цель состоит в том, чтобы иметь механизм для изменения класса и всех будущих / настоящих экземпляров. Это делается с помощью метода * include <a href="#id3"><span id="id4" class="problematic">*</span></a>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Hamster</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.Hamster&#39;</span><span class="p">);</span>

<span class="nx">Hamster</span><span class="p">.</span><span class="nx">include</span><span class="p">({</span>
    <span class="nx">sleep</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;zzzz&#39;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Это, очевидно, опасная операция, и ее следует выполнять с осторожностью. Но из-за структуры Odoo в одном дополнении иногда необходимо изменить поведение виджета / класса, определенного в другом дополнении. Обратите внимание, что он изменит все экземпляры класса, даже если они уже были созданы.</p></section><section id="widgets"><h2 >Виджеты</h2><p >Класс * Widget * действительно важный строительный блок пользовательского интерфейса. Практически все в пользовательском интерфейсе находится под контролем виджета. Класс Widget определен в модуле * web.Widget <a href="#id1"><span id="id2" class="problematic">*</span></a>, в * widget.js <a href="#id3"><span id="id4" class="problematic">*</span></a>.</p><p >Вкратце, функции, предоставляемые классом Widget, включают:</p><ul ><li >отношения родитель / потомок между виджетами (* PropertiesMixin <a href="#id1"><span id="id2" class="problematic">*</span></a>)</li><li ><dl ><dt >расширенное управление жизненным циклом с функциями безопасности (например,</dt><dd >автоматическое уничтожение дочерних виджетов при уничтожении родителя)</dd></dl></li><li >автоматический рендеринг с <a href="qweb.html#reference-qweb" class="reference internal"><span class="std std-ref">qweb</span></a></li><li >различные вспомогательные функции, помогающие взаимодействовать с внешней средой.</li></ul><p >Вот пример базового виджета счетчика:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Widget</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.Widget&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">Counter</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;some.template&#39;</span><span class="p">,</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click button&#39;</span><span class="o">:</span> <span class="s1">&#39;_onClick&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">count</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">_onClick</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.val&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >В этом примере предположим, что шаблон * some.template * (и загружен правильно: шаблон находится в файле, который правильно определен в ключе * qweb * в манифесте модуля) определяется как:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div</span> <span class="na">t-name=</span><span class="s">&quot;some.template&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;val&quot;</span><span class="nt">&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;widget.count&quot;</span><span class="nt">/&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;button&gt;</span>Increment<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p >Этот пример виджета можно использовать следующим образом:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Create the instance</span>
<span class="kd">var</span> <span class="nx">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Counter</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="c1">// Render and insert into DOM</span>
<span class="nx">counter</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="s2">&quot;.some-div&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p >Этот пример иллюстрирует некоторые особенности класса * Widget <a href="#id1"><span id="id2" class="problematic">*</span></a>, включая систему событий, систему шаблонов, конструктор с начальным аргументом * parent <a href="#id3"><span id="id4" class="problematic">*</span></a>.</p></section><section id="widget-lifecycle"><h3 >Жизненный цикл виджета</h3><p >Как и во многих системах компонентов, класс виджетов имеет четко определенный жизненный цикл. Обычный жизненный цикл следующий: вызывается * init <a href="#id1"><span id="id2" class="problematic">*</span></a>, затем * willStart <a href="#id3"><span id="id4" class="problematic">*</span></a>, затем выполняется рендеринг, затем * start * и наконец * destroy <a href="#id5"><span id="id6" class="problematic">*</span></a>.</p><section class="code-function"><h6 id="Widget.init"><code>Widget.init(<em>parent</em>)</code></h6><p >это конструктор Предполагается, что метод init инициализирует базовое состояние виджета. Это синхронно и может быть переопределено, чтобы получить больше параметров от создателя / родителя виджета</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Аргументы</div><div class="code-field-body"><ul ><li ><strong >parent</strong> (<code class="js xref js-class">Widget()</code>) – родитель нового виджета, используемый для обработки автоматического уничтожения и распространения событий. Может быть `` null``, чтобы виджет не имел родителя.</li></ul></div></div></div></section><section class="code-function"><h6 id="Widget.willStart"><code>Widget.willStart()</code></h6><p >этот метод будет вызываться платформой один раз при создании виджета и в процессе добавления к DOM. Метод * willStart * - это ловушка, которая должна возвращать обещание. Среда JS будет ждать выполнения этого обещания, прежде чем перейти к шагу рендеринга. Обратите внимание, что на данный момент виджет не имеет корневого элемента DOM. Хук * willStart * в основном полезен для выполнения некоторой асинхронной работы, такой как выборка данных с сервера.</p></section><section class="code-function"><h6 id="[Rendering]"><code>[Rendering]()</code></h6><p >Этот шаг автоматически выполняется фреймворком. Что происходит, так это то, что каркас проверяет, определен ли ключ шаблона в виджете. Если это так, то он будет отображать этот шаблон с ключом * widget <a href="#id1"><span id="id2" class="problematic">*</span></a>, связанным с виджетом в контексте рендеринга (см. Пример выше: мы используем * widget.count * в шаблоне QWeb для чтения значения из виджета ). Если шаблон не определен, мы читаем ключ * tagName * и создаем соответствующий элемент DOM. Когда рендеринг завершен, мы устанавливаем результат как свойство $ el виджета. После этого мы автоматически связываем все события в событиях и ключах custom_events.</p></section><section class="code-function"><h6 id="Widget.start"><code>Widget.start()</code></h6><p >когда рендеринг завершится, фреймворк автоматически вызовет метод * start <a href="#id1"><span id="id2" class="problematic">*</span></a>. Это полезно для выполнения некоторых специализированных пост-рендеринга. Например, настройка библиотеки.</p><p >Необходимо вернуть обещание, чтобы указать, когда его работа завершена.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">обещание</div></div></div></section><section class="code-function"><h6 id="Widget.destroy"><code>Widget.destroy()</code></h6><p >Это всегда последний шаг в жизни виджета. Когда виджет уничтожен, мы в основном выполняем все необходимые операции очистки: удаление виджета из дерева компонентов, открепление всех событий, …</p><p >Вызывается автоматически, когда родительский элемент виджета уничтожается, должен вызываться явно, если у виджета нет родителя или он удален, но его родительский элемент остается.</p></section><p >Обратите внимание, что willStart и метод start не обязательно вызываются. Виджет можно создать (будет вызван метод * init <a href="#id1"><span id="id2" class="problematic">*</span></a>), а затем уничтожить (метод * destroy <a href="#id3"><span id="id4" class="problematic">*</span></a>), даже не добавив его в DOM. Если это так, willStart и start даже не будут вызваны.</p></section><section id="widget-api"><h3 >API виджетов</h3><section class="code-attribute"><h6 id="Widget.tagName"><code>Widget.tagName</code></h6><p >Используется, если виджет не имеет определенного шаблона. По умолчанию `` div``, будет использоваться в качестве имени тега для создания элемента DOM, который будет установлен как корень DOM виджета. Можно дополнительно настроить этот сгенерированный корень DOM со следующими атрибутами:</p></section><section class="code-attribute"><h6 id="Widget.id"><code>Widget.id</code></h6><p >Используется для генерации атрибута `` id`` в сгенерированном корне DOM. Обратите внимание, что это редко требуется и, вероятно, не очень хорошая идея, если виджет можно использовать более одного раза.</p></section><section class="code-attribute"><h6 id="Widget.className"><code>Widget.className</code></h6><p >Используется для генерации атрибута `` class`` в сгенерированном корне DOM. Обратите внимание, что на самом деле он может содержать более одного класса css: * 'some-class other-class' *</p></section><section class="code-attribute"><h6 id="Widget.attributes"><code>Widget.attributes</code></h6><p >Отображение (литерал объекта) имен атрибутов в значения атрибутов. Каждая из этих пар k: v будет установлена как атрибут DOM в сгенерированном корне DOM.</p></section><section class="code-attribute"><h6 id="Widget.el"><code>Widget.el</code></h6><p >необработанный элемент DOM, установленный как корень для виджета (доступен только после запуска метода жизненного цикла)</p></section><section class="code-attribute"><h6 id="Widget._S_el"><code>Widget.$el</code></h6><p >jQuery обертка вокруг: attr: <code >~ Widget.el</code>. (доступно только после запуска жизненного цикла)</p></section><section class="code-attribute"><h6 id="Widget.template"><code>Widget.template</code></h6><p >Должно быть задано имя шаблона <a href="qweb.html#reference-qweb" class="alert-link reference internal"><span class="std std-ref">QWeb template</span></a>. Если установлено, шаблон будет отображаться после инициализации виджета, но до его запуска. Корневой элемент, сгенерированный шаблоном, будет установлен как корневой DOM виджета.</p></section><section class="code-attribute"><h6 id="Widget.xmlDependencies"><code>Widget.xmlDependencies</code></h6><p >Список путей к XML-файлам, которые необходимо загрузить перед тем, как виджет может быть визуализирован. Это не приведет к загрузке чего-либо, что уже было загружено. Это полезно, когда вы хотите загружать свои шаблоны лениво или если вы хотите поделиться виджетом между веб-сайтом и интерфейсом веб-клиента.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">EditorMenuBar</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">xmlDependencies</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;/web_editor/static/src/xml/editor.xml&#39;</span><span class="p">],</span>
    <span class="p">...</span>
</pre></div>
</div>
</section><section class="code-attribute"><h6 id="Widget.events"><code>Widget.events</code></h6><p >События - это отображение селектора событий (имя события и необязательный селектор CSS, разделенные пробелом) с обратным вызовом. Обратным вызовом может быть имя метода виджета или объекта функции. В любом случае, `` this`` будет установлен на виджет:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;click p.oe_some_class a&#39;</span><span class="o">:</span> <span class="s1">&#39;some_method&#39;</span><span class="p">,</span>
    <span class="s1">&#39;change input&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">},</span>
</pre></div>
</div>
<p >Селектор используется для делегирования событий jQuery, обратный вызов будет активирован только для потомков корня DOM, соответствующих селектору. Если селектор опущен (указывается только имя события), событие будет установлено непосредственно в корень DOM виджета.</p><p >Примечание: использование встроенной функции не рекомендуется, и, вероятно, будет удалено иногда в будущем.</p></section><section class="code-attribute"><h6 id="Widget.custom_events"><code>Widget.custom_events</code></h6><p >это почти то же самое, что и атрибут * events <a href="#id1"><span id="id2" class="problematic">*</span></a>, но ключи являются произвольными строками. Они представляют бизнес-события, запускаемые некоторыми вспомогательными виджетами. Когда событие инициируется, оно «всплывает» в дереве виджетов (см. Подробности в разделе «Связь с компонентами»).</p></section><section class="code-function"><h6 id="Widget.isDestroyed"><code>Widget.isDestroyed()</code></h6><div class="code-fields"><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">`` true``, если виджет находится или был уничтожен, `` false`` в противном случае</div></div></div></section><section class="code-function"><h6 id="Widget._S_"><code>Widget.$(<em>selector</em>)</code></h6><p >Применяет селектор CSS, указанный в качестве параметра, к корню DOM виджета:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
</pre></div>
</div>
<p >функционально идентичен:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
</pre></div>
</div>
<div class="code-fields"><div class="code-field"><div class="code-field-name">Аргументы</div><div class="code-field-body"><ul ><li ><strong >selector</strong> (<code >String</code>) – CSS селектор</li></ul></div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">объект jQuery</div></div></div><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >этот вспомогательный метод похож на `` Backbone.View. $ ``</p></div></section><section class="code-function"><h6 id="Widget.setElement"><code>Widget.setElement(<em>element</em>)</code></h6><p >Сбрасывает корень DOM виджета на предоставленный элемент, также обрабатывает переустановку различных псевдонимов корня DOM, а также сбрасывает и сбрасывает делегированные события.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Аргументы</div><div class="code-field-body"><ul ><li ><strong >element</strong> (<code >Element</code>) – элемент DOM или объект jQuery для установки в качестве корня DOM виджета</li></ul></div></div></div></section></section><section id="inserting-a-widget-in-the-dom"><h3 >Вставка виджета в DOM</h3><section class="code-function"><h6 id="Widget.appendTo"><code>Widget.appendTo(<em>element</em>)</code></h6><p >Визуализирует виджет и вставляет его как последний дочерний объект цели, используя <code >.appendTo ()</code> _</p></section><section class="code-function"><h6 id="Widget.prependTo"><code>Widget.prependTo(<em>element</em>)</code></h6><p >Визуализирует виджет и вставляет его в качестве первого потомка цели, использует <code >.prependTo ()</code> _</p></section><section class="code-function"><h6 id="Widget.insertAfter"><code>Widget.insertAfter(<em>element</em>)</code></h6><p >Визуализирует виджет и вставляет его как предшествующий элемент цели, использует <code >.insertAfter ()</code> _</p></section><section class="code-function"><h6 id="Widget.insertBefore"><code>Widget.insertBefore(<em>element</em>)</code></h6><p >Визуализирует виджет и вставляет его в качестве следующего целевого элемента, используя <code >.insertBefore ()</code> _</p></section><p >Все эти методы принимают все, что принимает соответствующий метод jQuery (селекторы CSS, узлы DOM или объекты jQuery). Все они возвращают обещание и отвечают за три задачи:</p><ul ><li ><dl ><dt >рендеринг корневого элемента виджета через</dt><dd >: FUNC: <code >~ Widget.renderElement</code></dd></dl></li><li ><dl ><dt >вставка корневого элемента виджета в DOM с использованием любого jQuery</dt><dd >метод они соответствуют</dd></dl></li><li >запуск виджета и возвращение результата его запуска</li></ul></section><section id="widget-guidelines"><h3 >Руководство по виджетам</h3><ul ><li ><dl ><dt >Идентификаторы (атрибут `` id``) следует избегать. В общих приложениях</dt><dd ><p >и для модулей, `` id`` ограничивает возможность повторного использования компонентов и делает код более хрупким. В большинстве случаев их можно заменить ничем, классами или сохранением ссылки на узел DOM или элемент jQuery.</p><p >Если `` id`` абсолютно необходим (потому что сторонняя библиотека требует его), идентификатор должен быть частично сгенерирован с использованием `` _.uniqueId () `` например:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="s1">&#39;my-widget-&#39;</span><span class="p">);</span>
</pre></div>
</div>
</dd></dl></li><li >Избегайте предсказуемых / общих имен классов CSS. Имена классов, такие как «контент» или «навигация», могут соответствовать желаемому значению / семантике, но вполне вероятно, что у другого разработчика возникнет такая же потребность, что приведет к конфликту имен и непреднамеренному поведению. Имена общих классов должны начинаться с префикса, например, с имени компонента, к которому они принадлежат (создавая «неформальные» пространства имен, как в C или Objective-C).</li><li >Глобальных селекторов следует избегать. Поскольку компонент может использоваться несколько раз на одной странице (примером в Odoo являются панели мониторинга), запросы должны быть ограничены областью действия данного компонента. Нефильтрованные выделения, такие как `` $ (селектор) `` или `` document.querySelectorAll (селектор) <a href="#id1"><span id="id2" class="problematic">``</span></a>, обычно приводят к непреднамеренному или неправильному поведению. Odoo Web <code class="js xref js-class">Widget()</code> имеет атрибут, обеспечивающий его корень DOM (: attr:` ~ Widget. $ El`), и ярлык для непосредственного выбора узлов ( <a href="#Widget._S_" title="Widget.$" class="reference internal"><code class="js xref js-func">$()</code></a>).</li><li >В более общем случае, никогда не предполагайте, что ваши компоненты принадлежат или управляют чем-либо, кроме его собственного: attr: <code >~ Widget. $ El</code> (поэтому избегайте использования ссылки на родительский виджет)</li><li >Шаблоны HTML / рендеринг должны использовать QWeb, если не совсем тривиально.</li><li >Все интерактивные компоненты (компоненты, отображающие информацию на экране или перехватывающие события DOM) должны наследовать от <code class="js xref js-class">Widget()</code> и правильно реализовывать и использовать его API и жизненный цикл.</li><li ><p >Прежде чем использовать $ el, обязательно дождитесь окончания начала, например:</p><blockquote ><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Widget</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.Widget&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">AlmostCorrectWidget</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(....)</span> <span class="c1">// in theory, $el is already set, but you don&#39;t know what the parent will do with it, better call super first</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">IncorrectWidget</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span> <span class="c1">// the parent promise is lost, nobody will wait for the start of this widget</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(....)</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">CorrectWidget</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">arguments</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(....)</span> <span class="c1">// this works, no promise is lost and the code executes in a controlled order: first super, then our code.</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</blockquote></li></ul></section><section id="qweb-template-engine"><i id="reference-javascript-reference-qweb"></i><h2 >QWeb Template Engine</h2><p >Веб-клиент использует шаблонизатор <a href="qweb.html" class="reference internal"><span class="doc">Qweb</span></a> для визуализации виджетов (если они не переопределяют метод * renderElement * для выполнения чего-то еще). Шаблонный движок Qweb JS основан на XML и в основном совместим с реализацией Python.</p><p >Теперь давайте объясним, как загружаются шаблоны. Каждый раз, когда запускается веб-клиент, создается rpc для маршрута * / web / webclient / qweb <a href="#id1"><span id="id2" class="problematic">*</span></a>. Затем сервер вернет список всех шаблонов, определенных в файлах данных для каждого установленного модуля. Правильные файлы перечислены в записи * qweb * каждого манифеста модуля.</p><p >Веб-клиент будет ждать загрузки этого списка шаблона, прежде чем запускать свой первый виджет.</p><p >Этот механизм работает достаточно хорошо для наших нужд, но иногда мы хотим лениво загрузить шаблон. Например, представьте, что у нас есть виджет, который используется редко. В этом случае, возможно, мы предпочитаем не загружать его шаблон в основной файл, чтобы сделать веб-клиент немного легче. В этом случае мы можем использовать ключ * xmlDependencies * виджета:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Widget</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.Widget&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">Counter</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;some.template&#39;</span><span class="p">,</span>
    <span class="nx">xmlDependencies</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;/myaddon/path/to/my/file.xml&#39;</span><span class="p">],</span>

    <span class="p">...</span>

<span class="p">});</span>
</pre></div>
</div>
<p >При этом виджет * Counter * загрузит файлы xmlDependencies в своем методе * willStart <a href="#id1"><span id="id2" class="problematic">*</span></a>, поэтому шаблон будет готов к выполнению рендеринга.</p></section><section id="event-system"><h2 >Система событий</h2><p >В настоящее время Odoo поддерживает две системы событий: простую систему, которая позволяет добавлять слушателей и инициировать события, и более совершенную систему, которая также создает «всплывающие» события.</p><p >Обе эти системы событий реализованы в * EventDispatcherMixin <a href="#id1"><span id="id2" class="problematic">*</span></a>, в файле * mixins.js <a href="#id3"><span id="id4" class="problematic">*</span></a>. Этот миксин входит в класс * Widget <a href="#id5"><span id="id6" class="problematic">*</span></a>.</p></section><section id="base-event-system"><h3 >Базовая система событий</h3><p >Эта система событий была исторически первой. Он реализует простой шаблон шины. У нас есть 4 основных метода:</p><ul ><li ><em >on</em>: this is used to register a listener on an event.</li><li ><em >off</em>: useful to remove events listener.</li><li ><em >once</em>: this is used to register a listener that will only be called once.</li><li ><em >trigger</em>: trigger an event. This will cause each listeners to be called.</li></ul><p >Вот пример того, как можно использовать эту систему событий:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Widget</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.Widget&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Counter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;myModule.Counter&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Counter</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">counter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;valuechange&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onValueChange</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">def</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">counter</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">def</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)]);</span>
    <span class="p">},</span>
    <span class="nx">_onValueChange</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// do something with val</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="c1">// in Counter widget, we need to call the trigger method:</span>

<span class="p">...</span> <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;valuechange&#39;</span><span class="p">,</span> <span class="nx">someValue</span><span class="p">);</span>
</pre></div>
</div>
<div role="alert" class="alert alert-warning"><h3 class="alert-title">Предупреждение</h3><p >использование этой системы событий не рекомендуется, мы планируем заменить каждый метод * trigger * на метод * trigger_up * из расширенной системы событий</p></div></section><section id="extended-event-system"><h3 >Расширенная система событий</h3><p >Пользовательские виджеты событий - это более продвинутая система, которая имитирует API событий DOM. Всякий раз, когда событие инициируется, оно «всплывает» в дереве компонентов, пока не достигнет корневого виджета или не будет остановлено.</p><ul ><li ><em >trigger_up</em>: this is the method that will create a small <em >OdooEvent</em> and
dispatch it in the component tree.  Note that it will start with the component
that triggered the event</li><li ><em >custom_events</em>: this is the equivalent of the <em >event</em> dictionary, but for
odoo events.</li></ul><p >Класс OdooEvent очень прост. У него есть три открытых атрибута: * target * (виджет, который вызвал событие), * name * (имя события) и * data * (полезная нагрузка). Он также имеет 2 метода: * stopPropagation * и * is_stopped <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p><p >Предыдущий пример можно обновить, чтобы использовать пользовательскую систему событий:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Widget</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.Widget&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Counter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;myModule.Counter&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">custom_events</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">valuechange</span><span class="o">:</span> <span class="s1">&#39;_onValueChange&#39;</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Counter</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">def</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">counter</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">def</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)]);</span>
    <span class="p">},</span>
    <span class="nx">_onValueChange</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// do something with event.data.val</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="c1">// in Counter widget, we need to call the trigger_up method:</span>

<span class="p">...</span> <span class="k">this</span><span class="p">.</span><span class="nx">trigger_up</span><span class="p">(</span><span class="s1">&#39;valuechange&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">value</span><span class="o">:</span> <span class="nx">someValue</span><span class="p">});</span>
</pre></div>
</div>
</section><section id="registries"><h2 >реестры</h2><p >Общей потребностью в экосистеме Odoo является расширение / изменение поведения базовой системы извне (путем установки приложения, то есть другого модуля). Например, может потребоваться добавить новый тип виджета в некоторых представлениях. В этом случае, как и во многих других, обычным процессом является создание нужного компонента, а затем добавление его в реестр (этап регистрации), чтобы остальная часть веб-клиента знала о его существовании.</p><p >В системе доступно несколько реестров:</p><ul ><li ><dl ><dt >реестр полей (экспортируется через 'web.field_registry'). Поле реестра содержит</dt><dd ><p >все виджеты полей известны веб-клиенту. Всякий раз, когда представлению (как правило, форме или списку / канбану) нужен виджет поля, именно здесь он будет выглядеть. Типичный пример использования выглядит следующим образом:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">fieldRegistry</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.field_registry&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">FieldPad</span> <span class="o">=</span> <span class="p">...;</span>

<span class="nx">fieldRegistry</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;pad&#39;</span><span class="p">,</span> <span class="nx">FieldPad</span><span class="p">);</span>
</pre></div>
</div>
<p >Обратите внимание, что каждое значение должно быть подклассом * AbstractField *</p></dd></dl></li><li ><dl ><dt >просмотр реестра: этот реестр содержит все представления JS, известные веб-клиенту</dt><dd >(и, в частности, просмотр менеджера). Каждое значение этого реестра должно быть подклассом * AbstractView *</dd></dl></li><li ><dl ><dt >Реестр действий: мы отслеживаем все действия клиента в этом реестре. Эта</dt><dd >где менеджер действий ищет каждый раз, когда ему нужно создать клиентское действие. В версии 11 каждое значение должно быть просто подклассом * Widget <a href="#id1"><span id="id2" class="problematic">*</span></a>. Однако в версии 12 значения должны быть * AbstractAction <a href="#id3"><span id="id4" class="problematic">*</span></a>.</dd></dl></li></ul></section><section id="communication-between-widgets"><h2 >Связь между виджетами</h2><p >Есть много способов общения между компонентами.</p><ul ><li ><dl ><dt >От родителя к ребенку:</dt><dd ><p >это простой случай. Родительский виджет может просто вызвать метод своего потомка:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">someWidget</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">someInfo</span><span class="p">);</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >От виджета к его родителю / некоторому предку:</dt><dd ><p >в этом случае работа виджета состоит в том, чтобы просто уведомить его окружение о том, что что-то произошло. Поскольку мы не хотим, чтобы виджет имел ссылку на своего родителя (это связывало бы виджет с реализацией его родителя), лучшим способом для продолжения обычно является запуск события, которое будет всплывать в дереве компонентов, используя ` Метод <code >trigger_up`</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">trigger_up</span><span class="p">(</span><span class="s1">&#39;open_record&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">record</span><span class="o">:</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">});</span>
</pre></div>
</div>
<p >Это событие будет вызвано в виджете, затем всплывет и будет в конечном итоге перехвачено каким-то восходящим виджетом:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">SomeAncestor</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">custom_events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;open_record&#39;</span><span class="o">:</span> <span class="s1">&#39;_onOpenRecord&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">_onOpenRecord</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">record</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
        <span class="c1">// do something with the event.</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >Перекрестный компонент:</dt><dd ><p >Межкомпонентная связь может быть достигнута с помощью шины. Это не предпочтительная форма общения, потому что она имеет недостаток, заключающийся в усложнении поддержки кода. Тем не менее, он имеет преимущество в разделении компонентов. В этом случае это просто делается путем запуска и прослушивания событий на шине. Например:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// in WidgetA</span>
<span class="kd">var</span> <span class="nx">core</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.core&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">WidgetA</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="p">...</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">core</span><span class="p">.</span><span class="nx">bus</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;barcode_scanned&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onBarcodeScanned</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="c1">// in WidgetB</span>
<span class="kd">var</span> <span class="nx">WidgetB</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="p">...</span>
    <span class="nx">someFunction</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">barcode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">core</span><span class="p">.</span><span class="nx">bus</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;barcode_scanned&#39;</span><span class="p">,</span> <span class="nx">barcode</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >В этом примере мы используем шину, экспортированную * web.core <a href="#id1"><span id="id2" class="problematic">*</span></a>, но это не обязательно. Автобус может быть создан для определенной цели.</p></dd></dl></li></ul></section><section id="services"><h2 >Сервисы</h2><p >В версии 11.0 мы ввели понятие * service <a href="#id1"><span id="id2" class="problematic">*</span></a>. Основная идея состоит в том, чтобы предоставить субкомпонентам контролируемый способ доступа к их среде, таким образом, чтобы структура имела достаточный контроль и была тестируемой.</p><p >Система обслуживания организована вокруг трех идей: услуги, поставщики услуг и виджеты. Это работает так, что виджеты инициируют (с * trigger_up <a href="#id1"><span id="id2" class="problematic">*</span></a>) события, эти события всплывают перед поставщиком услуг, который попросит службу выполнить задачу, а затем, возможно, вернет ответ.</p></section><section id="service"><h3 >обслуживание</h3><p >Служба является экземпляром класса * AbstractService <a href="#id1"><span id="id2" class="problematic">*</span></a>. В основном это только имя и несколько методов. Его работа - выполнять какую-то работу, обычно в зависимости от окружающей среды.</p><p >Например, у нас есть сервис * ajax * (работа заключается в выполнении rpc), * localStorage * (взаимодействие с локальным хранилищем браузера) и многие другие.</p><p >Вот упрощенный пример того, как реализован сервис ajax:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">AbstractService</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.AbstractService&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">AjaxService</span> <span class="o">=</span> <span class="nx">AbstractService</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;ajax&#39;</span><span class="p">,</span>
    <span class="nx">rpc</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(...)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">...;</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Этот сервис называется ajax и определяет один метод, * rpc <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p></section><section id="service-provider"><h3 >Поставщик услуг</h3><p >Чтобы службы работали, необходимо, чтобы у нас был поставщик услуг, готовый отправлять пользовательские события. В * backend * (веб-клиент) это делается основным экземпляром веб-клиента. Обратите внимание, что код для поставщика услуг взят из * ServiceProviderMixin <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p></section><section id="widget"><h3 >Виджет</h3><p >Виджет - это та часть, которая запрашивает услугу. Для этого он просто запускает событие * call_service * (обычно с помощью вспомогательной функции * call <a href="#id1"><span id="id2" class="problematic">*</span></a>). Это событие всплывет и сообщит намерение остальной части системы.</p><p >На практике некоторые функции вызываются так часто, что у нас есть несколько вспомогательных функций, облегчающих их использование. Например, метод * _rpc * является помощником, который помогает сделать rpc.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">SomeWidget</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">_getActivityModelViewID</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rpc</span><span class="p">({</span>
            <span class="nx">model</span><span class="o">:</span> <span class="nx">model</span><span class="p">,</span>
            <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;get_activity_view_id&#39;</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<div role="alert" class="alert alert-warning"><h3 class="alert-title">Предупреждение</h3><p >Если виджет уничтожен, он будет отделен от основного дерева компонентов и не будет иметь родителя. В этом случае события не будут пузыриться, что означает, что работа не будет выполнена. Обычно это именно то, что мы хотим от уничтоженного виджета.</p></div></section><section id="rpcs"><h3 >RPCs</h3><p >Функциональность rpc предоставляется службой ajax. Но большинство людей, вероятно, будут взаимодействовать только с помощниками * _rpc <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p><p >Обычно при работе с Odoo существует два варианта использования: одному может потребоваться вызвать метод в модели (python) (это происходит через контроллер * call_kw <a href="#id1"><span id="id2" class="problematic">*</span></a>), или может потребоваться непосредственный вызов контроллера (доступного на некотором маршруте).</p><ul ><li >Вызов метода на модели Python:</li></ul><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rpc</span><span class="p">({</span>
    <span class="nx">model</span><span class="o">:</span> <span class="s1">&#39;some.model&#39;</span><span class="p">,</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;some_method&#39;</span><span class="p">,</span>
    <span class="nx">args</span><span class="o">:</span> <span class="p">[</span><span class="nx">some</span><span class="p">,</span> <span class="nx">args</span><span class="p">],</span>
<span class="p">});</span>
</pre></div>
</div>
<ul ><li >Прямой вызов контроллера:</li></ul><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rpc</span><span class="p">({</span>
    <span class="nx">route</span><span class="o">:</span> <span class="s1">&#39;/some/route/&#39;</span><span class="p">,</span>
    <span class="nx">params</span><span class="o">:</span> <span class="p">{</span> <span class="nx">some</span><span class="o">:</span> <span class="nx">kwargs</span><span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</section><section id="notifications"><h2 >Уведомления</h2><p >Платформа Odoo имеет стандартный способ передачи различной информации пользователю: уведомления, которые отображаются в правом верхнем углу пользовательского интерфейса.</p><p >Существует два типа уведомлений:</p><ul ><li ><em >notification</em>: useful to display some feedback.  For example, whenever a user
unsubscribed to a channel.</li><li ><em >warning</em>: useful to display some important/urgent information.  Typically
most kind of (recoverable) errors in the system.</li></ul><p >Кроме того, уведомления могут использоваться, чтобы задать вопрос пользователю, не нарушая его рабочий процесс. Представьте себе телефонный звонок, полученный через VOIP: липкое уведомление может отображаться с помощью двух кнопок * Принять * и * Отклонить <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p></section><section id="notification-system"><h3 >Система уведомления</h3><p >Система уведомлений в Odoo разработана со следующими компонентами:</p><ul ><li >a <em >Notification</em> widget: this is a simple widget that is meant to be created
and displayed with the desired information</li><li >a <em >NotificationService</em>: a service whose responsibility is to create and
destroy notifications whenever a request is done (with a custom_event). Note
that the web client is a service provider.</li><li >клиентское действие * display_notification <a href="#id1"><span id="id2" class="problematic">*</span></a>: это позволяет запустить отображение уведомления от python (например, в методе, вызываемом, когда пользователь нажимает на кнопку типа объекта).</li><li >две вспомогательные функции в * ServiceMixin <a href="#id1"><span id="id2" class="problematic">*</span></a>: * do_notify * и * do_warn *</li></ul></section><section id="displaying-a-notification"><h3 >Отображение уведомления</h3><p >Наиболее распространенный способ отображения уведомлений - использование двух методов, которые взяты из * ServiceMixin <a href="#id1"><span id="id2" class="problematic">*</span></a>:</p><ul ><li ><dl ><dt ><em >do_notify(title, message, sticky, className)</em>:</dt><dd ><p >Отобразить уведомление типа * Уведомление <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p><ul ><li ><em >title</em>: string. This will be displayed on the top as a title</li><li ><em >message</em>: string, the content of the notification</li><li ><em >sticky</em>: boolean, optional. If true, the notification will stay until the
user dismisses it.  Otherwise, the notification will be automatically
closed after a short delay.</li><li ><em >className</em>: string, optional.  This is a css class name that will be
automatically added to the notification.  This could be useful for styling
purpose, even though its use is discouraged.</li></ul></dd></dl></li><li ><dl ><dt ><em >do_warn(title, message, sticky, className)</em>:</dt><dd ><p >Отобразить уведомление типа * warning <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p><ul ><li ><em >title</em>: string. This will be displayed on the top as a title</li><li ><em >message</em>: string, the content of the notification</li><li ><em >sticky</em>: boolean, optional. If true, the notification will stay until the
user dismisses it.  Otherwise, the notification will be automatically
closed after a short delay.</li><li ><em >className</em>: string, optional.  This is a css class name that will be
automatically added to the notification.  This could be useful for styling
purpose, even though its use is discouraged.</li></ul></dd></dl></li></ul><p >Вот два примера использования этих методов:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// note that we call _t on the text to make sure it is properly translated.</span>
<span class="k">this</span><span class="p">.</span><span class="nx">do_notify</span><span class="p">(</span><span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">),</span> <span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Your signature request has been sent.&quot;</span><span class="p">));</span>

<span class="k">this</span><span class="p">.</span><span class="nx">do_warn</span><span class="p">(</span><span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">),</span> <span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Filter name is required.&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p >Вот пример в Python:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># note that we call _(string) on the text to make sure it is properly translated.</span>
<span class="k">def</span> <span class="nf">show_notification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.actions.client&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tag&#39;</span><span class="p">:</span> <span class="s1">&#39;display_notification&#39;</span><span class="p">,</span>
        <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Success&#39;</span><span class="p">),</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Your signature request has been sent.&#39;</span><span class="p">),</span>
            <span class="s1">&#39;sticky&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</section><section id="systray"><h2 >Systray</h2><p >Systray - это правая часть строки меню в интерфейсе, где веб-клиент отображает несколько виджетов, таких как меню сообщений.</p><p >Когда SystrayMenu создается с помощью меню, оно будет искать все зарегистрированные виджеты и добавлять их в качестве вспомогательного виджета в нужное место.</p><p >В настоящее время нет специального API для виджетов systray. Предполагается, что они являются простыми виджетами и могут взаимодействовать со своей средой, как и другие виджеты, с помощью метода * trigger_up <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p></section><section id="adding-a-new-systray-item"><h3 >Добавление нового элемента Systray</h3><p >Там нет системного реестра. Правильный способ добавить виджет - добавить его в переменную класса SystrayMenu.items.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">SystrayMenu</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.SystrayMenu&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">MySystrayWidget</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="p">...</span>
<span class="p">});</span>

<span class="nx">SystrayMenu</span><span class="p">.</span><span class="nx">Items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">MySystrayWidget</span><span class="p">);</span>
</pre></div>
</div>
</section><section id="ordering"><h3 >заказ</h3><p >Перед добавлением виджета к себе, меню Systray отсортирует элементы по свойству sequence. Если это свойство отсутствует в прототипе, вместо него будет использовано 50. Таким образом, чтобы позиционировать элемент systray справа, можно установить очень высокий порядковый номер (и наоборот, низкое число, чтобы поместить его слева).</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">MySystrayWidget</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sequence</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</div>
</section><section id="translation-management"><h2 >Управление переводом</h2><p >Некоторые переводы выполняются на стороне сервера (в основном все текстовые строки, отображаемые или обрабатываемые сервером), но в статических файлах есть строки, которые необходимо перевести. В настоящее время это работает следующим образом:</p><ul ><li >каждая переводимая строка помечается специальной функцией * _t * (доступна в модуле JS * web.core *</li><li >эти строки используются сервером для генерации правильных PO-файлов</li><li >всякий раз, когда веб-клиент загружается, он вызывает маршрут * / web / webclient / translations <a href="#id1"><span id="id2" class="problematic">*</span></a>, который возвращает список всех переводимых терминов</li><li >во время выполнения всякий раз, когда вызывается функция * _t <a href="#id1"><span id="id2" class="problematic">*</span></a>, она будет искать в этом списке, чтобы найти перевод, и вернуть его или исходную строку, если ничего не найдено.</li></ul><p >Обратите внимание, что переводы объясняются более подробно, с точки зрения сервера, в документе <a href="translations.html" class="reference internal"><span class="doc">Перевод модулей</span></a>.</p><p >В javascript есть две важные функции для перевода: * _t * и * _lt <a href="#id1"><span id="id2" class="problematic">*</span></a>. Разница в том, что * _lt * лениво оценивается.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">core</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.core&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">core</span><span class="p">.</span><span class="nx">_t</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">core</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">SomeWidget</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">exampleString</span><span class="o">:</span> <span class="nx">_lt</span><span class="p">(</span><span class="s1">&#39;this should be translated&#39;</span><span class="p">),</span>
    <span class="p">...</span>
    <span class="nx">someMethod</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">_t</span><span class="p">(</span><span class="s1">&#39;some text&#39;</span><span class="p">);</span>
        <span class="p">...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >В этом примере * _lt * необходим, потому что переводы не готовы при загрузке модуля.</p><p >Обратите внимание, что функции перевода требуют некоторого внимания. Строка, указанная в аргументе, не должна быть динамической.</p></section><section id="session"><h2 >сессия</h2><p >Веб-клиент предоставляет специальный модуль, содержащий некоторую информацию, относящуюся к текущему * сеансу * пользователя. Некоторые известные ключи</p><ul ><li >uid: текущий идентификатор пользователя (его идентификатор как * res.users <a href="#id1"><span id="id2" class="problematic">*</span></a>)</li><li >user_name: имя пользователя в виде строки</li><li >пользовательский контекст (идентификатор пользователя, язык и часовой пояс)</li><li >partner_id: идентификатор партнера, связанного с текущим пользователем</li><li >db: имя базы данных, используемой в данный момент</li></ul></section><section id="adding-information-to-the-session"><h3 >Добавление информации в сессию</h3><p >Когда / web-маршрут загружен, сервер вставит некоторую информацию о сеансе в шаблон тега script. Информация будет считана из метода * session_info * модели * ir.http <a href="#id1"><span id="id2" class="problematic">*</span></a>. Итак, если кто-то хочет добавить конкретную информацию, это можно сделать, переопределив метод session_info и добавив его в словарь.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">odoo.http</span> <span class="kn">import</span> <span class="n">request</span>


<span class="k">class</span> <span class="nc">IrHttp</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">AbstractModel</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;ir.http&#39;</span>

    <span class="k">def</span> <span class="nf">session_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">IrHttp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">session_info</span><span class="p">()</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;some_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_some_value_from_db</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p >Теперь значение можно получить в javascript, прочитав его в сеансе:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.session&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">myValue</span> <span class="o">=</span> <span class="nx">session</span><span class="p">.</span><span class="nx">some_key</span><span class="p">;</span>
<span class="p">...</span>
</pre></div>
</div>
<p >Обратите внимание, что этот механизм предназначен для уменьшения объема связи, необходимой веб-клиенту для готовности. Это больше подходит для данных, которые дешевы для вычисления (медленный вызов session_info задержит загрузку для веб-клиента для всех), а также для данных, которые требуются в начале процесса инициализации.</p></section><section id="views"><h2 >Взгляды</h2><p >Слово «вид» имеет более одного значения. Этот раздел о дизайне кода представлений javascript, а не о структуре * arch * или о чем-то еще.</p><p >В 2017 году Odoo заменил предыдущий код представления новой архитектурой. Основной задачей было отделить логику рендеринга от логики модели.</p><p >Представления (в общем смысле) теперь описываются четырьмя частями: представление, контроллер, рендерер и модель. API этих 4 частей описан в классах AbstractView, AbstractController, AbstractRenderer и AbstractModel.</p><svg width="550" height="173">
    <!-- Created with Method Draw - https://github.com/duopixel/Method-Draw/ -->
    <path id="svg_1" d="m147.42498,79.79206c0.09944,-8.18859 -0.06363,-16.38812 0.81774,-24.5623c21.65679,2.68895 43.05815,7.08874 64.35,11.04543c1.14304,-4.01519 0.60504,-7.34585 1.59817,-11.05817c13.67878,7.81176 27.23421,15.73476 40.23409,24.03505c-12.47212,9.41539 -26.77809,17.592 -40.82272,25.96494c-0.4548,-3.89916 -0.90967,-7.79828 -1.36448,-11.69744c-20.69972,3.77225 -42.59036,7.6724 -63.42391,11.12096c-1.41678,-7.95741 -1.37514,-16.62327 -1.38888,-24.84846z" stroke-width="1.5" stroke="#000" fill="#fff"/>
    <rect id="svg_3" height="41" width="110" y="57.5" x="7" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff"/>
    <rect stroke="#000" id="svg_5" height="41" width="135" y="20.5" x="328" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" fill="#fff"/>
    <rect stroke="#000" id="svg_6" height="41" width="128" y="102.5" x="262" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" fill="#fff"/>
    <rect stroke="#000" id="svg_7" height="41" width="119" y="100.5" x="417" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" fill="#fff"/>
    <line stroke-linecap="null" stroke-linejoin="null" id="svg_8" y2="96.5" x2="317" y1="65.5" x1="364" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="none"/>
    <line stroke-linecap="null" stroke-linejoin="null" id="svg_9" y2="96.5" x2="467" y1="63.5" x1="425" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="none"/>
    <text xml:space="preserve" text-anchor="start" font-family="Helvetica, Arial, sans-serif" font-size="24" id="svg_10" y="83.5" x="38" fill-opacity="null" stroke-opacity="null" stroke-width="0" stroke="#000" fill="#000000">View</text>
    <text xml:space="preserve" text-anchor="start" font-family="Helvetica, Arial, sans-serif" font-size="24" id="svg_11" y="44.5" x="346" fill-opacity="null" stroke-opacity="null" stroke-width="0" stroke="#000" fill="#000000">Controller</text>
    <text xml:space="preserve" text-anchor="start" font-family="Helvetica, Arial, sans-serif" font-size="24" id="svg_12" y="128.5" x="276" fill-opacity="null" stroke-opacity="null" stroke-width="0" stroke="#000" fill="#000000">Renderer</text>
    <text xml:space="preserve" text-anchor="start" font-family="Helvetica, Arial, sans-serif" font-size="24" id="svg_13" y="127.5" x="442" fill-opacity="null" stroke-opacity="null" stroke-width="0" stroke="#000" fill="#000000">Model</text>
</svg><ul ><li ><p >Вид это фабрика. Его работа состоит в том, чтобы получить набор полей, арки, контекста и некоторых других параметров, а затем создать триплет Контроллер / Рендерер / Модель.</p><p >Роль представления заключается в правильной настройке каждого фрагмента шаблона MVC с правильной информацией. Обычно он должен обрабатывать строку арки и извлекать данные, необходимые для других частей представления.</p><p >Обратите внимание, что представление является классом, а не виджетом. Как только его работа будет выполнена, его можно выбросить.</p></li><li ><p >у рендерера есть одно задание: представлять данные, просматриваемые в элементе DOM. Каждое представление может отображать данные по-своему. Кроме того, он должен прислушиваться к соответствующим действиям пользователя и при необходимости уведомлять своего родителя (Контроллер).</p><p >Renderer - это V в шаблоне MVC.</p></li><li >Модель: ее работа заключается в том, чтобы извлекать и хранить состояние представления. Обычно он представляет собой набор записей в базе данных. Модель является владельцем «бизнес-данных». Это М в шаблоне MVC.</li><li ><p >Контроллер: его работа заключается в координации рендерера и модели. Кроме того, это основная точка входа для остальной части веб-клиента. Например, когда пользователь изменяет что-либо в окне поиска, будет вызван метод * update * контроллера с соответствующей информацией.</p><p >Это C в шаблоне MVC.</p></li></ul><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Код JS для представлений был разработан для использования вне контекста менеджера представлений / менеджера действий. Они могут быть использованы в действиях клиента или отображаться на общедоступном веб-сайте (с некоторой работой над активами).</p></div></section><section id="field-widgets"><i id="reference-js-widgets"></i><h2 >Полевые Виджеты</h2><p >Хорошая часть опыта веб-клиента связана с редактированием и созданием данных. Большая часть этой работы выполняется с помощью виджетов полей, которые знают тип поля и конкретные детали того, как значение должно отображаться и редактироваться.</p></section><section id="abstractfield"><h3 >AbstractField</h3><p >Класс * AbstractField * является базовым классом для всех виджетов в представлении, для всех представлений, которые их поддерживают (в настоящее время: Form, List, Kanban).</p><p >Существует много различий между виджетами полей v11 и предыдущими версиями. Отметим наиболее важные из них:</p><ul ><li >виджеты распределяются между всеми представлениями (ну, Form / List / Kanban). Больше не нужно дублировать реализацию. Обратите внимание, что можно иметь специализированную версию виджета для представления, добавив к имени префикса имя реестра в реестре представлений: * list.many2one * будет выбран с приоритетом над * many2one <a href="#id1"><span id="id2" class="problematic">*</span></a>.</li><li >виджеты больше не являются владельцем значения поля. Они только представляют данные и связываются с остальной частью представления.</li><li >виджетам больше не нужно переключаться между режимами редактирования и чтения. Теперь, когда такое изменение необходимо, виджет будет уничтожен и снова обработан. Это не проблема, так как они в любом случае не владеют своей ценностью.</li><li >виджеты полей можно использовать за пределами вида. Их API немного неловко, но они разработаны, чтобы быть автономными.</li></ul></section><section id="decorations"><h3 >Украшения</h3><p >Как и в виде списка, виджеты полей имеют простую поддержку украшений. Цель украшений - простой способ указать цвет текста в зависимости от текущего состояния записи. Например,</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;state&quot;</span> <span class="na">decoration-danger=</span><span class="s">&quot;amount &amp;lt; 10000&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p >Допустимые названия украшений:</p><ul ><li >украшение-бф</li><li >украшение-это</li><li >украшение-опасность</li><li >украшение-инфо</li><li >украшение-приглушен</li><li >оформление первичной</li><li >украшение-успех</li><li >украшение-предупреждение</li></ul><p >Каждое украшение * decor-X * будет сопоставлено с классом css * text-X <a href="#id1"><span id="id2" class="problematic">*</span></a>, который является стандартным классом начальной загрузки css (за исключением * text-it * и * text-bf <a href="#id3"><span id="id4" class="problematic">*</span></a>, которые обрабатываются odoo и соответствуют курсив и жирный, соответственно). Обратите внимание, что значение атрибута художественного оформления должно быть допустимым выражением Python, которое будет оцениваться с записью в качестве контекста оценки.</p></section><section id="non-relational-fields"><h3 >Нереляционные поля</h3><p >Здесь мы документируем все нереляционные поля, доступные по умолчанию, в произвольном порядке.</p><ul ><li ><dl ><dt >целое число (FieldInteger)</dt><dd ><p >Это тип поля по умолчанию для полей типа * целое число <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p><ul ><li >Поддерживаемые типы полей: * целое число *</li></ul><p >Параметры:</p><ul ><li >Тип: установка типа ввода (* текст * по умолчанию, может быть установлен на * номер <a href="#id1"><span id="id2" class="problematic">*</span></a>)</li></ul><p >В режиме редактирования поле отображается как ввод с типом атрибута HTML, установленным на * число * (таким образом, пользователь может использовать встроенную поддержку, особенно на мобильных устройствах). В этом случае форматирование по умолчанию отключено, чтобы избежать несовместимости.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;int_value&quot;</span> <span class="na">options=</span><span class="s">&#39;{&quot;type&quot;: &quot;number&quot;}&#39;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<ul ><li ><dl ><dt >шаг: установите шаг на значение вверх и вниз, когда пользователь нажимает на кнопки</dt><dd >(только для ввода номера типа, по умолчанию 1)</dd></dl></li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;int_value&quot;</span> <span class="na">options=</span><span class="s">&#39;{&quot;type&quot;: &quot;number&quot;, &quot;step&quot;: 100}&#39;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >float (FieldFloat)</dt><dd ><p >Это тип поля по умолчанию для полей типа * float <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p><ul ><li >Поддерживаемые типы полей: * float *</li></ul><p >Атрибуты:</p><ul ><li >цифры: отображаемая точность</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;factor&quot;</span> <span class="na">digits=</span><span class="s">&quot;[42,5]&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p >Параметры:</p><ul ><li >Тип: установка типа ввода (* текст * по умолчанию, может быть установлен на * номер <a href="#id1"><span id="id2" class="problematic">*</span></a>)</li></ul><p >В режиме редактирования поле отображается как ввод с типом атрибута HTML, установленным на * число * (таким образом, пользователь может использовать встроенную поддержку, особенно на мобильных устройствах). В этом случае форматирование по умолчанию отключено, чтобы избежать несовместимости.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;int_value&quot;</span> <span class="na">options=</span><span class="s">&#39;{&quot;type&quot;: &quot;number&quot;}&#39;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<ul ><li ><dl ><dt >шаг: установите шаг на значение вверх и вниз, когда пользователь нажимает на кнопки</dt><dd >(только для ввода номера типа, по умолчанию 1)</dd></dl></li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;int_value&quot;</span> <span class="na">options=</span><span class="s">&#39;{&quot;type&quot;: &quot;number&quot;, &quot;step&quot;: 0.1}&#39;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >float_time (FieldFloatTime)</dt><dd ><p >Цель этого виджета - правильно отобразить значение с плавающей точкой, представляющее временной интервал (в часах). Так, например, 0.5 должно быть отформатировано как 0:30, или 4.75 соответствует 4:45.</p><ul ><li >Поддерживаемые типы полей: * float *</li></ul></dd></dl></li><li ><dl ><dt >float_factor (FieldFloatFactor)</dt><dd ><p >Этот виджет предназначен для правильного отображения значения с плавающей запятой, которое конвертируется с использованием коэффициента, указанного в его параметрах. Так, например, значение, сохраненное в базе данных, равно 0,5, а коэффициент равен 3, значение виджета должно быть отформатировано как 1,5.</p><ul ><li >Поддерживаемые типы полей: * float *</li></ul></dd></dl></li><li ><dl ><dt >float_toggle (FieldFloatToggle)</dt><dd ><p >Цель этого виджета - заменить поле ввода кнопкой, содержащей диапазон возможных значений (заданных в опциях). Каждый щелчок позволяет пользователю зацикливаться в диапазоне. Цель здесь - ограничить значение поля предопределенным выбором. Кроме того, виджет поддерживает преобразование коэффициентов как виджет * float_factor * (значения диапазона должны быть результатом преобразования).</p><ul ><li >Поддерживаемые типы полей: * float *</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;days_to_close&quot;</span> <span class="na">widget=</span><span class="s">&quot;float_toggle&quot;</span> <span class="na">options=</span><span class="s">&#39;{&quot;factor&quot;: 2, &quot;range&quot;: [0, 4, 8]}&#39;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >логическое (FieldBoolean)</dt><dd ><p >Это тип поля по умолчанию для полей типа * boolean <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p><ul ><li >Поддерживаемые типы полей: * логическое *</li></ul></dd></dl></li><li ><dl ><dt >char (FieldChar)</dt><dd ><p >Это тип поля по умолчанию для полей типа * char <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p><ul ><li >Поддерживаемые типы полей: * char *</li></ul></dd></dl></li><li ><dl ><dt >дата (FieldDate)</dt><dd ><p >Это тип поля по умолчанию для полей типа * date <a href="#id1"><span id="id2" class="problematic">*</span></a>. Обратите внимание, что он также работает с полями datetime. Он использует часовой пояс сеанса при форматировании дат.</p><ul ><li >Поддерживаемые типы полей: * date <a href="#id1"><span id="id2" class="problematic">*</span></a>, * datetime *</li></ul><p >Параметры:</p><ul ><li >datepicker: дополнительные настройки для виджета <a href="https://github.com/Eonasdan/bootstrap-datetimepicker" class="external reference">datepicker</a>.</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;datefield&quot;</span> <span class="na">options=</span><span class="s">&#39;{&quot;datepicker&quot;: {&quot;daysOfWeekDisabled&quot;: [0, 6]}}&#39;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >datetime (FieldDateTime)</dt><dd ><p >Это тип поля по умолчанию для полей типа * datetime <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p><ul ><li >Поддерживаемые типы полей: * date <a href="#id1"><span id="id2" class="problematic">*</span></a>, * datetime *</li></ul><p >Параметры:</p><ul ><li >datepicker: дополнительные настройки для виджета <a href="https://github.com/Eonasdan/bootstrap-datetimepicker" class="external reference">datepicker</a>.</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;datetimefield&quot;</span> <span class="na">options=</span><span class="s">&#39;{&quot;datepicker&quot;: {&quot;daysOfWeekDisabled&quot;: [0, 6]}}&#39;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >daterange (FieldDateRange)</dt><dd ><p >Этот виджет позволяет пользователю выбрать начальную и конечную дату в одном окне выбора.</p><ul ><li >Поддерживаемые типы полей: * date <a href="#id1"><span id="id2" class="problematic">*</span></a>, * datetime *</li></ul><p >Параметры:</p><ul ><li >related_start_date: применить к полю даты окончания, чтобы получить значение даты начала, которое используется для отображения диапазона в средстве выбора.</li><li >related_end_date: применить к полю даты начала, чтобы получить значение даты окончания, которое используется для отображения диапазона в средстве выбора.</li><li >picker_options: дополнительные настройки для выбора.</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;start_date&quot;</span> <span class="na">widget=</span><span class="s">&quot;daterange&quot;</span> <span class="na">options=</span><span class="s">&#39;{&quot;related_end_date&quot;: &quot;end_date&quot;}&#39;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >денежный (FieldMonetary)</dt><dd ><p >Это тип поля по умолчанию для полей типа «денежный». Используется для отображения валюты. Если в параметре задано поле валюты, он будет использовать его, в противном случае он вернется к валюте по умолчанию (в сеансе).</p><ul ><li >Поддерживаемые типы полей: * денежные <a href="#id1"><span id="id2" class="problematic">*</span></a>, * плавающие *</li></ul><p >Параметры:</p><ul ><li >currency_field: другое имя поля, которое должно быть many2one для валюты.</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">widget=</span><span class="s">&quot;monetary&quot;</span> <span class="na">options=</span><span class="s">&quot;{&#39;currency_field&#39;: &#39;currency_id&#39;}&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >текст (FieldText)</dt><dd ><p >Это тип поля по умолчанию для полей типа * текст <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p><ul ><li >Поддерживаемые типы полей: * текст *</li></ul></dd></dl></li><li ><dl ><dt >обрабатывать (HandleWidget)</dt><dd ><p >Работа этого поля должна отображаться как * handle <a href="#id1"><span id="id2" class="problematic">*</span></a>, и позволяет переупорядочивать различные записи, перетаскивая их.</p><div role="alert" class="alert alert-warning"><h3 class="alert-title">Предупреждение</h3><p >Он должен быть указан в поле, по которому сортируются записи.</p></div><div role="alert" class="alert alert-warning"><h3 class="alert-title">Предупреждение</h3><p >Наличие более одного поля с виджетом дескриптора в одном списке не поддерживается.</p></div><ul ><li >Поддерживаемые типы полей: * целое число *</li></ul></dd></dl></li><li ><dl ><dt >электронная почта (FieldEmail)</dt><dd ><p >В этом поле отображается адрес электронной почты. Основная причина его использования заключается в том, что он отображается в виде тега привязки с соответствующим href в режиме только для чтения.</p><ul ><li >Поддерживаемые типы полей: * char *</li></ul></dd></dl></li><li ><dl ><dt >телефон (FieldPhone)</dt><dd ><p >В этом поле отображается номер телефона. Основная причина его использования заключается в том, что он отображается как метка привязки с надлежащим href в режиме только для чтения, но только в некоторых случаях: мы хотим сделать его кликабельным, только если устройство может вызвать этот конкретный номер.</p><ul ><li >Поддерживаемые типы полей: * char *</li></ul></dd></dl></li><li ><dl ><dt >url (UrlWidget)</dt><dd ><p >В этом поле отображается URL (в режиме только для чтения). Основная причина его использования заключается в том, что он отображается как тег привязки с соответствующими классами css и href.</p><ul ><li >Поддерживаемые типы полей: * char *</li></ul><p >Кроме того, текст тега привязки можно настроить с помощью атрибута * text * (он не изменит значение href).</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;foo&quot;</span> <span class="na">widget=</span><span class="s">&quot;url&quot;</span> <span class="na">text=</span><span class="s">&quot;Some URL&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >домен (FieldDomain)</dt><dd ><p >Поле «Домен» позволяет пользователю создать домен с техническим префиксом благодаря древовидному интерфейсу и просматривать выбранные записи в режиме реального времени. В режиме отладки также есть вход, чтобы иметь возможность напрямую входить в префиксный домен char (или для создания расширенных доменов, которые древовидный интерфейс не позволяет).</p><p >Обратите внимание, что это ограничено «статическим» доменом (без динамического выражения или доступа к контекстной переменной).</p><ul ><li >Поддерживаемые типы полей: * char *</li></ul></dd></dl></li><li ><dl ><dt >link_button (LinkButton)</dt><dd ><p >Виджет LinkButton на самом деле просто отображает диапазон со значком и текстовым значением в качестве содержимого. Ссылка кликабельна и откроет новое окно браузера со значением в качестве URL.</p><ul ><li >Поддерживаемые типы полей: * char *</li></ul></dd></dl></li><li ><dl ><dt >изображение (FieldBinaryImage)</dt><dd ><p >Этот виджет используется для представления двоичного значения в виде изображения. В некоторых случаях сервер возвращает «bin_size» вместо реального изображения (bin_size - это строка, представляющая размер файла, например, 6,5 КБ). В этом случае виджет создаст изображение с атрибутом источника, соответствующим изображению на сервере.</p><ul ><li >Поддерживаемые типы полей: * двоичный *</li></ul><p >Параметры:</p><ul ><li >preview_image: если изображение загружается только как «bin_size», этот параметр полезен для информирования веб-клиента о том, что именем поля по умолчанию является не имя текущего поля, а имя другого поля.</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;image&quot;</span> <span class="na">widget=</span><span class="s">&#39;image&#39;</span> <span class="na">options=</span><span class="s">&#39;{&quot;preview_image&quot;:&quot;image_128&quot;}&#39;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >двоичный (FieldBinaryFile)</dt><dd ><p >Общий виджет, позволяющий сохранять / загружать двоичный файл.</p><ul ><li >Поддерживаемые типы полей: * двоичный *</li></ul><p >Атрибут:</p><ul ><li >filename: сохранение двоичного файла потеряет его имя файла, так как оно сохраняет только двоичное значение. Имя файла может быть сохранено в другом поле. Для этого в качестве имени файла атрибута должно быть установлено поле, представленное в представлении.</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;datas&quot;</span> <span class="na">filename=</span><span class="s">&quot;datas_fname&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >приоритет (PriorityWidget)</dt><dd ><p >Этот виджет отображается в виде набора звездочек, что позволяет пользователю щелкнуть по нему, чтобы выбрать значение или нет. Это полезно, например, чтобы пометить задачу как приоритетную.</p><p >Обратите внимание, что этот виджет также работает в режиме «только чтение», что необычно.</p><ul ><li >Поддерживаемые типы полей: * выбор *</li></ul></dd></dl></li><li ><dl ><dt >attachment_image (AttachmentImage)</dt><dd ><p >Графический виджет для многих полей. Если поле установлено, этот виджет будет отображаться как изображение с соответствующим URL-адресом src. Этот виджет не имеет другого поведения в режиме редактирования или только для чтения, он полезен только для просмотра изображения.</p><ul ><li >Поддерживаемые типы полей: * many2one *</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;displayed_image_id&quot;</span> <span class="na">widget=</span><span class="s">&quot;attachment_image&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >image_selection (ImageSelection)</dt><dd ><p >Разрешить пользователю выбирать значение, нажав на изображение.</p><ul ><li >Поддерживаемые типы полей: * выбор *</li></ul><p >Параметры: словарь с отображением значения выбора на объект с URL-адресом для изображения (* image_link <em >) и предварительным просмотром изображения (</em> preview_link <a href="#id1"><span id="id2" class="problematic">*</span></a>).</p><p >Обратите внимание, что эта опция не является обязательной!</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;external_report_layout&quot;</span> <span class="na">widget=</span><span class="s">&quot;image_selection&quot;</span> <span class="na">options=</span><span class="s">&quot;{</span>
<span class="s">    &#39;background&#39;: {</span>
<span class="s">        &#39;image_link&#39;: &#39;/base/static/img/preview_background.png&#39;,</span>
<span class="s">        &#39;preview_link&#39;: &#39;/base/static/pdf/preview_background.pdf&#39;</span>
<span class="s">    },</span>
<span class="s">    &#39;standard&#39;: {</span>
<span class="s">        &#39;image_link&#39;: &#39;/base/static/img/preview_standard.png&#39;,</span>
<span class="s">        &#39;preview_link&#39;: &#39;/base/static/pdf/preview_standard.pdf&#39;</span>
<span class="s">    }</span>
<span class="s">}&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >label_selection (LabelSelection)</dt><dd ><p >Этот виджет отображает простой не редактируемый ярлык. Это полезно только для отображения некоторой информации, а не для ее редактирования.</p><ul ><li >Поддерживаемые типы полей: * выбор *</li></ul><p >Параметры:</p><ul ><li >классы: отображение значения выбора в класс CSS</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;state&quot;</span> <span class="na">widget=</span><span class="s">&quot;label_selection&quot;</span> <span class="na">options=</span><span class="s">&quot;{</span>
<span class="s">    &#39;classes&#39;: {&#39;draft&#39;: &#39;default&#39;, &#39;cancel&#39;: &#39;default&#39;, &#39;none&#39;: &#39;danger&#39;}</span>
<span class="s">}&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >state_selection (StateSelectionWidget)</dt><dd ><p >Это специализированный виджет выбора. Предполагается, что запись имеет несколько жестко закодированных полей, присутствующих в представлении: * stage_id <a href="#id1"><span id="id2" class="problematic">*</span></a>, * legend_normal <a href="#id3"><span id="id4" class="problematic">*</span></a>, * legend_blocked <a href="#id5"><span id="id6" class="problematic">*</span></a>, * legend_done <a href="#id7"><span id="id8" class="problematic">*</span></a>. В основном это используется для отображения и изменения состояния задачи в проекте, а в раскрывающемся списке отображается дополнительная информация.</p><ul ><li >Поддерживаемые типы полей: * выбор *</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;kanban_state&quot;</span> <span class="na">widget=</span><span class="s">&quot;state_selection&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >kanban_state_selection (StateSelectionWidget)</dt><dd ><p >Это точно такой же виджет, что и state_selection</p><ul ><li >Поддерживаемые типы полей: * выбор *</li></ul></dd></dl></li><li ><dl ><dt >boolean_favorite (FavoriteWidget)</dt><dd ><p >Этот виджет отображается как пустая (или нет) звезда, в зависимости от логического значения. Обратите внимание, что он также может быть отредактирован в режиме только для чтения.</p><ul ><li >Поддерживаемые типы полей: * логическое *</li></ul></dd></dl></li><li ><dl ><dt >boolean_button (FieldBooleanButton)</dt><dd ><p >Виджет Boolean Button предназначен для использования в кнопке статистики в виде формы. Цель состоит в том, чтобы отобразить симпатичную кнопку с текущим состоянием логического поля (например, «Активно») и позволить пользователю изменять это поле при нажатии на него.</p><p >Обратите внимание, что он также может быть отредактирован в режиме только для чтения.</p><ul ><li >Поддерживаемые типы полей: * логическое *</li></ul><p >Параметры:</p><ul ><li >Терминология: это может быть «активный», «архив», «закрыть» или настраиваемое отображение с ключами * string_true <a href="#id1"><span id="id2" class="problematic">*</span></a>, * string_false <a href="#id3"><span id="id4" class="problematic">*</span></a>, * hover_true <a href="#id5"><span id="id6" class="problematic">*</span></a>, * hover_false *</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;active&quot;</span> <span class="na">widget=</span><span class="s">&quot;boolean_button&quot;</span> <span class="na">options=</span><span class="s">&#39;{&quot;terminology&quot;: &quot;archive&quot;}&#39;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >boolean_toggle (BooleanToggle)</dt><dd >Отображает тумблер для представления логического значения. Это подполе FieldBoolean, в основном оно выглядит иначе.</dd></dl></li><li ><dl ><dt >statinfo (СтатИнфо)</dt><dd ><p >Этот виджет предназначен для представления статистической информации в виде кнопки * stat <a href="#id1"><span id="id2" class="problematic">*</span></a>. Это в основном просто метка с номером.</p><ul ><li >Поддерживаемые типы полей: * integer, float *</li></ul><p >Параметры:</p><ul ><li >label_field: если дано, виджет будет использовать значение label_field в качестве текста.</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;button</span> <span class="na">name=</span><span class="s">&quot;%(act_payslip_lines)d&quot;</span>
    <span class="na">icon=</span><span class="s">&quot;fa-money&quot;</span>
    <span class="na">type=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;payslip_count&quot;</span> <span class="na">widget=</span><span class="s">&quot;statinfo&quot;</span>
        <span class="na">string=</span><span class="s">&quot;Payslip&quot;</span>
        <span class="na">options=</span><span class="s">&quot;{&#39;label_field&#39;: &#39;label_tasks&#39;}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/button&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >проценты (FieldPercentPie)</dt><dd ><p >Этот виджет предназначен для представления статистической информации в виде кнопки * stat <a href="#id1"><span id="id2" class="problematic">*</span></a>. Это похоже на виджет statinfo, но информация представлена в виде * pie * диаграммы (от пустого до полного). Обратите внимание, что значение интерпретируется как процент (число от 0 до 100).</p><ul ><li >Поддерживаемые типы полей: * integer, float *</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;replied_ratio&quot;</span> <span class="na">string=</span><span class="s">&quot;Replied&quot;</span> <span class="na">widget=</span><span class="s">&quot;percentpie&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >индикатор выполнения (FieldProgressBar)</dt><dd ><p >Представлять значение в виде индикатора выполнения (от 0 до некоторого значения)</p><ul ><li >Поддерживаемые типы полей: * integer, float *</li></ul><p >Параметры:</p><ul ><li >editable: логическое значение, если значение редактируемое</li><li >current_value: получить current_value из поля, которое должно присутствовать в представлении</li><li >max_value: получить max_value из поля, которое должно присутствовать в представлении</li><li >edit_max_value: логическое значение, если max_value доступно для редактирования</li><li >title: заголовок панели, отображаемый в верхней части панели -&amp;gt; не переведен, используйте параметр (не опция) вместо «title»</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;absence_of_today&quot;</span> <span class="na">widget=</span><span class="s">&quot;progressbar&quot;</span>
    <span class="na">options=</span><span class="s">&quot;{&#39;current_value&#39;: &#39;absence_of_today&#39;, &#39;max_value&#39;: &#39;total_employee&#39;, &#39;editable&#39;: false}&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >toggle_button (FieldToggleBoolean)</dt><dd ><p >Этот виджет предназначен для использования в логических полях. Переключение кнопки между зеленой и серой пулей. Также настраивается всплывающая подсказка, в зависимости от значения и некоторых параметров.</p><ul ><li >Поддерживаемые типы полей: * логическое *</li></ul><p >Параметры:</p><ul ><li >active: строка для всплывающей подсказки, которая должна быть установлена, когда логическое значение true</li><li >неактивный: всплывающая подсказка, которая должна быть установлена, когда логическое значение ложно</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;payslip_status&quot;</span> <span class="na">widget=</span><span class="s">&quot;toggle_button&quot;</span>
    <span class="na">options=</span><span class="s">&#39;{&quot;active&quot;: &quot;Reported in last payslips&quot;, &quot;inactive&quot;: &quot;To Report in Payslip&quot;}&#39;</span>
<span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >dashboard_graph (JournalDashboardGraph)</dt><dd ><p >Это более специализированный виджет, полезный для отображения графика, представляющего набор данных. Например, он используется в представлении панели инструментов учета kanban.</p><p >Предполагается, что поле представляет собой сериализацию набора данных в формате JSON.</p><ul ><li >Поддерживаемые типы полей: * char *</li></ul><p >атрибут</p><ul ><li >graph_type: string, может быть либо 'line', либо 'bar'</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;dashboard_graph_data&quot;</span>
    <span class="na">widget=</span><span class="s">&quot;dashboard_graph&quot;</span>
    <span class="na">graph_type=</span><span class="s">&quot;line&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >туз (AceEditor)</dt><dd ><p >Этот виджет предназначен для использования в текстовых полях. Он предоставляет Ace Editor для редактирования XML и Python.</p><ul ><li >Поддерживаемые типы полей: * char, text *</li></ul></dd></dl></li></ul></section><section id="relational-fields"><h3 >Реляционные поля</h3><section class="code-class"><h6 id="web.relational_fields.FieldSelection"><code><em >class </em>web.relational_fields.FieldSelection()</code></h6><p >Поддерживаемые типы полей: * выбор *</p><section class="code-attribute"><h6 id="web.relational_fields.FieldSelection.placeholder"><code>web.relational_fields.FieldSelection.placeholder</code></h6><p >строка, которая используется для отображения некоторой информации, когда значение не выбрано</p></section><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;tax_id&quot;</span> <span class="na">widget=</span><span class="s">&quot;selection&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Select a tax&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</section><ul ><li ><dl ><dt >радио (FieldRadio)</dt><dd ><p >Это подполе FielSelection, но оно специализировано для отображения всех допустимых вариантов выбора в качестве переключателей.</p><p >Обратите внимание, что если используется для многих записей, то будет сделано больше rpcs для извлечения name_gets связанных записей.</p><ul ><li >Поддерживаемые типы полей: * selection, many2one *</li></ul><p >Параметры:</p><ul ><li >горизонтальный: если true, радио-кнопки будут отображаться горизонтально.</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;recommended_activity_type_id&quot;</span> <span class="na">widget=</span><span class="s">&quot;radio&quot;</span>
    <span class="na">options=</span><span class="s">&quot;{&#39;horizontal&#39;:true}&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >selection_badge (FieldSelectionBadge)</dt><dd ><p >Это подполе FieldSelection, но оно специализировано для отображения всех допустимых вариантов выбора в виде прямоугольных значков.</p><ul ><li >Поддерживаемые типы полей: * selection, many2one *</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;recommended_activity_type_id&quot;</span> <span class="na">widget=</span><span class="s">&quot;selection_badge&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >many2one (FieldMany2One)</dt><dd ><p >Виджет по умолчанию для многих полей.</p><ul ><li >Поддерживаемые типы полей: * many2one *</li></ul><p >Атрибуты:</p><ul ><li >can_create: разрешить создание связанных записей (имеет приоритет над параметром no_create)</li><li >can_write: разрешить редактирование связанных записей (по умолчанию: true)</li></ul><p >Параметры:</p><ul ><li >no_create: запретить создание связанных записей</li><li >quick_create: разрешить быстрое создание связанных записей (по умолчанию: true)</li><li >no_quick_create: предотвратить быстрое создание связанных записей (не спрашивайте меня)</li><li >no_create_edit: так же, как no_create, может быть …</li><li >create_name_field: при создании связанной записи, если эта опция установлена, значение * create_name_field * будет заполнено значением ввода (по умолчанию: * name <a href="#id1"><span id="id2" class="problematic">*</span></a>)</li><li >always_reload: логическое значение, по умолчанию false. Если true, виджет всегда будет делать дополнительный name_get для получения значения имени. Это используется для ситуаций, когда метод name_get переопределяется (пожалуйста, не делайте этого)</li><li >no_open: логическое значение, по умолчанию false. Если установлено значение true, many2one не будет перенаправлять на запись при нажатии на нее (в режиме только для чтения)</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;currency_id&quot;</span> <span class="na">options=</span><span class="s">&quot;{&#39;no_create&#39;: True, &#39;no_open&#39;: True}&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >list.many2one (ListFieldMany2One)</dt><dd ><p >Виджет по умолчанию для многих полей (в виде списка).</p><p >Специализация поля many2one для просмотра списка. Основная причина в том, что нам нужно отобразить многие два поля (в режиме только для чтения) в виде текста, что не позволяет открывать связанные записи.</p><ul ><li >Поддерживаемые типы полей: * many2one *</li></ul></dd></dl></li><li ><dl ><dt >many2one_barcode (FieldMany2OneBarcode)</dt><dd ><p >Виджет для многих полей позволяет открывать камеру с мобильного устройства (Android / iOS) для сканирования штрих-кода.</p><p >Специализация поля many2one, где пользователю разрешено использовать собственную камеру для сканирования штрих-кода. Затем он использует name_search для поиска этого значения.</p><p >Если этот виджет установлен, а пользователь не использует мобильное приложение, он откатится к обычному many2one (FieldMany2One)</p><ul ><li >Поддерживаемые типы полей: * many2one *</li></ul></dd></dl></li><li ><dl ><dt >kanban.many2one (KanbanFieldMany2One)</dt><dd ><p >Виджет по умолчанию для многих полей (в представлении Канбан). Нам нужно отключить все издания в представлениях канбан.</p><ul ><li >Поддерживаемые типы полей: * many2one *</li></ul></dd></dl></li><li ><dl ><dt >many2many (FieldMany2Many)</dt><dd ><p >Виджет по умолчанию для многих полей.</p><ul ><li >Поддерживаемые типы полей: * many2many *</li></ul><p >Атрибуты:</p><ul ><li >режим: строка, вид по умолчанию для отображения</li><li >домен: ограничить данные конкретным доменом</li></ul><p >Параметры:</p><ul ><li >create_text: разрешить настройку текста, отображаемого при добавлении новой записи</li></ul></dd></dl></li><li ><dl ><dt >many2many_binary (FieldMany2ManyBinaryMultiFiles)</dt><dd ><p >Этот виджет помогает пользователю загружать или удалять один или несколько файлов одновременно.</p><p >Обратите внимание, что этот виджет специфичен для модели ir.attachment.</p><ul ><li >Поддерживаемые типы полей: * many2many *</li></ul></dd></dl></li><li ><dl ><dt >many2many_tags (FieldMany2ManyTags)</dt><dd ><p >Отображение many2many в виде списка тегов.</p><ul ><li >Поддерживаемые типы полей: * many2many *</li></ul><p >Параметры:</p><ul ><li >color_field: имя числового поля, которое должно присутствовать в представлении. Цвет будет выбран в зависимости от его стоимости.</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;category_id&quot;</span> <span class="na">widget=</span><span class="s">&quot;many2many_tags&quot;</span> <span class="na">options=</span><span class="s">&quot;{&#39;color_field&#39;: &#39;color&#39;}&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<ul ><li >no_edit_color: установите в True, чтобы удалить возможность изменить цвет тегов (по умолчанию: False).</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;category_id&quot;</span> <span class="na">widget=</span><span class="s">&quot;many2many_tags&quot;</span> <span class="na">options=</span><span class="s">&quot;{&#39;color_field&#39;: &#39;color&#39;, &#39;no_edit_color&#39;: True}&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >form.many2many_tags (FormFieldMany2ManyTags)</dt><dd ><p >Специализация виджета many2many_tags для представлений форм. В нем есть дополнительный код, позволяющий редактировать цвет тега.</p><ul ><li >Поддерживаемые типы полей: * many2many *</li></ul></dd></dl></li><li ><dl ><dt >kanban.many2many_tags (KanbanFieldMany2ManyTags)</dt><dd ><p >Специализация виджета many2many_tags для представлений канбан.</p><ul ><li >Поддерживаемые типы полей: * many2many *</li></ul></dd></dl></li><li ><dl ><dt >many2many_checkboxes (FieldMany2ManyCheckBoxes)</dt><dd ><p >Это поле отображает список флажков и позволяет пользователю выбирать подмножество вариантов.</p><ul ><li >Поддерживаемые типы полей: * many2many *</li></ul></dd></dl></li><li ><dl ><dt >one2many (FieldOne2Many)</dt><dd ><p >Стандартный виджет для одного из множества полей.</p><p >Обычно данные отображаются в виде подсписка или в подканале.</p><ul ><li >Поддерживаемые типы полей: * one2many *</li></ul><p >Параметры:</p><ul ><li >create_text: строка, используемая для настройки надписи / текста «Добавить».</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;turtles&quot;</span> <span class="na">options=</span><span class="s">&quot;{\&#39;create_text\&#39;: \&#39;Add turtle\&#39;}&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >строка состояния (FieldStatus)</dt><dd ><p >Это действительно специализированный виджет для представлений формы. Это панель поверх многих форм, которые представляют поток и позволяют выбрать конкретное состояние.</p><ul ><li >Поддерживаемые типы полей: * selection, many2one *</li></ul></dd></dl></li><li ><dl ><dt >ссылка (FieldReference)</dt><dd ><p >FieldReference - это комбинация выбора (для модели) и FieldMany2One (для его значения). Это позволяет выбрать запись по произвольной модели.</p><ul ><li >Поддерживаемые типы полей: * char, reference *</li></ul></dd></dl></li></ul></section><section id="client-actions"><h2 >Действия клиента</h2><p >Идея действия клиента - это настраиваемый виджет, который интегрирован в интерфейс веб-клиента, подобно * act_window_action <a href="#id1"><span id="id2" class="problematic">*</span></a>. Это полезно, когда вам нужен компонент, который не тесно связан с существующим представлением или конкретной моделью. Например, приложение Discuss на самом деле является клиентским действием.</p><p >Действие клиента - это термин, который имеет различные значения в зависимости от контекста:</p><ul ><li >с точки зрения сервера, это запись модели * ir_action * с полем * tag * типа char</li><li >с точки зрения веб-клиента, это виджет, который наследуется от класса AbstractAction и должен быть зарегистрирован в реестре действий под соответствующим ключом (из поля char)</li></ul><p >Всякий раз, когда пункт меню связан с клиентским действием, при открытии он просто получает определение действия с сервера, затем просматривает его реестр действий, чтобы получить определение виджета по соответствующему ключу, и, наконец, он создает экземпляр и добавляет виджет к правильное место в DOM.</p></section><section id="adding-a-client-action"><h3 >Добавление действия клиента</h3><p >Действие клиента - это виджет, который будет управлять частью экрана под строкой меню. При необходимости может иметь панель управления. Определение действия клиента может быть выполнено в два этапа: реализация нового виджета и регистрация виджета в реестре действий.</p><ul ><li ><dl ><dt >Реализация нового действия клиента:</dt><dd ><p >Это делается путем создания виджета:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">ControlPanelMixin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.ControlPanelMixin&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">AbstractAction</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.AbstractAction&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">ClientAction</span> <span class="o">=</span> <span class="nx">AbstractAction</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">ControlPanelMixin</span><span class="p">,</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Не добавляйте миксин контрольной панели, если он вам не нужен. Обратите внимание, что для взаимодействия с панелью управления необходим некоторый код (с помощью метода `` update_control_panel``, заданного mixin).</p></dd></dl></li><li ><dl ><dt >Регистрация действия клиента:</dt><dd ><p >Как обычно, нам нужно, чтобы веб-клиент знал о сопоставлении действий клиента и фактического класса:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">core</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.core&#39;</span><span class="p">);</span>

<span class="nx">core</span><span class="p">.</span><span class="nx">action_registry</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;my-custom-action&#39;</span><span class="p">,</span> <span class="nx">ClientAction</span><span class="p">);</span>
</pre></div>
</div>
<p >Затем, чтобы использовать действие клиента в веб-клиенте, нам нужно создать запись действия клиента (запись модели `` ir.actions.client``) с соответствующим атрибутом `` tag``:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;my_client_action&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.actions.client&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Some Name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;tag&quot;</span><span class="nt">&gt;</span>my-custom-action<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
</dd></dl></li></ul></section><section id="using-the-control-panel-mixin"><h3 >Использование панели управления mixin</h3><p >По умолчанию класс AbstractAction не включает миксин панели управления. Это означает, что действие клиента не отображает панель управления. Для этого нужно сделать несколько шагов.</p><ul ><li ><p >добавить ControlPanelMixin в виджет:</p><blockquote ><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">ControlPanelMixin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.ControlPanelMixin&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">MyClientAction</span> <span class="o">=</span> <span class="nx">AbstractAction</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">ControlPanelMixin</span><span class="p">,</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">});</span>
</pre></div>
</div>
</blockquote></li><li ><p >вызывайте метод * update_control_panel * всякий раз, когда нам нужно обновить панель управления. Например:</p><blockquote ><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">SomeClientAction</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">ControlPanelMixin</span><span class="p">,</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_renderButtons</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_updateControlPanel</span><span class="p">();</span>
        <span class="p">...</span>
    <span class="p">},</span>
    <span class="nx">do_show</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
         <span class="p">...</span>
         <span class="k">this</span><span class="p">.</span><span class="nx">_updateControlPanel</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">_renderButtons</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$buttons</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;SomeTemplate.Buttons&#39;</span><span class="p">));</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$buttons</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">...);</span>
    <span class="p">},</span>
    <span class="nx">_updateControlPanel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">update_control_panel</span><span class="p">({</span>
            <span class="nx">cp_content</span><span class="o">:</span> <span class="p">{</span>
               <span class="nx">$buttons</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">$buttons</span><span class="p">,</span>
            <span class="p">},</span>
     <span class="p">});</span>
</pre></div>
</div>
</blockquote></li></ul><p >Для получения дополнительной информации просмотрите файл * control_panel.js <a href="#id1"><span id="id2" class="problematic">*</span></a>.</p></section>

          </article>
        </div>
        
        <div id="mask"></div>
      </main>
  </div>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
<!-- 
  <footer>
    <div id="footer" class="container">
      <span class="o_logo o_logo_inverse center-block o_footer_logo"></span>
      <div class="row">
        <div class="col-sm-7 col-md-7 col-lg-6">
          <div class="row">
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Community</span>
              <ul>
                <li><a href="https://github.com/odoo/odoo">Github</a></li>
                <li><a href="http://www.odoo.com/page/download">Download</a></li>
                <li class="divider"></li>
                <li><a href="http://runbot.odoo.com/runbot/repo/git-github-com-odoo-enterprise-7">Runbot</a></li>
                <li><a href="https://github.com/odoo/odoo/wiki/Translations">Translations</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/odoo-community">Mailing Lists</a></li>
                <li><a href="http://www.odoo.com/forum/help-1">Forum</a></li>
              </ul>
            </div>
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Services</span>
              <ul>
                <li><a href="https://www.odoo.sh">Odoo Cloud Platform</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/help">Support</a></li>
                <li><a href="https://upgrade.odoo.com">Upgrade</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/partners">Find a partner</a></li>
                <li><a href="http://www.odoo.com/page/become-a-partner">Become a partner</a></li>
                <li class="divider"></li>
                <li><a href="http://training.odoo.com/courses/odoo-functional">Training Center</a></li>
                <li><a href="http://www.odoo.com/page/education-program">Education</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/security">Security</a></li>
              </ul>
            </div>
            <div class="col-xs-12 col-sm-4 mb64">
              <span class="menu_title">About us</span>
              <ul>
                <li><a href="http://www.odoo.com/page/about-us">Our company</a></li>
                <li><a href="http://www.odoo.com/page/contactus">Contact</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/event">Events</a></li>
                <li><a href="http://www.odoo.com/blog">Blog</a></li>
                <li><a href="http://www.odoo.com/blog/6">Customers</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/jobs">Jobs</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/page/legal">Legal</a> | <a href="http://www.odoo.com/privacy">Privacy</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-5 col-md-4 col-md-offset-1 col-lg-5 col-lg-offset-1">
          <p>
            <small>
              Odoo is a suite of open source business apps that cover all your company needs: CRM, eCommerce, accounting, inventory, point of sale, project management, etc.
              <br/><br/>
              Odoo's unique value proposition is to be at the same time very easy to use and fully integrated.
            </small>
          </p>
        </div>
      </div>
    </div>
    <div class="o_footer_bottom">
      <div class="container">
        <a class="small" href="http://www.odoo.com/page/website-builder">Website made with <span class="o_logo o_logo_inverse o_logo_15"></span></a>
        <div class="social-links pull-right">
          <a href="http://www.odoo.com/web/about/facebook"><i class="fa fa-facebook"></i></a>
          <a href="http://www.odoo.com/web/about/twitter"><i class="fa fa-twitter"></i></a>
          <a href="http://www.odoo.com/web/about/linkedin"><i class="fa fa-linkedin"></i></a>
          <a href="mailto:info@odoo.com"><i class="fa fa-envelope"></i></a>
        </div>
      </div>
    </div>
  </footer>
  -->
  </body>
</html>