<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Work+Sans:500,600" rel="stylesheet">
  
    <title>Mixins и полезные занятия &#8212; Документация odoo 13.0</title>
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/patchqueue.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script><link rel="canonical" href="" />
  
    <link rel="index" title="Алфавитный указатель" href="../genindex.html" />
    <link rel="search" title="Поиск" href="../search.html" />
    <link rel="next" title="Руководство Odoo" href="guidelines.html" />
    <link rel="prev" title="QWeb Reports" href="reports.html" /> 
  </head><body><header class="o_main_header o_has_sub_nav o_inverted ">
<!-- 
    <div class="o_main_header_main">
      <a class="pull-left o_logo" href="/"></a>
      <a href="#" class="o_mobile_menu_toggle visible-xs-block pull-right">
        <span class="sr-only">Toggle navigation</span>
        <span class="mdi-navigation-menu"></span>
      </a>
      <div class="o_header_buttons">
        <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
      </div>
      <ul class="o_primary_nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Apps</a>
          <div class="dropdown-menu o_secondary_nav">
            <div class="container">
              <div class="row">
                <div class="col-sm-3 o_website_apps">
                  <div class="o_nav_app_family">
                    <span></span> Websites
                    <div>Build great user experience</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/website-builder">Website Builder</a></li>
                    <li><a href="https://www.odoo.com/page/e-commerce">eCommerce</a></li>
                    <li><a href="https://www.odoo.com/page/blog-engine">Blogs</a></li>
                    <li><a href="https://www.odoo.com/page/community-builder">Forums</a></li>
                    <li><a href="https://www.odoo.com/page/slides">Slides</a></li>
                    <li><a href="https://adspike.odoo.com">SEA</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_sale_apps">
                  <div class="o_nav_app_family">
                    <span></span> Sales
                    <div>Boost your success rate</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/sales">Sales</a></li>
                    <li><a href="https://www.odoo.com/page/crm">CRM</a></li>
                    <li><a href="https://www.odoo.com/page/billing">Invoicing</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Point of Sale</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/point-of-sale">Shops</a></li>
                        <li><a href="https://www.odoo.com/page/pos-restaurant">Restaurants</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/subscriptions">Subscriptions</a></li>
                    <li><a href="https://www.odoo.com/page/sign">Sign</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_operation_apps">
                  <div class="o_nav_app_family">
                    <span></span> Operations
                    <div>It's all about efficiency</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/accounting">Accounting</a></li>
                    <li><a href="https://www.odoo.com/page/project-management">Project</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Human Resources</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/recruitment">Recruitment</a></li>
                        <li><a href="https://www.odoo.com/page/employees">Employees</a></li>
                        <li><a href="https://www.odoo.com/page/expenses">Expenses</a></li>
                        <li><a href="https://www.odoo.com/page/appraisal">Appraisal</a></li>
                        <li><a href="https://www.odoo.com/page/fleet">Fleet</a></li>
                        <li><a href="https://www.odoo.com/page/leaves">Leaves</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/warehouse">Inventory</a></li>
                    <li><a href="https://www.odoo.com/page/purchase">Purchase</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Manufacturing</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/manufacturing">MRP</a></li>
                        <li><a href="https://www.odoo.com/page/plm">PLM</a></li>
                        <li><a href="https://www.odoo.com/page/maintenance">Maintenance</a></li>
                        <li><a href="https://www.odoo.com/page/quality">Quality</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-sm-3 o_productivity_apps">
                  <div class="o_nav_app_family">
                    <span></span> Productivity Tools
                    <div>Great Tools = Happy People</div>
                  </div>
                  <ul>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Communication</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/discuss">Discuss</a></li>
                        <li><a href="https://www.odoo.com/page/discuss-groups">Mailing Lists</a></li>
                        <li><a href="https://www.odoo.com/page/notes">Notes</a></li>
                        <li><a href="#">Help desk</a></li>
                        <li><a href="#">Appointment</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/timesheet">Timesheet</a></li>
                    <li><a href="https://www.odoo.com/page/email-marketing">Email Marketing</a></li>
                    <li><a href="https://www.odoo.com/page/events">Events</a></li>
                    <li><a href="https://www.odoo.com/page/survey">Survey</a></li>
                    <li><a href="https://www.odoo.com/page/live-chat">Live Chat</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <a href="http://www.odoo.com/apps/modules" class="o_store_link"><i class="fa fa-cube fa-fw"></i> Third party apps</a>
          </div>
        </li>
        <li><a href="https://www.odoo.com/page/tour">Tour</a></li>
        <li><a href="https://www.odoo.com/pricing">Pricing</a></li>
        <li><a href="https://www.odoo.com/page/docs">Docs</a></li>
      </ul>
    </div>
-->
    <nav class="navbar o_sub_nav">
      <div class="container">
        <div class="navbar-header visible-xs">
            <button type="button" class="navbar-toggle collapsed text-left btn-block" data-toggle="collapse" data-target="#o_sub-menu" aria-expanded="false">
              Navigate
              <span class="mdi-hardware-keyboard-arrow-down pull-right"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="o_sub-menu">
          <ol class="o_breadcrumb breadcrumb nav navbar-left">
              
              





    
        
            <li><a href="../index.html">Developer Doc</a></li>
        
    
    <li class="active"><a href="#">Mixins и полезные занятия</a></li>

              
          </ol>

          <div class="call-to-action navbar-right hidden-xs">
            <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
          </div>

          <ul class="navbar-nav navbar-right nav o_sub_nav_actions">
            
              <li class="divider"></li>
            

            
            


            
          </ul>

          <ul class="nav navbar-nav navbar-right">
            

            
            
<!--
<li><a href="https://www.odoo.com/documentation/user/13.0/index.html">User</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/index.html">Developer</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/setup/install.html">Installation</a></li>
<li><a href="https://odoo.com/slides">eLearning</a></li>
<li><a href="https://www.odoo.com/page/odoo-white-paper">White Papers</a></li>
<li><a href="https://www.odoo.com/page/legal">Legal</a></li>
-->
            

            
          </ul>
        </div>
      </div>
    </nav>
  </header><div id="wrap" class="">
    
    
    
    <figure class="card top has_banner">
      <span class="card-img" style="background-image: url('../_static/banners/mixins.jpg');"></span>
      <div class="container text-center">
        <h1> Mixins и полезные занятия </h1>
      </div>
    </figure>
    
    
    
      <main class="container ">
        
        <div class="o_content row">
          
          <aside>
            <div class="navbar-aside text-center">
              <ul class="nav text-left list-group"><li class="list-group-item"><a href="#messaging-features" class="ripple reference internal">Функции обмена сообщениями</a><ul ><li class="list-group-item"><a href="#messaging-integration" class="ripple reference internal">Интеграция обмена сообщениями</a><ul ><li class="list-group-item"><a href="#basic-messaging-system" class="ripple reference internal">Базовая система обмена сообщениями</a></li><li class="list-group-item"><a href="#logging-changes" class="ripple reference internal">Регистрация изменений</a></li><li class="list-group-item"><a href="#subtypes" class="ripple reference internal">Подтипы</a></li><li class="list-group-item"><a href="#customizing-notifications" class="ripple reference internal">Настройка уведомлений</a></li><li class="list-group-item"><a href="#overriding-defaults" class="ripple reference internal">Переопределяющие значения по умолчанию</a></li></ul></li><li class="list-group-item"><a href="#mail-alias" class="ripple reference internal">Почтовый псевдоним</a><ul ><li class="list-group-item"><a href="#aliases-vs-incoming-mail-gateway" class="ripple reference internal">Псевдонимы и шлюз входящей почты</a></li><li class="list-group-item"><a href="#alias-support-integration" class="ripple reference internal">Псевдоним поддерживает интеграцию</a></li></ul></li><li class="list-group-item"><a href="#activities-tracking" class="ripple reference internal">Отслеживание деятельности</a></li></ul></li><li class="list-group-item"><a href="#website-features" class="ripple reference internal">Особенности сайта</a><ul ><li class="list-group-item"><a href="#visitor-tracking" class="ripple reference internal">Отслеживание посетителей</a></li><li class="list-group-item"><a href="#website-visibility" class="ripple reference internal">Видимость сайта</a></li><li class="list-group-item"><a href="#website-metadata" class="ripple reference internal">Метаданные сайта</a></li></ul></li><li class="list-group-item"><a href="#others" class="ripple reference internal">другие</a><ul ><li class="list-group-item"><a href="#customer-rating" class="ripple reference internal">Рейтинг клиентов</a><ul ><li class="list-group-item"><a href="#adding-rating-on-your-model" class="ripple reference internal">Добавление рейтинга на вашу модель</a></li><li class="list-group-item"><a href="#send-rating-requests-by-e-mail" class="ripple reference internal">Отправить запрос на оценку по электронной почте</a></li></ul></li></ul></li></ul>
              
              <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/13.0/doc/reference/mixins.rst" class="gith-link">
                  Edit on GitHub
              </a></p>
              
            </div>
          </aside>
          
          <article class="doc-body ">
            
            
  <section id="mixins-and-useful-classes"><i id="reference-mixins"></i><p >В Odoo реализованы некоторые полезные классы и миксины, которые позволяют легко добавлять часто используемые поведения в ваши объекты. В этом руководстве будут подробно описаны большинство из них, приведены примеры и варианты использования.</p></section><section id="messaging-features"><i id="reference-mixins-mail"></i><h2 >Функции обмена сообщениями</h2></section><section id="messaging-integration"><i id="reference-mixins-mail-chatter"></i><h3 >Интеграция обмена сообщениями</h3></section><section id="basic-messaging-system"><h4 >Базовая система обмена сообщениями</h4><p >Интеграция функций обмена сообщениями в вашу модель чрезвычайно проста. Простое наследование модели `` mail.thread`` и добавление полей сообщений (и соответствующих им виджетов) в представление формы поможет вам быстро приступить к работе.</p><div role="alert" class="admonition-example alert"><h3 class="alert-title">пример</h3><p >Давайте создадим упрощенную модель, представляющую командировку. Поскольку в организации такого рода поездок обычно участвует много людей и много дискуссий, давайте добавим поддержку обмена сообщениями в модели.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BusinessTrip</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;business.trip&#39;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mail.thread&#39;</span><span class="p">]</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Business Trip&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">partner_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="s1">&#39;Responsible&#39;</span><span class="p">)</span>
    <span class="n">guest_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="s1">&#39;Participants&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p >В виде формы:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;businness_trip_form&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>business.trip.form<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>business.trip<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">&quot;Business Trip&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- Your usual form view goes here</span>
<span class="c">            ...</span>
<span class="c">            Then comes chatter integration --&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_chatter&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;message_follower_ids&quot;</span> <span class="na">widget=</span><span class="s">&quot;mail_followers&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;message_ids&quot;</span> <span class="na">widget=</span><span class="s">&quot;mail_thread&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
</div><p >После того, как вы добавили поддержку болтовни в свою модель, пользователи могут легко добавлять сообщения или внутренние заметки в любую запись вашей модели; каждый из них будет отправлять уведомление (всем подписчикам для сообщений, сотрудникам (* base.group_user <a href="#id1"><span id="id2" class="problematic">*</span></a>) пользователям для внутренних заметок). Если ваш почтовый шлюз и адрес переадресации настроены правильно, эти уведомления будут отправлены по электронной почте, и на них можно будет ответить прямо из вашего почтового клиента; автоматическая система маршрутизации перенаправит ответ на правильный поток.</p><p >На стороне сервера есть некоторые вспомогательные функции, которые помогут вам легко отправлять сообщения и управлять подписчиками в вашей записи:</p><h5 >Отправка сообщений</h5><section class="code-method"><h6 id="message_post"><code>message_post(<em>self</em>, <em>body=''</em>, <em>subject=None</em>, <em>message_type='notification'</em>, <em>subtype=None</em>, <em>parent_id=False</em>, <em>attachments=None</em>, <em>**kwargs</em>)</code></h6><p >Опубликовать новое сообщение в существующей теме, возвращая новый идентификатор mail.message.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><ul ><li ><strong >body</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#str" title="(в Python v3.8)" class="alert-link reference external"><code >str</code></a>) – тело сообщения, обычно необработанный HTML, который будет очищен</li><li ><strong >message_type</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#str" title="(в Python v3.8)" class="alert-link reference external"><code >str</code></a>) – см. поле mail_message.message_type</li><li ><strong >parent_id</strong> (<a href="https://docs.python.org/3/library/functions.html#int" title="(в Python v3.8)" class="alert-link reference external"><code >int</code></a>) – обрабатывать ответ на предыдущее сообщение, добавляя к сообщению родительских партнеров в случае приватного обсуждения</li><li ><strong >attachments</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#list" title="(в Python v3.8)" class="alert-link reference external"><code >list</code></a><code >(</code><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(в Python v3.8)" class="alert-link reference external"><code >tuple</code></a><code >(</code><a href="https://docs.python.org/3/library/stdtypes.html#str" title="(в Python v3.8)" class="alert-link reference external"><code >str</code></a><code >,</code><a href="https://docs.python.org/3/library/stdtypes.html#str" title="(в Python v3.8)" class="alert-link reference external"><code >str</code></a><code >)</code><code >)</code>) – список кортежей вложений в виде `` (имя, контент) <a href="#id1"><span id="id2" class="problematic">``</span></a>, где контент НЕ кодируется в base64</li><li ><strong >**kwargs</strong> – дополнительные аргументы ключевого слова будут использоваться в качестве значений столбца по умолчанию для новой записи mail.message</li></ul></div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">ID вновь созданного mail.message</div></div><div class="code-field"><div class="code-field-name">Тип результата</div><div class="code-field-body"><a href="https://docs.python.org/3/library/functions.html#int" title="(в Python v3.8)" class="alert-link reference external">int</a></div></div></div></section><section class="code-method"><h6 ><code>message_post_with_view(views_or_xmlid, **kwargs):</code></h6><p >Вспомогательный метод для отправки почты / публикации сообщения с использованием view_id для рендеринга с использованием механизма ir.qweb. Этот метод является автономным, поскольку в шаблоне и компоновщике нет ничего, что позволяло бы обрабатывать представления в пакетном режиме. Этот метод, вероятно, исчезнет, когда шаблоны будут обрабатывать пользовательские интерфейсы.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >or ir.ui.view record</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#str" title="(в Python v3.8)" class="alert-link reference external"><code >str</code></a>) – внешний идентификатор или запись представления, которое должно быть отправлено</div></div></div></section><section class="code-method"><h6 id="message_post_with_template"><code>message_post_with_template(<em>template_id</em>, <em>**kwargs</em>)</code></h6><p >Вспомогательный метод для отправки почты с шаблоном</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><ul ><li ><strong >template_id</strong> – идентификатор шаблона для визуализации для создания тела сообщения</li><li ><strong >**kwargs</strong> – параметр для создания mail.compose.message wizzard (который наследуется от mail.message)</li></ul></div></div></div></section><h5 >Получение сообщений</h5><p >Эти методы вызываются, когда почтовый шлюз обрабатывает новое сообщение. Эти электронные письма могут быть новыми темами (если они приходят через <a href="#reference-mixins-mail-alias" class="internal reference"><span class="std std-ref">alias</span></a>) или просто отвечает из существующей темы. Переопределение их позволяет вам устанавливать значения в записи потока в зависимости от некоторых значений из самого электронного письма (например, обновлять дату или адрес электронной почты, добавлять адреса CC в качестве подписчиков и т. Д.).</p><section class="code-method"><h6 id="message_new"><code>message_new(<em>msg_dict</em>, <em>custom_values=None</em>)</code></h6><p >Вызывается `` message_process`` при получении нового сообщения для данной модели потока, если сообщение не принадлежало существующему потоку.</p><p >Поведение по умолчанию - создание новой записи соответствующей модели (на основе некоторой базовой информации, извлеченной из сообщения). Дополнительное поведение может быть реализовано путем переопределения этого метода.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><ul ><li ><strong >msg_dict</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#dict" title="(в Python v3.8)" class="alert-link reference external"><code >dict</code></a>) – карта, содержащая данные электронной почты и вложения. Подробности смотрите в `` message_process`` и `` mail.message.parse``</li><li ><strong >custom_values</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#dict" title="(в Python v3.8)" class="alert-link reference external"><code >dict</code></a>) – необязательный словарь дополнительных значений полей для передачи в create () при создании новой записи потока; будьте осторожны, эти значения могут переопределять любые другие значения, поступающие из сообщения</li></ul></div></div><div class="code-field"><div class="code-field-name">Тип результата</div><div class="code-field-body"><a href="https://docs.python.org/3/library/functions.html#int" title="(в Python v3.8)" class="alert-link reference external">int</a></div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">идентификатор недавно созданного объекта потока</div></div></div></section><section class="code-method"><h6 id="message_update"><code>message_update(<em>msg_dict</em>, <em>update_vals=None</em>)</code></h6><p >Вызывается `` message_process`` при получении нового сообщения для существующего потока. Поведение по умолчанию - обновлять запись с помощью `` update_vals``, взятых из входящей электронной почты.</p><p >Дополнительное поведение может быть реализовано путем переопределения этого метода.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><ul ><li ><strong >msg_dict</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#dict" title="(в Python v3.8)" class="alert-link reference external"><code >dict</code></a>) – карта, содержащая данные электронной почты и вложения; подробности смотрите в `` message_process`` и `` mail.message.parse () <a href="#id1"><span id="id2" class="problematic">``</span></a>.</li><li ><strong >update_vals</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#dict" title="(в Python v3.8)" class="alert-link reference external"><code >dict</code></a>) – дикт, содержащий значения для обновления записей с учетом их идентификаторов; если dict None или void, операция записи не выполняется.</li></ul></div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">Правда</div></div></div></section><h5 >Управление подписчиками</h5><section class="code-method"><h6 id="message_subscribe"><code>message_subscribe(<em>partner_ids=None</em>, <em>channel_ids=None</em>, <em>subtype_ids=None</em>, <em>force=True</em>)</code></h6><p >Добавьте партнеров в записи последователей.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><ul ><li ><strong >partner_ids</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#list" title="(в Python v3.8)" class="alert-link reference external"><code >list</code></a><code >(</code><a href="https://docs.python.org/3/library/functions.html#int" title="(в Python v3.8)" class="alert-link reference external"><code >int</code></a><code >)</code>) – Идентификаторы партнеров, которые будут подписаны на запись</li><li ><strong >channel_ids</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#list" title="(в Python v3.8)" class="alert-link reference external"><code >list</code></a><code >(</code><a href="https://docs.python.org/3/library/functions.html#int" title="(в Python v3.8)" class="alert-link reference external"><code >int</code></a><code >)</code>) – Идентификаторы каналов, которые будут подписаны на запись</li><li ><strong >subtype_ids</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#list" title="(в Python v3.8)" class="alert-link reference external"><code >list</code></a><code >(</code><a href="https://docs.python.org/3/library/functions.html#int" title="(в Python v3.8)" class="alert-link reference external"><code >int</code></a><code >)</code>) – Идентификаторы подтипов, на которые будут подписаны каналы / партнеры (по умолчанию используется подтипы по умолчанию, если `` None``)</li><li ><strong >force</strong> – если True, удалите существующих подписчиков перед созданием новых, используя подтипы, указанные в параметрах</li></ul></div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">Успех / Неудача</div></div><div class="code-field"><div class="code-field-name">Тип результата</div><div class="code-field-body"><a href="https://docs.python.org/3/library/functions.html#bool" title="(в Python v3.8)" class="alert-link reference external">bool</a></div></div></div></section><section class="code-method"><h6 id="message_unsubscribe"><code>message_unsubscribe(<em>partner_ids=None</em>, <em>channel_ids=None</em>)</code></h6><p >Удалить партнеров из подписчиков записи.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><ul ><li ><strong >partner_ids</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#list" title="(в Python v3.8)" class="alert-link reference external"><code >list</code></a><code >(</code><a href="https://docs.python.org/3/library/functions.html#int" title="(в Python v3.8)" class="alert-link reference external"><code >int</code></a><code >)</code>) – Идентификаторы партнеров, которые будут подписаны на запись</li><li ><strong >channel_ids</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#list" title="(в Python v3.8)" class="alert-link reference external"><code >list</code></a><code >(</code><a href="https://docs.python.org/3/library/functions.html#int" title="(в Python v3.8)" class="alert-link reference external"><code >int</code></a><code >)</code>) – Идентификаторы каналов, которые будут подписаны на запись</li></ul></div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">Правда</div></div><div class="code-field"><div class="code-field-name">Тип результата</div><div class="code-field-body"><a href="https://docs.python.org/3/library/functions.html#bool" title="(в Python v3.8)" class="alert-link reference external">bool</a></div></div></div></section><section class="code-method"><h6 id="message_unsubscribe_users"><code>message_unsubscribe_users(<em>user_ids=None</em>)</code></h6><p >Оболочка на message_subscribe, используя пользователей.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >user_ids</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#list" title="(в Python v3.8)" class="alert-link reference external"><code >list</code></a><code >(</code><a href="https://docs.python.org/3/library/functions.html#int" title="(в Python v3.8)" class="alert-link reference external"><code >int</code></a><code >)</code>) – Идентификаторы пользователей, которые будут отписаны от записи; если нет, отмените подписку на текущего пользователя.</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">Правда</div></div><div class="code-field"><div class="code-field-name">Тип результата</div><div class="code-field-body"><a href="https://docs.python.org/3/library/functions.html#bool" title="(в Python v3.8)" class="alert-link reference external">bool</a></div></div></div></section></section><section id="logging-changes"><h4 >Регистрация изменений</h4><p >Модуль `` mail`` добавляет мощную систему отслеживания полей, позволяя регистрировать изменения в определенных полях в записи записи. Чтобы добавить отслеживание в поле, просто установите для атрибута отслеживания значение True.</p><div role="alert" class="admonition-example alert"><h3 class="alert-title">пример</h3><p >Давайте отследим изменения в названии и ответственных за наши командировки:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BusinessTrip</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;business.trip&#39;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mail.thread&#39;</span><span class="p">]</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Business Trip&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">tracking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">partner_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="s1">&#39;Responsible&#39;</span><span class="p">,</span>
                                 <span class="n">tracking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">guest_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="s1">&#39;Participants&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p >Отныне каждое изменение названия поездки или ответственного лица будет записывать запись в записи. Поле `` name`` также будет отображаться в уведомлении, чтобы дать больше контекста об уведомлении (даже если имя не изменилось).</p></div></section><section id="subtypes"><h4 >Подтипы</h4><p >Подтипы дают вам более детальный контроль над сообщениями. Подтипы действуют как система классификации уведомлений, позволяя подписчикам документа настраивать подтип уведомлений, которые они хотят получать.</p><p >Подтипы создаются как данные в вашем модуле; Модель имеет следующие поля:</p><dl ><dt >`` name`` (обязательно) - <a href="orm.html#odoo.fields.Char" title="odoo.fields.Char" class="internal reference"><code class="py-class py xref">Char</code></a></dt><dd >имя подтипа, будет отображаться во всплывающем окне настройки уведомлений</dd><dt >`` description`` - <a href="orm.html#odoo.fields.Char" title="odoo.fields.Char" class="internal reference"><code class="py-class py xref">Char</code></a></dt><dd >описание, которое будет добавлено в сообщении, опубликованном для этого подтипа. Если void, имя будет добавлено вместо</dd><dt >`` internal`` - <a href="orm.html#odoo.fields.Boolean" title="odoo.fields.Boolean" class="internal reference"><code class="py-class py xref">Boolean</code></a></dt><dd >сообщения с внутренними подтипами будут видны только сотрудникам, которые также являются членами группы `` base.group_user``</dd><dt >`` parent_id`` - - class: <code >~ odoo.fields.Many2one</code></dt><dd >подтипы ссылок для автоматической подписки; например, подтипы проекта связаны с подтипами задачи через эту ссылку. Когда кто-то подписан на проект, он будет подписан на все задачи этого проекта с подтипами, найденными с использованием родительского подтипа.</dd><dt >`` ratio_field`` - <a href="orm.html#odoo.fields.Char" title="odoo.fields.Char" class="internal reference"><code class="py-class py xref">Char</code></a></dt><dd >Например, при связывании подтипов проекта и задач поле отношения - это поле задач project_id</dd><dt >`` res_model`` - <a href="orm.html#odoo.fields.Char" title="odoo.fields.Char" class="internal reference"><code class="py-class py xref">Char</code></a></dt><dd >модель, к которой относится подтип; если False, этот подтип применяется ко всем моделям</dd><dt >`` default`` - <a href="orm.html#odoo.fields.Boolean" title="odoo.fields.Boolean" class="internal reference"><code class="py-class py xref">Boolean</code></a></dt><dd >Подтип активирован по умолчанию при подписке</dd><dt >`` sequence`` - <a href="orm.html#odoo.fields.Integer" title="odoo.fields.Integer" class="internal reference"><code class="py-class py xref">Integer</code></a></dt><dd >используется для заказа подтипов во всплывающем окне настройки уведомлений</dd><dt >`` hidden`` - <a href="orm.html#odoo.fields.Boolean" title="odoo.fields.Boolean" class="internal reference"><code class="py-class py xref">Boolean</code></a></dt><dd >Подтип скрыт во всплывающем окне настройки уведомлений</dd></dl><p >Сопряжение подтипов с полевым отслеживанием позволяет подписываться на различные виды уведомлений в зависимости от того, что может заинтересовать пользователей. Для этого вы можете переопределить функцию `` _track_subtype () <a href="#id1"><span id="id2" class="problematic">``</span></a>:</p><section class="code-method"><h6 id="_track_subtype"><code>_track_subtype(<em>init_values</em>)</code></h6><p >Укажите подтип, вызванный изменениями в записи, в соответствии со значениями, которые были обновлены.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >init_values</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#dict" title="(в Python v3.8)" class="alert-link reference external"><code >dict</code></a>) – исходные значения записи; в поле присутствуют только измененные поля</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">полный внешний идентификатор подтипа или False, если подтип не запущен</div></div></div></section><div role="alert" class="admonition-example alert"><h3 class="alert-title">пример</h3><p >Давайте добавим поле `` state`` в нашем примере класса и вызовем уведомление с определенным подтипом, когда это поле изменит значения.</p><p >Сначала давайте определим наш подтип:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;mt_state_change&quot;</span> <span class="na">model=</span><span class="s">&quot;mail.message.subtype&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Trip confirmed<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>business.trip<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;default&quot;</span> <span class="na">eval=</span><span class="s">&quot;True&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span><span class="nt">&gt;</span>Business Trip confirmed!<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p >Затем нам нужно переопределить функцию `` track_subtype () <code >. Эта функция вызывается системой отслеживания, чтобы узнать, какой подтип следует использовать в зависимости от применяемого в данный момент изменения. В нашем случае мы хотим использовать наш новый блестящий подтип, когда поле `` state</code> изменяется с * чернового * на * подтвержденное <a href="#id1"><span id="id2" class="problematic">*</span></a>:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BusinessTrip</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;business.trip&#39;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mail.thread&#39;</span><span class="p">]</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Business Trip&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">tracking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">partner_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="s1">&#39;Responsible&#39;</span><span class="p">,</span>
                                 <span class="n">tracking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">guest_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="s1">&#39;Participants&#39;</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">([(</span><span class="s1">&#39;draft&#39;</span><span class="p">,</span> <span class="s1">&#39;New&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;confirmed&#39;</span><span class="p">,</span> <span class="s1">&#39;Confirmed&#39;</span><span class="p">)],</span>
                             <span class="n">tracking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_track_subtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_values</span><span class="p">):</span>
        <span class="c1"># init_values contains the modified fields&#39; values before the changes</span>
        <span class="c1">#</span>
        <span class="c1"># the applied values can be accessed on the record as they are already</span>
        <span class="c1"># in cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensure_one</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;state&#39;</span> <span class="ow">in</span> <span class="n">init_values</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;confirmed&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;my_module.mt_state_change&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">BusinessTrip</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_track_subtype</span><span class="p">(</span><span class="n">init_values</span><span class="p">)</span>
</pre></div>
</div>
</div></section><section id="customizing-notifications"><h4 >Настройка уведомлений</h4><p >При отправке уведомлений подписчикам может оказаться полезным добавить в шаблон кнопки, позволяющие быстро выполнять действия непосредственно из электронной почты. Даже простая кнопка для прямой связи с представлением формы записи может быть полезна; однако в большинстве случаев вы не хотите показывать эти кнопки пользователям портала.</p><p >Система уведомлений позволяет настраивать шаблоны уведомлений следующими способами:</p><ul ><li >Отображать * кнопки доступа <a href="#id1"><span id="id2" class="problematic">*</span></a>: эти кнопки отображаются в верхней части уведомления по электронной почте и позволяют получателю получить прямой доступ к представлению формы записи.</li><li >Отображать * следовать кнопкам <a href="#id1"><span id="id2" class="problematic">*</span></a>: эти кнопки позволяют получателю напрямую быстро подписаться на запись</li><li >Отображать * кнопки отмены подписки <a href="#id1"><span id="id2" class="problematic">*</span></a>: эти кнопки позволяют получателю сразу же быстро отписаться от записи</li><li >Отображение * кнопок настраиваемых действий <a href="#id1"><span id="id2" class="problematic">*</span></a>: эти кнопки служат для вызова определенных маршрутов и позволяют вам сделать некоторые полезные действия непосредственно доступными из электронной почты (например, преобразование потенциальной возможности в возможность, подтверждение таблицы расходов для менеджера расходов и т. Д.)</li></ul><p >Эти настройки кнопок можно применить к разным группам, которые вы можете определить самостоятельно, переопределив функцию `` _notification_recipients``.</p><section class="code-method"><h6 id="_notification_recipients"><code>_notification_recipients(<em>message</em>, <em>groups</em>)</code></h6><p >Укажите подтип, вызванный изменениями в записи, в соответствии со значениями, которые были обновлены.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><ul ><li ><strong >message</strong> (<code >record</code>) – `` mail.message`` запись в данный момент отправляется</li><li ><strong >groups</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#list" title="(в Python v3.8)" class="alert-link reference external"><code >list</code></a><code >(</code><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(в Python v3.8)" class="alert-link reference external"><code >tuple</code></a><code >)</code>) – список кортежей формы (имя_группы, группа_функций, данные_группы), где: имя_группы - это идентификатор, используемый только для возможности переопределения и управления группами. Группами по умолчанию являются `` user`` (получатели, связанные с пользователем сотрудника), `` portal`` (получатели, связанные с пользователем портала) и `` customer`` (получатели, не связанные ни с одним пользователем). Примером использования переопределения может быть добавление группы, связанной с res.groups, такой как Hr Officers, для установки для них определенных кнопок действий. group_func - указатель на функцию, принимающий запись партнера в качестве параметра. Этот метод будет применяться к получателям, чтобы узнать, принадлежат ли они к данной группе или нет. Сохраняется только первая подходящая группа. Порядок оценки - это порядок списка. group_data - это файл, содержащий параметры для уведомления по электронной почте со следующими возможными ключами - значениями: - has_button_access, отображать ли Access &lt;Document&gt; по электронной почте True по умолчанию для новых групп, False для портала / клиента. - button_access dict с URL и заголовком кнопки - has_button_follow, отображать ли Follow в письме (если получатель в данный момент не подписан на ветку). True по умолчанию для новых групп, False для портала / клиента. - button_follow диктует URL-адрес и заголовок кнопки - has_button_unfollow, отображать ли Unfollow в письме (если получатель в настоящее время следует за темой). True по умолчанию для новых групп, False для портала / клиента. - button_unfollow dict с URL-адресом и названием кнопки - список действий кнопок действий для отображения в уведомлении по электронной почте. Каждое действие является указанием, содержащим URL и заголовок кнопки.</li></ul></div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">полный внешний идентификатор подтипа или False, если подтип не запущен</div></div></div></section><p >URL-адреса в списке действий могут быть сгенерированы автоматически путем вызова функции `` _notification_link_helper () <a href="#id1"><span id="id2" class="problematic">``</span></a>:</p><section class="code-method"><h6 id="_notification_link_helper"><code>_notification_link_helper(<em>self</em>, <em>link_type</em>, <em>**kwargs</em>)</code></h6><p >Создайте ссылку для данного типа в текущей записи (или в конкретной записи, если установлены kwargs `` model`` и `` res_id``).</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >link_type</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#str" title="(в Python v3.8)" class="alert-link reference external"><code >str</code></a>) – тип ссылки для генерации; может быть любым из этих значений: `` view`` ссылка на представление формы записи `` assign`` присваивает зарегистрированному пользователю поле `` user_id`` записи (если оно существует) `` follow`` self -объяснительный `` unfollow`` самоочевидный `` метод`` вызывает метод записи; имя метода должно быть предоставлено в виде kwarg `` method`` `` new``, открывающего пустое представление формы для новой записи; Вы можете указать конкретное действие, указав его идентификатор (идентификатор базы данных или полностью разрешенный внешний идентификатор) в kwarg `` action_id``</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">ссылка типа, выбранного для записи</div></div><div class="code-field"><div class="code-field-name">Тип результата</div><div class="code-field-body"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="(в Python v3.8)" class="alert-link reference external">str</a></div></div></div></section><div role="alert" class="admonition-example alert"><h3 class="alert-title">пример</h3><p >Давайте добавим пользовательскую кнопку в уведомление об изменении состояния командировки; эта кнопка сбросит состояние на Черновик и будет видна только члену (воображаемой) группы Travel Manager (`` business.group_trip_manager``)</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BusinessTrip</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;business.trip&#39;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mail.thread&#39;</span><span class="p">,</span> <span class="s1">&#39;mail.alias.mixin&#39;</span><span class="p">]</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Business Trip&#39;</span>

    <span class="c1"># Pevious code goes here</span>

    <span class="k">def</span> <span class="nf">action_cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;draft&#39;</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">_notification_recipients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">groups</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Handle Trip Manager recipients that can cancel the trip at the last</span>
<span class="sd">        minute and kill all the fun. &quot;&quot;&quot;</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">BusinessTrip</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_notification_recipients</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ensure_one</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;confirmed&#39;</span><span class="p">:</span>
            <span class="n">app_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notification_link_helper</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span>
                                <span class="n">method</span><span class="o">=</span><span class="s1">&#39;action_cancel&#39;</span><span class="p">)</span>
            <span class="n">trip_actions</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">app_action</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Cancel&#39;</span><span class="p">)}]</span>

        <span class="n">new_group</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;group_trip_manager&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">partner</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">partner</span><span class="o">.</span><span class="n">user_ids</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">any</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">has_group</span><span class="p">(</span><span class="s1">&#39;business.group_trip_manager&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">partner</span><span class="o">.</span><span class="n">user_ids</span><span class="p">),</span>
            <span class="p">{</span>
                <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="n">trip_actions</span><span class="p">,</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">new_group</span><span class="p">]</span> <span class="o">+</span> <span class="n">groups</span>
</pre></div>
</div>
<p >Обратите внимание, что я мог бы определить свою функцию оценки вне этого метода и определить глобальную функцию для ее выполнения вместо лямбды, но для того, чтобы быть более кратким и менее многословным в этих файлах документации, которые иногда могут быть скучными, я выбираю первый вместо второго.</p></div></section><section id="overriding-defaults"><h4 >Переопределяющие значения по умолчанию</h4><p >Существует несколько способов настроить поведение моделей `` mail.thread``, включая (но не ограничиваясь):</p><dl ><dt >Атрибут `` _mail_post_access`` - <a href="orm.html#odoo.models.Model" title="odoo.models.Model" class="internal reference"><code class="py-class py xref">Model</code></a></dt><dd >необходимые права доступа, чтобы иметь возможность разместить сообщение на модели; по умолчанию требуется доступ `` write``, также может быть установлено значение `` read``</dd><dt >Контекстные ключи:</dt><dd ><p >Эти контекстные ключи могут использоваться для некоторого управления функциями `` mail.thread``, такими как автоматическая подписка или отслеживание полей во время вызовов `` create () `` или `` write () `` (или любого другого метода, где это возможно быть полезным).</p><ul ><li >`` mail_create_nosubscribe``: при создании или message_post не подписывать текущего пользователя на поток записей</li><li >`` mail_create_nolog``: при создании не регистрировать автоматическое ' &lt;Document&gt; создано сообщение</li><li >`` mail_notrack``: при создании и записи не выполнять отслеживание значений при создании сообщений</li><li >`` tracking_disable``: при создании и записи не выполнять функции MailThread (автоматическая подписка, отслеживание, публикация, …)</li><li >`` mail_auto_delete``: автоматическое удаление почтовых уведомлений; Правда по умолчанию</li><li >`` mail_notify_force_send``: если отправлено менее 50 уведомлений по электронной почте, отправляйте их напрямую вместо использования очереди; Правда по умолчанию</li><li >`` mail_notify_user_signature``: добавить подпись текущего пользователя в уведомления по электронной почте; Правда по умолчанию</li></ul></dd></dl></section><section id="mail-alias"><i id="reference-mixins-mail-alias"></i><h3 >Почтовый псевдоним</h3><p >Псевдонимы - это настраиваемые адреса электронной почты, которые связаны с определенной записью (которая обычно наследует модель `` mail.alias.mixin``), которая будет создавать новые записи при обращении по электронной почте. Это простой способ сделать вашу систему доступной извне, позволяя пользователям или клиентам быстро создавать записи в вашей базе данных без необходимости прямого подключения к Odoo.</p></section><section id="aliases-vs-incoming-mail-gateway"><h4 >Псевдонимы и шлюз входящей почты</h4><p >Некоторые люди используют шлюз входящей почты для этой же цели. Вам все еще нужен правильно настроенный почтовый шлюз для использования псевдонимов, однако будет достаточно одного домена перехвата, поскольку вся маршрутизация будет выполняться внутри Odoo. Псевдонимы имеют несколько преимуществ перед почтовыми шлюзами:</p><ul ><li ><dl ><dt >Проще настроить</dt><dd ><ul ><li >Один входящий шлюз может использоваться многими псевдонимами; это избавляет от необходимости настраивать несколько электронных писем на вашем доменном имени (все настройки выполняются внутри Odoo)</li><li >Нет необходимости в правах доступа к Системе для настройки псевдонимов</li></ul></dd></dl></li><li ><dl ><dt >Более последовательный</dt><dd ><ul ><li >Настраивается на связанной записи, а не в подменю настроек</li></ul></dd></dl></li><li ><dl ><dt >Проще переопределить серверную часть</dt><dd ><ul ><li >Модель Mixin построена так, чтобы расширяться с самого начала, что позволяет вам извлекать полезные данные из входящих писем легче, чем с помощью почтового шлюза.</li></ul></dd></dl></li></ul></section><section id="alias-support-integration"><h4 >Псевдоним поддерживает интеграцию</h4><p >Псевдонимы обычно настраиваются на родительской модели, которая затем создает конкретную запись при обращении по электронной почте. Например, у Project есть псевдонимы для создания задач или проблем, у Sales Team есть псевдонимы для создания потенциальных клиентов.</p><div role="alert" class="alert-info alert"><h3 class="alert-title">Примечание</h3><p >Модель, которая будет создана псевдонимом <a href="#id1"><span id="id2" class="problematic">**</span></a>, должна ** наследовать модель `` mail_thread``.</p></div><p >Поддержка псевдонимов добавлена наследованием `` mail.alias.mixin``; этот миксин будет генерировать новую запись `` mail.alias`` для каждой создаваемой записи родительского класса (например, каждая запись `` project.project``, имеющая свою запись `` mail.alias``, инициализированную при создании) ).</p><div role="alert" class="alert-info alert"><h3 class="alert-title">Примечание</h3><p >Псевдонимы также можно создавать вручную и поддерживать с помощью простого поля <a href="orm.html#odoo.fields.Many2one" title="odoo.fields.Many2one" class="internal alert-link reference"><code class="py-class py xref">Many2one</code></a>. В этом руководстве предполагается, что вы хотите более полной интеграции с автоматическим созданием псевдонима, значений по умолчанию для конкретных записей и т. Д.</p></div><p >В отличие от `` mail.thread`` наследования, `` mail.alias.mixin`` ** требует ** некоторых специальных переопределений для корректной работы. Эти переопределения будут указывать значения созданного псевдонима, такие как тип записи, которую он должен создать, и, возможно, некоторые значения по умолчанию, которые эти записи могут иметь в зависимости от родительского объекта:</p><section class="code-method"><h6 id="get_alias_model_name"><code>get_alias_model_name(<em>vals</em>)</code></h6><p >Верните название модели для псевдонима. Входящие электронные письма, которые не являются ответами на существующие записи, вызовут создание новой записи этой модели псевдонима. Значение может зависеть от `` vals``, значения, передаваемого в `` create`` при создании записи этой модели.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >dict</strong> (<code >vals</code>) – значения вновь созданной записи, которая будет содержать псевдоним</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">наименование модели</div></div><div class="code-field"><div class="code-field-name">Тип результата</div><div class="code-field-body"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="(в Python v3.8)" class="alert-link reference external">str</a></div></div></div></section><section class="code-method"><h6 id="get_alias_values"><code>get_alias_values()</code></h6><p >Вернуть значения, чтобы создать псевдоним или записать псевдоним после его создания. Хотя это и не является полностью обязательным, обычно требуется убедиться, что вновь созданные записи будут связаны с родительским псевдонимом (т. Е. Задачи создаются в правильном проекте), установив словарь значений по умолчанию в псевдониме «alias_defaults». поле.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">словарь значений, которые будут записаны в новый псевдоним</div></div><div class="code-field"><div class="code-field-name">Тип результата</div><div class="code-field-body"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="(в Python v3.8)" class="alert-link reference external">dict</a></div></div></div></section><p >Переопределение `` get_alias_values () `` особенно интересно, поскольку оно позволяет вам легко изменять поведение ваших псевдонимов. Среди полей, которые можно задать для псевдонима, следующие представляют особый интерес:</p><dl ><dt >`` alias_name`` - <a href="orm.html#odoo.fields.Char" title="odoo.fields.Char" class="internal reference"><code class="py-class py xref">Char</code></a></dt><dd >имя псевдонима электронной почты, например, «рабочие места», если вы хотите перехватить электронные письма для &lt;<a href="mailto:jobs@example.odoo.com" class="reference external">jobs@example.odoo.com</a>&gt;</dd><dt >`` alias_user_id`` - <a href="orm.html#odoo.fields.Many2one" title="odoo.fields.Many2one" class="internal reference"><code class="py-class py xref">Many2one</code></a> (` <code >res.users`</code>)</dt><dd >владелец записей, созданных при получении писем на этот псевдоним; если это поле не установлено, система будет пытаться найти подходящего владельца на основе адреса отправителя (От) или будет использовать учетную запись администратора, если системный пользователь не найден для этого адреса</dd><dt >`` alias_defaults`` - <a href="orm.html#odoo.fields.Text" title="odoo.fields.Text" class="internal reference"><code class="py-class py xref">Text</code></a></dt><dd >Словарь Python, который будет оцениваться для предоставления значений по умолчанию при создании новых записей для этого псевдонима</dd><dt >`` alias_force_thread_id`` - <a href="orm.html#odoo.fields.Integer" title="odoo.fields.Integer" class="internal reference"><code class="py-class py xref">Integer</code></a></dt><dd >необязательный идентификатор потока (записи), к которому будут присоединяться все входящие сообщения, даже если они не ответили на него; если установлено, это полностью отключит создание новых записей</dd><dt >`` alias_contact`` - <a href="orm.html#odoo.fields.Selection" title="odoo.fields.Selection" class="internal reference"><code class="py-class py xref">Selection</code></a></dt><dd ><p >Политика публикации сообщения в документе с помощью mailgateway</p><ul ><li ><em >everyone</em>: everyone can post</li><li ><em >partners</em>: only authenticated partners</li><li ><em >followers</em>: only followers of the related document or members of following channels</li></ul></dd></dl><p >Обратите внимание, что псевдонимы используют <a href="orm.html#reference-orm-inheritance" class="internal reference"><span class="std std-ref">delegation inheritance</span></a>, что означает, что хотя псевдоним хранится в другой таблице, у вас есть доступ ко всем этим полям непосредственно из вашего родительского объекта. Это позволяет вам легко настроить псевдоним из представления формы записи.</p><div role="alert" class="admonition-example alert"><h3 class="alert-title">пример</h3><p >Давайте добавим псевдонимы в наш класс командировки, чтобы создавать расходы на лету по электронной почте.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BusinessTrip</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;business.trip&#39;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mail.thread&#39;</span><span class="p">,</span> <span class="s1">&#39;mail.alias.mixin&#39;</span><span class="p">]</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Business Trip&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">tracking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">partner_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="s1">&#39;Responsible&#39;</span><span class="p">,</span>
                                 <span class="n">tracking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">guest_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="s1">&#39;Participants&#39;</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">([(</span><span class="s1">&#39;draft&#39;</span><span class="p">,</span> <span class="s1">&#39;New&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;confirmed&#39;</span><span class="p">,</span> <span class="s1">&#39;Confirmed&#39;</span><span class="p">)],</span>
                             <span class="n">tracking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">expense_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;business.expense&#39;</span><span class="p">,</span> <span class="s1">&#39;trip_id&#39;</span><span class="p">,</span> <span class="s1">&#39;Expenses&#39;</span><span class="p">)</span>
    <span class="n">alias_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;mail.alias&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Alias&#39;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;restrict&quot;</span><span class="p">,</span>
                               <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_alias_model_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Specify the model that will get created when the alias receives a message &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;business.expense&#39;</span>

    <span class="k">def</span> <span class="nf">get_alias_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Specify some default values that will be set in the alias at its creation &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">BusinessTrip</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_alias_values</span><span class="p">()</span>
        <span class="c1"># alias_defaults holds a dictionnary that will be written</span>
        <span class="c1"># to all records created by this alias</span>
        <span class="c1">#</span>
        <span class="c1"># in this case, we want all expense records sent to a trip alias</span>
        <span class="c1"># to be linked to the corresponding business trip</span>
        <span class="n">values</span><span class="p">[</span><span class="s1">&#39;alias_defaults&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;trip_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>
        <span class="c1"># we only want followers of the trip to be able to post expenses</span>
        <span class="c1"># by default</span>
        <span class="n">values</span><span class="p">[</span><span class="s1">&#39;alias_contact&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;followers&#39;</span>
        <span class="k">return</span> <span class="n">values</span>

<span class="k">class</span> <span class="nc">BusinessExpense</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;business.expense&#39;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mail.thread&#39;</span><span class="p">]</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Business Expense&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="s1">&#39;Amount&#39;</span><span class="p">)</span>
    <span class="n">trip_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;business.trip&#39;</span><span class="p">,</span> <span class="s1">&#39;Business Trip&#39;</span><span class="p">)</span>
    <span class="n">partner_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="s1">&#39;Created by&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p >Мы хотели бы, чтобы наш псевдоним был легко конфигурируемым из представления формы наших деловых поездок, поэтому давайте добавим следующее в наше представление формы:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">&quot;Emails&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;group</span> <span class="na">name=</span><span class="s">&quot;group_alias&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;alias_name&quot;</span> <span class="na">string=</span><span class="s">&quot;Email Alias&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">name=</span><span class="s">&quot;alias_def&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- display a link while in view mode and a configurable field</span>
<span class="c">            while in edit mode --&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;alias_id&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_read_only oe_inline&quot;</span>
                    <span class="na">string=</span><span class="s">&quot;Email Alias&quot;</span> <span class="na">required=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_edit_only oe_inline&quot;</span> <span class="na">name=</span><span class="s">&quot;edit_alias&quot;</span>
                 <span class="na">style=</span><span class="s">&quot;display: inline;&quot;</span> <span class="nt">&gt;</span>
                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;alias_name&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_inline&quot;</span><span class="nt">/&gt;</span>
                @
                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;alias_domain&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_inline&quot;</span> <span class="na">readonly=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;alias_contact&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_inline&quot;</span>
                <span class="na">string=</span><span class="s">&quot;Accept Emails From&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/group&gt;</span>
<span class="nt">&lt;/page&gt;</span>
</pre></div>
</div>
<p >Теперь мы можем изменить адрес псевдонима непосредственно из представления формы и изменить, кто может отправлять электронные письма на псевдоним.</p><p >Затем мы можем переопределить `` message_new () `` в нашей модели расходов, чтобы получить значения из нашего электронного письма, когда счет будет создан:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BusinessExpense</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># Previous code goes here</span>
    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">message_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">custom_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Override to set values according to the email.</span>

<span class="sd">        In this simple example, we simply use the email title as the name</span>
<span class="sd">        of the expense, try to find a partner with this email address and</span>
<span class="sd">        do a regex match to find the amount of the expense.&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">msg_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">,</span> <span class="s1">&#39;New Expense&#39;</span><span class="p">)</span>
        <span class="c1"># Match the last occurence of a float in the string</span>
        <span class="c1"># Example: &#39;50.3 bar 34.5&#39; becomes &#39;34.5&#39;. This is potentially the price</span>
        <span class="c1"># to encode on the expense. If not, take 1.0 instead</span>
        <span class="n">amount_pattern</span> <span class="o">=</span> <span class="s1">&#39;(\d+(\.\d*)?|\.\d+)&#39;</span>
        <span class="n">expense_price</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">amount_pattern</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">expense_price</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">expense_price</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> <span class="mf">1.0</span>
        <span class="c1"># find the partner by looking for it&#39;s email</span>
        <span class="n">partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="n">email_address</span><span class="p">)],</span>
                                                 <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="n">price</span><span class="p">,</span>
            <span class="s1">&#39;partner_id&#39;</span><span class="p">:</span> <span class="n">partner</span><span class="o">.</span><span class="n">id</span>
        <span class="p">}</span>
        <span class="n">defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">custom_values</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">BusinessExpense</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">message_new</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">custom_values</span><span class="o">=</span><span class="n">defaults</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
</div></section><section id="activities-tracking"><i id="reference-mixins-mail-activities"></i><h3 >Отслеживание деятельности</h3><p >Действия - это действия, которые пользователи должны выполнять над документом, такие как телефонный звонок или организация встречи. Действия поставляются с почтовым модулем, поскольку они интегрированы в Chatter, но * не связаны с mail.thread <a href="#id1"><span id="id2" class="problematic">*</span></a>. Действия - это записи класса `` mail.activity``, которые имеют тип (`` mail.activity.type``), имя, описание, запланированное время (среди прочего). Ожидающие действия видны над историей сообщений в виджете болтовни.</p><p >Вы можете интегрировать действия, используя класс `` mail.activity.mixin`` для вашего объекта и специальные виджеты для их отображения (через поле `` activity_ids``) в виде формы и представлении kanban ваших записей (`` mail_activity) Виджеты `` и `` kanban_activity`` соответственно).</p><div role="alert" class="admonition-example alert"><h3 class="alert-title">пример</h3><p >Организация деловой поездки - это утомительный процесс, и отслеживание необходимых действий, таких как заказ авиабилетов или такси в аэропорт, может быть полезным. Для этого мы добавим миксин действий в нашу модель и отобразим следующие запланированные действия в истории сообщений нашей поездки.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BusinessTrip</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;business.trip&#39;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mail.thread&#39;</span><span class="p">,</span> <span class="s1">&#39;mail.activity.mixin&#39;</span><span class="p">]</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Business Trip&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="c1"># [...]</span>
</pre></div>
</div>
<p >Мы изменяем вид формы наших поездок, чтобы отобразить их следующие действия:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;businness_trip_form&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>business.trip.form<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>business.trip<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">&quot;Business Trip&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- Your usual form view goes here --&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_chatter&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;message_follower_ids&quot;</span> <span class="na">widget=</span><span class="s">&quot;mail_followers&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;activity_ids&quot;</span> <span class="na">widget=</span><span class="s">&quot;mail_activity&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;message_ids&quot;</span> <span class="na">widget=</span><span class="s">&quot;mail_thread&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
</div><p >Вы можете найти конкретные примеры интеграции в следующих моделях:</p><ul ><li >`` crm.lead`` в приложении CRM (* crm <a href="#id1"><span id="id2" class="problematic">*</span></a>)</li><li >`` sale.order`` в приложении Sales (* sale <a href="#id1"><span id="id2" class="problematic">*</span></a>)</li><li >`` project.task`` в приложении Project (* poject <a href="#id1"><span id="id2" class="problematic">*</span></a>)</li></ul></section><section id="website-features"><i id="reference-mixins-website"></i><h2 >Особенности сайта</h2></section><section id="visitor-tracking"><i id="reference-mixins-website-utm"></i><h3 >Отслеживание посетителей</h3><p >Класс utm.mixin может использоваться для отслеживания онлайн-маркетинговых / коммуникационных кампаний с помощью аргументов в ссылках на указанные ресурсы. Миксин добавляет 3 поля к вашей модели:</p><ul ><li >Поле `` campaign_id``: <a href="orm.html#odoo.fields.Many2one" title="odoo.fields.Many2one" class="internal reference"><code class="py-class py xref">Many2one</code></a> для объекта` <code >utm.campaign`</code> (т. е. Christmas_Special, Fall_Collection и т. д.)</li><li >Поле `` source_id``: <a href="orm.html#odoo.fields.Many2one" title="odoo.fields.Many2one" class="internal reference"><code class="py-class py xref">Many2one</code></a> для объекта` <code >utm.source`</code> (т. е. поисковая система, список рассылки и т. д.)</li><li >Поле `` medium_id``: <a href="orm.html#odoo.fields.Many2one" title="odoo.fields.Many2one" class="internal reference"><code class="py-class py xref">Many2one</code></a> для объекта` <code >utm.medium`</code> (например, Snail Mail, электронная почта, обновление социальной сети и т. д.)</li></ul><p >Эти модели имеют одно поле `` имя`` (то есть они просто предназначены для различения кампаний, но не имеют определенного поведения).</p><p >Как только клиент заходит на ваш веб-сайт с этими параметрами, заданными в URL (т. Е. <a href="Https://www.odoo.com/?campaign_id=mixin_talk&amp;amp;source_id=www.odoo.com&amp;amp;medium_id=website" class="reference external">Https://www.odoo.com/?campaign_id=mixin_talk&amp;amp;source_id=www.odoo.com&amp;amp;medium_id=website</a>), на веб-сайте посетителя устанавливаются три файла cookie для этих параметров. , Как только объект, который наследует utm.mixin, создается на веб-сайте (т. Е. Ведущая форма, заявка на работу и т. Д.), Код utm.mixin запускается и выбирает значения из файлов cookie, чтобы установить их в новой записи. Как только это будет сделано, вы можете использовать поля кампании / источника / среды как любое другое поле при определении отчетов и представлений (группировка по и т. Д.).</p><p >Чтобы расширить это поведение, просто добавьте реляционное поле в простую модель (модель должна поддерживать * quick create * (то есть вызов `` create () `` с единственным значением `` name``) и расширить функцию ` <code >tracking_fields ()</code> <a href="#id1"><span id="id2" class="problematic">`</span></a>:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UtmMyTrack</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;my_module.my_track&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;My Tracking Object&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Models</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;my_module.my_model&#39;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;utm.mixin&#39;</span><span class="p">]</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;My Tracked Object&#39;</span>

    <span class="n">my_field</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;my_module.my_track&#39;</span><span class="p">,</span> <span class="s1">&#39;My Field&#39;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
    <span class="k">def</span> <span class="nf">tracking_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">MyModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">tracking_fields</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
        <span class="c1"># (&quot;URL_PARAMETER&quot;, &quot;FIELD_NAME_MIXIN&quot;, &quot;NAME_IN_COOKIES&quot;)</span>
            <span class="p">(</span><span class="s1">&#39;my_field&#39;</span><span class="p">,</span> <span class="s1">&#39;my_field&#39;</span><span class="p">,</span> <span class="s1">&#39;odoo_utm_my_field&#39;</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p >Это скажет системе создать cookie с именем * odoo_utm_my_field * со значением, найденным в параметре url `` my_field``; как только новая запись этой модели будет создана с помощью вызова из формы веб-сайта, общее переопределение метода `` create () `` для `` utm.mixin`` извлечет значения по умолчанию для этого поля из файла cookie ( и запись `` my_module.my_track`` будет создана на лету, если она еще не существует).</p><p >Вы можете найти конкретные примеры интеграции в следующих моделях:</p><ul ><li >`` crm.lead`` в приложении CRM (* crm <a href="#id1"><span id="id2" class="problematic">*</span></a>)</li><li >`` hr.applicant`` в приложении процесса найма (* hr_recruitment <a href="#id1"><span id="id2" class="problematic">*</span></a>)</li><li >`` helpdesk.ticket`` в приложении Helpdesk (* helpdesk * - только для Odoo Enterprise)</li></ul></section><section id="website-visibility"><i id="reference-mixins-website-published"></i><h3 >Видимость сайта</h3><p >Вы можете довольно легко добавить переключатель видимости веб-сайта к любой вашей записи. Хотя этот миксин довольно легко реализовать вручную, он наиболее часто используется после наследования `` mail.thread``; свидетельство его полезности. Типичным вариантом использования этого миксина является любой объект, имеющий страницу внешнего интерфейса; возможность контролировать видимость страницы позволяет вам не торопиться при редактировании страницы и публиковать ее только тогда, когда вы довольны.</p><p >Чтобы включить функциональность, вам нужно только унаследовать `` website.published.mixin``:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogPost</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s2">&quot;blog.post&quot;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Blog Post&quot;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;website.published.mixin&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p >Этот миксин добавляет 2 поля вашей модели:</p><ul ><li >`` website_published``: <a href="orm.html#odoo.fields.Boolean" title="odoo.fields.Boolean" class="internal reference"><code class="py-class py xref">Boolean</code></a> поле, которое представляет статус публикации</li><li >`` website_url``:: <a href="orm.html#odoo.fields.Char" title="odoo.fields.Char" class="internal reference"><code class="py-class py xref">Char</code></a> поле, которое представляет URL, через который осуществляется доступ к объекту</li></ul><p >Обратите внимание, что это последнее поле является вычисляемым полем и должно быть реализовано для вашего класса:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_compute_website_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">blog_post</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">blog_post</span><span class="o">.</span><span class="n">website_url</span> <span class="o">=</span> <span class="s2">&quot;/blog/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">log_post</span><span class="o">.</span><span class="n">blog_id</span><span class="p">)</span>
</pre></div>
</div>
<p >Как только механизм будет создан, вам просто нужно адаптировать внешний и внешний вид, чтобы сделать его доступным. В бэкэнде добавление кнопки в поле кнопок обычно является следующим способом:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;oe_stat_button&quot;</span> <span class="na">name=</span><span class="s">&quot;website_publish_button&quot;</span>
    <span class="na">type=</span><span class="s">&quot;object&quot;</span> <span class="na">icon=</span><span class="s">&quot;fa-globe&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;website_published&quot;</span> <span class="na">widget=</span><span class="s">&quot;website_button&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/button&gt;</span>
</pre></div>
</div>
<p >Во внешнем интерфейсе некоторые проверки безопасности необходимы, чтобы не показывать посетителям сайта кнопки «Редакция»:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;website_published_button&quot;</span> <span class="na">class=</span><span class="s">&quot;float-right&quot;</span>
     <span class="na">groups=</span><span class="s">&quot;base.group_website_publisher&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- or any other meaningful group --&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;website.publish_management&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;t</span> <span class="na">t-set=</span><span class="s">&quot;object&quot;</span> <span class="na">t-value=</span><span class="s">&quot;blog_post&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;t</span> <span class="na">t-set=</span><span class="s">&quot;publish_edit&quot;</span> <span class="na">t-value=</span><span class="s">&quot;True&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;t</span> <span class="na">t-set=</span><span class="s">&quot;action&quot;</span> <span class="na">t-value=</span><span class="s">&quot;&#39;blog.blog_post_action&#39;&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p >Обратите внимание, что вы должны передать свой объект как переменную `` object`` в шаблон; в этом примере запись `` blog.post`` была передана как переменная `` blog_post`` движку рендеринга `` qweb``, необходимо указать это в шаблоне управления публикацией. Переменная `` publish_edit`` позволяет кнопке внешнего интерфейса связываться с внутренним интерфейсом (что позволяет легко переключаться с внешнего интерфейса на внутренний и наоборот); если установлено, вы должны указать полный внешний идентификатор действия, которое вы хотите вызвать в бэкэнде, в переменной `` action`` (обратите внимание, что представление формы должно существовать для модели).</p><p >Действие `` website_publish_button`` определено в mixin и адаптирует его поведение к вашему объекту: если у класса есть допустимая вычислительная функция `` website_url``, пользователь перенаправляется на веб-интерфейс, когда нажимает кнопку; пользователь может опубликовать страницу прямо из внешнего интерфейса. Это гарантирует, что никакая онлайн-публикация не может произойти случайно. Если нет функции вычисления, логический `` website_published`` просто запускается.</p></section><section id="website-metadata"><i id="reference-mixins-website-seo"></i><h3 >Метаданные сайта</h3><p >Этот простой миксин позволяет вам легко вставлять метаданные в ваши страницы интерфейса.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogPost</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s2">&quot;blog.post&quot;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Blog Post&quot;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;website.seo.metadata&#39;</span><span class="p">,</span> <span class="s1">&#39;website.published.mixin&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p >Этот миксин добавляет 3 поля вашей модели:</p><ul ><li >Поле `` website_meta_title``: <a href="orm.html#odoo.fields.Char" title="odoo.fields.Char" class="internal reference"><code class="py-class py xref">Char</code></a>, которое позволяет вам задать дополнительный заголовок для вашей страницы.</li><li >Поле `` website_meta_description``: <a href="orm.html#odoo.fields.Char" title="odoo.fields.Char" class="internal reference"><code class="py-class py xref">Char</code></a>, которое содержит краткое описание страницы (иногда используется в результатах поисковых систем).</li><li >Поле `` website_meta_keywords``: <a href="orm.html#odoo.fields.Char" title="odoo.fields.Char" class="internal reference"><code class="py-class py xref">Char</code></a>, которое содержит несколько ключевых слов, которые помогают вашей странице более точно классифицироваться поисковыми системами; инструмент «Содействие» поможет вам легко выбрать ключевые слова, связанные с лексикой</li></ul><p >Эти поля доступны для редактирования во внешнем интерфейсе с помощью инструмента «Продвижение» на панели инструментов редактора. Установка этих полей может помочь поисковым системам лучше индексировать ваши страницы. Обратите внимание, что поисковые системы не основывают свои результаты только на этих метаданных; лучшая практика SEO должна по-прежнему получать ссылки из надежных источников.</p></section><section id="others"><i id="reference-mixins-misc"></i><h2 >другие</h2></section><section id="customer-rating"><i id="reference-mixins-misc-rating"></i><h3 >Рейтинг клиентов</h3><p >Миксин рейтинга позволяет отправлять электронные письма с просьбой о рейтинге клиентов, автоматический переход в канбан-процессы и агрегирование статистики по вашим рейтингам.</p></section><section id="adding-rating-on-your-model"><h4 >Добавление рейтинга на вашу модель</h4><p >Чтобы добавить поддержку рейтинга, просто унаследуйте модель `` rating.mixin``:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Models</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;my_module.my_model&#39;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rating.mixin&#39;</span><span class="p">,</span> <span class="s1">&#39;mail.thread&#39;</span><span class="p">]</span>

    <span class="n">user_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span> <span class="s1">&#39;Responsible&#39;</span><span class="p">)</span>
    <span class="n">partner_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="s1">&#39;Customer&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p >Поведение миксина адаптируется к вашей модели:</p><ul ><li ><p >Запись `` rating.rating`` будет связана с полем `` partner_id`` вашей модели (если поле присутствует).</p><ul ><li >это поведение может быть переопределено функцией `` rating_get_partner_id () <code >, если вы используете другое поле, кроме `` partner_id</code></li></ul></li><li ><p >Запись `` rating.rating`` будет связана с партнером поля `` user_id`` вашей модели (если поле присутствует) (т.е. с партнером, который получил оценку)</p><ul ><li >это поведение можно переопределить с помощью функции `` rating_get_rated_partner_id () <code >, если вы используете другое поле, кроме `` user_id</code> (обратите внимание, что функция должна возвращать `` res.partner``, для `` user_id`` системы) автоматически выбирает партнера пользователя)</li></ul></li><li >История болтовни будет отображать рейтинговое событие (если ваша модель наследует от `` mail.thread``)</li></ul></section><section id="send-rating-requests-by-e-mail"><h4 >Отправить запрос на оценку по электронной почте</h4><p >Если вы хотите отправлять электронные письма для запроса рейтинга, просто создайте электронное письмо со ссылками на объект рейтинга. Очень простой шаблон электронной почты может выглядеть так:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;rating_my_model_email_template&quot;</span> <span class="na">model=</span><span class="s">&quot;mail.template&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>My Model: Rating Request<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;email_from&quot;</span><span class="nt">&gt;</span>${object.rating_get_rated_partner_id().email or &#39;&#39; | safe}<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;subject&quot;</span><span class="nt">&gt;</span>Service Rating Request<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;my_module.model_my_model&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;partner_to&quot;</span> <span class="nt">&gt;</span>${object.rating_get_partner_id().id}<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;auto_delete&quot;</span> <span class="na">eval=</span><span class="s">&quot;True&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;body_html&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">% set access_token = object.rating_get_access_token()</span>
<span class="cp">&lt;p&gt;Hi,&lt;/p&gt;</span>
<span class="cp">&lt;p&gt;How satsified are you?&lt;/p&gt;</span>
<span class="cp">&lt;ul&gt;</span>
<span class="cp">    &lt;li&gt;&lt;a href=&quot;/rating/${access_token}/10&quot;&gt;Satisfied&lt;/a&gt;&lt;/li&gt;</span>
<span class="cp">    &lt;li&gt;&lt;a href=&quot;/rating/${access_token}/5&quot;&gt;Not satisfied&lt;/a&gt;&lt;/li&gt;</span>
<span class="cp">    &lt;li&gt;&lt;a href=&quot;/rating/${access_token}/1&quot;&gt;Very unsatisfied&lt;/a&gt;&lt;/li&gt;</span>
<span class="cp">&lt;/ul&gt;</span>
<span class="cp">]]&gt;</span><span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p >Затем ваш клиент получит электронное письмо со ссылками на простую веб-страницу, которая позволит ему оставить отзыв об их взаимодействии с вашими пользователями (включая сообщение с произвольным текстом).</p><p >Затем вы можете довольно легко интегрировать свои оценки с представлением формы, определив действие для оценок:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;rating_rating_action_my_model&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Customer Ratings<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>rating.rating<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>kanban,pivot,graph<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="nt">&gt;</span>[(&#39;res_model&#39;, &#39;=&#39;, &#39;my_module.my_model&#39;), (&#39;res_id&#39;, &#39;=&#39;, active_id), (&#39;consumed&#39;, &#39;=&#39;, True)]<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;my_module_my_model_view_form_inherit_rating&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>my_module.my_model.view.form.inherit.rating<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>my_module.my_model<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inherit_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;my_module.my_model_view_form&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xpath</span> <span class="na">expr=</span><span class="s">&quot;//div[@name=&#39;button_box&#39;]&quot;</span> <span class="na">position=</span><span class="s">&quot;inside&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">name=</span><span class="s">&quot;%(rating_rating_action_my_model)d&quot;</span> <span class="na">type=</span><span class="s">&quot;action&quot;</span>
                    <span class="na">class=</span><span class="s">&quot;oe_stat_button&quot;</span> <span class="na">icon=</span><span class="s">&quot;fa-smile-o&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;rating_count&quot;</span> <span class="na">string=</span><span class="s">&quot;Rating&quot;</span> <span class="na">widget=</span><span class="s">&quot;statinfo&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;/xpath&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p >Обратите внимание, что существуют рейтинги по умолчанию (kanban, pivot, graph) для рейтингов, которые позволяют вам быстро увидеть рейтинг ваших клиентов.</p><p >Вы можете найти конкретные примеры интеграции в следующих моделях:</p><ul ><li >`` project.task`` в приложении Project (* rating_project <a href="#id1"><span id="id2" class="problematic">*</span></a>)</li><li >`` helpdesk.ticket`` в приложении Helpdesk (* helpdesk * - только для Odoo Enterprise)</li></ul></section>

          </article>
        </div>
        
        <div id="mask"></div>
      </main>
  </div>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
<!-- 
  <footer>
    <div id="footer" class="container">
      <span class="o_logo o_logo_inverse center-block o_footer_logo"></span>
      <div class="row">
        <div class="col-sm-7 col-md-7 col-lg-6">
          <div class="row">
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Community</span>
              <ul>
                <li><a href="https://github.com/odoo/odoo">Github</a></li>
                <li><a href="http://www.odoo.com/page/download">Download</a></li>
                <li class="divider"></li>
                <li><a href="http://runbot.odoo.com/runbot/repo/git-github-com-odoo-enterprise-7">Runbot</a></li>
                <li><a href="https://github.com/odoo/odoo/wiki/Translations">Translations</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/odoo-community">Mailing Lists</a></li>
                <li><a href="http://www.odoo.com/forum/help-1">Forum</a></li>
              </ul>
            </div>
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Services</span>
              <ul>
                <li><a href="https://www.odoo.sh">Odoo Cloud Platform</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/help">Support</a></li>
                <li><a href="https://upgrade.odoo.com">Upgrade</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/partners">Find a partner</a></li>
                <li><a href="http://www.odoo.com/page/become-a-partner">Become a partner</a></li>
                <li class="divider"></li>
                <li><a href="http://training.odoo.com/courses/odoo-functional">Training Center</a></li>
                <li><a href="http://www.odoo.com/page/education-program">Education</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/security">Security</a></li>
              </ul>
            </div>
            <div class="col-xs-12 col-sm-4 mb64">
              <span class="menu_title">About us</span>
              <ul>
                <li><a href="http://www.odoo.com/page/about-us">Our company</a></li>
                <li><a href="http://www.odoo.com/page/contactus">Contact</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/event">Events</a></li>
                <li><a href="http://www.odoo.com/blog">Blog</a></li>
                <li><a href="http://www.odoo.com/blog/6">Customers</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/jobs">Jobs</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/page/legal">Legal</a> | <a href="http://www.odoo.com/privacy">Privacy</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-5 col-md-4 col-md-offset-1 col-lg-5 col-lg-offset-1">
          <p>
            <small>
              Odoo is a suite of open source business apps that cover all your company needs: CRM, eCommerce, accounting, inventory, point of sale, project management, etc.
              <br/><br/>
              Odoo's unique value proposition is to be at the same time very easy to use and fully integrated.
            </small>
          </p>
        </div>
      </div>
    </div>
    <div class="o_footer_bottom">
      <div class="container">
        <a class="small" href="http://www.odoo.com/page/website-builder">Website made with <span class="o_logo o_logo_inverse o_logo_15"></span></a>
        <div class="social-links pull-right">
          <a href="http://www.odoo.com/web/about/facebook"><i class="fa fa-facebook"></i></a>
          <a href="http://www.odoo.com/web/about/twitter"><i class="fa fa-twitter"></i></a>
          <a href="http://www.odoo.com/web/about/linkedin"><i class="fa fa-linkedin"></i></a>
          <a href="mailto:info@odoo.com"><i class="fa fa-envelope"></i></a>
        </div>
      </div>
    </div>
  </footer>
  -->
  </body>
</html>