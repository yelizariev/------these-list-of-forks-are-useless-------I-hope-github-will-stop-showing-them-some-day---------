<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Work+Sans:500,600" rel="stylesheet">
  
    <title>Тестирование Odoo &#8212; Документация odoo 13.0</title>
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/patchqueue.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script><link rel="canonical" href="" />
  
    <link rel="index" title="Алфавитный указатель" href="../genindex.html" />
    <link rel="search" title="Поиск" href="../search.html" />
    <link rel="next" title="Веб-контроллеры" href="http.html" />
    <link rel="prev" title="Безопасность в Odoo" href="security.html" /> 
  </head><body><header class="o_main_header o_has_sub_nav o_inverted ">
<!-- 
    <div class="o_main_header_main">
      <a class="pull-left o_logo" href="/"></a>
      <a href="#" class="o_mobile_menu_toggle visible-xs-block pull-right">
        <span class="sr-only">Toggle navigation</span>
        <span class="mdi-navigation-menu"></span>
      </a>
      <div class="o_header_buttons">
        <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
      </div>
      <ul class="o_primary_nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Apps</a>
          <div class="dropdown-menu o_secondary_nav">
            <div class="container">
              <div class="row">
                <div class="col-sm-3 o_website_apps">
                  <div class="o_nav_app_family">
                    <span></span> Websites
                    <div>Build great user experience</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/website-builder">Website Builder</a></li>
                    <li><a href="https://www.odoo.com/page/e-commerce">eCommerce</a></li>
                    <li><a href="https://www.odoo.com/page/blog-engine">Blogs</a></li>
                    <li><a href="https://www.odoo.com/page/community-builder">Forums</a></li>
                    <li><a href="https://www.odoo.com/page/slides">Slides</a></li>
                    <li><a href="https://adspike.odoo.com">SEA</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_sale_apps">
                  <div class="o_nav_app_family">
                    <span></span> Sales
                    <div>Boost your success rate</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/sales">Sales</a></li>
                    <li><a href="https://www.odoo.com/page/crm">CRM</a></li>
                    <li><a href="https://www.odoo.com/page/billing">Invoicing</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Point of Sale</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/point-of-sale">Shops</a></li>
                        <li><a href="https://www.odoo.com/page/pos-restaurant">Restaurants</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/subscriptions">Subscriptions</a></li>
                    <li><a href="https://www.odoo.com/page/sign">Sign</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_operation_apps">
                  <div class="o_nav_app_family">
                    <span></span> Operations
                    <div>It's all about efficiency</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/accounting">Accounting</a></li>
                    <li><a href="https://www.odoo.com/page/project-management">Project</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Human Resources</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/recruitment">Recruitment</a></li>
                        <li><a href="https://www.odoo.com/page/employees">Employees</a></li>
                        <li><a href="https://www.odoo.com/page/expenses">Expenses</a></li>
                        <li><a href="https://www.odoo.com/page/appraisal">Appraisal</a></li>
                        <li><a href="https://www.odoo.com/page/fleet">Fleet</a></li>
                        <li><a href="https://www.odoo.com/page/leaves">Leaves</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/warehouse">Inventory</a></li>
                    <li><a href="https://www.odoo.com/page/purchase">Purchase</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Manufacturing</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/manufacturing">MRP</a></li>
                        <li><a href="https://www.odoo.com/page/plm">PLM</a></li>
                        <li><a href="https://www.odoo.com/page/maintenance">Maintenance</a></li>
                        <li><a href="https://www.odoo.com/page/quality">Quality</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-sm-3 o_productivity_apps">
                  <div class="o_nav_app_family">
                    <span></span> Productivity Tools
                    <div>Great Tools = Happy People</div>
                  </div>
                  <ul>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Communication</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/discuss">Discuss</a></li>
                        <li><a href="https://www.odoo.com/page/discuss-groups">Mailing Lists</a></li>
                        <li><a href="https://www.odoo.com/page/notes">Notes</a></li>
                        <li><a href="#">Help desk</a></li>
                        <li><a href="#">Appointment</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/timesheet">Timesheet</a></li>
                    <li><a href="https://www.odoo.com/page/email-marketing">Email Marketing</a></li>
                    <li><a href="https://www.odoo.com/page/events">Events</a></li>
                    <li><a href="https://www.odoo.com/page/survey">Survey</a></li>
                    <li><a href="https://www.odoo.com/page/live-chat">Live Chat</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <a href="http://www.odoo.com/apps/modules" class="o_store_link"><i class="fa fa-cube fa-fw"></i> Third party apps</a>
          </div>
        </li>
        <li><a href="https://www.odoo.com/page/tour">Tour</a></li>
        <li><a href="https://www.odoo.com/pricing">Pricing</a></li>
        <li><a href="https://www.odoo.com/page/docs">Docs</a></li>
      </ul>
    </div>
-->
    <nav class="navbar o_sub_nav">
      <div class="container">
        <div class="navbar-header visible-xs">
            <button type="button" class="navbar-toggle collapsed text-left btn-block" data-toggle="collapse" data-target="#o_sub-menu" aria-expanded="false">
              Navigate
              <span class="mdi-hardware-keyboard-arrow-down pull-right"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="o_sub-menu">
          <ol class="o_breadcrumb breadcrumb nav navbar-left">
              
              





    
        
            <li><a href="../index.html">Developer Doc</a></li>
        
    
    <li class="active"><a href="#">Тестирование Odoo</a></li>

              
          </ol>

          <div class="call-to-action navbar-right hidden-xs">
            <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
          </div>

          <ul class="navbar-nav navbar-right nav o_sub_nav_actions">
            
              <li class="divider"></li>
            

            
            


            
          </ul>

          <ul class="nav navbar-nav navbar-right">
            

            
            
<!--
<li><a href="https://www.odoo.com/documentation/user/13.0/index.html">User</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/index.html">Developer</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/setup/install.html">Installation</a></li>
<li><a href="https://odoo.com/slides">eLearning</a></li>
<li><a href="https://www.odoo.com/page/odoo-white-paper">White Papers</a></li>
<li><a href="https://www.odoo.com/page/legal">Legal</a></li>
-->
            

            
          </ul>
        </div>
      </div>
    </nav>
  </header><div id="wrap" class="">
    
    
    
    <figure class="card top has_banner">
      <span class="card-img" style="background-image: url('../_static/banners/testing_modules.jpg');"></span>
      <div class="container text-center">
        <h1> Тестирование Odoo </h1>
      </div>
    </figure>
    
    
    
      <main class="container ">
        
        <div class="o_content row">
          
          <aside>
            <div class="navbar-aside text-center">
              <ul class="nav list-group text-left"><li class="list-group-item"><a href="#testing-python-code" class="reference internal ripple">Тестирование кода Python</a><ul ><li class="list-group-item"><a href="#running-tests" class="reference internal ripple">Запуск тестов</a></li><li class="list-group-item"><a href="#test-selection" class="reference internal ripple">Тестовый выбор</a><ul ><li class="list-group-item"><a href="#invocation" class="reference internal ripple">мольба</a></li><li class="list-group-item"><a href="#special-tags" class="reference internal ripple">Специальные теги</a></li><li class="list-group-item"><a href="#examples" class="reference internal ripple">Примеры</a></li></ul></li></ul></li><li class="list-group-item"><a href="#testing-js-code" class="reference internal ripple">Тестирование кода JS</a><ul ><li class="list-group-item"><a href="#qunit-test-suite" class="reference internal ripple">Тестовый набор Qunit</a></li><li class="list-group-item"><a href="#testing-infrastructure" class="reference internal ripple">Инфраструктура тестирования</a></li><li class="list-group-item"><a href="#modularity-and-testing" class="reference internal ripple">Модульность и тестирование</a></li><li class="list-group-item"><a href="#adding-a-new-test-case" class="reference internal ripple">Добавление нового теста</a></li><li class="list-group-item"><a href="#helper-functions-and-specialized-assertions" class="reference internal ripple">Вспомогательные функции и специализированные утверждения</a></li><li class="list-group-item"><a href="#best-practices" class="reference internal ripple">Лучшие практики</a></li><li class="list-group-item"><a href="#tips" class="reference internal ripple">подсказки</a></li></ul></li><li class="list-group-item"><a href="#integration-testing" class="reference internal ripple">Интеграционное тестирование</a><ul ><li class="list-group-item"><a href="#screenshots-and-screencasts-during-browser-js-tests" class="reference internal ripple">Скриншоты и скриншоты во время тестов browser_js</a></li></ul></li></ul>
              
              <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/13.0/doc/reference/testing.rst" class="gith-link">
                  Edit on GitHub
              </a></p>
              
            </div>
          </aside>
          
          <article class="doc-body ">
            
            
  <section id="testing-odoo"><i id="reference-testing"></i><p >Есть много способов протестировать приложение. В Odoo у нас есть три вида тестов</p><ul ><li >Модульные тесты Python (см. «Тестирование кода Python»): полезны для тестирования бизнес-логики модели</li><li >Модульные тесты JS (см. «Тестирование кода JS»): полезно для тестирования кода javascript в отдельности</li><li >Туры (см. «Интеграционное тестирование»): туры имитируют реальную ситуацию. Они гарантируют, что части python и javascript правильно общаются друг с другом.</li></ul></section><section id="testing-python-code"><h2 >Тестирование кода Python</h2><p >Odoo предоставляет поддержку для тестирования модулей с использованием unittest.</p><p >Чтобы написать тесты, просто определите подпакет `` tests`` в вашем модуле, он будет автоматически проверен на наличие тестовых модулей. Тестовые модули должны иметь имя, начинающееся с `` test_``, и должны быть импортированы из `` tests / __ init __. Py``, например</p><div class="highlight-text"><div class="highlight"><pre><span></span>your_module
|-- ...
`-- tests
    |-- __init__.py
    |-- test_bar.py
    `-- test_foo.py
</pre></div>
</div>
<p >и `` __init __. py`` содержит</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">test_foo</span><span class="p">,</span> <span class="n">test_bar</span>
</pre></div>
</div>
<div role="alert" class="alert alert-warning"><h3 class="alert-title">Предупреждение</h3><p >тестовые модули, которые не импортированы из `` tests / __ init __. py``, не будут запущены</p></div><p >Организатор теста просто запустит любой тестовый случай, как описано в официальной <a href="https://docs.python.org/3/library/unittest.html" class="external reference">документации для unittest</a>, но Odoo предоставляет ряд утилит и помощников, связанных с тестированием контента Odoo (в основном модулей):</p><section class="code-class"><h6 id="odoo.tests.common.TransactionCase"><code><em >class </em>odoo.tests.common.TransactionCase(<em>methodName='runTest'</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L419" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >TestCase, в котором каждый метод теста запускается в своей собственной транзакции и со своим собственным курсором. Откат транзакции и курсор закрывается после каждого теста.</p><section class="code-method"><h6 id="odoo.tests.common.TransactionCase.browse_ref"><code>browse_ref(<em>xid</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L235" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Возвращает объект записи для предоставленного: term: <code >external identifier</code></p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >xid</strong> – полностью определено: term: <code >external identifier</code>, в форме: samp:` {module}. {identifier} `</div></div><div class="code-field"><div class="code-field-name">повышение</div><div class="code-field-body">ValueError, если не найден</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">: Класс: <code >~ odoo.models.BaseModel</code></div></div></div></section><section class="code-method"><h6 id="odoo.tests.common.TransactionCase.ref"><code>ref(<em>xid</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L224" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Возвращает идентификатор базы данных для предоставленного: term: <code >внешний идентификатор</code>, ярлык для` <code >get_object_reference`</code></p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >xid</strong> – полностью определено: term: <code >external identifier</code>, в форме: samp:` {module}. {identifier} `</div></div><div class="code-field"><div class="code-field-name">повышение</div><div class="code-field-body">ValueError, если не найден</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">зарегистрированный идентификатор</div></div></div></section></section><section class="code-class"><h6 id="odoo.tests.common.SingleTransactionCase"><code><em >class </em>odoo.tests.common.SingleTransactionCase(<em>methodName='runTest'</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L452" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >TestCase, в котором все методы тестирования выполняются в одной и той же транзакции, транзакция запускается с первым методом тестирования и откатывается в конце последней.</p><section class="code-method"><h6 id="odoo.tests.common.SingleTransactionCase.browse_ref"><code>browse_ref(<em>xid</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L235" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Возвращает объект записи для предоставленного: term: <code >external identifier</code></p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >xid</strong> – полностью определено: term: <code >external identifier</code>, в форме: samp:` {module}. {identifier} `</div></div><div class="code-field"><div class="code-field-name">повышение</div><div class="code-field-body">ValueError, если не найден</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">: Класс: <code >~ odoo.models.BaseModel</code></div></div></div></section><section class="code-method"><h6 id="odoo.tests.common.SingleTransactionCase.ref"><code>ref(<em>xid</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L224" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Возвращает идентификатор базы данных для предоставленного: term: <code >внешний идентификатор</code>, ярлык для` <code >get_object_reference`</code></p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >xid</strong> – полностью определено: term: <code >external identifier</code>, в форме: samp:` {module}. {identifier} `</div></div><div class="code-field"><div class="code-field-name">повышение</div><div class="code-field-body">ValueError, если не найден</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">зарегистрированный идентификатор</div></div></div></section></section><section class="code-class"><h6 id="odoo.tests.common.SavepointCase"><code><em >class </em>odoo.tests.common.SavepointCase(<em>methodName='runTest'</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L480" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Аналогично <a href="#odoo.tests.common.SingleTransactionCase" title="odoo.tests.common.SingleTransactionCase" class="alert-link reference internal"><code class="xref py py-class">SingleTransactionCase</code></a> в том, что все методы тестирования выполняются в одной транзакции <a href="#id1"><span id="id2" class="problematic">*</span></a>, но * каждый тестовый случай выполняется в откатанной точке сохранения (под-транзакции).</p><p >Полезно для тестовых случаев, содержащих быстрые тесты, но со значительной настройкой базы данных, общей для всех случаев (сложные тестовые данные in-db): данные, не влияя друг на друга, но без необходимости повторного создания тестовых данных.</p></section><section class="code-class"><h6 id="odoo.tests.common.HttpCase"><code><em >class </em>odoo.tests.common.HttpCase(<em>methodName='runTest'</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L1073" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Транзакционный HTTP TestCase с url_open и безголовыми помощниками Chrome.</p><section class="code-method"><h6 id="odoo.tests.common.HttpCase.browse_ref"><code>browse_ref(<em>xid</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L235" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Возвращает объект записи для предоставленного: term: <code >external identifier</code></p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >xid</strong> – полностью определено: term: <code >external identifier</code>, в форме: samp:` {module}. {identifier} `</div></div><div class="code-field"><div class="code-field-name">повышение</div><div class="code-field-body">ValueError, если не найден</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">: Класс: <code >~ odoo.models.BaseModel</code></div></div></div></section><section class="code-method"><h6 id="odoo.tests.common.HttpCase.phantom_js"><code>phantom_js(<em>url_path</em>, <em>code</em>, <em>ready=''</em>, <em>login=None</em>, <em>timeout=60</em>, <em>**kw</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L1181" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Проверьте js-код, работающий в браузере - при необходимости войдите в систему как 'login' - загрузите страницу, заданную url_path - дождитесь готовности готового объекта - eval (код) внутри страницы</p><p >To signal success test do: console.log(„test successful“)
To signal test failure raise an exception or call console.error</p></section><section class="code-method"><h6 id="odoo.tests.common.HttpCase.ref"><code>ref(<em>xid</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L224" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Возвращает идентификатор базы данных для предоставленного: term: <code >внешний идентификатор</code>, ярлык для` <code >get_object_reference`</code></p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >xid</strong> – полностью определено: term: <code >external identifier</code>, в форме: samp:` {module}. {identifier} `</div></div><div class="code-field"><div class="code-field-name">повышение</div><div class="code-field-body">ValueError, если не найден</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">зарегистрированный идентификатор</div></div></div></section></section><section class="code-function"><h6 id="odoo.tests.common.tagged"><code>odoo.tests.common.tagged(<em>*tags</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L2235" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Декоратор для тегирования объектов BaseCase Теги хранятся в наборе, доступ к которому можно получить из атрибута «test_tags». Тег с префиксом «-» удалит тег, например, для удаления «стандартного» тега. По умолчанию все классы Test из odoo. У test.common есть атрибут test_tags, который по умолчанию равен стандарту, а также техническое имя модуля. При использовании наследования классов теги НЕ наследуются.</p></section><p >По умолчанию тесты запускаются один раз сразу после установки соответствующего модуля. Тестовые случаи также можно настроить для запуска после установки всех модулей, а не для запуска сразу после установки модуля:</p><section class="code-function"><h6 id="odoo.tests.common.at_install"><code>odoo.tests.common.at_install(<em>flag</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L92" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Устанавливает состояние теста при установке, флаг является логическим значением, определяющим, должен ли тест (`` True``) или не ((<code >False`</code>) выполняться во время установки модуля).</p><p >По умолчанию тесты запускаются сразу после установки модуля, перед началом установки следующего модуля.</p><div class="deprecated"><p ><span class="versionmodified">Не рекомендуется, начиная с версии 12.0: </span>`` at_install`` теперь является флагом, вы можете использовать <a href="#odoo.tests.common.tagged" title="odoo.tests.common.tagged" class="alert-link reference internal"><code class="xref py py-func">tagged()</code></a>, чтобы добавить / удалить его, хотя` <code >tagged`</code> работает только на тестовых классах</p></div></section><section class="code-function"><h6 id="odoo.tests.common.post_install"><code>odoo.tests.common.post_install(<em>flag</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L107" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Устанавливает состояние после установки теста. Флаг является логическим значением, указывающим, должен ли тест выполняться или не запускаться после набора установок модуля.</p><p >По умолчанию тесты * не * запускаются после установки всех модулей в текущем наборе установки.</p><div class="deprecated"><p ><span class="versionmodified">Не рекомендуется, начиная с версии 12.0: </span>`` post_install`` теперь является флагом, вы можете использовать <a href="#odoo.tests.common.tagged" title="odoo.tests.common.tagged" class="alert-link reference internal"><code class="xref py py-func">tagged()</code></a>, чтобы добавить / удалить его, хотя` <code >tagged`</code> работает только на тестовых классах</p></div></section><p >Наиболее распространенной ситуацией является использование <a href="#odoo.tests.common.TransactionCase" title="odoo.tests.common.TransactionCase" class="reference internal"><code class="xref py py-class">TransactionCase</code></a> и тестирование свойства модели в каждом методе:</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestModelA</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">TransactionCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_some_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;model.a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">})</span>
        <span class="n">record</span><span class="o">.</span><span class="n">some_action</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">record</span><span class="o">.</span><span class="n">field</span><span class="p">,</span>
            <span class="n">expected_field_value</span><span class="p">)</span>

    <span class="c1"># other tests...</span>
</pre></div>
</div>
<div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Методы тестирования должны начинаться с `` test_``</p></div><section class="code-class"><h6 id="odoo.tests.common.Form"><code><em >class </em>odoo.tests.common.Form(<em>recordp</em>, <em>view=None</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L1336" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Реализация представления формы на стороне сервера (частично)</p><p >Реализует большую часть потока манипуляций с «представлением формы», так что тесты на стороне сервера могут более правильно отражать поведение, которое наблюдается при манипулировании интерфейсом:</p><ul ><li >вызовите default_get и соответствующие изменения на <code >создание</code></li><li >позвоните в соответствующие органы по настройке полей</li><li >правильно обрабатывать значения по умолчанию и изменения вокруг полей x2many</li></ul><p >Сохранение формы возвращает созданную запись, если в режиме создания.</p><p >Регулярные поля могут быть просто назначены непосредственно в форме, для полей <a href="orm.html#odoo.fields.Many2one" title="odoo.fields.Many2one" class="alert-link reference internal"><code class="xref py py-class">Many2one</code></a> назначается одноэлементный набор записей</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># empty recordset =&gt; creation mode</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">Form</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;sale.order&#39;</span><span class="p">])</span>
<span class="n">f</span><span class="o">.</span><span class="n">partner_id</span> <span class="o">=</span> <span class="n">a_partner</span>
<span class="n">so</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p >При редактировании записи, используя форму в качестве менеджера контекста, вы автоматически сохраняете ее в конце области</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Form</span><span class="p">(</span><span class="n">so</span><span class="p">)</span> <span class="k">as</span> <span class="n">f2</span><span class="p">:</span>
    <span class="n">f2</span><span class="o">.</span><span class="n">payment_term_id</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;account.account_payment_term_15days&#39;</span><span class="p">)</span>
    <span class="c1"># f2 is saved here</span>
</pre></div>
</div>
<p >Для полей <a href="orm.html#odoo.fields.Many2many" title="odoo.fields.Many2many" class="alert-link reference internal"><code class="xref py py-class">Many2many</code></a> само поле является <a href="orm.html#odoo.fields.Many2many" title="odoo.fields.Many2many" class="alert-link reference internal"><code class="xref py py-class">Many2many</code></a> и может быть изменено путем добавления или удаления records</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Form</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="k">as</span> <span class="n">u</span><span class="p">:</span>
    <span class="n">u</span><span class="o">.</span><span class="n">groups_id</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;account.group_account_manager&#39;</span><span class="p">))</span>
    <span class="n">u</span><span class="o">.</span><span class="n">groups_id</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.group_portal&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
<p >Наконец <a href="orm.html#odoo.fields.One2many" title="odoo.fields.One2many" class="alert-link reference internal"><code class="xref py py-class">One2many</code></a> имеют вид <a href="orm.html#odoo.fields.One2many" title="odoo.fields.One2many" class="alert-link reference internal"><code class="xref py py-class">One2many</code></a>.</p><p >Поскольку <a href="orm.html#odoo.fields.One2many" title="odoo.fields.One2many" class="alert-link reference internal"><code class="xref py py-class">One2many</code></a> существует только через своего родителя, он более непосредственно управляется путем создания« подформ »с помощью <a href="#odoo.tests.common.O2MProxy.new" title="odoo.tests.common.O2MProxy.new" class="alert-link reference internal"><code class="py-meth xref py">new()</code></a> и: Методы: <code >~ odoo.tests.common.O2MProxy.edit</code>. Обычно они используются как менеджеры контекста, так как они сохраняются в родительской записи:</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Form</span><span class="p">(</span><span class="n">so</span><span class="p">)</span> <span class="k">as</span> <span class="n">f3</span><span class="p">:</span>
    <span class="c1"># add support</span>
    <span class="k">with</span> <span class="n">f3</span><span class="o">.</span><span class="n">order_line</span><span class="o">.</span><span class="n">new</span><span class="p">()</span> <span class="k">as</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">line</span><span class="o">.</span><span class="n">product_id</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;product.product_product_2&#39;</span><span class="p">)</span>
    <span class="c1"># add a computer</span>
    <span class="k">with</span> <span class="n">f3</span><span class="o">.</span><span class="n">order_line</span><span class="o">.</span><span class="n">new</span><span class="p">()</span> <span class="k">as</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">line</span><span class="o">.</span><span class="n">product_id</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;product.product_product_3&#39;</span><span class="p">)</span>
    <span class="c1"># we actually want 5 computers</span>
    <span class="k">with</span> <span class="n">f3</span><span class="o">.</span><span class="n">order_line</span><span class="o">.</span><span class="n">edit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">line</span><span class="o">.</span><span class="n">product_uom_qty</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="c1"># remove support</span>
    <span class="n">f3</span><span class="o">.</span><span class="n">order_line</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># SO is saved here</span>
</pre></div>
</div>
<div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><ul ><li ><strong >recordp</strong> (<a href="orm.html#odoo.models.Model" title="odoo.models.Model" class="alert-link reference internal"><code >odoo.models.Model</code></a>) – пустой или одиночный набор записей. Пустой набор записей переведет представление в режим «создания» и вызовет вызовы default_get и on-load onchanges, а синглтон переведет его в режим «редактирования» и загрузит только данные представления.</li><li ><strong >view</strong> (<code >int | str | odoo.model.Model</code>) – id, xmlid или фактический объект представления, чтобы использовать для onchanges и ограничений представления. Если ничего не указано, просто загружается представление по умолчанию для модели.</li></ul></div></div></div><div class="versionadded"><p ><span class="versionmodified">Добавлено в версии 12.0.</span></p></div><section class="code-method"><h6 id="odoo.tests.common.Form.save"><code>save()<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L1689" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Сохраняет форму, возвращает созданную запись, если применимо</p><ul ><li >не сохраняет `` readonly`` поля</li><li >не сохраняет неизмененные поля (во время редактирования) - любое присваивание или возвращение onchange помечает поле как измененное, даже если установлено его текущее значение</li></ul><div class="code-fields"><div class="code-field"><div class="code-field-name">Исключение</div><div class="code-field-body"><a href="https://docs.python.org/3/library/exceptions.html#AssertionError" title="(в Python v3.8)" class="external reference alert-link"><strong >AssertionError</strong></a> – если в форме есть незаполненное обязательное поле</div></div></div></section></section><section class="code-class"><h6 id="odoo.tests.common.M2MProxy"><code><em >class </em>odoo.tests.common.M2MProxy<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L2118" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Ведет себя как <code class="xref py py-class">Sequence</code> наборов записей, может быть проиндексирован или разрезан для получения реальных базовых наборов записей.</p><section class="code-method"><h6 id="odoo.tests.common.M2MProxy.add"><code>add(<em>record</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L2147" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Добавляет `` record`` в поле, запись уже должна существовать.</p><p >Добавление будет завершено только после сохранения родительской записи.</p></section><section class="code-method"><h6 id="odoo.tests.common.M2MProxy.clear"><code>clear()<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L2184" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Удаляет все существующие записи в м2</p></section><section class="code-method"><h6 id="odoo.tests.common.M2MProxy.remove"><code>remove(<em>id=None</em>, <em>index=None</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L2167" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Удаляет запись с определенным индексом или с указанным идентификатором из поля.</p></section></section><section class="code-class"><h6 id="odoo.tests.common.O2MProxy"><code><em >class </em>odoo.tests.common.O2MProxy<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L2016" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><section class="code-method"><h6 id="odoo.tests.common.O2MProxy.edit"><code>edit(<em>index</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L2083" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Возвращает <a href="#odoo.tests.common.Form" title="odoo.tests.common.Form" class="alert-link reference internal"><code class="xref py py-class">Form</code></a> для редактирования существующей записи <a href="#odoo.tests.common.Form" title="odoo.tests.common.Form" class="alert-link reference internal"><code class="xref py py-class">Form</code></a>.</p><p >Форма создается из списка, если он доступен для редактирования, или из формы поля в противном случае.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Исключение</div><div class="code-field-body"><a href="https://docs.python.org/3/library/exceptions.html#AssertionError" title="(в Python v3.8)" class="external reference alert-link"><strong >AssertionError</strong></a> – если поле не доступно для редактирования</div></div></div></section><section class="code-method"><h6 id="odoo.tests.common.O2MProxy.new"><code>new()<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L2071" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Возвращает <a href="#odoo.tests.common.Form" title="odoo.tests.common.Form" class="alert-link reference internal"><code class="xref py py-class">Form</code></a> для новой записи <a href="#odoo.tests.common.Form" title="odoo.tests.common.Form" class="alert-link reference internal"><code class="xref py py-class">Form</code></a>, правильно инициализированной.</p><p >Форма создается из списка, если он доступен для редактирования, или из формы поля в противном случае.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Исключение</div><div class="code-field-body"><a href="https://docs.python.org/3/library/exceptions.html#AssertionError" title="(в Python v3.8)" class="external reference alert-link"><strong >AssertionError</strong></a> – если поле не доступно для редактирования</div></div></div></section><section class="code-method"><h6 id="odoo.tests.common.O2MProxy.remove"><code>remove(<em>index</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L2095" class="external reference alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Удаляет запись в `` index`` из родительской формы.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Исключение</div><div class="code-field-body"><a href="https://docs.python.org/3/library/exceptions.html#AssertionError" title="(в Python v3.8)" class="external reference alert-link"><strong >AssertionError</strong></a> – если поле не доступно для редактирования</div></div></div></section></section></section><section id="running-tests"><h3 >Запуск тестов</h3><p >Тесты автоматически запускаются при установке или обновлении модулей, если: option: <a href="#id1"><span id="id2" class="problematic">`</span></a>–test-enable &lt;odoo-bin –test-enable&gt; <a href="#id3"><span id="id4" class="problematic">`</span></a>был включен при запуске сервера Odoo.</p></section><section id="test-selection"><h3 >Тестовый выбор</h3><p >В Odoo тесты Python могут быть помечены для облегчения выбора тестов при запуске тестов.</p><p >Подклассы <code class="xref py py-class">odoo.tests.common.BaseCase</code> (обычно через <code class="xref py py-class">odoo.tests.common.BaseCase</code>, <code class="xref py py-class">odoo.tests.common.BaseCase</code> или <code class="xref py py-class">odoo.tests.common.BaseCase</code>) автоматически помечаются как `` standard``, `` at_install`` и именем их исходного модуля по умолчанию.</p></section><section id="invocation"><h4 >мольба</h4><p >: Опция: <a href="#id1"><span id="id2" class="problematic">`</span></a>–test-теги &lt;odoo-bin –test-tags&gt; <a href="#id3"><span id="id4" class="problematic">`</span></a>может использоваться для выбора / фильтрации тестов для запуска в командной строке.</p><p >Эта опция по умолчанию имеет значение `` + standard``, что означает, что тесты с тегом `` standard`` (явно или неявно) будут запускаться по умолчанию при запуске Odoo с: option: <a href="#id1"><span id="id2" class="problematic">`</span></a>–test-enable &lt;odoo-bin –test-enable&gt; <a href="#id3"><span id="id4" class="problematic">`</span></a>.</p><p >При написании тестов декоратор <a href="#odoo.tests.common.tagged" title="odoo.tests.common.tagged" class="reference internal"><code class="xref py py-func">tagged()</code></a> можно использовать в ** тестовых классах ** для добавления или удаления тегов.</p><p >Аргументы декоратора - это имена тегов в виде строк.</p><div role="alert" class="alert alert-danger"><h3 class="alert-title">Опасно</h3><p ><a href="#odoo.tests.common.tagged" title="odoo.tests.common.tagged" class="alert-link reference internal"><code class="xref py py-func">tagged()</code></a> is a class decorator, it has no
effect on functions or methods</p></div><p >Теги могут иметь префикс со знаком минус (`` -<code >), чтобы * удалить * их вместо добавления или выбрать их, например, если вы не хотите, чтобы ваш тест выполнялся по умолчанию, вы можете удалить `` standard</code> тег:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">odoo.tests</span> <span class="kn">import</span> <span class="n">TransactionCase</span><span class="p">,</span> <span class="n">tagged</span>

<span class="nd">@tagged</span><span class="p">(</span><span class="s1">&#39;-standard&#39;</span><span class="p">,</span> <span class="s1">&#39;nice&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">NiceTest</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p >Этот тест не будет выбран по умолчанию, для его запуска соответствующий тег должен быть выбран явно:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> odoo-bin --test-enable --test-tags nice
</pre></div>
</div>
<p >Обратите внимание, что будут выполняться только тесты с тегом `` nice``. Для запуска * обоих * `` nice`` и `` standard``, укажите несколько значений для: option: <a href="#id1"><span id="id2" class="problematic">`</span></a>–test-tags &lt;odoo-bin –test-tags&gt; <a href="#id3"><span id="id4" class="problematic">`</span></a>: в командной строке значения являются * аддитивными * (вы выбираете все тесты с * любым * из указанных тегов)</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> odoo-bin --test-enable --test-tags nice,standard
</pre></div>
</div>
<p >Параметр config switch также принимает префиксы `` + `` и `` -<code >. Префикс `` + `` подразумевается и, следовательно, полностью необязателен. Префикс `` -</code> (минус) предназначен для отмены выбора тестов, помеченных префиксными тегами, даже если они выбраны другими указанными тегами, например, если существуют `` стандартные`` тесты, которые также помечены как `` slow`` Вы можете запустить все стандартные тесты * кроме * медленных:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> odoo-bin --test-enable --test-tags <span class="s1">&#39;standard,-slow&#39;</span>
</pre></div>
</div>
<p >Когда вы пишете тест, который не наследуется от <code class="xref py py-class">BaseCase</code>, этот тест не будет иметь тегов по умолчанию, вы должны добавить их явно, чтобы тест был включен в набор тестов по умолчанию , Это распространенная проблема при использовании простого `` unittest.TestCase``, так как они не запускаются:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">odoo.tests</span> <span class="kn">import</span> <span class="n">tagged</span>

<span class="nd">@tagged</span><span class="p">(</span><span class="s1">&#39;standard&#39;</span><span class="p">,</span> <span class="s1">&#39;at_install&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">SmallTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</section><section id="special-tags"><h4 >Специальные теги</h4><ul ><li ><p >`` standard``: Все тесты Odoo, которые наследуются от <code class="xref py py-class">BaseCase</code>, неявно помечены как стандартные. : Опция: <code >--test-теги &lt;odoo-bin --test-tags&gt; `также по умолчанию</code> <code >стандарт`</code>.</p><p >Это означает, что тест без тегов будет выполняться по умолчанию, когда тесты включены.</p></li><li >`` at_install``: означает, что тест будет выполнен сразу после установки модуля и до установки других модулей. Это неявный тег по умолчанию.</li><li ><p >`` post_install``: означает, что тест будет выполнен после установки всех модулей. Это то, что вы хотите для тестов HttpCase большую часть времени.</p><p >Обратите внимание, что это * не исключительно * с `` at_install``, однако, поскольку вы, как правило, не хотите, чтобы оба `` post_install`` обычно сопряжены с `` -at_install`` при пометке тестового класса.</p></li><li ><p ><em >module_name</em>: Odoo tests classes extending
<code class="xref py py-class">BaseCase</code> are implicitely tagged with the
technical name of their module. This allows easily selecting or excluding
specific modules when testing e.g. if you want to only run tests from
<code >stock_account</code>:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> odoo-bin --test-enable --test-tags stock_account
</pre></div>
</div>
</li></ul></section><section id="examples"><h4 >Примеры</h4><div role="alert" class="alert alert-warning"><h3 class="alert-title">Важно</h3><p >Тесты будут выполняться только в установленных или обновленных модулях. Поэтому модули должны выбираться с помощью опции: option: <code >-u &lt;odoo-bin -u&gt; `или: опция:</code> -i &lt;odoo-bin -i&gt; переключатели. Для простоты эти переключатели не указаны в приведенных ниже примерах.</p></div><p >Запустите только тесты из модуля продажи:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> odoo-bin --test-enable --test-tags sale
</pre></div>
</div>
<p >Запустите тесты из модуля продажи, но не помеченные как медленные:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> odoo-bin --test-enable --test-tags <span class="s1">&#39;sale,-slow&#39;</span>
</pre></div>
</div>
<p >Запускайте только тесты со склада или помеченные как медленные:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> odoo-bin --test-enable --test-tags <span class="s1">&#39;-standard, slow, stock&#39;</span>
</pre></div>
</div>
<div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >`` -standard`` является неявным (не обязательным) и представлен для ясности</p></div></section><section id="testing-js-code"><h2 >Тестирование кода JS</h2><p >Тестирование сложной системы является важной гарантией предотвращения регрессий и гарантии того, что некоторые основные функции все еще работают. Поскольку Odoo имеет нетривиальную кодовую базу в Javascript, необходимо протестировать ее. В этом разделе мы обсудим практику тестирования кода JS изолированно: эти тесты остаются в браузере и не должны достигать сервера.</p></section><section id="qunit-test-suite"><h3 >Тестовый набор Qunit</h3><p >Каркас Odoo использует каркас тестирования библиотеки <a href="https://qunitjs.com/" class="external reference">QUnit</a> в качестве тестового прогона. QUnit определяет понятия * tests * и * modules * (набор связанных тестов) и предоставляет нам веб-интерфейс для выполнения тестов.</p><p >Например, вот как может выглядеть тест pyUtils:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;py_utils&#39;</span><span class="p">);</span>

<span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;simple arithmetic&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">assert</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">pyUtils</span><span class="p">.</span><span class="nx">py_eval</span><span class="p">(</span><span class="s2">&quot;1 + 2&quot;</span><span class="p">);</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">strictEqual</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;should properly evaluate sum&quot;</span><span class="p">);</span>
    <span class="nx">result</span> <span class="o">=</span> <span class="nx">pyUtils</span><span class="p">.</span><span class="nx">py_eval</span><span class="p">(</span><span class="s2">&quot;42 % 5&quot;</span><span class="p">);</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">strictEqual</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;should properly evaluate modulo operator&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Основной способ запустить набор тестов - запустить работающий сервер Odoo, а затем перейти в веб-браузер к `` / web / tests``. Затем набор тестов будет выполнен движком Javascript веб-браузера.</p><img src="../_images/tests.png" class="center-block img-responsive"><p >Веб-интерфейс имеет много полезных функций: он может запускать только некоторые подмодули или фильтровать тесты, соответствующие строке. Он может показать все утверждения, неудачные или пройденные, перезапустить определенные тесты, …</p><div role="alert" class="alert alert-warning"><h3 class="alert-title">Предупреждение</h3><p >Во время работы набора тестов убедитесь, что:</p><ul ><li >окно вашего браузера сфокусировано,</li><li >он не увеличен / уменьшен. Он должен иметь ровно 100% уровень масштабирования.</li></ul><p >Если это не так, некоторые тесты не пройдут без надлежащего объяснения.</p></div></section><section id="testing-infrastructure"><h3 >Инфраструктура тестирования</h3><p >Вот краткий обзор самых важных частей инфраструктуры тестирования:</p><ul ><li >есть пакет ресурсов с именем <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/views/webclient_templates.xml#L427" class="external reference">web.js_tests_assets</a>. Этот пакет содержит основной код (общие ресурсы + бэкэнд ресурсов), некоторые библиотеки, средство выполнения тестов QUnit и дополнительный вспомогательный код</li><li >другой пакет ресурсов, <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/views/webclient_templates.xml#L509" class="external reference">web.qunit_suite</a>, содержит все тесты (и код js_tests_assets). Почти все тестовые файлы должны быть добавлены в этот комплект</li><li >в сети есть <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/controllers/main.py#L637" class="external reference">controller</a>, сопоставленный с маршрутом * / web / tests <a href="#id1"><span id="id2" class="problematic">*</span></a>. Этот контроллер просто отображает шаблон * web.qunit_suite <a href="#id3"><span id="id4" class="problematic">*</span></a>.</li><li >чтобы выполнить тесты, можно просто указать браузеру маршрут * / web / tests <a href="#id1"><span id="id2" class="problematic">*</span></a>. В этом случае браузер загрузит все ресурсы, и QUnit вступит во владение.</li><li >в <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/qunit_config.js#L49" class="external reference">qunit_config.js</a> есть некоторый код, который регистрирует в консоли некоторую информацию, когда тест проходит или не проходит.</li><li >мы хотим, чтобы runbot также запускал эти тесты, поэтому есть тест (в <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/tests/test_js.py#L13" class="external reference">test_js.py</a>), который просто порождает браузер и указывает его на URL * web / tests <a href="#id1"><span id="id2" class="problematic">*</span></a>. Обратите внимание, что метод phantom_js порождает не phantom_js, а Chrome без заголовка.</li></ul></section><section id="modularity-and-testing"><h3 >Модульность и тестирование</h3><p >Благодаря тому, как Odoo разработан, любой аддон может изменять поведение других частей системы. Например, дополнение * voip * может изменить виджет * FieldPhone * для использования дополнительных функций. Это не очень хорошо с точки зрения системы тестирования, так как это означает, что тест в сети аддонов будет провален всякий раз, когда аддон voip установлен (обратите внимание, что runbot запускает тесты со всеми установленными аддонами).</p><p >В то же время, наша система тестирования хороша, потому что она может обнаруживать, когда другой модуль нарушает некоторые основные функции. Нет полного решения этой проблемы. Сейчас мы решаем это в каждом конкретном случае.</p><p >Обычно не стоит менять какое-либо другое поведение. В нашем примере с voip лучше добавить новый виджет * FieldVOIPPhone * и изменить несколько представлений, которым он нужен. Таким образом, виджет * FieldPhone * не затрагивается, и оба могут быть протестированы.</p></section><section id="adding-a-new-test-case"><h3 >Добавление нового теста</h3><p >Предположим, что мы поддерживаем аддон * my_addon * и хотим добавить тест для некоторого кода JavaScript (например, некоторой служебной функции myFunction, расположенной в * my_addon.utils <a href="#id1"><span id="id2" class="problematic">*</span></a>). Процесс добавления нового контрольного примера следующий:</p><ol ><li ><p >создайте новый файл * my_addon / static / tests / utils_tests.js <a href="#id1"><span id="id2" class="problematic">*</span></a>. Этот файл содержит основной код для добавления модуля QUnit * my_addon&amp;gt; utils <a href="#id3"><span id="id4" class="problematic">*</span></a>.</p><blockquote ><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;my_addon.utils_tests&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">require</span><span class="p">)</span> <span class="p">{</span>
<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">utils</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;my_addon.utils&#39;</span><span class="p">);</span>

<span class="nx">QUnit</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;my_addon&#39;</span><span class="p">,</span> <span class="p">{},</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;utils&#39;</span><span class="p">);</span>

<span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
</blockquote></li><li ><p >В * my_addon / assets.xml * добавьте файл в основные тестовые ресурсы:</p><blockquote ><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;odoo&gt;</span>
    <span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">&quot;qunit_suite&quot;</span> <span class="na">name=</span><span class="s">&quot;my addon tests&quot;</span> <span class="na">inherit_id=</span><span class="s">&quot;web.qunit_suite&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xpath</span> <span class="na">expr=</span><span class="s">&quot;//script[last()]&quot;</span> <span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;/my_addon/static/tests/utils_tests.js&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/xpath&gt;</span>
    <span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/odoo&gt;</span>
</pre></div>
</div>
</blockquote></li><li >Перезапустите сервер и обновите * my_addon * или сделайте это из интерфейса (чтобы убедиться, что новый тестовый файл загружен)</li><li ><p >Добавьте тестовый пример после определения набора субтестов * utils <a href="#id1"><span id="id2" class="problematic">*</span></a>:</p><blockquote ><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s2">&quot;some test case that we want to test&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">assert</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">myFunction</span><span class="p">(</span><span class="nx">someArgument</span><span class="p">);</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">strictEqual</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">expectedResult</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</blockquote></li><li >Посетите * / web / tests / <a href="#id1"><span id="id2" class="problematic">*</span></a>, чтобы убедиться, что тест выполнен</li></ol></section><section id="helper-functions-and-specialized-assertions"><h3 >Вспомогательные функции и специализированные утверждения</h3><p >Без помощи довольно сложно протестировать некоторые части Odoo. В частности, представления являются хитрыми, потому что они взаимодействуют с сервером и могут выполнять много операций rpcs, которые необходимо смоделировать. Вот почему мы разработали некоторые специализированные вспомогательные функции, расположенные в <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/test_utils.js" class="external reference">test_utils.js</a>.</p><ul ><li >Тестовые функции: эти функции помогают настроить тестовую среду. Наиболее важным вариантом использования является насмешка над ответами, данными сервером Odoo. Эти функции используют <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/mock_server.js" class="external reference">mock server</a>. Это класс javascript, который имитирует ответы на наиболее распространенные методы модели: read, search_read, nameget, …</li><li >Помощники DOM: полезны для имитации событий / действий для определенной цели. Например, testUtils.dom.click выполняет щелчок по цели. Обратите внимание, что это безопаснее, чем делать это вручную, поскольку он также проверяет, что цель существует и видна.</li><li >создавать помощников: они, вероятно, являются наиболее важными функциями, экспортируемыми <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/test_utils.js" class="external reference">test_utils.js</a>. Эти помощники полезны для создания виджетов, с имитацией среды и множеством мелких деталей, чтобы максимально симулировать реальные условия. Самое важное, безусловно, <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/test_utils_create.js#L267" class="external reference">createView</a>.</li><li ><a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/qunit_asserts.js" class="external reference">qunit assertions</a>: QUnit может быть расширен специальными утверждениями. Для Odoo мы часто тестируем некоторые свойства DOM. Вот почему мы сделали некоторые утверждения, чтобы помочь с этим. Например, утверждение * containsOnce * принимает виджет / jQuery / HtmlElement и селектор, а затем проверяет, содержит ли цель одно совпадение с селектором css.</li></ul><p >Например, с этими помощниками вот как может выглядеть простой тест формы:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;simple group rendering&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">assert</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">testUtils</span><span class="p">.</span><span class="nx">createView</span><span class="p">({</span>
        <span class="nx">View</span><span class="o">:</span> <span class="nx">FormView</span><span class="p">,</span>
        <span class="nx">model</span><span class="o">:</span> <span class="s1">&#39;partner&#39;</span><span class="p">,</span>
        <span class="nx">data</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
        <span class="nx">arch</span><span class="o">:</span> <span class="s1">&#39;&lt;form string=&quot;Partners&quot;&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;group&gt;&#39;</span> <span class="o">+</span>
                    <span class="s1">&#39;&lt;field name=&quot;foo&quot;/&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;/group&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;/form&gt;&#39;</span><span class="p">,</span>
        <span class="nx">res_id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">});</span>

    <span class="nx">assert</span><span class="p">.</span><span class="nx">containsOnce</span><span class="p">(</span><span class="nx">form</span><span class="p">,</span> <span class="s1">&#39;table.o_inner_group&#39;</span><span class="p">);</span>

    <span class="nx">form</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Обратите внимание на использование хелпера testUtils.createView и утверждения containsOnce. Кроме того, контроллер формы был должным образом уничтожен в конце теста.</p></section><section id="best-practices"><h3 >Лучшие практики</h3><p >В произвольном порядке:</p><ul ><li >все тестовые файлы должны быть добавлены в * some_addon / static / tests / *</li><li >для исправления ошибок убедитесь, что тест не пройден без исправления ошибки, и проходит с ним. Это гарантирует, что это на самом деле работает.</li><li >старайтесь иметь минимальный объем кода, необходимый для работы теста.</li><li >обычно два маленьких теста лучше, чем один большой. Меньший тест легче понять и исправить.</li><li >всегда убирайте после теста. Например, если ваш тест создает экземпляр виджета, он должен уничтожить его в конце.</li><li >нет необходимости иметь полное и полное покрытие кода. Но добавление нескольких тестов очень помогает: оно гарантирует, что ваш код не полностью сломан, и всякий раз, когда ошибка исправлена, действительно намного проще добавить тест в существующий набор тестов.</li><li >если вы хотите проверить некоторое отрицательное утверждение (например, что HtmlElement не имеет определенного класса css), то попробуйте добавить положительное утверждение в том же тесте (например, выполнив действие, которое изменяет состояние). Это поможет избежать смерти теста в будущем (например, при изменении класса css).</li></ul></section><section id="tips"><h3 >подсказки</h3><ul ><li >запуск только одного теста: вы можете (временно!) изменить определение * QUnit.test (…) * на * QUnit.only (…) <a href="#id1"><span id="id2" class="problematic">*</span></a>. Это полезно, чтобы убедиться, что QUnit запускает только этот конкретный тест.</li><li >флаг отладки: большинство служебных функций создания имеют режим отладки (активируется параметром debug: true). В этом случае целевой виджет будет помещен в DOM вместо специального скрытого прибора Qunit, и будет записано больше информации. Например, все смоделированные сетевые коммуникации будут доступны в консоли.</li><li >при работе над ошибочным тестом обычно добавляют флаг отладки, а затем комментируют конец теста (в частности, вызов destroy). Благодаря этому можно напрямую видеть состояние виджета и, что еще лучше, управлять им, щелкая / взаимодействуя с ним.</li></ul></section><section id="integration-testing"><h2 >Интеграционное тестирование</h2><p >Тестирование кода Python и кода JS по отдельности очень полезно, но это не доказывает, что веб-клиент и сервер работают вместе. Для этого мы можем написать еще один вид теста: туры. Тур - это мини-сценарий интересного делового потока. Это объясняет последовательность шагов, которые должны быть выполнены. Затем организатор теста создаст браузер phantom_js, укажет ему правильный URL-адрес и смоделирует щелчок и ввод данных в соответствии со сценарием.</p></section><section id="screenshots-and-screencasts-during-browser-js-tests"><h3 >Скриншоты и скриншоты во время тестов browser_js</h3><p >При запуске тестов, использующих HttpCase.browser_js из командной строки, браузер Chrome используется в автономном режиме. По умолчанию, если тест не пройден, снимок экрана PNG берется в момент сбоя и записывается в</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">&#39;/tmp/odoo_tests/{db_name}/screenshots/&#39;</span>
</pre></div>
</div>
<p >С Odoo 13.0 были добавлены два новых аргумента командной строки для управления этим поведением:: option: <code >--screenshots &lt;odoo-bin --screenshots&gt; `и: опция:</code> –screencasts &lt;odoo-bin –screencasts&gt; `</p></section>

          </article>
        </div>
        
        <div id="mask"></div>
      </main>
  </div>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
<!-- 
  <footer>
    <div id="footer" class="container">
      <span class="o_logo o_logo_inverse center-block o_footer_logo"></span>
      <div class="row">
        <div class="col-sm-7 col-md-7 col-lg-6">
          <div class="row">
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Community</span>
              <ul>
                <li><a href="https://github.com/odoo/odoo">Github</a></li>
                <li><a href="http://www.odoo.com/page/download">Download</a></li>
                <li class="divider"></li>
                <li><a href="http://runbot.odoo.com/runbot/repo/git-github-com-odoo-enterprise-7">Runbot</a></li>
                <li><a href="https://github.com/odoo/odoo/wiki/Translations">Translations</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/odoo-community">Mailing Lists</a></li>
                <li><a href="http://www.odoo.com/forum/help-1">Forum</a></li>
              </ul>
            </div>
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Services</span>
              <ul>
                <li><a href="https://www.odoo.sh">Odoo Cloud Platform</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/help">Support</a></li>
                <li><a href="https://upgrade.odoo.com">Upgrade</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/partners">Find a partner</a></li>
                <li><a href="http://www.odoo.com/page/become-a-partner">Become a partner</a></li>
                <li class="divider"></li>
                <li><a href="http://training.odoo.com/courses/odoo-functional">Training Center</a></li>
                <li><a href="http://www.odoo.com/page/education-program">Education</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/security">Security</a></li>
              </ul>
            </div>
            <div class="col-xs-12 col-sm-4 mb64">
              <span class="menu_title">About us</span>
              <ul>
                <li><a href="http://www.odoo.com/page/about-us">Our company</a></li>
                <li><a href="http://www.odoo.com/page/contactus">Contact</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/event">Events</a></li>
                <li><a href="http://www.odoo.com/blog">Blog</a></li>
                <li><a href="http://www.odoo.com/blog/6">Customers</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/jobs">Jobs</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/page/legal">Legal</a> | <a href="http://www.odoo.com/privacy">Privacy</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-5 col-md-4 col-md-offset-1 col-lg-5 col-lg-offset-1">
          <p>
            <small>
              Odoo is a suite of open source business apps that cover all your company needs: CRM, eCommerce, accounting, inventory, point of sale, project management, etc.
              <br/><br/>
              Odoo's unique value proposition is to be at the same time very easy to use and fully integrated.
            </small>
          </p>
        </div>
      </div>
    </div>
    <div class="o_footer_bottom">
      <div class="container">
        <a class="small" href="http://www.odoo.com/page/website-builder">Website made with <span class="o_logo o_logo_inverse o_logo_15"></span></a>
        <div class="social-links pull-right">
          <a href="http://www.odoo.com/web/about/facebook"><i class="fa fa-facebook"></i></a>
          <a href="http://www.odoo.com/web/about/twitter"><i class="fa fa-twitter"></i></a>
          <a href="http://www.odoo.com/web/about/linkedin"><i class="fa fa-linkedin"></i></a>
          <a href="mailto:info@odoo.com"><i class="fa fa-envelope"></i></a>
        </div>
      </div>
    </div>
  </footer>
  -->
  </body>
</html>