<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Work+Sans:500,600" rel="stylesheet">
  
    <title>Javascript Cheatsheet &#8212; Документация odoo 13.0</title>
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/patchqueue.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script><link rel="canonical" href="" />
  
    <link rel="index" title="Алфавитный указатель" href="../genindex.html" />
    <link rel="search" title="Поиск" href="../search.html" />
    <link rel="next" title="Ссылка на JavaScript" href="javascript_reference.html" />
    <link rel="prev" title="Qweb" href="qweb.html" /> 
  </head><body><header class="o_main_header o_has_sub_nav o_inverted ">
<!-- 
    <div class="o_main_header_main">
      <a class="pull-left o_logo" href="/"></a>
      <a href="#" class="o_mobile_menu_toggle visible-xs-block pull-right">
        <span class="sr-only">Toggle navigation</span>
        <span class="mdi-navigation-menu"></span>
      </a>
      <div class="o_header_buttons">
        <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
      </div>
      <ul class="o_primary_nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Apps</a>
          <div class="dropdown-menu o_secondary_nav">
            <div class="container">
              <div class="row">
                <div class="col-sm-3 o_website_apps">
                  <div class="o_nav_app_family">
                    <span></span> Websites
                    <div>Build great user experience</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/website-builder">Website Builder</a></li>
                    <li><a href="https://www.odoo.com/page/e-commerce">eCommerce</a></li>
                    <li><a href="https://www.odoo.com/page/blog-engine">Blogs</a></li>
                    <li><a href="https://www.odoo.com/page/community-builder">Forums</a></li>
                    <li><a href="https://www.odoo.com/page/slides">Slides</a></li>
                    <li><a href="https://adspike.odoo.com">SEA</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_sale_apps">
                  <div class="o_nav_app_family">
                    <span></span> Sales
                    <div>Boost your success rate</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/sales">Sales</a></li>
                    <li><a href="https://www.odoo.com/page/crm">CRM</a></li>
                    <li><a href="https://www.odoo.com/page/billing">Invoicing</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Point of Sale</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/point-of-sale">Shops</a></li>
                        <li><a href="https://www.odoo.com/page/pos-restaurant">Restaurants</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/subscriptions">Subscriptions</a></li>
                    <li><a href="https://www.odoo.com/page/sign">Sign</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_operation_apps">
                  <div class="o_nav_app_family">
                    <span></span> Operations
                    <div>It's all about efficiency</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/accounting">Accounting</a></li>
                    <li><a href="https://www.odoo.com/page/project-management">Project</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Human Resources</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/recruitment">Recruitment</a></li>
                        <li><a href="https://www.odoo.com/page/employees">Employees</a></li>
                        <li><a href="https://www.odoo.com/page/expenses">Expenses</a></li>
                        <li><a href="https://www.odoo.com/page/appraisal">Appraisal</a></li>
                        <li><a href="https://www.odoo.com/page/fleet">Fleet</a></li>
                        <li><a href="https://www.odoo.com/page/leaves">Leaves</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/warehouse">Inventory</a></li>
                    <li><a href="https://www.odoo.com/page/purchase">Purchase</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Manufacturing</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/manufacturing">MRP</a></li>
                        <li><a href="https://www.odoo.com/page/plm">PLM</a></li>
                        <li><a href="https://www.odoo.com/page/maintenance">Maintenance</a></li>
                        <li><a href="https://www.odoo.com/page/quality">Quality</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-sm-3 o_productivity_apps">
                  <div class="o_nav_app_family">
                    <span></span> Productivity Tools
                    <div>Great Tools = Happy People</div>
                  </div>
                  <ul>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Communication</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/discuss">Discuss</a></li>
                        <li><a href="https://www.odoo.com/page/discuss-groups">Mailing Lists</a></li>
                        <li><a href="https://www.odoo.com/page/notes">Notes</a></li>
                        <li><a href="#">Help desk</a></li>
                        <li><a href="#">Appointment</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/timesheet">Timesheet</a></li>
                    <li><a href="https://www.odoo.com/page/email-marketing">Email Marketing</a></li>
                    <li><a href="https://www.odoo.com/page/events">Events</a></li>
                    <li><a href="https://www.odoo.com/page/survey">Survey</a></li>
                    <li><a href="https://www.odoo.com/page/live-chat">Live Chat</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <a href="http://www.odoo.com/apps/modules" class="o_store_link"><i class="fa fa-cube fa-fw"></i> Third party apps</a>
          </div>
        </li>
        <li><a href="https://www.odoo.com/page/tour">Tour</a></li>
        <li><a href="https://www.odoo.com/pricing">Pricing</a></li>
        <li><a href="https://www.odoo.com/page/docs">Docs</a></li>
      </ul>
    </div>
-->
    <nav class="navbar o_sub_nav">
      <div class="container">
        <div class="navbar-header visible-xs">
            <button type="button" class="navbar-toggle collapsed text-left btn-block" data-toggle="collapse" data-target="#o_sub-menu" aria-expanded="false">
              Navigate
              <span class="mdi-hardware-keyboard-arrow-down pull-right"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="o_sub-menu">
          <ol class="o_breadcrumb breadcrumb nav navbar-left">
              
              





    
        
            <li><a href="../index.html">Developer Doc</a></li>
        
    
    <li class="active"><a href="#">Javascript Cheatsheet</a></li>

              
          </ol>

          <div class="call-to-action navbar-right hidden-xs">
            <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
          </div>

          <ul class="navbar-nav navbar-right nav o_sub_nav_actions">
            
              <li class="divider"></li>
            

            
            


            
          </ul>

          <ul class="nav navbar-nav navbar-right">
            

            
            
<!--
<li><a href="https://www.odoo.com/documentation/user/13.0/index.html">User</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/index.html">Developer</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/setup/install.html">Installation</a></li>
<li><a href="https://odoo.com/slides">eLearning</a></li>
<li><a href="https://www.odoo.com/page/odoo-white-paper">White Papers</a></li>
<li><a href="https://www.odoo.com/page/legal">Legal</a></li>
-->
            

            
          </ul>
        </div>
      </div>
    </nav>
  </header><div id="wrap" class="">
    
    
    
    <figure class="card top has_banner">
      <span class="card-img" style="background-image: url('../_static/banners/javascript.jpg');"></span>
      <div class="container text-center">
        <h1> Javascript Cheatsheet </h1>
      </div>
    </figure>
    
    
    
      <main class="container ">
        
        <div class="o_content row">
          
          <aside>
            <div class="navbar-aside text-center">
              <ul class="nav list-group text-left"><li class="list-group-item"><a href="#creating-a-new-field-widget" class="reference internal ripple">Создание нового виджета поля</a></li><li class="list-group-item"><a href="#modifying-an-existing-field-widget" class="reference internal ripple">Изменение существующего виджета поля</a></li><li class="list-group-item"><a href="#modifying-a-main-widget-from-the-interface" class="reference internal ripple">Модификация основного виджета из интерфейса</a></li><li class="list-group-item"><a href="#creating-a-new-view-from-scratch" class="reference internal ripple">Создание нового вида (с нуля)</a></li><li class="list-group-item"><a href="#customizing-an-existing-view" class="reference internal ripple">Настройка существующего представления</a></li><li class="list-group-item"><a href="#promises-and-asynchronous-code" class="reference internal ripple">Обещания и асинхронный код</a><ul ><li class="list-group-item"><a href="#creating-new-promises" class="reference internal ripple">Создание новых обещаний</a></li><li class="list-group-item"><a href="#waiting-for-promises" class="reference internal ripple">В ожидании обещаний</a></li><li class="list-group-item"><a href="#error-handling" class="reference internal ripple">Обработка ошибок</a></li><li class="list-group-item"><a href="#testing-asynchronous-code" class="reference internal ripple">Тестирование асинхронного кода</a></li></ul></li></ul>
              
              <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/13.0/doc/reference/javascript_cheatsheet.rst" class="gith-link">
                  Edit on GitHub
              </a></p>
              
            </div>
          </aside>
          
          <article class="doc-body ">
            
            
  <section id="javascript-cheatsheet"><i id="reference-jscs"></i><p >Есть много способов решить проблему как в JavaScript, так и в Odoo. Тем не менее, инфраструктура Odoo была разработана, чтобы быть расширяемой (это довольно большое ограничение), и некоторые распространенные проблемы имеют хорошее стандартное решение. Стандартное решение, вероятно, имеет то преимущество, что его легко понять разработчикам odoo, и, вероятно, оно будет продолжать работать после модификации Odoo.</p><p >Этот документ пытается объяснить, как можно решить некоторые из этих проблем. Обратите внимание, что это не ссылка. Это просто случайная коллекция рецептов или объяснения того, как действовать в некоторых случаях.</p><p >Прежде всего, помните, что первое правило настройки odoo с помощью JS: * попробуйте сделать это в python <a href="#id1"><span id="id2" class="problematic">*</span></a>. Это может показаться странным, но среда Python достаточно расширяема, и многие варианты поведения могут быть реализованы просто с помощью xml или python. Это обычно имеет более низкую стоимость обслуживания, чем работа с JS:</p><ul ><li >среда JS имеет тенденцию меняться больше, поэтому код JS необходимо чаще обновлять</li><li >часто бывает сложнее реализовать настраиваемое поведение, если ему необходимо взаимодействовать с сервером и должным образом интегрироваться в инфраструктуру javascript. Фреймворк требует много мелких деталей, которые нужно реплицировать в настраиваемом коде. Например, отзывчивость, или обновление URL, или отображение данных без мерцания.</li></ul><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Этот документ на самом деле не объясняет никаких понятий. Это больше поваренная книга. Для более подробной информации, пожалуйста, обратитесь к справочной странице по javascript (см . <a href="javascript_reference.html" class="alert-link reference internal"><span class="doc">Ссылка на JavaScript</span></a>)</p></div></section><section id="creating-a-new-field-widget"><h2 >Создание нового виджета поля</h2><p >Вероятно, это очень распространенный сценарий использования: мы хотим отображать некоторую информацию в виде формы действительно конкретным (возможно, бизнес-зависимым) способом. Например, предположим, что мы хотим изменить цвет текста в зависимости от бизнес-условий.</p><p >Это можно сделать в три этапа: создать новый виджет, зарегистрировать его в реестре полей, затем добавить виджет в поле в представлении формы.</p><ul ><li ><dl ><dt >Создание нового виджета:</dt><dd ><p >Это можно сделать, расширив виджет:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">FieldChar</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.basic_fields&#39;</span><span class="p">).</span><span class="nx">FieldChar</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">CustomFieldChar</span> <span class="o">=</span> <span class="nx">FieldChar</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">_renderReadonly</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// implement some custom logic here</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >зарегистрировать его в полевом реестре:</dt><dd ><p >Веб-клиент должен знать соответствие между именем виджета и его фактическим классом. Это делается реестром:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">fieldRegistry</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.field_registry&#39;</span><span class="p">);</span>

<span class="nx">fieldRegistry</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;my-custom-field&#39;</span><span class="p">,</span> <span class="nx">CustomFieldChar</span><span class="p">);</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >добавление виджета в виде формы</dt><dd ><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;somefield&quot;</span> <span class="na">widget=</span><span class="s">&quot;my-custom-field&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p >Обратите внимание, что только поля формы, списка и представления kanban используют это поле реестра виджетов. Эти представления тесно интегрированы, поскольку представления списка и канбана могут отображаться внутри представления формы).</p></dd></dl></li></ul></section><section id="modifying-an-existing-field-widget"><h2 >Изменение существующего виджета поля</h2><p >Другой вариант использования - мы хотим изменить существующий виджет поля. Например, аддон voip в odoo должен изменить виджет FieldPhone, чтобы добавить возможность легко звонить по указанному номеру в voip. Это делается путем * включения * виджета FieldPhone, поэтому нет необходимости изменять какой-либо существующий вид формы.</p><p >Виджеты полей (экземпляры (подкласса) AbstractField), как и все остальные виджеты, могут быть исправлены обезьянами. Это выглядит так:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">basic_fields</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.basic_fields&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Phone</span> <span class="o">=</span> <span class="nx">basic_fields</span><span class="p">.</span><span class="nx">FieldPhone</span><span class="p">;</span>

<span class="nx">Phone</span><span class="p">.</span><span class="nx">include</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">Phone</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">events</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;click&#39;</span><span class="o">:</span> <span class="s1">&#39;_onClick&#39;</span><span class="p">,</span>
    <span class="p">}),</span>

    <span class="nx">_onClick</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mode</span> <span class="o">===</span> <span class="s1">&#39;readonly&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">phoneNumber</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="c1">// call the number on voip...</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Обратите внимание, что нет необходимости добавлять виджет в реестр, так как он уже зарегистрирован.</p></section><section id="modifying-a-main-widget-from-the-interface"><h2 >Модификация основного виджета из интерфейса</h2><p >Другим распространенным вариантом использования является необходимость настройки некоторых элементов из пользовательского интерфейса. Например, добавив сообщение в домашнее меню. Обычный процесс в этом случае снова включает * включение * виджета. Это единственный способ сделать это, поскольку для этих виджетов нет реестров.</p><p >Обычно это делается с помощью кода, похожего на это:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">HomeMenu</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web_enterprise.HomeMenu&#39;</span><span class="p">);</span>

<span class="nx">HomeMenu</span><span class="p">.</span><span class="nx">include</span><span class="p">({</span>
    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="c1">// do something else here...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</section><section id="creating-a-new-view-from-scratch"><h2 >Создание нового вида (с нуля)</h2><p >Создание нового представления - более сложная тема. Эта таблица будет только подсвечивать шаги, которые, вероятно, нужно будет выполнить (без определенного порядка):</p><ul ><li ><p >добавление нового типа представления в поле `` type`` из `` ir.ui.view``</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">View</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;ir.ui.view&#39;</span>

    <span class="nb">type</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">selection_add</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="s2">&quot;Map&quot;</span><span class="p">)])</span>
</pre></div>
</div>
</li><li ><p >добавление нового типа представления в поле `` view_mode`` `` ir.actions.act_window.view``</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ActWindowView</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;ir.actions.act_window.view&#39;</span>

    <span class="n">view_mode</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">selection_add</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="s2">&quot;Map&quot;</span><span class="p">)])</span>
</pre></div>
</div>
</li><li ><dl ><dt >Создание четырех основных частей, из которых создается представление (в JavaScript):</dt><dd ><p >нам нужно представление (подкласс `` AbstractView``, это фабрика), средство визуализации (из `` AbstractRenderer``), контроллер (из `` AbstractController``) и модель (из `` AbstractModel` <a href="#id1"><span id="id2" class="problematic">`</span></a>). Я предлагаю начать с простого расширения суперклассов:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">AbstractController</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.AbstractController&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">AbstractModel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.AbstractModel&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">AbstractRenderer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.AbstractRenderer&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">AbstractView</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.AbstractView&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">MapController</span> <span class="o">=</span> <span class="nx">AbstractController</span><span class="p">.</span><span class="nx">extend</span><span class="p">({});</span>
<span class="kd">var</span> <span class="nx">MapRenderer</span> <span class="o">=</span> <span class="nx">AbstractRenderer</span><span class="p">.</span><span class="nx">extend</span><span class="p">({});</span>
<span class="kd">var</span> <span class="nx">MapModel</span> <span class="o">=</span> <span class="nx">AbstractModel</span><span class="p">.</span><span class="nx">extend</span><span class="p">({});</span>

<span class="kd">var</span> <span class="nx">MapView</span> <span class="o">=</span> <span class="nx">AbstractView</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">config</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">Model</span><span class="o">:</span> <span class="nx">MapModel</span><span class="p">,</span>
        <span class="nx">Controller</span><span class="o">:</span> <span class="nx">MapController</span><span class="p">,</span>
        <span class="nx">Renderer</span><span class="o">:</span> <span class="nx">MapRenderer</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >добавление представления в реестр:</dt><dd ><p >Как обычно, отображение между типом представления и фактическим классом должно быть обновлено:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">viewRegistry</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.view_registry&#39;</span><span class="p">);</span>

<span class="nx">viewRegistry</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="nx">MapView</span><span class="p">);</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >Реализация четырех основных классов:</dt><dd >Класс `` View`` должен проанализировать поле `` arch`` и настроить остальные три класса. «Renderer» отвечает за представление данных в пользовательском интерфейсе, а «Model» должен общаться с сервером, загружать данные и обрабатывать их. И `` Контроллер`` предназначен для координации, общения с веб-клиентом, …</dd></dl></li><li ><dl ><dt >создание некоторых представлений в базе данных:</dt><dd ><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;customer_map_view&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>customer.map.view<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>res.partner<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;map</span> <span class="na">latitude=</span><span class="s">&quot;partner_latitude&quot;</span> <span class="na">longitude=</span><span class="s">&quot;partner_longitude&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
</dd></dl></li></ul></section><section id="customizing-an-existing-view"><h2 >Настройка существующего представления</h2><p >Предположим, нам нужно создать собственную версию универсального представления. Например, представление канбан с некоторым дополнительным * ленточным * виджетом сверху (для отображения определенной пользовательской информации). В этом случае это можно сделать за 3 шага: расширить представление канбана (что также, вероятно, означает расширение контроллеров / визуализаторов и / или моделей), затем зарегистрировать представление в реестре представлений и, наконец, использовать представление в арке канбана. (конкретный пример - панель инструментов службы поддержки).</p><ul ><li ><dl ><dt >расширяя вид:</dt><dd ><p >Вот как это может выглядеть:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">HelpdeskDashboardRenderer</span> <span class="o">=</span> <span class="nx">KanbanRenderer</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="p">...</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">HelpdeskDashboardModel</span> <span class="o">=</span> <span class="nx">KanbanModel</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="p">...</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">HelpdeskDashboardController</span> <span class="o">=</span> <span class="nx">KanbanController</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="p">...</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">HelpdeskDashboardView</span> <span class="o">=</span> <span class="nx">KanbanView</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">config</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">KanbanView</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">config</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">Model</span><span class="o">:</span> <span class="nx">HelpdeskDashboardModel</span><span class="p">,</span>
        <span class="nx">Renderer</span><span class="o">:</span> <span class="nx">HelpdeskDashboardRenderer</span><span class="p">,</span>
        <span class="nx">Controller</span><span class="o">:</span> <span class="nx">HelpdeskDashboardController</span><span class="p">,</span>
    <span class="p">}),</span>
<span class="p">});</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >добавив его в реестр просмотра:</dt><dd ><p >как обычно, нам нужно проинформировать веб-клиента о сопоставлении имени представлений и фактического класса.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">viewRegistry</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.view_registry&#39;</span><span class="p">);</span>
<span class="nx">viewRegistry</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;helpdesk_dashboard&#39;</span><span class="p">,</span> <span class="nx">HelpdeskDashboardView</span><span class="p">);</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >используя его в реальном виде:</dt><dd ><p >Теперь нам нужно сообщить веб-клиенту, что конкретному `` ir.ui.view`` необходимо использовать наш новый класс. Обратите внимание, что это особая проблема веб-клиента. С точки зрения сервера у нас все еще есть представление о канбан. Правильный способ сделать это - использовать специальный атрибут `` js_class`` (который когда-нибудь будет переименован в `` widget``, потому что это действительно не очень хорошее имя) в корневом узле арки:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;helpdesk_team_view_kanban&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;kanban</span> <span class="na">js_class=</span><span class="s">&quot;helpdesk_dashboard&quot;</span><span class="nt">&gt;</span>
            ...
        <span class="nt">&lt;/kanban&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
</dd></dl></li></ul><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Примечание: вы можете изменить способ, которым представление интерпретирует структуру арки. Однако, с точки зрения сервера, это все еще вид того же базового типа, подчиняющийся тем же правилам (например, валидация rng). Таким образом, ваши представления все еще должны иметь правильное поле арки.</p></div></section><section id="promises-and-asynchronous-code"><h2 >Обещания и асинхронный код</h2><p >Для очень хорошего и полного введения в обещания, пожалуйста, прочитайте эту превосходную статью <a href="https://github.com/getify/You-Dont-Know-JS/blob/1st-ed/async%20%26%20performance/ch3.md" class="external reference">https://github.com/getify/You-Dont-Know-JS/blob/1st-ed/async%20%26%20performance/ch3.md</a></p></section><section id="creating-new-promises"><h3 >Создание новых обещаний</h3><ul ><li ><dl ><dt >превратить константу в обещание</dt><dd ><p >В Promise есть две статические функции, которые создают разрешенное или отклоненное обещание на основе константы:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span><span class="nx">blabla</span><span class="o">:</span> <span class="s1">&#39;1&#39;</span><span class="p">});</span> <span class="c1">// creates a resolved promise</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span> <span class="c1">// --&gt; {blabla: &#39;1&#39;};</span>
<span class="p">});</span>


<span class="kd">var</span> <span class="nx">p2</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">({</span><span class="nx">error</span><span class="o">:</span> <span class="s1">&#39;error message&#39;</span><span class="p">});</span> <span class="c1">// creates a rejected promise</span>
<span class="nx">p2</span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">reason</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">reason</span><span class="p">);</span> <span class="c1">// --&gt; {error: &#39;error message&#39;);</span>
<span class="p">});</span>
</pre></div>
</div>
<div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >Обратите внимание, что даже если обещания созданы уже разрешенными или отклоненными, обработчики <code >then</code> или` catch` будут по-прежнему вызываться асинхронно.</p></div></dd></dl></li><li ><dl ><dt >на основе уже асинхронного кода</dt><dd ><p >Предположим, что в функции вы должны выполнить rpc, и когда она будет завершена, установите результат для этого. This._rpc - это функция, которая возвращает Promise.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">callRpc</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rpc</span><span class="p">(...).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">myValueFromRpc</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >для функции обратного вызова</dt><dd ><p >Предположим, что вы использовали функцию <code >this.close</code>, которая принимает в качестве параметра обратный вызов, который вызывается по окончании закрытия. Теперь предположим, что вы делаете это в методе, который должен отправить обещание, которое разрешается после завершения закрытия.</p><div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">waitForClose</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="nx">resolve</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<ul ><li >строка 2: мы сохраняем this в переменную, чтобы во внутренней функции мы могли получить доступ к области действия нашего компонента</li><li ><dl ><dt >строка 3: мы создаем и возвращаем новое обещание. Конструктор обещания принимает функцию в качестве параметра. Эта функция сама имеет 2 параметра, которые мы назвали здесь <code >resol</code> и` reject`</dt><dd ><ul ><li ><code >resol</code> - это функция, которая при вызове переводит обещание в разрешенное состояние.</li><li ><code >reject</code> - это функция, которая при вызове переводит обещание в отклоненное состояние. Мы не используем отклонение здесь, и это может быть опущено.</li></ul></dd></dl></li><li >строка 4: мы вызываем функцию close для нашего объекта. Он принимает функцию в качестве параметра (обратный вызов), и случается, что resolved уже является функцией, поэтому мы можем передать ее напрямую. Чтобы быть более понятным, мы могли бы написать:</li></ul><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">resolve</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >создание генератора обещаний (вызов одного обещания за другим * в последовательности * и ожидание последнего)</dt><dd ><p >Предположим, вам нужно зациклить массив, выполнить операцию * в последовательности * и разрешить обещание, когда последняя операция будет выполнена.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">doStuffOnArray</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">done</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
    <span class="nx">arr</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">done</span> <span class="o">=</span> <span class="nx">done</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">item</span><span class="p">.</span><span class="nx">doSomethingAsynchronous</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">done</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p >Таким образом, обещание, которое вы возвращаете, фактически является последним обещанием.</p></dd></dl></li><li ><dl ><dt >создание обещания, а затем разрешение его вне рамок его определения (анти-шаблон)</dt><dd ><div role="alert" class="alert alert-info"><h3 class="alert-title">Примечание</h3><p >мы не рекомендуем использовать это, но иногда это полезно. Сначала тщательно продумайте альтернативы …</p></div><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="kd">var</span> <span class="nx">resolver</span><span class="p">,</span> <span class="nx">rejecter</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">prom</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">){</span>
    <span class="nx">resolver</span> <span class="o">=</span> <span class="nx">resolve</span><span class="p">;</span>
    <span class="nx">rejecter</span> <span class="o">=</span> <span class="nx">reject</span><span class="p">;</span>
<span class="p">});</span>
<span class="p">...</span>

<span class="nx">resolver</span><span class="p">(</span><span class="s2">&quot;done&quot;</span><span class="p">);</span> <span class="c1">// will resolve the promise prom with the result &quot;done&quot;</span>
<span class="nx">rejecter</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">);</span> <span class="c1">// will reject the promise prom with the reason &quot;error&quot;</span>
</pre></div>
</div>
</dd></dl></li></ul></section><section id="waiting-for-promises"><h3 >В ожидании обещаний</h3><ul ><li ><dl ><dt >в ожидании ряда обещаний</dt><dd ><p >если у вас есть несколько обещаний, которые все должны ждать, вы можете преобразовать их в одно обещание, которое будет разрешено, когда все обещания будут разрешены с помощью Promise.all (arrayOfPromises).</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">prom1</span> <span class="o">=</span> <span class="nx">doSomethingThatReturnsAPromise</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">prom2</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">constant</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">all</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">prom1</span><span class="p">,</span> <span class="nx">prom2</span><span class="p">,</span> <span class="nx">constant</span><span class="p">]);</span> <span class="c1">// all is a promise</span>
<span class="c1">// results is an array, the individual results correspond to the index of their</span>
<span class="c1">// promise as called in Promise.all()</span>
<span class="nx">all</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">prom1Result</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">prom2Result</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">constantResult</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">});</span>
<span class="k">return</span> <span class="nx">all</span><span class="p">;</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >ожидание части цепочки обещаний, но не другой части</dt><dd ><p >Если у вас есть асинхронный процесс, который вы хотите подождать, чтобы что-то сделать, но вы также хотите вернуться к вызывающей стороне, прежде чем что-то сделать.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">returnAsSoonAsAsyncProcessIsDone</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">prom</span> <span class="o">=</span> <span class="nx">AsyncProcess</span><span class="p">();</span>
    <span class="nx">prom</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">resultOfAsyncProcess</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">doSomething</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="cm">/* returns prom which will only wait for AsyncProcess(),</span>
<span class="cm">       and when it will be resolved, the result will be the one of AsyncProcess */</span>
    <span class="k">return</span> <span class="nx">prom</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl></li></ul></section><section id="error-handling"><h3 >Обработка ошибок</h3><ul ><li ><dl ><dt >в общем в обещаниях</dt><dd ><p >Общая идея заключается в том, что обещание не должно быть отклонено для потока управления, а должно быть отклонено только для ошибок. В этом случае у вас будет несколько разрешений вашего обещания с, например, кодами состояния, которые вы должны будете проверить в обработчиках <code >then</code> и одиночном обработчике` catch` в конце цепочки обещаний.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">a</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">x</span><span class="p">.</span><span class="nx">y</span><span class="p">();</span>  <span class="c1">// &lt;-- this is an error: x is undefined</span>
    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">b</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">a</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">);</span>           <span class="c1">// will log the error in a</span>
<span class="nx">a</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">b</span><span class="p">).</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">);</span>   <span class="c1">// will log the error in a, the then is not executed</span>
<span class="nx">b</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">);</span>           <span class="c1">// will log the rejected reason of b (2)</span>
<span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>                   <span class="c1">// the then is executed, it executes b</span>
       <span class="p">.</span><span class="nx">then</span><span class="p">(...)</span>                 <span class="c1">// this then is not executed</span>
       <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">);</span>       <span class="c1">// will log the rejected reason of b (2)</span>
</pre></div>
</div>
</dd></dl></li><li ><dl ><dt >в Оду конкретно</dt><dd ><p >В Odoo случается, что мы используем отклонение обещания для потока управления, как в мьютексах и других примитивах параллелизма, определенных в модуле <code >web.concurrency</code>. Мы также хотим выполнить перехват по причинам * business <a href="#id1"><span id="id2" class="problematic">*</span></a>, но не в случае ошибки кодирования в определении обещания или обработчиков. Для этого мы ввели понятие <code >guardedCatch</code>. Он вызывается как <code >catch</code>, но не тогда, когда отклоненная причина является ошибкой</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">blabla</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">someCondition</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="s2">&quot;someCondition is truthy&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// ...</span>

<span class="kd">var</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">blabla</span><span class="p">();</span>
<span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;everything went fine&quot;</span><span class="p">);</span> <span class="p">})</span>
<span class="c1">// this will be called if blabla returns a rejected promise, but not if it has an error</span>
<span class="nx">promise</span><span class="p">.</span><span class="nx">guardedCatch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">reason</span><span class="p">)</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">reason</span><span class="p">);</span> <span class="p">});</span>

<span class="c1">// ...</span>

<span class="kd">var</span> <span class="nx">anotherPromise</span> <span class="o">=</span>
        <span class="nx">blabla</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;everything went fine&quot;</span><span class="p">);</span> <span class="p">})</span>
                <span class="c1">// this will be called if blabla returns a rejected promise,</span>
                <span class="c1">// but not if it has an error</span>
                <span class="p">.</span><span class="nx">guardedCatch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">promiseWithError</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">x</span><span class="p">.</span><span class="nx">y</span><span class="p">();</span>  <span class="c1">// &lt;-- this is an error: x is undefined</span>
<span class="p">});</span>
<span class="nx">promiseWithError</span><span class="p">.</span><span class="nx">guardedCatch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">reason</span><span class="p">)</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">reason</span><span class="p">);});</span> <span class="c1">// will not be called</span>
<span class="nx">promiseWithError</span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">reason</span><span class="p">)</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">reason</span><span class="p">);});</span> <span class="c1">// will be called</span>
</pre></div>
</div>
</dd></dl></li></ul></section><section id="testing-asynchronous-code"><h3 >Тестирование асинхронного кода</h3><ul ><li ><dl ><dt >используя обещания в тестах</dt><dd ><p >В тестовом коде мы поддерживаем последнюю версию Javascript, включая примитивы, такие как <code >async</code> и` await`. Это делает использование и ожидание обещаний очень легким. Большинство вспомогательных методов также возвращают обещание (либо помечая как «async», либо возвращая обещание напрямую.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">testUtils</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.test_utils&#39;</span><span class="p">);</span>
<span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s2">&quot;My test&quot;</span><span class="p">,</span> <span class="nx">async</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">assert</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// making the function async has 2 advantages:</span>
    <span class="c1">// 1) it always returns a promise so you don&#39;t need to define `var done = assert.async()`</span>
    <span class="c1">// 2) it allows you to use the `await`</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">testUtils</span><span class="p">.</span><span class="nx">createView</span><span class="p">({</span> <span class="p">...</span> <span class="p">});</span>
    <span class="nx">await</span> <span class="nx">testUtils</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">clickEdit</span><span class="p">(</span><span class="nx">form</span><span class="p">);</span>
    <span class="nx">await</span> <span class="nx">testUtils</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="s1">&#39;jquery selector&#39;</span><span class="p">);</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">containsOnce</span><span class="p">(</span><span class="s1">&#39;jquery selector&#39;</span><span class="p">);</span>
    <span class="nx">form</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s2">&quot;My test - no async - no done&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">assert</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// this function is not async, but it returns a promise.</span>
    <span class="c1">// QUnit will wait for for this promise to be resolved.</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">testUtils</span><span class="p">.</span><span class="nx">createView</span><span class="p">({</span> <span class="p">...</span> <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">testUtils</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">clickEdit</span><span class="p">(</span><span class="nx">form</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">testUtils</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="s1">&#39;jquery selector&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">assert</span><span class="p">.</span><span class="nx">containsOnce</span><span class="p">(</span><span class="s1">&#39;jquery selector&#39;</span><span class="p">);</span>
                <span class="nx">form</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
            <span class="p">});</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>


<span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s2">&quot;My test - no async&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">assert</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// this function is not async and does not return a promise.</span>
    <span class="c1">// we have to use the done function to signal QUnit that the test is async and will be finished inside an async callback</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">done</span> <span class="o">=</span> <span class="nx">assert</span><span class="p">.</span><span class="nx">async</span><span class="p">();</span>

    <span class="nx">testUtils</span><span class="p">.</span><span class="nx">createView</span><span class="p">({</span> <span class="p">...</span> <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">testUtils</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">clickEdit</span><span class="p">(</span><span class="nx">form</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">testUtils</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="s1">&#39;jquery selector&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">assert</span><span class="p">.</span><span class="nx">containsOnce</span><span class="p">(</span><span class="s1">&#39;jquery selector&#39;</span><span class="p">);</span>
            <span class="nx">form</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
            <span class="nx">done</span><span class="p">();</span>
            <span class="p">});</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Как вы можете видеть, более приятной формой является использование <code >async / await</code>, так как это проще и короче писать.</p></dd></dl></li></ul></section>

          </article>
        </div>
        
        <div id="mask"></div>
      </main>
  </div>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
<!-- 
  <footer>
    <div id="footer" class="container">
      <span class="o_logo o_logo_inverse center-block o_footer_logo"></span>
      <div class="row">
        <div class="col-sm-7 col-md-7 col-lg-6">
          <div class="row">
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Community</span>
              <ul>
                <li><a href="https://github.com/odoo/odoo">Github</a></li>
                <li><a href="http://www.odoo.com/page/download">Download</a></li>
                <li class="divider"></li>
                <li><a href="http://runbot.odoo.com/runbot/repo/git-github-com-odoo-enterprise-7">Runbot</a></li>
                <li><a href="https://github.com/odoo/odoo/wiki/Translations">Translations</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/odoo-community">Mailing Lists</a></li>
                <li><a href="http://www.odoo.com/forum/help-1">Forum</a></li>
              </ul>
            </div>
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Services</span>
              <ul>
                <li><a href="https://www.odoo.sh">Odoo Cloud Platform</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/help">Support</a></li>
                <li><a href="https://upgrade.odoo.com">Upgrade</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/partners">Find a partner</a></li>
                <li><a href="http://www.odoo.com/page/become-a-partner">Become a partner</a></li>
                <li class="divider"></li>
                <li><a href="http://training.odoo.com/courses/odoo-functional">Training Center</a></li>
                <li><a href="http://www.odoo.com/page/education-program">Education</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/security">Security</a></li>
              </ul>
            </div>
            <div class="col-xs-12 col-sm-4 mb64">
              <span class="menu_title">About us</span>
              <ul>
                <li><a href="http://www.odoo.com/page/about-us">Our company</a></li>
                <li><a href="http://www.odoo.com/page/contactus">Contact</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/event">Events</a></li>
                <li><a href="http://www.odoo.com/blog">Blog</a></li>
                <li><a href="http://www.odoo.com/blog/6">Customers</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/jobs">Jobs</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/page/legal">Legal</a> | <a href="http://www.odoo.com/privacy">Privacy</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-5 col-md-4 col-md-offset-1 col-lg-5 col-lg-offset-1">
          <p>
            <small>
              Odoo is a suite of open source business apps that cover all your company needs: CRM, eCommerce, accounting, inventory, point of sale, project management, etc.
              <br/><br/>
              Odoo's unique value proposition is to be at the same time very easy to use and fully integrated.
            </small>
          </p>
        </div>
      </div>
    </div>
    <div class="o_footer_bottom">
      <div class="container">
        <a class="small" href="http://www.odoo.com/page/website-builder">Website made with <span class="o_logo o_logo_inverse o_logo_15"></span></a>
        <div class="social-links pull-right">
          <a href="http://www.odoo.com/web/about/facebook"><i class="fa fa-facebook"></i></a>
          <a href="http://www.odoo.com/web/about/twitter"><i class="fa fa-twitter"></i></a>
          <a href="http://www.odoo.com/web/about/linkedin"><i class="fa fa-linkedin"></i></a>
          <a href="mailto:info@odoo.com"><i class="fa fa-envelope"></i></a>
        </div>
      </div>
    </div>
  </footer>
  -->
  </body>
</html>